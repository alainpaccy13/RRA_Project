This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
backend/.gitignore
backend/blank.txt
backend/Tax_appeal_system/.gitattributes
backend/Tax_appeal_system/.gitignore
backend/Tax_appeal_system/.mvn/wrapper/maven-wrapper.properties
backend/Tax_appeal_system/docker-compose.yml
backend/Tax_appeal_system/Dockerfile
backend/Tax_appeal_system/mvnw
backend/Tax_appeal_system/mvnw.cmd
backend/Tax_appeal_system/pom.xml
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/AgendaController.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/AuthController.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/CommitteeController.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/ExplanatoryController.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/MeetingController.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/MeetingInfoContoller.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/MyCasesController.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/PreAppealController.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/UserController.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/VotingController.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/DashboardAnalyticsDto.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/AppealDetailsDTO.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/AuditedTaxDTO.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/ExplanatoryNoteDTO.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/LoginRequest.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/MeetingInfoDTO.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/RegisterUser.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/TokenRefreshRequest.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/UpdateUserRequest.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/VoteRequest.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/AgendaDTO.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/AppealDTO.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/AuthResponse.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/ExplanatoryNoteDTO.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/ExplanatoryNoteResponseDTO.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/GenericResponse.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/MyCaseDTO.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/TaxAuditedDTO.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/VoteResponse.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Email/AppealsInvitationRequest.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Email/EmailDetails.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Email/EmailServiceImpl.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Email/MeetingInfoService.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Enums/AppealStatus.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Enums/CaseStatus.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Enums/CommitteeGroup.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Enums/Privilege.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Enums/VoteDecision.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Exceptions/CaseNotFoundException.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Exceptions/DuplicateCaseSubmissionException.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Exceptions/GlobalExceptionHandler.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Exceptions/UserAlreadyExistsException.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/filters/JwtAuthFilter.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Models/Appeals.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Models/CaseInfo.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Models/CommitteeVote.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Models/MeetingInfo.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Models/MyCases.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Models/RefreshToken.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Models/TaxAudited.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Models/UserInfo.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Repositories/AppealsRepo.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Repositories/CaseInfoRepo.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Repositories/CommitteeVoteRepository.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Repositories/MeetingInfoRepo.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Repositories/MyCasesRepo.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Repositories/RefreshTokenRepository.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Repositories/TaxAuditedRepo.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Repositories/UserInfoRepo.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Security/CustomOAuth2AuthenticationSuccessHandler.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Security/SecurityConfig.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/AuthServices/AuthService.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/AuthServices/JwtService.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/ExplanatoryNoteService.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/GoogleCalendarService.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/MyCasesService.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/UserInfoDetails.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/UserInfoDetailsService.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/UserInfoService.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/VotingService.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/sms/SmsController.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/sms/SmsRequest.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/sms/SmsService.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/swagger/SwaggerConfig.java
backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/TaxAppealSystemApplication.java
backend/Tax_appeal_system/src/main/resources/application.properties
backend/Tax_appeal_system/src/main/resources/templates/invitationEmail.html
backend/Tax_appeal_system/src/test/java/org/RRA/tax_appeal_system/TaxAppealSystemApplicationTests.java
frontend/.gitignore
frontend/components.json
frontend/eslint.config.mjs
frontend/next.config.ts
frontend/package.json
frontend/postcss.config.mjs
frontend/public/file.svg
frontend/public/globe.svg
frontend/public/next.svg
frontend/public/profile-image.jpeg
frontend/public/profile.png
frontend/public/Rralogo.png
frontend/public/vercel.svg
frontend/public/window.svg
frontend/README.md
frontend/repomix-output.xml
frontend/src/app/admin/page.tsx
frontend/src/app/cases/all-cases/explanatory-note/page.tsx
frontend/src/app/cases/all-cases/page.tsx
frontend/src/app/cases/new-case/appealpoint/page.tsx
frontend/src/app/cases/new-case/page.tsx
frontend/src/app/cases/page.tsx
frontend/src/app/chat/page.tsx
frontend/src/app/favicon.ico
frontend/src/app/globals.css
frontend/src/app/layout.tsx
frontend/src/app/meetings/case-details/page.tsx
frontend/src/app/meetings/case-details/tax-type-details/[appealId]/page.tsx
frontend/src/app/meetings/case-details/tax-type-details/page.tsx
frontend/src/app/meetings/page.tsx
frontend/src/app/page.tsx
frontend/src/app/pre-appeal/page.tsx
frontend/src/app/profile/page.tsx
frontend/src/app/reports/new-minutes/page.tsx
frontend/src/app/reports/page.tsx
frontend/src/app/staff-login/page.tsx
frontend/src/app/staff-register/page.tsx
frontend/src/app/types/case.ts
frontend/src/app/types/meetingminutes.ts
frontend/src/app/types/minutes-mock-data.ts
frontend/src/app/types/mock-data.ts
frontend/src/app/vote/page.tsx
frontend/src/components/AdminGuard.tsx
frontend/src/components/AnalyticsDashboard.tsx
frontend/src/components/appealpoint.tsx
frontend/src/components/AppealPointDetails.tsx
frontend/src/components/AppealVote.tsx
frontend/src/components/attendance-list.tsx
frontend/src/components/authguard.tsx
frontend/src/components/case-analytics-chart.tsx
frontend/src/components/casedetails.tsx
frontend/src/components/cases.tsx
frontend/src/components/casesubmitted.tsx
frontend/src/components/explanatorynote.tsx
frontend/src/components/InvitationTemplateModal.tsx
frontend/src/components/meetingminutes.tsx
frontend/src/components/minutesform.tsx
frontend/src/components/navbar.tsx
frontend/src/components/preappealcases.tsx
frontend/src/components/profile.tsx
frontend/src/components/sidebar.tsx
frontend/src/components/taxForm.tsx
frontend/src/components/TaxTypeDetails.tsx
frontend/src/components/ui/avatar.tsx
frontend/src/components/ui/button.tsx
frontend/src/components/ui/calendar.tsx
frontend/src/components/ui/card.tsx
frontend/src/components/ui/checkbox.tsx
frontend/src/components/ui/dialog.tsx
frontend/src/components/ui/form.tsx
frontend/src/components/ui/input.tsx
frontend/src/components/ui/label.tsx
frontend/src/components/ui/pagination.tsx
frontend/src/components/ui/select.tsx
frontend/src/components/ui/shadcn-io/dropzone/index.tsx
frontend/src/components/ui/switch.tsx
frontend/src/components/ui/table.tsx
frontend/src/components/ui/textarea.tsx
frontend/src/components/vote.tsx
frontend/src/components/yourcases.tsx
frontend/src/lib/api.ts
frontend/src/lib/firebase.ts
frontend/src/lib/utils.ts
frontend/tsconfig.json
README.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="backend/.gitignore">
.idea
</file>

<file path="backend/Tax_appeal_system/.gitattributes">
/mvnw text eol=lf
*.cmd text eol=crlf
</file>

<file path="backend/Tax_appeal_system/.gitignore">
HELP.md
target/
.mvn/wrapper/maven-wrapper.jar
!**/src/main/**/target/
!**/src/test/**/target/

### STS ###
.apt_generated
.classpath
.factorypath
.project
.settings
.springBeans
.sts4-cache

### IntelliJ IDEA ###
.idea
*.iws
*.iml
*.ipr

### NetBeans ###
/nbproject/private/
/nbbuild/
/dist/
/nbdist/
/.nb-gradle/
build/
!**/src/main/**/build/
!**/src/test/**/build/

### VS Code ###
.vscode/
</file>

<file path="backend/Tax_appeal_system/.mvn/wrapper/maven-wrapper.properties">
wrapperVersion=3.3.4
distributionType=only-script
distributionUrl=https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.9.11/apache-maven-3.9.11-bin.zip
</file>

<file path="backend/Tax_appeal_system/docker-compose.yml">
version: '3.8'
services:
  db:
    image: postgres:16
    environment:
      POSTGRES_DB: tax_claim_system
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres@123
    ports:
      - "5432:5432"
  app:
    build: .
    ports:
      - "8084:8084"
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://db:5432/tax_claim_system
      SPRING_DATASOURCE_USERNAME: postgres
      SPRING_DATASOURCE_PASSWORD: postgres@123
    depends_on:
      - db
</file>

<file path="backend/Tax_appeal_system/Dockerfile">
# Dockerfile
FROM maven:3.9.9-amazoncorretto-21 AS build
WORKDIR /app
COPY . .
RUN mvn clean package -DskipTests

FROM amazoncorretto:21-alpine
WORKDIR /app
COPY --from=build /app/target/*.jar app.jar
ENTRYPOINT ["java", "-jar", "app.jar"]
</file>

<file path="backend/Tax_appeal_system/mvnw">
#!/bin/sh
# ----------------------------------------------------------------------------
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------
# Apache Maven Wrapper startup batch script, version 3.3.4
#
# Optional ENV vars
# -----------------
#   JAVA_HOME - location of a JDK home dir, required when download maven via java source
#   MVNW_REPOURL - repo url base for downloading maven distribution
#   MVNW_USERNAME/MVNW_PASSWORD - user and password for downloading maven
#   MVNW_VERBOSE - true: enable verbose log; debug: trace the mvnw script; others: silence the output
# ----------------------------------------------------------------------------

set -euf
[ "${MVNW_VERBOSE-}" != debug ] || set -x

# OS specific support.
native_path() { printf %s\\n "$1"; }
case "$(uname)" in
CYGWIN* | MINGW*)
  [ -z "${JAVA_HOME-}" ] || JAVA_HOME="$(cygpath --unix "$JAVA_HOME")"
  native_path() { cygpath --path --windows "$1"; }
  ;;
esac

# set JAVACMD and JAVACCMD
set_java_home() {
  # For Cygwin and MinGW, ensure paths are in Unix format before anything is touched
  if [ -n "${JAVA_HOME-}" ]; then
    if [ -x "$JAVA_HOME/jre/sh/java" ]; then
      # IBM's JDK on AIX uses strange locations for the executables
      JAVACMD="$JAVA_HOME/jre/sh/java"
      JAVACCMD="$JAVA_HOME/jre/sh/javac"
    else
      JAVACMD="$JAVA_HOME/bin/java"
      JAVACCMD="$JAVA_HOME/bin/javac"

      if [ ! -x "$JAVACMD" ] || [ ! -x "$JAVACCMD" ]; then
        echo "The JAVA_HOME environment variable is not defined correctly, so mvnw cannot run." >&2
        echo "JAVA_HOME is set to \"$JAVA_HOME\", but \"\$JAVA_HOME/bin/java\" or \"\$JAVA_HOME/bin/javac\" does not exist." >&2
        return 1
      fi
    fi
  else
    JAVACMD="$(
      'set' +e
      'unset' -f command 2>/dev/null
      'command' -v java
    )" || :
    JAVACCMD="$(
      'set' +e
      'unset' -f command 2>/dev/null
      'command' -v javac
    )" || :

    if [ ! -x "${JAVACMD-}" ] || [ ! -x "${JAVACCMD-}" ]; then
      echo "The java/javac command does not exist in PATH nor is JAVA_HOME set, so mvnw cannot run." >&2
      return 1
    fi
  fi
}

# hash string like Java String::hashCode
hash_string() {
  str="${1:-}" h=0
  while [ -n "$str" ]; do
    char="${str%"${str#?}"}"
    h=$(((h * 31 + $(LC_CTYPE=C printf %d "'$char")) % 4294967296))
    str="${str#?}"
  done
  printf %x\\n $h
}

verbose() { :; }
[ "${MVNW_VERBOSE-}" != true ] || verbose() { printf %s\\n "${1-}"; }

die() {
  printf %s\\n "$1" >&2
  exit 1
}

trim() {
  # MWRAPPER-139:
  #   Trims trailing and leading whitespace, carriage returns, tabs, and linefeeds.
  #   Needed for removing poorly interpreted newline sequences when running in more
  #   exotic environments such as mingw bash on Windows.
  printf "%s" "${1}" | tr -d '[:space:]'
}

scriptDir="$(dirname "$0")"
scriptName="$(basename "$0")"

# parse distributionUrl and optional distributionSha256Sum, requires .mvn/wrapper/maven-wrapper.properties
while IFS="=" read -r key value; do
  case "${key-}" in
  distributionUrl) distributionUrl=$(trim "${value-}") ;;
  distributionSha256Sum) distributionSha256Sum=$(trim "${value-}") ;;
  esac
done <"$scriptDir/.mvn/wrapper/maven-wrapper.properties"
[ -n "${distributionUrl-}" ] || die "cannot read distributionUrl property in $scriptDir/.mvn/wrapper/maven-wrapper.properties"

case "${distributionUrl##*/}" in
maven-mvnd-*bin.*)
  MVN_CMD=mvnd.sh _MVNW_REPO_PATTERN=/maven/mvnd/
  case "${PROCESSOR_ARCHITECTURE-}${PROCESSOR_ARCHITEW6432-}:$(uname -a)" in
  *AMD64:CYGWIN* | *AMD64:MINGW*) distributionPlatform=windows-amd64 ;;
  :Darwin*x86_64) distributionPlatform=darwin-amd64 ;;
  :Darwin*arm64) distributionPlatform=darwin-aarch64 ;;
  :Linux*x86_64*) distributionPlatform=linux-amd64 ;;
  *)
    echo "Cannot detect native platform for mvnd on $(uname)-$(uname -m), use pure java version" >&2
    distributionPlatform=linux-amd64
    ;;
  esac
  distributionUrl="${distributionUrl%-bin.*}-$distributionPlatform.zip"
  ;;
maven-mvnd-*) MVN_CMD=mvnd.sh _MVNW_REPO_PATTERN=/maven/mvnd/ ;;
*) MVN_CMD="mvn${scriptName#mvnw}" _MVNW_REPO_PATTERN=/org/apache/maven/ ;;
esac

# apply MVNW_REPOURL and calculate MAVEN_HOME
# maven home pattern: ~/.m2/wrapper/dists/{apache-maven-<version>,maven-mvnd-<version>-<platform>}/<hash>
[ -z "${MVNW_REPOURL-}" ] || distributionUrl="$MVNW_REPOURL$_MVNW_REPO_PATTERN${distributionUrl#*"$_MVNW_REPO_PATTERN"}"
distributionUrlName="${distributionUrl##*/}"
distributionUrlNameMain="${distributionUrlName%.*}"
distributionUrlNameMain="${distributionUrlNameMain%-bin}"
MAVEN_USER_HOME="${MAVEN_USER_HOME:-${HOME}/.m2}"
MAVEN_HOME="${MAVEN_USER_HOME}/wrapper/dists/${distributionUrlNameMain-}/$(hash_string "$distributionUrl")"

exec_maven() {
  unset MVNW_VERBOSE MVNW_USERNAME MVNW_PASSWORD MVNW_REPOURL || :
  exec "$MAVEN_HOME/bin/$MVN_CMD" "$@" || die "cannot exec $MAVEN_HOME/bin/$MVN_CMD"
}

if [ -d "$MAVEN_HOME" ]; then
  verbose "found existing MAVEN_HOME at $MAVEN_HOME"
  exec_maven "$@"
fi

case "${distributionUrl-}" in
*?-bin.zip | *?maven-mvnd-?*-?*.zip) ;;
*) die "distributionUrl is not valid, must match *-bin.zip or maven-mvnd-*.zip, but found '${distributionUrl-}'" ;;
esac

# prepare tmp dir
if TMP_DOWNLOAD_DIR="$(mktemp -d)" && [ -d "$TMP_DOWNLOAD_DIR" ]; then
  clean() { rm -rf -- "$TMP_DOWNLOAD_DIR"; }
  trap clean HUP INT TERM EXIT
else
  die "cannot create temp dir"
fi

mkdir -p -- "${MAVEN_HOME%/*}"

# Download and Install Apache Maven
verbose "Couldn't find MAVEN_HOME, downloading and installing it ..."
verbose "Downloading from: $distributionUrl"
verbose "Downloading to: $TMP_DOWNLOAD_DIR/$distributionUrlName"

# select .zip or .tar.gz
if ! command -v unzip >/dev/null; then
  distributionUrl="${distributionUrl%.zip}.tar.gz"
  distributionUrlName="${distributionUrl##*/}"
fi

# verbose opt
__MVNW_QUIET_WGET=--quiet __MVNW_QUIET_CURL=--silent __MVNW_QUIET_UNZIP=-q __MVNW_QUIET_TAR=''
[ "${MVNW_VERBOSE-}" != true ] || __MVNW_QUIET_WGET='' __MVNW_QUIET_CURL='' __MVNW_QUIET_UNZIP='' __MVNW_QUIET_TAR=v

# normalize http auth
case "${MVNW_PASSWORD:+has-password}" in
'') MVNW_USERNAME='' MVNW_PASSWORD='' ;;
has-password) [ -n "${MVNW_USERNAME-}" ] || MVNW_USERNAME='' MVNW_PASSWORD='' ;;
esac

if [ -z "${MVNW_USERNAME-}" ] && command -v wget >/dev/null; then
  verbose "Found wget ... using wget"
  wget ${__MVNW_QUIET_WGET:+"$__MVNW_QUIET_WGET"} "$distributionUrl" -O "$TMP_DOWNLOAD_DIR/$distributionUrlName" || die "wget: Failed to fetch $distributionUrl"
elif [ -z "${MVNW_USERNAME-}" ] && command -v curl >/dev/null; then
  verbose "Found curl ... using curl"
  curl ${__MVNW_QUIET_CURL:+"$__MVNW_QUIET_CURL"} -f -L -o "$TMP_DOWNLOAD_DIR/$distributionUrlName" "$distributionUrl" || die "curl: Failed to fetch $distributionUrl"
elif set_java_home; then
  verbose "Falling back to use Java to download"
  javaSource="$TMP_DOWNLOAD_DIR/Downloader.java"
  targetZip="$TMP_DOWNLOAD_DIR/$distributionUrlName"
  cat >"$javaSource" <<-END
	public class Downloader extends java.net.Authenticator
	{
	  protected java.net.PasswordAuthentication getPasswordAuthentication()
	  {
	    return new java.net.PasswordAuthentication( System.getenv( "MVNW_USERNAME" ), System.getenv( "MVNW_PASSWORD" ).toCharArray() );
	  }
	  public static void main( String[] args ) throws Exception
	  {
	    setDefault( new Downloader() );
	    java.nio.file.Files.copy( java.net.URI.create( args[0] ).toURL().openStream(), java.nio.file.Paths.get( args[1] ).toAbsolutePath().normalize() );
	  }
	}
	END
  # For Cygwin/MinGW, switch paths to Windows format before running javac and java
  verbose " - Compiling Downloader.java ..."
  "$(native_path "$JAVACCMD")" "$(native_path "$javaSource")" || die "Failed to compile Downloader.java"
  verbose " - Running Downloader.java ..."
  "$(native_path "$JAVACMD")" -cp "$(native_path "$TMP_DOWNLOAD_DIR")" Downloader "$distributionUrl" "$(native_path "$targetZip")"
fi

# If specified, validate the SHA-256 sum of the Maven distribution zip file
if [ -n "${distributionSha256Sum-}" ]; then
  distributionSha256Result=false
  if [ "$MVN_CMD" = mvnd.sh ]; then
    echo "Checksum validation is not supported for maven-mvnd." >&2
    echo "Please disable validation by removing 'distributionSha256Sum' from your maven-wrapper.properties." >&2
    exit 1
  elif command -v sha256sum >/dev/null; then
    if echo "$distributionSha256Sum  $TMP_DOWNLOAD_DIR/$distributionUrlName" | sha256sum -c - >/dev/null 2>&1; then
      distributionSha256Result=true
    fi
  elif command -v shasum >/dev/null; then
    if echo "$distributionSha256Sum  $TMP_DOWNLOAD_DIR/$distributionUrlName" | shasum -a 256 -c >/dev/null 2>&1; then
      distributionSha256Result=true
    fi
  else
    echo "Checksum validation was requested but neither 'sha256sum' or 'shasum' are available." >&2
    echo "Please install either command, or disable validation by removing 'distributionSha256Sum' from your maven-wrapper.properties." >&2
    exit 1
  fi
  if [ $distributionSha256Result = false ]; then
    echo "Error: Failed to validate Maven distribution SHA-256, your Maven distribution might be compromised." >&2
    echo "If you updated your Maven version, you need to update the specified distributionSha256Sum property." >&2
    exit 1
  fi
fi

# unzip and move
if command -v unzip >/dev/null; then
  unzip ${__MVNW_QUIET_UNZIP:+"$__MVNW_QUIET_UNZIP"} "$TMP_DOWNLOAD_DIR/$distributionUrlName" -d "$TMP_DOWNLOAD_DIR" || die "failed to unzip"
else
  tar xzf${__MVNW_QUIET_TAR:+"$__MVNW_QUIET_TAR"} "$TMP_DOWNLOAD_DIR/$distributionUrlName" -C "$TMP_DOWNLOAD_DIR" || die "failed to untar"
fi

# Find the actual extracted directory name (handles snapshots where filename != directory name)
actualDistributionDir=""

# First try the expected directory name (for regular distributions)
if [ -d "$TMP_DOWNLOAD_DIR/$distributionUrlNameMain" ]; then
  if [ -f "$TMP_DOWNLOAD_DIR/$distributionUrlNameMain/bin/$MVN_CMD" ]; then
    actualDistributionDir="$distributionUrlNameMain"
  fi
fi

# If not found, search for any directory with the Maven executable (for snapshots)
if [ -z "$actualDistributionDir" ]; then
  # enable globbing to iterate over items
  set +f
  for dir in "$TMP_DOWNLOAD_DIR"/*; do
    if [ -d "$dir" ]; then
      if [ -f "$dir/bin/$MVN_CMD" ]; then
        actualDistributionDir="$(basename "$dir")"
        break
      fi
    fi
  done
  set -f
fi

if [ -z "$actualDistributionDir" ]; then
  verbose "Contents of $TMP_DOWNLOAD_DIR:"
  verbose "$(ls -la "$TMP_DOWNLOAD_DIR")"
  die "Could not find Maven distribution directory in extracted archive"
fi

verbose "Found extracted Maven distribution directory: $actualDistributionDir"
printf %s\\n "$distributionUrl" >"$TMP_DOWNLOAD_DIR/$actualDistributionDir/mvnw.url"
mv -- "$TMP_DOWNLOAD_DIR/$actualDistributionDir" "$MAVEN_HOME" || [ -d "$MAVEN_HOME" ] || die "fail to move MAVEN_HOME"

clean || :
exec_maven "$@"
</file>

<file path="backend/Tax_appeal_system/mvnw.cmd">
<# : batch portion
@REM ----------------------------------------------------------------------------
@REM Licensed to the Apache Software Foundation (ASF) under one
@REM or more contributor license agreements.  See the NOTICE file
@REM distributed with this work for additional information
@REM regarding copyright ownership.  The ASF licenses this file
@REM to you under the Apache License, Version 2.0 (the
@REM "License"); you may not use this file except in compliance
@REM with the License.  You may obtain a copy of the License at
@REM
@REM    http://www.apache.org/licenses/LICENSE-2.0
@REM
@REM Unless required by applicable law or agreed to in writing,
@REM software distributed under the License is distributed on an
@REM "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
@REM KIND, either express or implied.  See the License for the
@REM specific language governing permissions and limitations
@REM under the License.
@REM ----------------------------------------------------------------------------

@REM ----------------------------------------------------------------------------
@REM Apache Maven Wrapper startup batch script, version 3.3.4
@REM
@REM Optional ENV vars
@REM   MVNW_REPOURL - repo url base for downloading maven distribution
@REM   MVNW_USERNAME/MVNW_PASSWORD - user and password for downloading maven
@REM   MVNW_VERBOSE - true: enable verbose log; others: silence the output
@REM ----------------------------------------------------------------------------

@IF "%__MVNW_ARG0_NAME__%"=="" (SET __MVNW_ARG0_NAME__=%~nx0)
@SET __MVNW_CMD__=
@SET __MVNW_ERROR__=
@SET __MVNW_PSMODULEP_SAVE=%PSModulePath%
@SET PSModulePath=
@FOR /F "usebackq tokens=1* delims==" %%A IN (`powershell -noprofile "& {$scriptDir='%~dp0'; $script='%__MVNW_ARG0_NAME__%'; icm -ScriptBlock ([Scriptblock]::Create((Get-Content -Raw '%~f0'))) -NoNewScope}"`) DO @(
  IF "%%A"=="MVN_CMD" (set __MVNW_CMD__=%%B) ELSE IF "%%B"=="" (echo %%A) ELSE (echo %%A=%%B)
)
@SET PSModulePath=%__MVNW_PSMODULEP_SAVE%
@SET __MVNW_PSMODULEP_SAVE=
@SET __MVNW_ARG0_NAME__=
@SET MVNW_USERNAME=
@SET MVNW_PASSWORD=
@IF NOT "%__MVNW_CMD__%"=="" ("%__MVNW_CMD__%" %*)
@echo Cannot start maven from wrapper >&2 && exit /b 1
@GOTO :EOF
: end batch / begin powershell #>

$ErrorActionPreference = "Stop"
if ($env:MVNW_VERBOSE -eq "true") {
  $VerbosePreference = "Continue"
}

# calculate distributionUrl, requires .mvn/wrapper/maven-wrapper.properties
$distributionUrl = (Get-Content -Raw "$scriptDir/.mvn/wrapper/maven-wrapper.properties" | ConvertFrom-StringData).distributionUrl
if (!$distributionUrl) {
  Write-Error "cannot read distributionUrl property in $scriptDir/.mvn/wrapper/maven-wrapper.properties"
}

switch -wildcard -casesensitive ( $($distributionUrl -replace '^.*/','') ) {
  "maven-mvnd-*" {
    $USE_MVND = $true
    $distributionUrl = $distributionUrl -replace '-bin\.[^.]*$',"-windows-amd64.zip"
    $MVN_CMD = "mvnd.cmd"
    break
  }
  default {
    $USE_MVND = $false
    $MVN_CMD = $script -replace '^mvnw','mvn'
    break
  }
}

# apply MVNW_REPOURL and calculate MAVEN_HOME
# maven home pattern: ~/.m2/wrapper/dists/{apache-maven-<version>,maven-mvnd-<version>-<platform>}/<hash>
if ($env:MVNW_REPOURL) {
  $MVNW_REPO_PATTERN = if ($USE_MVND -eq $False) { "/org/apache/maven/" } else { "/maven/mvnd/" }
  $distributionUrl = "$env:MVNW_REPOURL$MVNW_REPO_PATTERN$($distributionUrl -replace "^.*$MVNW_REPO_PATTERN",'')"
}
$distributionUrlName = $distributionUrl -replace '^.*/',''
$distributionUrlNameMain = $distributionUrlName -replace '\.[^.]*$','' -replace '-bin$',''

$MAVEN_M2_PATH = "$HOME/.m2"
if ($env:MAVEN_USER_HOME) {
  $MAVEN_M2_PATH = "$env:MAVEN_USER_HOME"
}

if (-not (Test-Path -Path $MAVEN_M2_PATH)) {
    New-Item -Path $MAVEN_M2_PATH -ItemType Directory | Out-Null
}

$MAVEN_WRAPPER_DISTS = $null
if ((Get-Item $MAVEN_M2_PATH).Target[0] -eq $null) {
  $MAVEN_WRAPPER_DISTS = "$MAVEN_M2_PATH/wrapper/dists"
} else {
  $MAVEN_WRAPPER_DISTS = (Get-Item $MAVEN_M2_PATH).Target[0] + "/wrapper/dists"
}

$MAVEN_HOME_PARENT = "$MAVEN_WRAPPER_DISTS/$distributionUrlNameMain"
$MAVEN_HOME_NAME = ([System.Security.Cryptography.SHA256]::Create().ComputeHash([byte[]][char[]]$distributionUrl) | ForEach-Object {$_.ToString("x2")}) -join ''
$MAVEN_HOME = "$MAVEN_HOME_PARENT/$MAVEN_HOME_NAME"

if (Test-Path -Path "$MAVEN_HOME" -PathType Container) {
  Write-Verbose "found existing MAVEN_HOME at $MAVEN_HOME"
  Write-Output "MVN_CMD=$MAVEN_HOME/bin/$MVN_CMD"
  exit $?
}

if (! $distributionUrlNameMain -or ($distributionUrlName -eq $distributionUrlNameMain)) {
  Write-Error "distributionUrl is not valid, must end with *-bin.zip, but found $distributionUrl"
}

# prepare tmp dir
$TMP_DOWNLOAD_DIR_HOLDER = New-TemporaryFile
$TMP_DOWNLOAD_DIR = New-Item -Itemtype Directory -Path "$TMP_DOWNLOAD_DIR_HOLDER.dir"
$TMP_DOWNLOAD_DIR_HOLDER.Delete() | Out-Null
trap {
  if ($TMP_DOWNLOAD_DIR.Exists) {
    try { Remove-Item $TMP_DOWNLOAD_DIR -Recurse -Force | Out-Null }
    catch { Write-Warning "Cannot remove $TMP_DOWNLOAD_DIR" }
  }
}

New-Item -Itemtype Directory -Path "$MAVEN_HOME_PARENT" -Force | Out-Null

# Download and Install Apache Maven
Write-Verbose "Couldn't find MAVEN_HOME, downloading and installing it ..."
Write-Verbose "Downloading from: $distributionUrl"
Write-Verbose "Downloading to: $TMP_DOWNLOAD_DIR/$distributionUrlName"

$webclient = New-Object System.Net.WebClient
if ($env:MVNW_USERNAME -and $env:MVNW_PASSWORD) {
  $webclient.Credentials = New-Object System.Net.NetworkCredential($env:MVNW_USERNAME, $env:MVNW_PASSWORD)
}
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
$webclient.DownloadFile($distributionUrl, "$TMP_DOWNLOAD_DIR/$distributionUrlName") | Out-Null

# If specified, validate the SHA-256 sum of the Maven distribution zip file
$distributionSha256Sum = (Get-Content -Raw "$scriptDir/.mvn/wrapper/maven-wrapper.properties" | ConvertFrom-StringData).distributionSha256Sum
if ($distributionSha256Sum) {
  if ($USE_MVND) {
    Write-Error "Checksum validation is not supported for maven-mvnd. `nPlease disable validation by removing 'distributionSha256Sum' from your maven-wrapper.properties."
  }
  Import-Module $PSHOME\Modules\Microsoft.PowerShell.Utility -Function Get-FileHash
  if ((Get-FileHash "$TMP_DOWNLOAD_DIR/$distributionUrlName" -Algorithm SHA256).Hash.ToLower() -ne $distributionSha256Sum) {
    Write-Error "Error: Failed to validate Maven distribution SHA-256, your Maven distribution might be compromised. If you updated your Maven version, you need to update the specified distributionSha256Sum property."
  }
}

# unzip and move
Expand-Archive "$TMP_DOWNLOAD_DIR/$distributionUrlName" -DestinationPath "$TMP_DOWNLOAD_DIR" | Out-Null

# Find the actual extracted directory name (handles snapshots where filename != directory name)
$actualDistributionDir = ""

# First try the expected directory name (for regular distributions)
$expectedPath = Join-Path "$TMP_DOWNLOAD_DIR" "$distributionUrlNameMain"
$expectedMvnPath = Join-Path "$expectedPath" "bin/$MVN_CMD"
if ((Test-Path -Path $expectedPath -PathType Container) -and (Test-Path -Path $expectedMvnPath -PathType Leaf)) {
  $actualDistributionDir = $distributionUrlNameMain
}

# If not found, search for any directory with the Maven executable (for snapshots)
if (!$actualDistributionDir) {
  Get-ChildItem -Path "$TMP_DOWNLOAD_DIR" -Directory | ForEach-Object {
    $testPath = Join-Path $_.FullName "bin/$MVN_CMD"
    if (Test-Path -Path $testPath -PathType Leaf) {
      $actualDistributionDir = $_.Name
    }
  }
}

if (!$actualDistributionDir) {
  Write-Error "Could not find Maven distribution directory in extracted archive"
}

Write-Verbose "Found extracted Maven distribution directory: $actualDistributionDir"
Rename-Item -Path "$TMP_DOWNLOAD_DIR/$actualDistributionDir" -NewName $MAVEN_HOME_NAME | Out-Null
try {
  Move-Item -Path "$TMP_DOWNLOAD_DIR/$MAVEN_HOME_NAME" -Destination $MAVEN_HOME_PARENT | Out-Null
} catch {
  if (! (Test-Path -Path "$MAVEN_HOME" -PathType Container)) {
    Write-Error "fail to move MAVEN_HOME"
  }
} finally {
  try { Remove-Item $TMP_DOWNLOAD_DIR -Recurse -Force | Out-Null }
  catch { Write-Warning "Cannot remove $TMP_DOWNLOAD_DIR" }
}

Write-Output "MVN_CMD=$MAVEN_HOME/bin/$MVN_CMD"
</file>

<file path="backend/Tax_appeal_system/pom.xml">
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.5.5</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>
    <groupId>org.shamiinnocent</groupId>
    <artifactId>Tax_appeal_system</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>Tax_appeal_system</name>
    <description>Tax_appeal_system</description>
    <url/>
    <licenses>
        <license/>
    </licenses>
    <developers>
        <developer/>
    </developers>
    <scm>
        <connection/>
        <developerConnection/>
        <tag/>
        <url/>
    </scm>
    <properties>
        <java.version>21</java.version>
    </properties>
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>

        <dependency>
            <groupId>org.postgresql</groupId>
            <artifactId>postgresql</artifactId>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <version>1.18.38</version>
            <optional>true</optional>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-validation</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-security</artifactId>
        </dependency>
        <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-api</artifactId>
        <version>0.12.5</version>
    </dependency>
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-impl</artifactId>
        <version>0.12.5</version>
    </dependency>
    <dependency>
        <groupId>io.jsonwebtoken</groupId>
        <artifactId>jjwt-jackson</artifactId>
        <version>0.12.5</version>
    </dependency>
        <dependency>
            <groupId>org.springdoc</groupId>
            <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
            <version>2.8.6</version>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-mail</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-thymeleaf</artifactId>
        </dependency>
        <dependency>
            <groupId>com.twilio.sdk</groupId>
            <artifactId>twilio</artifactId>
            <version>8.8.0</version>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-oauth2-client</artifactId>
        </dependency>

        <dependency>
            <groupId>com.google.api-client</groupId>
            <artifactId>google-api-client</artifactId>
            <version>2.2.0</version>
        </dependency>

        <dependency>
            <groupId>com.google.apis</groupId>
            <artifactId>google-api-services-calendar</artifactId>
            <version>v3-rev20251028-2.0.0</version>
        </dependency>

    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <configuration>
                    <annotationProcessorPaths>
                        <path>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </path>
                    </annotationProcessorPaths>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <excludes>
                        <exclude>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </exclude>
                    </excludes>
                    <image>
                        <name>shamiinnocent/tax-appeal-system-backend:${project.version}</name>  <!-- Customize: repo/image-name:tag -->
                    </image>
                </configuration>
            </plugin>
        </plugins>
    </build>

</project>
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/AgendaController.java">
package org.RRA.tax_appeal_system.Controllers;

import org.springframework.data.domain.Page;
import lombok.AllArgsConstructor;
import org.RRA.tax_appeal_system.DTOS.responses.AgendaDTO;
import org.RRA.tax_appeal_system.Services.ExplanatoryNoteService;
import org.springframework.data.web.PageableDefault;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import org.springframework.data.domain.Pageable;

@RestController
@RequestMapping("/api/v1/agenda")
@AllArgsConstructor
public class AgendaController {
    private final ExplanatoryNoteService explanatoryNoteService;

    @GetMapping("/")
    public ResponseEntity<Page<AgendaDTO>> getAgendaCases(@PageableDefault(page = 0, size = 5) Pageable pageable){
        Page<AgendaDTO> agendaPage = explanatoryNoteService.agenda(pageable);
        return new ResponseEntity<>(agendaPage, HttpStatus.OK);
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/AuthController.java">
package org.RRA.tax_appeal_system.Controllers;

import io.swagger.v3.oas.annotations.tags.Tag;
import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.DTOS.requests.TokenRefreshRequest;
import org.RRA.tax_appeal_system.DTOS.responses.AuthResponse;
import org.RRA.tax_appeal_system.DTOS.requests.LoginRequest;
import org.RRA.tax_appeal_system.DTOS.requests.RegisterUser;
import org.RRA.tax_appeal_system.DTOS.responses.GenericResponse;
import org.RRA.tax_appeal_system.Models.UserInfo;
import org.RRA.tax_appeal_system.Services.AuthServices.AuthService;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.security.Principal;

@RestController
@RequestMapping("/api/v1/auth/")
@RequiredArgsConstructor
@Tag(name = " Authentication ")
public class AuthController {
    private final AuthService authService;

    @PostMapping("/register")
    public ResponseEntity<UserInfo> registerUser(@RequestBody RegisterUser user) {
        UserInfo user1 = authService.registerUser(user);
        return ResponseEntity.status(HttpStatus.CREATED).body(user1);
    }


    @PostMapping("/login")
    public ResponseEntity<AuthResponse> login(@RequestBody LoginRequest request){
        AuthResponse response = authService.login(request);
        return ResponseEntity.ok(response);
    }

    // MODIFIED SECTION: Changed from @PathVariable to @RequestBody
    @PostMapping("/refresh-token")
    public AuthResponse refreshToken(@RequestBody TokenRefreshRequest refreshTokenRequest) {
        // Extract the token from the request body and pass it to the service
        return authService.refreshToken(refreshTokenRequest.refreshToken());
    }


    // Note: To use this in a controller, you can extract the email from the
    // Access Token of the current request via the SecurityContextHolder:

    @PostMapping("/logout")
    public ResponseEntity<GenericResponse<String>> logout(Principal principal) {
        String userEmail = principal.getName();

        return authService.logout(userEmail);
    }

}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/CommitteeController.java">
package org.RRA.tax_appeal_system.Controllers;


import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.Services.UserInfoService;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.security.Principal;
import java.util.List;
import java.util.Map;
import java.util.UUID;

@RestController
@RequestMapping("/api/v1/committee")
@RequiredArgsConstructor
public class CommitteeController {

    private final UserInfoService userInfoService; // or your service name

    @GetMapping("/members-availability")
    public ResponseEntity<List<UserInfoService.MemberAvailabilityDTO>> getMembersAvailability(
            Principal principal) {

        String email = principal.getName(); // assuming email is principal
        List<UserInfoService.MemberAvailabilityDTO> members = userInfoService
                .getAllMemberAndTheirAvailabilityStatus(email);

        return ResponseEntity.ok(members);
    }

    @PutMapping("/member/{userId}/availability")
    public ResponseEntity<Void> updateMemberAvailability(
            @PathVariable UUID userId,
            @RequestBody Map<String, Boolean> body, // { "availabilityStatus": true }
            Principal principal) {

        boolean status = body.getOrDefault("availabilityStatus", false);
        userInfoService.updateMemberAvailabilityAsLeader(principal.getName(), userId, status);

        return ResponseEntity.ok().build();
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/ExplanatoryController.java">
package org.RRA.tax_appeal_system.Controllers;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.security.SecurityRequirement;
import io.swagger.v3.oas.annotations.tags.Tag;
import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.DTOS.responses.ExplanatoryNoteDTO;
import org.RRA.tax_appeal_system.DTOS.responses.ExplanatoryNoteResponseDTO;
import org.RRA.tax_appeal_system.DTOS.responses.GenericResponse;
import org.RRA.tax_appeal_system.Services.ExplanatoryNoteService;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.bind.annotation.*;
import java.security.Principal;
import java.util.Map;
import java.util.UUID;

@RestController
@Tag(name = " Explanatory Note Related APIs")
@SecurityRequirement(name = "bearerAuth")
@RequiredArgsConstructor
@RequestMapping("/api/v1/auth/explanatory_note/")
public class ExplanatoryController {
    private final ExplanatoryNoteService explanatoryNoteService;

    @Operation(summary = " Generating a new Explanatory Note")
    @PostMapping("/")
    public ResponseEntity<GenericResponse<String>> createExplanatoryNote(@RequestBody ExplanatoryNoteDTO explanatoryNote, Principal principal) {
        explanatoryNoteService.generateExplanatoryNote(explanatoryNote,principal.getName());
        GenericResponse<String> response = new GenericResponse<>(
                HttpStatus.CREATED.value(),
                "succesfully Registered new explanatory Note",
                null
        );
         return ResponseEntity.status(HttpStatus.CREATED).body(response);
    }

    @Operation(summary = " Get Explanatory note by CaseId")
    @GetMapping("/{caseId}")
    public ResponseEntity<GenericResponse<ExplanatoryNoteResponseDTO>> getExplanatoryNoteByCaseId(
            @PathVariable String caseId) {

        ExplanatoryNoteResponseDTO explanatoryNote = explanatoryNoteService.getExplanatoryNoteByCaseId(caseId);
            return ResponseEntity.ok(new GenericResponse<>(
                    200,
                    "Explanatory note retrieved successfully",
                    explanatoryNote
            ));
    }

    @PutMapping("/{caseId}")
    public ResponseEntity<GenericResponse<String>> updateExplanatoryNote(@PathVariable String caseId, @RequestBody ExplanatoryNoteDTO explanatoryNote, Principal principal) {
        explanatoryNoteService.updatingExplanatoryNoteByCaseId(caseId, explanatoryNote, principal.getName());
        GenericResponse<String> response = new GenericResponse<>(
                HttpStatus.OK.value(),
                "Updated Note successfully",
                null
        );
        return ResponseEntity.ok(response);
    }

    @Operation(summary = "Save note without changing status")
    @PutMapping("/{caseId}/save")
    public ResponseEntity<GenericResponse<String>> saveNote(@PathVariable String caseId, @RequestBody ExplanatoryNoteDTO explanatoryNote, Principal principal) {
        explanatoryNoteService.saveNote(caseId, explanatoryNote, principal.getName());
        GenericResponse<String> response = new GenericResponse<>(
                HttpStatus.OK.value(),
                "Note saved successfully",
                null
        );
        return ResponseEntity.ok(response);
    }

    @Operation(summary = "Move note to pre-appeal")
    @PostMapping("/{caseId}/move-to-pre-appeal")
    public ResponseEntity<GenericResponse<String>> moveToPreAppeal(@PathVariable String caseId) {
        explanatoryNoteService.moveToPreAppeal(caseId);

        GenericResponse<String> response = new GenericResponse<>(
                HttpStatus.OK.value(),
                "Note moved to pre-appeal successfully",
                null
        );
        return ResponseEntity.ok(response);
    }

    @DeleteMapping("/{caseId}")
    public ResponseEntity<String> DeleteExplanatoryNote(@PathVariable String caseId) {
        explanatoryNoteService.deleteExplanatoryNoteByCaseId(caseId);
    return ResponseEntity.ok("DELETED NOTE Successfully");
    };

    @PostMapping("/appeal/comment/{appealId}")
    @Transactional(readOnly = true)
    public ResponseEntity<?> getCommentForAppealPoint(@PathVariable UUID appealId) {
        String comment  = explanatoryNoteService.getCommentOnAppealPoint(appealId);

        if (comment == null) {
            return ResponseEntity.ok(Map.of("message", "No comments found for this appeal."));
        }
        return ResponseEntity.ok(Map.of("comment", comment));
    }



}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/MeetingController.java">
package org.RRA.tax_appeal_system.Controllers;

import jakarta.mail.MessagingException;
import jakarta.mail.internet.MimeMessage;
import org.RRA.tax_appeal_system.Enums.CommitteeGroup;
import org.RRA.tax_appeal_system.Models.UserInfo;
import org.RRA.tax_appeal_system.Repositories.UserInfoRepo;
import org.RRA.tax_appeal_system.Services.GoogleCalendarService;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.security.oauth2.client.OAuth2AuthorizedClient;
import org.springframework.security.oauth2.client.annotation.RegisteredOAuth2AuthorizedClient;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.io.IOException;
import java.security.Principal;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/api/v1/meetings")
public class MeetingController {

    private final GoogleCalendarService calendarService;
    private final UserInfoRepo userInfoRepo;
    private final JavaMailSender mailSender;

    // Constructor injection (keep only this  remove OAuth2AuthorizedClientService)
    public MeetingController(GoogleCalendarService calendarService, UserInfoRepo userInfoRepo, JavaMailSender mailSender) {
        this.calendarService = calendarService;
        this.userInfoRepo = userInfoRepo;
        this.mailSender = mailSender;
    }

    @PostMapping("/create")
    public ResponseEntity<Map<String, String>> createMeeting(
            @RegisteredOAuth2AuthorizedClient("google") OAuth2AuthorizedClient authorizedClient, Principal principal) {

        System.out.println("Entering createMeeting - Authorized client exists: " + (authorizedClient != null));

        if (authorizedClient == null || authorizedClient.getAccessToken() == null) {
            System.out.println("Authorized client or access token is null - Returning 401");
            Map<String, String> errorResponse = new HashMap<>();
            errorResponse.put("error", "Not authenticated with Google. Please sign in.");
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body(errorResponse);
        }

        String accessToken = authorizedClient.getAccessToken().getTokenValue();
        System.out.println("Access token retrieved: " + accessToken);  // This will print the token (sensitive, so remove later)

        Map<String, String> response = new HashMap<>();
        try {
            String committeeLeaderEmail = principal.getName();
            String meetLink = calendarService.createEventWithMeetLink(accessToken);

            response.put("meetLink", meetLink);
//            // so now here we will try to send the meeting link to everyone's email in that committee group
//            UserInfo user = userInfoRepo.findByEmail(committeeLeaderEmail).orElseThrow(()->new UsernameNotFoundException("User with " + committeeLeaderEmail + " not found"));
//            CommitteeGroup committeeGroup = user.getCommitteeGroup();
//            //Now we get the list of users in the same committee group
//            List<UserInfo> usersList = userInfoRepo.findAllByCommitteeGroupAndAvailabilityStatus(committeeGroup,true);
//
//            //prepare for sending Email
//            MimeMessage message = mailSender.createMimeMessage();
//            MimeMessageHelper helper = new MimeMessageHelper(message, true, "UTF-8");
//
//            for(UserInfo committee : usersList) {
//                helper.setTo(committee.getEmail());
//                helper.setSubject("Google Meeting Link");
//                helper.setText(meetLink);
//                mailSender.send(message);
//            }

            return ResponseEntity.ok(response);
        }catch (IOException e) {
                System.err.println("Controller caught IOException: " + e.getMessage());
                e.printStackTrace();
                response.put("error", "Failed to create Google Meet: " + e.getMessage());
                return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(response);
            }
//        catch (MessagingException e) {
//            throw new RuntimeException(e);
//        }
    }


}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/MeetingInfoContoller.java">
package org.RRA.tax_appeal_system.Controllers;

import org.RRA.tax_appeal_system.DTOS.requests.MeetingInfoDTO;
import org.RRA.tax_appeal_system.DTOS.responses.GenericResponse;
import org.RRA.tax_appeal_system.Email.MeetingInfoService;
import org.RRA.tax_appeal_system.Models.MeetingInfo;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/v1/meeting-info")
public class MeetingInfoContoller {
    @Autowired
    MeetingInfoService meetingInfoService;
    @PostMapping
    @PreAuthorize("hasRole('COMMITTEE_LEADER')")
    public ResponseEntity<String> provideMeetingInfo(@RequestBody MeetingInfoDTO meetingInfo) {
        meetingInfoService.insertMeetingVenueAndTime(meetingInfo.venue(), meetingInfo.meetingTime());
        return ResponseEntity.ok().body("Meeting Info inserted successfully");
    }

    @PutMapping("/{id}")
    @PreAuthorize("hasRole('COMMITTEE_LEADER')")
    public ResponseEntity<String> updateMeetingInfo(@PathVariable int id, @RequestBody MeetingInfoDTO meetingInfo) {
        String updated = meetingInfoService.updateMeetingVenueAndTime(id, meetingInfo.venue(), meetingInfo.meetingTime());
        return ResponseEntity.ok().body(updated);
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/MyCasesController.java">
package org.RRA.tax_appeal_system.Controllers;

import io.swagger.v3.oas.annotations.security.SecurityRequirement;
import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.DTOS.DashboardAnalyticsDto;
import org.RRA.tax_appeal_system.DTOS.responses.GenericResponse;
import org.RRA.tax_appeal_system.DTOS.responses.MyCaseDTO;
import org.RRA.tax_appeal_system.Services.MyCasesService;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.security.Principal;
import java.util.List;

@RestController
@RequestMapping("/api/v1/my-cases")
@RequiredArgsConstructor
@SecurityRequirement(name = "bearerAuth")
public class MyCasesController {

    private final MyCasesService myCasesService;

    @GetMapping("/my-cases")
    public ResponseEntity<GenericResponse<List<MyCaseDTO>>> getMyCases(Principal principal) {
        try {
            String notePreparator = principal.getName(); // Assuming email is the preparator
            List<MyCaseDTO> myCases = myCasesService.getMyCasesByPreparator(notePreparator);

            GenericResponse<List<MyCaseDTO>> response = new GenericResponse<>(
                    200,
                    "My cases retrieved successfully",
                    myCases
            );
            return ResponseEntity.ok(response);

        } catch (Exception e) {
            GenericResponse<List<MyCaseDTO>> errorResponse = new GenericResponse<>(
                    500,
                    "Error retrieving my cases: " + e.getMessage(),
                    null
            );
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);
        }
    }
    @GetMapping("/analytics")
    public ResponseEntity<GenericResponse<DashboardAnalyticsDto>> getDashboardAnalytics(Principal principal) {
        try {
            String committeeEmail = principal.getName();
            DashboardAnalyticsDto analytics = myCasesService.getDashboardAnalytics(committeeEmail);
            GenericResponse<DashboardAnalyticsDto> response = new GenericResponse<>(
                    200,
                    "Dashboard analytics retrieved successfully",
                    analytics
            );
            return ResponseEntity.ok(response);

        } catch (Exception e) {
            GenericResponse<DashboardAnalyticsDto> errorResponse = new GenericResponse<>(
                    500,
                    "Error retrieving dashboard analytics: " + e.getMessage(),
                    null
            );
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);
        }
    }
    @GetMapping("/this-week")
    public ResponseEntity<GenericResponse<List<MyCaseDTO>>> getCasesForThisWeek() {
        try {
            List<MyCaseDTO> weekCases = myCasesService.getCasesForThisWeek();

            GenericResponse<List<MyCaseDTO>> response = new GenericResponse<>(
                    200,
                    "This week's cases retrieved successfully",
                    weekCases
            );
            return ResponseEntity.ok(response);

        } catch (Exception e) {
            GenericResponse<List<MyCaseDTO>> errorResponse = new GenericResponse<>(
                    500,
                    "Error retrieving this week's cases: " + e.getMessage(),
                    null
            );
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);
        }
    }}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/PreAppealController.java">
package org.RRA.tax_appeal_system.Controllers;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.security.SecurityRequirement;
import io.swagger.v3.oas.annotations.tags.Tag;
import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.DTOS.responses.AgendaDTO;
import org.RRA.tax_appeal_system.DTOS.responses.GenericResponse;
import org.RRA.tax_appeal_system.Services.ExplanatoryNoteService;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.security.Principal;

@RestController
@Tag(name = "Pre-Appeal Related APIs")
@SecurityRequirement(name = "bearerAuth")
@RequiredArgsConstructor
@RequestMapping("/api/v1/auth/pre-appeal/")
public class PreAppealController {
    private final ExplanatoryNoteService explanatoryNoteService;

    @Operation(summary = "Get all pre-appeal cases")
    @GetMapping("/")
    public ResponseEntity<GenericResponse<Page<AgendaDTO>>> getPreAppealCases(Pageable pageable) {
        Page<AgendaDTO> preAppealCases = explanatoryNoteService.getPreAppealCases(pageable);
        GenericResponse<Page<AgendaDTO>> response = new GenericResponse<>(
                HttpStatus.OK.value(),
                "Pre-appeal cases retrieved successfully",
                preAppealCases
        );
        return ResponseEntity.ok(response);
    }

    @Operation(summary = "Move a case from pre-appeal to agenda")
    @PostMapping("/{caseId}/move-to-agenda")
    public ResponseEntity<GenericResponse<String>> moveToAgenda(@PathVariable String caseId) {
        explanatoryNoteService.moveToAgenda(caseId);
        GenericResponse<String> response = new GenericResponse<>(
                HttpStatus.OK.value(),
                "Case moved to agenda successfully",
                null
        );
        return ResponseEntity.ok(response);
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/UserController.java">
package org.RRA.tax_appeal_system.Controllers;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.security.SecurityRequirement;
import io.swagger.v3.oas.annotations.tags.Tag;
import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.DTOS.requests.UpdateUserRequest;
import org.RRA.tax_appeal_system.DTOS.responses.GenericResponse;
import org.RRA.tax_appeal_system.Models.UserInfo;
import org.RRA.tax_appeal_system.Services.UserInfoService;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.web.bind.annotation.*;

import java.security.Principal;
import java.util.List;
import java.util.Map;
import java.util.UUID;

@RestController
@Tag(name = "User")
@RequiredArgsConstructor
@SecurityRequirement(name = "bearerAuth")
@RequestMapping("/api/v1/")
public class UserController {
    private final UserInfoService userInfoService;

    @Operation(summary = "Updating User")
    @PreAuthorize("hasAnyAuthority('COMMITTEE_LEADER')")
    @PutMapping("/user/{id}")
    public String updateUser(@PathVariable UUID id, @RequestBody UpdateUserRequest updateUser) {
        userInfoService.updateUserInfo(id,updateUser);
        return "User updated";
    }

    @GetMapping("/user/{id}")
    public ResponseEntity<GenericResponse<UserInfo>> getUserById(@PathVariable UUID id) {
        UserInfo userInfo = userInfoService.getUserById(id);
        GenericResponse<UserInfo> response = new GenericResponse<>(200,"OK",userInfo);
        return ResponseEntity.ok(response);
    }

    @GetMapping("/user/")
    public ResponseEntity<GenericResponse<UserInfo>> getCurrentUser(Principal principal) {
        String username = principal.getName();
        UserInfo user = userInfoService.getUserByEmail(username);
        GenericResponse<UserInfo> response = new GenericResponse<>(200,"OK",user);
        return ResponseEntity.ok(response);
    }

    @PutMapping("/user/{id}/availability-status")
    public ResponseEntity<String> updateUserAvailabilityStatus(@PathVariable UUID id,@RequestBody boolean availabilityStatus){
        userInfoService.updateUserAvailabilityStatus(id,availabilityStatus);
        return ResponseEntity.ok("user availability status updated successfully!");
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Controllers/VotingController.java">
package org.RRA.tax_appeal_system.Controllers;

import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.DTOS.requests.VoteRequest;
import org.RRA.tax_appeal_system.DTOS.responses.AppealDTO;
import org.RRA.tax_appeal_system.Models.Appeals;
import org.RRA.tax_appeal_system.Models.CommitteeVote;
import org.RRA.tax_appeal_system.Repositories.AppealsRepo;
import org.RRA.tax_appeal_system.Services.VotingService;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.bind.annotation.*;

import java.security.Principal;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.UUID;

@RestController
@RequiredArgsConstructor
@RequestMapping("/api/appeals")  //  CORRECT BASE PATH
public class VotingController {

    private final VotingService votingService;
    private final AppealsRepo appealsRepo;

    // 1. Submit vote
    @PostMapping("/{appealId}/vote")
    public ResponseEntity<Map<String, Object>> submitVote(
            @PathVariable UUID appealId,
            @Valid @RequestBody VoteRequest voteRequest,
            Principal principal) {

        try {
            String memberEmail = principal.getName();
            CommitteeVote vote = votingService.submitVote(appealId, voteRequest, memberEmail);

            Map<String, Object> response = new HashMap<>();
            response.put("message", "Vote submitted successfully");
            response.put("vote", Map.of(
                    "id", vote.getId(),
                    "committeeMemberName", vote.getCommitteeMemberName(),
                    "committeeDecision", vote.getCommitteeDecision(),
                    "votedAt", vote.getVotedAt()
            ));

            return ResponseEntity.status(HttpStatus.CREATED).body(response);
        } catch (RuntimeException e) {
            return ResponseEntity.status(HttpStatus.CONFLICT)
                    .body(Map.of("error", e.getMessage()));
        }
    }

    // 2. Check if user voted all appeals
    @PostMapping("/are-all-appeals-voted")
    @Transactional(readOnly = true)
    public ResponseEntity<?> hasUserVotedAllTheAppeals(
            Principal principal,
            @RequestBody List<UUID> appealIds) {

        if (appealIds == null || appealIds.isEmpty()) {
            return ResponseEntity.badRequest().body(Map.of("error", "List cannot be empty"));
        }

        Map<UUID, Boolean> result = votingService.hasUserVotedAllTheAppeals(principal.getName(), appealIds);
        return ResponseEntity.ok(result);
    }


    // 4. GET ALL VOTES (Leader only  service enforces it)
// Add this method to your existing VotingController.java
    @GetMapping("/{appealId}/all-votes")
    @Transactional(readOnly = true)
    public ResponseEntity<List<VotingService.SimpleVoteDTO>> getAllVotesForAppeal(
            @PathVariable UUID appealId,
            Principal principal) {

        List<VotingService.SimpleVoteDTO> votes = votingService.getAllVotesForAppeal(appealId, principal.getName());
        return ResponseEntity.ok(votes);
    }

}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/DashboardAnalyticsDto.java">
package org.RRA.tax_appeal_system.DTOS;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.List;

@Data
@NoArgsConstructor
@AllArgsConstructor
public class DashboardAnalyticsDto {
    private int totalCases;
    private double reviewRate;
    private int pendingCases;
    private List<CaseAnalyticsData> caseAnalytics;
    private AttendanceData attendanceList;

    @Data
    @NoArgsConstructor
    @AllArgsConstructor
    public static class CaseAnalyticsData {
        private String month;
        private int casesWithBases;
        private int casesWithoutBases;
    }

    @Data
    @NoArgsConstructor
    @AllArgsConstructor
    public static class AttendanceData {
        private int totalMembers;
        private int availableMembers;
    }

}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/AppealDetailsDTO.java">
package org.RRA.tax_appeal_system.DTOS.requests;

public  record AppealDetailsDTO(
        String appealPoint,
        String summarisedProblem,
        String auditorsOpinion,
        String proposedSolution
){ }
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/AuditedTaxDTO.java">
package org.RRA.tax_appeal_system.DTOS.requests;

import java.util.List;

public record AuditedTaxDTO(
        String taxTypeAudited,
        double principalAmountToBePaid,
        double understatementFines,
        double fixedAdministrativeFines,
        double dischargedAmount,
        double otherFines,
        double totalTaxAndFinesToBePaid,
        List<AppealDetailsDTO> appeals
) {
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/ExplanatoryNoteDTO.java">
package org.RRA.tax_appeal_system.DTOS.requests;

import java.util.Date;
import java.util.List;
import java.util.UUID;

public record ExplanatoryNoteDTO(
        String caseId,
        String auditorsName,
        Date taxAssessmentAcknowledgementDateByTaxpayer,
        String taxAssessmentTime,
        Date appealDate,
        Date appealExpireDate,
        String casePresenter,
        String tin,
        String attachmentLink,
        List<AuditedTaxDTO> taxAudited
) {
}

;
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/LoginRequest.java">
package org.RRA.tax_appeal_system.DTOS.requests;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@AllArgsConstructor
@NoArgsConstructor
public class LoginRequest {
    private String email;
    private String password;
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/MeetingInfoDTO.java">
package org.RRA.tax_appeal_system.DTOS.requests;

import java.time.LocalTime;

public record MeetingInfoDTO(
        LocalTime meetingTime,
        String venue
) {
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/RegisterUser.java">
package org.RRA.tax_appeal_system.DTOS.requests;

import jakarta.validation.constraints.Email;
import jakarta.validation.constraints.Size;
import org.RRA.tax_appeal_system.Enums.CommitteeGroup;
import org.RRA.tax_appeal_system.Enums.Privilege;


public record RegisterUser(

        @Size(min = 3,message = "full names must not go under 3 characters")
        String fullName,
        @Email(message = "please provide a valid email")
        String email,
        String title,
        Privilege committeeRole,
        CommitteeGroup committeeGroup,
        @Size(min = 10,max = 12,message = "Phone number are incomplete")
        String phoneNumber,
        @Size(min = 8,message = "password must be above 8 characters")
        String password,
        boolean availabilityStatus
) {
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/TokenRefreshRequest.java">
package org.RRA.tax_appeal_system.DTOS.requests;

public record TokenRefreshRequest(
        String refreshToken
) {
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/UpdateUserRequest.java">
package org.RRA.tax_appeal_system.DTOS.requests;

import jakarta.validation.constraints.Email;
import jakarta.validation.constraints.Size;
import org.RRA.tax_appeal_system.Enums.CommitteeGroup;
import org.RRA.tax_appeal_system.Enums.Privilege;

public record UpdateUserRequest(
        @Size(min = 3,message = "full names must not go under 3 characters")
        String fullName,
        @Email(message = "please provide a valid email")
        String email,
        String title,
        Privilege committee_role ,
        CommitteeGroup committeeGroup,
        @Size(min = 10,max = 12,message = "Phone number are incomplete")
        String phoneNumber
) {
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/requests/VoteRequest.java">
package org.RRA.tax_appeal_system.DTOS.requests;

import lombok.Data;
import org.RRA.tax_appeal_system.Enums.VoteDecision;

import java.util.UUID;

@Data
public class VoteRequest {
    private UUID committeeMemberId;
    private String committeeMemberName;
    private VoteDecision committeeDecision;
    private String voteComment;
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/AgendaDTO.java">
package org.RRA.tax_appeal_system.DTOS.responses;

import org.RRA.tax_appeal_system.Enums.CaseStatus;

import java.time.LocalDate;
import java.util.UUID;

public record AgendaDTO(
        String caseId,
        String taxpayerName,
        String casePresenter,
        String tin,
        CaseStatus caseStatus,
        long daysLeft,
        LocalDate appealDate,
        double amountDischarged,
        double taxToBePaid,
        String auditor

) {

}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/AppealDTO.java">
package org.RRA.tax_appeal_system.DTOS.responses;

import java.util.UUID;

public record AppealDTO(
        UUID AppealId,
        String appealPoint,
        String summarisedProblem,
        String auditorsOpinion,
        String proposedSolution
) { }
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/AuthResponse.java">
package org.RRA.tax_appeal_system.DTOS.responses;

import jakarta.validation.constraints.NotBlank;

import java.util.UUID;

public record AuthResponse(
        UUID id,
        @NotBlank(message = "full names required")
        String fullNames,
        @NotBlank(message = "email required")
        String email,
        @NotBlank(message = "role required")
        String role,
        String accessToken,
        String refreshToken
) {
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/ExplanatoryNoteDTO.java">
package org.RRA.tax_appeal_system.DTOS.responses;

import org.RRA.tax_appeal_system.DTOS.requests.AuditedTaxDTO;

import java.time.LocalDate;
import java.util.List;

public record ExplanatoryNoteDTO(
        String caseId,
        String auditorsName,
        LocalDate taxAssessmentAcknowledgementDateByTaxpayer,
        String taxAssessmentTime,
        LocalDate appealDate,
        LocalDate appealExpireDate,
        String casePresenter,
        String tin,
        String attachmentLink,
        LocalDate preparatorSubmissionDate,
        List<AuditedTaxDTO> taxAudited
) {
}

;
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/ExplanatoryNoteResponseDTO.java">
package org.RRA.tax_appeal_system.DTOS.responses;

import org.RRA.tax_appeal_system.DTOS.requests.AuditedTaxDTO;
import org.RRA.tax_appeal_system.Enums.CaseStatus;

import java.time.LocalDate;
import java.util.List;

public record ExplanatoryNoteResponseDTO(
        String caseId,
        String auditorsName,
        LocalDate taxAssessmentAcknowledgementDateByTaxpayer,
        String taxAssessmentTime,
        LocalDate appealDate,
        LocalDate appealExpireDate,
        String casePresenter,
        String tin,
        String attachmentLink,
        CaseStatus status,
        LocalDate preparatorSubmissionDate,
        List<TaxAuditedDTO> taxAudited
) {
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/GenericResponse.java">
package org.RRA.tax_appeal_system.DTOS.responses;

public class GenericResponse<T> {
    private int status;
    private String message;
    private T data;

    public GenericResponse(int status, String message, T data) {
        this.status = status;
        this.message = message;
        this.data = data;
    }

    // Getters and setters
    public int getStatus() { return status; }
    public void setStatus(int status) { this.status = status; }

    public String getMessage() { return message; }
    public void setMessage(String message) { this.message = message; }

    public T getData() { return data; }
    public void setData(T data) { this.data = data; }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/MyCaseDTO.java">
package org.RRA.tax_appeal_system.DTOS.responses;

import org.RRA.tax_appeal_system.Enums.CaseStatus;

public record MyCaseDTO(
        String caseId,
        String taxPayer,
        String submittedAt,
        String daysLeft,
        CaseStatus status
) {
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/TaxAuditedDTO.java">
package org.RRA.tax_appeal_system.DTOS.responses;

import org.RRA.tax_appeal_system.DTOS.requests.AppealDetailsDTO;

import java.util.List;
import java.util.UUID;

public record TaxAuditedDTO (
        UUID taxAuditedId,
        String taxTypeAudited,
        double principalAmountToBePaid,
        double understatementFines,
        double fixedAdministrativeFines,
        double dischargedAmount,
        double otherFines,
        double totalTaxAndFinesToBePaid,
        List<AppealDTO> appeals
){
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/DTOS/responses/VoteResponse.java">
package org.RRA.tax_appeal_system.DTOS.responses;

import org.RRA.tax_appeal_system.Enums.VoteDecision;

public class VoteResponse {
    private String committeeName;
    private VoteDecision committeeDecision;
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Email/AppealsInvitationRequest.java">
package org.RRA.tax_appeal_system.Email;

public record AppealsInvitationRequest(
        String meetingHour,
        String venue
) {
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Email/EmailDetails.java">
package org.RRA.tax_appeal_system.Email;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@AllArgsConstructor
@NoArgsConstructor

public class EmailDetails {

    private String recipient;
    private String msgBody;
    private String subject;
    private String attachment;
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Email/EmailServiceImpl.java">
package org.RRA.tax_appeal_system.Email;


import jakarta.mail.internet.MimeMessage;
import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.Enums.CommitteeGroup;
import org.RRA.tax_appeal_system.Models.MeetingInfo;
import org.RRA.tax_appeal_system.Models.UserInfo;
import org.RRA.tax_appeal_system.Repositories.MeetingInfoRepo;
import org.RRA.tax_appeal_system.Services.UserInfoService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.scheduling.annotation.Scheduled;
import org.springframework.stereotype.Service;
import org.thymeleaf.TemplateEngine;
import org.thymeleaf.context.Context;
import java.time.DayOfWeek;
import java.time.LocalDate;
import java.time.LocalTime;
import java.time.format.DateTimeFormatter;
import java.time.temporal.TemporalAdjusters;
import java.util.List;


@Service
@RequiredArgsConstructor
public class EmailServiceImpl {

        private final JavaMailSender mailSender;
    private final UserInfoService userInfoService;
    private final TemplateEngine templateEngine;
    private final MeetingInfoRepo meetingInfoRepo;
    @Value("${spring.mail.username}") private String sender;

//    @Scheduled(cron = "0 0/2 * * * ?")
    public void sendAppealsMeetingEmail() {
        try {
            Integer meetingInfoId = 1;
            MeetingInfo meetingInfo = meetingInfoRepo.findById(meetingInfoId).orElseThrow(()->new RuntimeException("MeetingInfo not found"));
            LocalTime meetingHour = meetingInfo.getMeetingTime();
            String venue = meetingInfo.getMeetingVenue() ;

            // getting Users to send the invitation to
            List<UserInfo> users = userInfoService.getUsersByCommitteeGroup(CommitteeGroup.APPEAL_COMMITTEE);

            MimeMessage message = mailSender.createMimeMessage();
            MimeMessageHelper helper = new MimeMessageHelper(message, true, "UTF-8");

            // Calculate next Thursday
            String nextThursday = getNextThursday();
            String formattedDate = formatDateForDisplay(nextThursday);

            for(UserInfo user : users) {


                // Set email basics
                helper.setTo(user.getEmail());
                helper.setSubject("Invitation: Appeals Committee Meeting - " + formattedDate);

                // Prepare Thymeleaf context
                Context context = new Context();
                context.setVariable("name", user.getFullName());
                context.setVariable("subject", "Invitation: Appeals Committee Meeting");
                context.setVariable("meetingDate", formattedDate);
                context.setVariable("meetingHour", meetingHour);
                context.setVariable("venue", venue);

                // Process HTML template
                String htmlContent = templateEngine.process("invitationEmail", context);
                helper.setText(htmlContent, true);

                mailSender.send(message);
            }

        } catch (Exception e) {
            throw new RuntimeException("Failed to send email" + e.getMessage());
        }
    }

    /**
     * Calculate the date of the next upcoming Thursday
     */
    private String getNextThursday() {
        LocalDate today = LocalDate.now();
        LocalDate nextThursday = today.with(TemporalAdjusters.nextOrSame(DayOfWeek.THURSDAY));

        // If today is Thursday, use next Thursday instead of today
        if (nextThursday.isEqual(today)) {
            nextThursday = today.with(TemporalAdjusters.next(DayOfWeek.THURSDAY));
        }

        return nextThursday.toString(); // Returns in format: 2023-12-14
    }

    /**
     * Format the date for nice display (e.g., "Thursday, December 14, 2023")
     */
    private String formatDateForDisplay(String dateString) {
        LocalDate date = LocalDate.parse(dateString);
        DateTimeFormatter formatter = DateTimeFormatter.ofPattern("EEEE, MMMM d, yyyy");
        return date.format(formatter);
    }

}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Email/MeetingInfoService.java">
package org.RRA.tax_appeal_system.Email;

import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.Models.MeetingInfo;
import org.RRA.tax_appeal_system.Repositories.MeetingInfoRepo;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalTime;
import java.util.Optional;

@Service
@RequiredArgsConstructor
public class MeetingInfoService {
    private final MeetingInfoRepo meetingInfoRepo;

    @Transactional
    public String insertMeetingVenueAndTime(String venue,LocalTime meetingTime) {
        MeetingInfo meetingInfo = MeetingInfo.builder().meetingVenue(venue).meetingTime(meetingTime).build();
        meetingInfoRepo.save(meetingInfo);
        return "Meeting Info Inserted";
    }

    @Transactional
    public String updateMeetingVenueAndTime(Integer id,String venue,LocalTime meetingTime) {
    MeetingInfo meetingInfo = meetingInfoRepo.findById(id).orElseThrow(()->new IllegalArgumentException("Meeting Information with ID: " +id+" not found"));
    meetingInfo.setMeetingVenue(venue);
    meetingInfo.setMeetingTime(meetingTime);
    meetingInfoRepo.save(meetingInfo);
    return "Meeting Info Updated";
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Enums/AppealStatus.java">
package org.RRA.tax_appeal_system.Enums;

public enum AppealStatus {
    PENDING,
    DISCUSSED
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Enums/CaseStatus.java">
package org.RRA.tax_appeal_system.Enums;

public enum CaseStatus {
    SUBMITTED,
    PENDING,
    RESOLVED,
    PRE_APPEAL,
    READY_FOR_AGENDA,
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Enums/CommitteeGroup.java">
package org.RRA.tax_appeal_system.Enums;

public enum CommitteeGroup {
    APPEAL_COMMITTEE,
    AMICABLE_SETTLEMENT_COMMITTEE,
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Enums/Privilege.java">
package org.RRA.tax_appeal_system.Enums;

public enum Privilege {
    COMMITTEE_LEADER,
    COMMITTEE_MEMBER,
    COMMITTEE_MEMBER_T3_TAM
}
/*
* COMMITTEE_LEADER : represents the Leader of the meeting (Appeal meeting or Amicable)
* COMMITTEE_MEMBER : is a normal member of the committee
* COMMITTEE_MEMBER_T3_TAM : is a member responsible to create and present explanatory Note (Principal Technical Officer in charge of Tax Appeal Management)
* */
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Enums/VoteDecision.java">
package org.RRA.tax_appeal_system.Enums;

public enum VoteDecision {
    WITHBASIS("WithBasis"),
    NOBASIS("NoBasis"),
    ABSTAIN("Abstained");

    private final String displayName;

    VoteDecision(String displayName) {
        this.displayName = displayName;
    }

    public String getDisplayName() {
        return displayName;
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Exceptions/CaseNotFoundException.java">
package org.RRA.tax_appeal_system.Exceptions;

public class CaseNotFoundException extends RuntimeException {
    public CaseNotFoundException(String message) {
        super(message);
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Exceptions/DuplicateCaseSubmissionException.java">
package org.RRA.tax_appeal_system.Exceptions;

import java.util.UUID;

public class DuplicateCaseSubmissionException extends RuntimeException {
    public DuplicateCaseSubmissionException(String caseId) {
        super("Explanatory Note with case Id: " + caseId + " has already been submitted.");
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Exceptions/GlobalExceptionHandler.java">
package org.RRA.tax_appeal_system.Exceptions;

import org.RRA.tax_appeal_system.DTOS.responses.GenericResponse;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.security.authentication.BadCredentialsException;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.security.oauth2.client.ClientAuthorizationRequiredException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;

import java.time.LocalDateTime;

@RestControllerAdvice
public class GlobalExceptionHandler {

    // general Exceptions
    @ExceptionHandler(Exception.class)
    public ResponseEntity<GenericResponse<String>> handleAll(Exception ex) {
        GenericResponse<String> error = new GenericResponse<>(
                 HttpStatus.INTERNAL_SERVER_ERROR.value(),
                "Unexpected server error" ,
                LocalDateTime.now().toString()
        );
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(error);
    }

    @ExceptionHandler(ClientAuthorizationRequiredException.class)
    public ResponseEntity<GenericResponse<String>> handleClientAuthorizationRequired(ClientAuthorizationRequiredException ex) {
        GenericResponse<String> error = new GenericResponse<>(
                HttpStatus.UNAUTHORIZED.value(),
                "OAuth2 authorization required. Please log in with Google.",
                ex.getMessage()
        );
        return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body(error);
    }

    @ExceptionHandler
    public ResponseEntity<String> handleRunTimeException(RuntimeException ex){
        System.out.println(ex.getStackTrace());
        return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(" Something went Wrong " + ex.getMessage() );
    }

    @ExceptionHandler({IllegalArgumentException.class, IllegalStateException.class })
    public ResponseEntity<String> handleIllegalArgument(IllegalArgumentException ex) {
        return ResponseEntity
                .badRequest()
                .body("Invalid error: " + ex.getMessage());
    }

    @ExceptionHandler(BadCredentialsException.class)
    public ResponseEntity<String> handleBadCredentials(BadCredentialsException ex) {
        return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body(ex.getMessage());
    }

    // CUSTOM EXCEPTION

    //Handling Not Found Exception
    @ExceptionHandler(CaseNotFoundException.class)
    public ResponseEntity<GenericResponse<String>> handleCaseNotFound(CaseNotFoundException ex) {
        GenericResponse<String> error =  new GenericResponse<>(
                HttpStatus.NOT_FOUND.value(),
                ex.getMessage(),
                LocalDateTime.now().toString()
        );
        return ResponseEntity.status(HttpStatus.NOT_FOUND).body(error);
    }

    @ExceptionHandler( UsernameNotFoundException.class)
    public ResponseEntity<GenericResponse<String>> handleUserNotFound(UsernameNotFoundException ex) {
        GenericResponse<String> error =  new GenericResponse<>(
                HttpStatus.NOT_FOUND.value(),
                ex.getMessage(),
                LocalDateTime.now().toString()
        );
        return ResponseEntity.status(HttpStatus.NOT_FOUND).body(error);
    }

    // handling duplicate record Exceptions
    @ExceptionHandler(DuplicateCaseSubmissionException.class)
    public ResponseEntity<GenericResponse<String>> handleDuplicateCaseSubmission(DuplicateCaseSubmissionException ex) {
        GenericResponse<String> error =  new GenericResponse<>(
                HttpStatus.CONFLICT.value(),
                ex.getMessage(),
                LocalDateTime.now().toString()
        );

        return ResponseEntity.status(HttpStatus.CONFLICT).body(error);
    }
    @ExceptionHandler(UserAlreadyExistsException.class)
    public ResponseEntity<GenericResponse<String>> handleUserAlreadyExists(UserAlreadyExistsException ex) {
        GenericResponse<String> error =  new GenericResponse<>(
                HttpStatus.CONFLICT.value(),
                ex.getMessage(),
                LocalDateTime.now().toString()
        );

        return ResponseEntity.status(HttpStatus.CONFLICT).body(error);
    }


}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Exceptions/UserAlreadyExistsException.java">
package org.RRA.tax_appeal_system.Exceptions;

public class UserAlreadyExistsException extends RuntimeException {
    public UserAlreadyExistsException(String message) {
        super(message);
    }

}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/filters/JwtAuthFilter.java">
package org.RRA.tax_appeal_system.filters;

import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.Services.AuthServices.JwtService;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.web.authentication.WebAuthenticationDetailsSource;
import org.springframework.stereotype.Component;
import org.springframework.web.filter.OncePerRequestFilter;

import java.io.IOException;

@Component
@RequiredArgsConstructor
public class JwtAuthFilter extends OncePerRequestFilter {

    private final UserDetailsService userDetailsService;
    private final JwtService jwtService;




    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException {
        String authHeader = request.getHeader("Authorization");
        String token = null;
        String username = null;
        String email = null;

        if (authHeader != null && authHeader.startsWith("Bearer ")) {
            token = authHeader.substring(7);
            // in our case the username is represented by email
            username = jwtService.extractUsername(token);
        }

        if (username != null && SecurityContextHolder.getContext().getAuthentication() == null) {
            UserDetails userDetails = userDetailsService.loadUserByUsername(username);
            if (jwtService.validateToken(token, userDetails)) {
                UsernamePasswordAuthenticationToken authToken = new UsernamePasswordAuthenticationToken(
                        userDetails,
                        null,
                        userDetails.getAuthorities());
                authToken.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));
                SecurityContextHolder.getContext().setAuthentication(authToken);
            }
        }
        filterChain.doFilter(request, response);
    }


}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Models/Appeals.java">
package org.RRA.tax_appeal_system.Models;

import jakarta.persistence.*;
import lombok.*;
import org.RRA.tax_appeal_system.Enums.AppealStatus;

import java.util.UUID;

@Entity
@Builder
@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
public class Appeals {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    @Column(name = "appeal_id")
    private UUID appealId;

    @Column(nullable = false,name = "appeal_points")
    private String appealPoint;

    @Lob
    @Column(nullable = false,name = "summarised_problem")
    private String summarisedProblem;

    @Lob
    @Column(nullable = false,name = "basis_of_tax_assessment_by_auditor")
    private String auditorsOpinion;

    @Lob
    @Column(nullable = false,name = "proposed_solution")
    private String proposedSolution;


    @ManyToOne(fetch = FetchType.EAGER)
    @JoinColumn(name = "tax_audited_id",nullable = false)
    private TaxAudited taxAuditedId;
    @ManyToOne
    @JoinColumn(name = "case_id", referencedColumnName = "case_id")
    private CaseInfo caseInfo;
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Models/CaseInfo.java">
package org.RRA.tax_appeal_system.Models;

import jakarta.persistence.*;
import jakarta.validation.constraints.Future;
import lombok.*;
import org.RRA.tax_appeal_system.Enums.CaseStatus;

import java.time.LocalDate;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.UUID;

@Entity
@Builder
@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
public class CaseInfo {
    @Id
    @Column(unique = true,nullable = false,name = "case_id")
    private String caseId;

    @Column(nullable = false,name = "auditor_names")
    private String auditorsNames;

    @Column(nullable = false, name = "tax_assessment_acknowledgement_date_by_taxpayer")
    private LocalDate taxAssessmentAcknowledgementDateByTaxpayer;

    @Column(nullable = false,name = "tax_assessment_time")
    private String taxAssessmentTime;

    @Column(nullable = false,name = "appeal_date")
    private LocalDate appealDate;

    @Future
    @Column(nullable = false,name = "appeal_expire_date")
    private LocalDate appealExpireDate;

    @Column(nullable = false, name = "case_presenter")
    private String casePresenter;

    @Column(nullable = false,name = "tin")
    private String tin;

    @Column(nullable = false,name = "attachment_link")
    private String attachmentLink;

    private CaseStatus status;

    private LocalDate preparatorSubmissionDate;

    @OneToMany(mappedBy = "caseId",cascade = CascadeType.ALL, orphanRemoval = true)
    @Builder.Default
    private List<TaxAudited> taxAudited = new ArrayList<>();

    @OneToOne(mappedBy = "caseId",cascade = CascadeType.ALL)
    private MyCases myCases;

}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Models/CommitteeVote.java">
package org.RRA.tax_appeal_system.Models;

import jakarta.persistence.*;
import lombok.Data;
import org.RRA.tax_appeal_system.Enums.VoteDecision;

import java.time.LocalDateTime;
import java.util.UUID;

@Entity
@Table(name ="committee_votes",
        uniqueConstraints = {
                @UniqueConstraint(columnNames = {"appeal_id", "committee_member_id"})
        }
)
@Data
public class CommitteeVote {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private UUID id;

    @ManyToOne
    @JoinColumn(name = "appeal_id", nullable = false)
    private Appeals appeal;

    @Column(name = "committee_member_id", nullable = false)
    private UUID committeeMemberId;

    @Column(name = "committee_member_name", nullable = false)
    private String committeeMemberName;

    @Enumerated(EnumType.STRING)
    @Column(name = "committee_decision", nullable = false)
    private VoteDecision committeeDecision;

    @Column(name = "vote_comment")
    private String voteComment;

    @Column(name = "voted_at", nullable = false)
    private LocalDateTime votedAt = LocalDateTime.now();
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Models/MeetingInfo.java">
package org.RRA.tax_appeal_system.Models;

import jakarta.persistence.*;
import lombok.*;
import java.time.LocalTime;

@Entity
@Getter
@Setter
@Builder
@RequiredArgsConstructor
@AllArgsConstructor
public class MeetingInfo {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    Integer id;
    @Column(nullable = false,name = "meeting_venue")
    String meetingVenue;
    @Column(nullable = false)
    LocalTime meetingTime;

}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Models/MyCases.java">
package org.RRA.tax_appeal_system.Models;

import jakarta.persistence.*;
import lombok.*;
import org.RRA.tax_appeal_system.Enums.CaseStatus;
import java.util.UUID;

@Entity(name = "my_cases")
@Getter
@Setter
@Builder
@AllArgsConstructor
@RequiredArgsConstructor
public class MyCases {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private UUID id;

    @Column(name = "note_preparator")
    private String notePreparator;

    private CaseStatus status;

    @OneToOne(cascade = CascadeType.ALL, orphanRemoval = true)
    @JoinColumn(name = "case_id",unique = true, nullable = false)
    private CaseInfo caseId;

}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Models/RefreshToken.java">
package org.RRA.tax_appeal_system.Models;

import jakarta.persistence.*;
import lombok.*;

import java.util.Date;

@Entity
@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@Builder
public class RefreshToken {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private int id;

    @Column(nullable = false, unique = true)
    private String token;

    @Column(nullable = false)
    private Date expiryDate;

    @OneToOne
    @JoinColumn(name = "user_id", referencedColumnName = "id")
    private UserInfo userInfo;
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Models/TaxAudited.java">
package org.RRA.tax_appeal_system.Models;

import jakarta.persistence.*;
import lombok.*;

import java.util.ArrayList;
import java.util.List;
import java.util.UUID;

@Entity
@Builder
@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
public class TaxAudited {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    @Column(unique = true, nullable = false,name = "id")
    private UUID id;

    @Column(nullable = false,name = "audited_tax_type")
    private String auditedTaxType;

    @Column(nullable = false,name = "principal_amount_tobe_paid")
    private double principalAmountToBePaid;

    @Column(nullable = false,name = "understatement_fines")
    private double understatementFines;

    @Column(nullable = false,name = "fixed_administrative_fines")
    private double fixedAdministrativeFines;

    @Column(nullable = false,name = "discharged_amount")
    private double dischargedAmount;

    @Column(nullable = false)
    private double otherFines;

    @Column(nullable = false,name = "total_tax_fines_to_be_paid")
    private double totalTaxAndFinesToBePaid;

    @ManyToOne(fetch = FetchType.EAGER)
    @JoinColumn(name = "case_id",nullable = false)
    private CaseInfo caseId;

    @OneToMany(mappedBy = "taxAuditedId", cascade = CascadeType.ALL, orphanRemoval = true)
    @Builder.Default
    private List<Appeals> appeals = new ArrayList<>();
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Models/UserInfo.java">
package org.RRA.tax_appeal_system.Models;


import jakarta.persistence.*;
import lombok.*;
import org.RRA.tax_appeal_system.Enums.CommitteeGroup;
import org.RRA.tax_appeal_system.Enums.Privilege;

import java.util.UUID;

@AllArgsConstructor
@NoArgsConstructor
@Getter
@Builder
@Setter
@Entity
@Table(name = "system_users")
public class UserInfo {
    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private UUID id;
    @Column(name = "names")
    private String fullName;
    @Column(unique = true, nullable = false)
    private String email;
    private String title;
    @Column(nullable = false,name = "committee_group")
    @Enumerated(EnumType.STRING)
    private CommitteeGroup committeeGroup;
    @Column(unique = true,name = "phone",nullable = false)
    private String phoneNumber;
    @Column(nullable = false)
    private String password;
    @Column(nullable = false)
    @Enumerated(EnumType.STRING)
    private Privilege committeeRole;
    @Column(nullable = false)
    private boolean availabilityStatus;
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Repositories/AppealsRepo.java">
package org.RRA.tax_appeal_system.Repositories;

import org.RRA.tax_appeal_system.Models.Appeals;
import org.RRA.tax_appeal_system.Models.TaxAudited;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;
import java.util.List;
import java.util.Optional;
import java.util.UUID;

@Repository
public interface AppealsRepo extends JpaRepository<Appeals, UUID> {
    Optional<Appeals> findByTaxAuditedId_Id(UUID taxAuditedId);

    List<Appeals> findByTaxAuditedId(TaxAudited taxAudited);

    Optional<Appeals> findByAppealId(UUID appealId);
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Repositories/CaseInfoRepo.java">
package org.RRA.tax_appeal_system.Repositories;

import org.RRA.tax_appeal_system.Enums.CaseStatus;
import org.RRA.tax_appeal_system.Models.CaseInfo;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;
import java.util.UUID;

@Repository
public interface CaseInfoRepo extends JpaRepository<CaseInfo, String> {
    boolean existsByCaseId(String caseId);
    Optional<CaseInfo> findByCaseId(String caseId);

    // Added for pre-appeal functionality
    Page<CaseInfo> findByStatus(CaseStatus status, Pageable pageable);

    // Added for agenda functionality to fetch cases with multiple statuses
    Page<CaseInfo> findByStatusIn(List<CaseStatus> statuses, Pageable pageable);
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Repositories/CommitteeVoteRepository.java">
package org.RRA.tax_appeal_system.Repositories;

import org.RRA.tax_appeal_system.Models.Appeals;
import org.RRA.tax_appeal_system.Models.CommitteeVote;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;

import java.util.List;
import java.util.Optional;
import java.util.UUID;

public interface CommitteeVoteRepository extends JpaRepository<CommitteeVote, UUID> {
    @Query("SELECT cv FROM CommitteeVote cv WHERE cv.appeal.appealId = :appealId")
    List<CommitteeVote> findByAppealId(@Param("appealId") UUID appealId);



    @Query("SELECT cv FROM CommitteeVote cv WHERE cv.appeal.appealId = :appealId " +
            "AND cv.committeeMemberId = :committeeMemberId")
    Optional<CommitteeVote> findByAppealIdAndCommitteeMemberId(
            @Param("appealId") UUID appealId,
            @Param("committeeMemberId") UUID committeeMemberId
    );

    int countByAppeal(Appeals appeal);

    List<CommitteeVote> findByAppeal_AppealId(UUID appealId);

    List<CommitteeVote> findByAppeal(Appeals appeal);
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Repositories/MeetingInfoRepo.java">
package org.RRA.tax_appeal_system.Repositories;

import org.RRA.tax_appeal_system.Models.MeetingInfo;
import org.springframework.data.jpa.repository.JpaRepository;

public interface MeetingInfoRepo extends JpaRepository<MeetingInfo, Integer> {
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Repositories/MyCasesRepo.java">
package org.RRA.tax_appeal_system.Repositories;

import org.RRA.tax_appeal_system.Enums.CaseStatus;
import org.RRA.tax_appeal_system.Models.MyCases;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.List;
import java.util.Optional;
import java.util.UUID;

public interface MyCasesRepo extends JpaRepository<MyCases, UUID> {

    List<MyCases> findByNotePreparator(String notePreparator);

    @Query("SELECT mc FROM my_cases mc WHERE mc.caseId.caseId = :caseId")
    Optional<MyCases> findByCaseId(@Param("caseId") String caseId);

    int countByStatus(CaseStatus status);

    @Query("SELECT COUNT(mc) FROM my_cases mc WHERE mc.status IN (org.RRA.tax_appeal_system.Enums.CaseStatus.RESOLVED)")
    int countReviewedCases();

    @Query("SELECT m.month, SUM(m.justified) as justified, SUM(m.unjustified) as unjustified " +
            "FROM (" +
            "   SELECT MONTH(ci.appealDate) as month, a.appealId as appealId, " +
            "   CASE WHEN MAX(CASE WHEN cv.committeeDecision = org.RRA.tax_appeal_system.Enums.VoteDecision.WITHBASIS THEN 1 ELSE 0 END) > 0 THEN 1 ELSE 0 END as justified, " +
            "   CASE WHEN MAX(CASE WHEN cv.committeeDecision = org.RRA.tax_appeal_system.Enums.VoteDecision.NOBASIS THEN 1 ELSE 0 END) > 0 THEN 1 ELSE 0 END as unjustified " +
            "   FROM my_cases mc " +
            "   JOIN mc.caseId ci " +
            "   JOIN ci.taxAudited ta " +
            "   JOIN ta.appeals a " +
            "   LEFT JOIN CommitteeVote cv ON cv.appeal = a " +
            "   WHERE YEAR(ci.appealDate) = YEAR(CURRENT_DATE) " +
            "   GROUP BY MONTH(ci.appealDate), a.appealId" +
            ") m " +
            "GROUP BY m.month " +
            "ORDER BY m.month")
    List<Object[]> getCaseAnalyticsByMonth();

    @Query("SELECT mc FROM my_cases mc WHERE mc.caseId.appealDate >= :startOfWeek")
    List<MyCases> findCasesThisWeek(@Param("startOfWeek") LocalDate startOfWeek);

}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Repositories/RefreshTokenRepository.java">
package org.RRA.tax_appeal_system.Repositories;

import org.RRA.tax_appeal_system.Models.RefreshToken;
import org.RRA.tax_appeal_system.Models.UserInfo;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Modifying;
import org.springframework.stereotype.Repository;

import java.util.Optional;

@Repository
public interface RefreshTokenRepository extends JpaRepository<RefreshToken, Integer> {
    Optional<RefreshToken> findByToken(String token);

    @Modifying
    void deleteByUserInfo(UserInfo userInfo);

    Optional<RefreshToken> findByUserInfo(UserInfo userInfo);
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Repositories/TaxAuditedRepo.java">
package org.RRA.tax_appeal_system.Repositories;

import org.RRA.tax_appeal_system.Models.CaseInfo;
import org.RRA.tax_appeal_system.Models.TaxAudited;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;
import java.util.UUID;

@Repository
public interface TaxAuditedRepo extends JpaRepository<TaxAudited, UUID> {

    List<TaxAudited> findByCaseId(CaseInfo caseInfo);
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Repositories/UserInfoRepo.java">
package org.RRA.tax_appeal_system.Repositories;

import org.RRA.tax_appeal_system.Enums.CommitteeGroup;
import org.RRA.tax_appeal_system.Models.UserInfo;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;
import java.util.UUID;

@Repository
public interface UserInfoRepo extends JpaRepository<UserInfo, UUID> {
    Optional<UserInfo> findByEmail(String email);
    Optional<UserInfo> findById(UUID id);

    boolean existsByEmail(String email);

    boolean existsByPhoneNumber(String phoneNumber);

    List<UserInfo> findAllByCommitteeGroup(CommitteeGroup committeeGroup);

    List<UserInfo> findAllByCommitteeGroupAndAvailabilityStatus(CommitteeGroup committeeGroup, Boolean availabilityStatus);

    int countAllByCommitteeGroup(CommitteeGroup committeeGroup);

    int countByAvailabilityStatus(Boolean availabilityStatus);
    int countByCommitteeGroupAndAvailabilityStatus(CommitteeGroup committeeGroup, Boolean availabilityStatus);

    List<UserInfo> findByCommitteeGroup(CommitteeGroup committeeGroup);
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Security/CustomOAuth2AuthenticationSuccessHandler.java">
package org.RRA.tax_appeal_system.Security;

import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import org.springframework.security.core.Authentication;
import org.springframework.security.web.authentication.AuthenticationSuccessHandler;
import org.springframework.stereotype.Component;

import java.io.IOException;

@Component
public class CustomOAuth2AuthenticationSuccessHandler implements AuthenticationSuccessHandler {

    @Override
    public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {
        // After a successful Google login, this handler is triggered.
        // It redirects the user's browser back to the frontend chat page.
        // The browser will now have the necessary session cookie for the backend.
        response.sendRedirect("http://localhost:3000/chat");
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Security/SecurityConfig.java">
package org.RRA.tax_appeal_system.Security;

import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.filters.JwtAuthFilter;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.annotation.Order;
import org.springframework.http.HttpMethod;
import org.springframework.http.HttpStatus;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.AuthenticationProvider;
import org.springframework.security.authentication.dao.DaoAuthenticationProvider;
import org.springframework.security.config.Customizer;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.HttpStatusEntryPoint;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
@EnableWebSecurity
@RequiredArgsConstructor
public class SecurityConfig {

    private final JwtAuthFilter jwtAuthFilter;
    private final UserDetailsService userDetailsService;
    private final CustomOAuth2AuthenticationSuccessHandler customOAuth2AuthenticationSuccessHandler;



    @Bean
    @Order(1)
    public SecurityFilterChain oauth2StatefulFilterChain(HttpSecurity http) throws Exception {
        http
                // THIS IS THE CRITICAL ADDITION
                .cors(cors -> cors.configurationSource(request -> {
                    var corsConfiguration = new org.springframework.web.cors.CorsConfiguration();
                    corsConfiguration.setAllowedOrigins(java.util.List.of("http://localhost:3000")); // Your frontend URL
                    corsConfiguration.setAllowedMethods(java.util.List.of("GET", "POST", "PUT", "DELETE", "OPTIONS"));
                    corsConfiguration.setAllowedHeaders(java.util.List.of("*"));
                    corsConfiguration.setAllowCredentials(true);
                    return corsConfiguration;
                })).csrf(csrf -> csrf.disable())
                // The security matcher is correct
                .securityMatcher("/login/oauth2/**", "/oauth2/**", "/api/v1/meetings/create")
                .authorizeHttpRequests(auth -> auth
                        .anyRequest().authenticated()
                )
                .oauth2Login(oauth2 -> oauth2
                        .successHandler(customOAuth2AuthenticationSuccessHandler)
                )
                .exceptionHandling(e -> e
                        .authenticationEntryPoint(new HttpStatusEntryPoint(HttpStatus.UNAUTHORIZED))
                );

        return http.build();
    }



    @Bean
    @Order(2)
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                // Enable CORS (or disable if you handle it globally)
                .cors(cors -> cors.configurationSource(request -> {
                    var corsConfiguration = new org.springframework.web.cors.CorsConfiguration();
                    corsConfiguration.setAllowedOrigins(java.util.List.of("http://localhost:3000")); // Your frontend URL
                    corsConfiguration.setAllowedMethods(java.util.List.of("GET", "POST", "PUT", "DELETE", "OPTIONS"));
                    corsConfiguration.setAllowedHeaders(java.util.List.of("*"));
                    corsConfiguration.setAllowCredentials(true);
                    return corsConfiguration;
                }))
                // Disable CSRF for stateless JWT
                .csrf(csrf -> csrf.disable())
                // Configure endpoint authorization
                .authorizeHttpRequests(auth -> auth
                        // Public endpoints
                        .requestMatchers(
                                "/api/v1/auth/login",
                                "/api/v1/auth/register",
                                "/api/v1/auth/refresh-token/**",
                                "/api-docs/**",
                                "/swagger-ui/**"
                        ).permitAll()
                        .requestMatchers(HttpMethod.GET, "/api/appeals/**").authenticated()
                        // Role-based endpoints
                        .requestMatchers("/api/v1/auth/user/**").hasAuthority("COMMITTEE_MEMBER")
                        .requestMatchers("/api/v1/auth/user/**","/api/v1/auth/explanatory_note").hasAuthority("COMMITTEE_MEMBER_T3_TAM")
                        .requestMatchers("/api/v1/auth/admin/**").hasAuthority("COMMITTEE_LEADER")

                        // All other endpoints require authentication
                        .anyRequest().authenticated()
                )
                // Stateless session (required for JWT)
                .sessionManagement(sess -> sess.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                // Set custom authentication provider
                .authenticationProvider(authenticationProvider())
                // Add JWT filter before Spring Security's default filter
                .addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class);

        return http.build();
    }

    // BCrypt password encoder
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    // Authentication provider
    @Bean
    public AuthenticationProvider authenticationProvider() {
        DaoAuthenticationProvider provider = new DaoAuthenticationProvider();
        provider.setUserDetailsService(userDetailsService);
        provider.setPasswordEncoder(passwordEncoder());
        return provider;
    }

    // Authentication manager
    @Bean
    public AuthenticationManager authenticationManager(AuthenticationConfiguration config) throws Exception {
        return config.getAuthenticationManager();
    }

    // Optional: global CORS configuration (allow Swagger UI to access API)
    @Bean
    public WebMvcConfigurer corsConfigurer() {
        return new WebMvcConfigurer() {
            @Override
            public void addCorsMappings(CorsRegistry registry) {
                registry.addMapping("/**")
                        .allowedOrigins("*")   // allow all origins (for testing)
                        .allowedMethods("*")
                        .allowedHeaders("*");
            }
        };
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/AuthServices/AuthService.java">
package org.RRA.tax_appeal_system.Services.AuthServices;

import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.DTOS.requests.LoginRequest;
import org.RRA.tax_appeal_system.DTOS.requests.RegisterUser;
import org.RRA.tax_appeal_system.DTOS.responses.AuthResponse;
import org.RRA.tax_appeal_system.DTOS.responses.GenericResponse;
import org.RRA.tax_appeal_system.Exceptions.UserAlreadyExistsException;
import org.RRA.tax_appeal_system.Models.UserInfo;
import org.RRA.tax_appeal_system.Repositories.RefreshTokenRepository;
import org.RRA.tax_appeal_system.Repositories.UserInfoRepo;
import org.RRA.tax_appeal_system.Services.UserInfoDetails;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.BadCredentialsException;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@Service
@RequiredArgsConstructor
public class AuthService {
    private final UserInfoRepo userRepo;
    private final PasswordEncoder passwordEncoder;
    private final AuthenticationManager authenticationManager;

    private final JwtService jwtService;
    @Autowired
    private RefreshTokenRepository refreshTokenRepository;

    public boolean userExists(String email,String phoneNumber) {
        return userRepo.existsByEmail(email) || userRepo.existsByPhoneNumber(phoneNumber);
    }

    @Transactional
    public UserInfo registerUser(RegisterUser userinfo) {

        //check whether the user exists

        if (userExists(userinfo.email(), userinfo.phoneNumber())) {
            throw new UserAlreadyExistsException("user with " + userinfo.email() + " and " + userinfo
                    .phoneNumber() + " already exists !");
        }

        // User registration
        UserInfo user = UserInfo.builder()
                .fullName(userinfo.fullName())
                .email(userinfo.email())
                .title(userinfo.title())
                .committeeGroup(userinfo.committeeGroup())
                .phoneNumber(userinfo.phoneNumber())
                .password(passwordEncoder.encode(userinfo.password()))
                .committeeRole(userinfo.committeeRole())
                .availabilityStatus(true)
                .build();

        // saving the user
        UserInfo savedUser = userRepo.save(user);
        System.out.println("User saved successfully");

        return savedUser;
    }

    public AuthResponse login (LoginRequest request) throws UsernameNotFoundException {
        //check whether even the userExists
        if(!userRepo.existsByEmail(request.getEmail())){
            throw new UsernameNotFoundException("user with " + request.getEmail() + " not found");
        }
        try {
            //Authenticating the user
            Authentication authentication = authenticationManager.authenticate(
                    new UsernamePasswordAuthenticationToken(request.getEmail(), request.getPassword())
            );

            // Set authentication in security context
            SecurityContextHolder.getContext().setAuthentication(authentication);

            // Retrieve the UserDetails object from the Authentication
            UserInfoDetails userDetails = (UserInfoDetails) authentication.getPrincipal();

            // Check if the user already has a valid token
            UserInfo userInfo = userRepo.findByEmail(userDetails.getUsername())
                    .orElseThrow(() -> new UsernameNotFoundException("User with " + userDetails.getUsername() + " not found"));


            // 3. Generate a new token
            String accessToken = jwtService.generateAccessToken(userDetails.getUsername());
            String refreshToken = jwtService.generateRefreshToken(userDetails.getUsername());

            // 4. Return the custom response with user data and the new token
            return new AuthResponse(userInfo.getId(),userInfo.getFullName(), userInfo.getEmail(), userInfo.getCommitteeRole().toString(), accessToken, refreshToken);
        }catch (BadCredentialsException e){
            // If authentication fails
            throw new BadCredentialsException("Invalid username or password");
        }
    }

    @Transactional
    public ResponseEntity<GenericResponse<String>> logout(String userEmail) {
        try {

            // 1. Retrieve the UserInfo object
            System.out.println(" finding user with " + userEmail);
            UserInfo userInfo = userRepo.findByEmail(userEmail)
                    .orElseThrow(() -> new UsernameNotFoundException("User not found for logout"));


            // 2. Delete the refresh token from the database
            // Convert UUID to String for the repository method
            refreshTokenRepository.deleteByUserInfo(userInfo);

            // 3. Clear the Security Context
            SecurityContextHolder.clearContext();

            // 4. Return consistent response
            GenericResponse<String> response = new GenericResponse<>(
                    200,
                    "Logout successful.",
                    null
            );

            return ResponseEntity.ok(response);

        } catch (UsernameNotFoundException e) {
            GenericResponse<String> errorResponse = new GenericResponse<>(
                    404,
                    e.getMessage(),
                    null
            );
            return ResponseEntity.status(HttpStatus.NOT_FOUND).body(errorResponse);
        } catch (Exception e) {
            GenericResponse<String> errorResponse = new GenericResponse<>(
                    500,
                    "Logout failed",
                    null
            );
            System.out.println("ERROR: [ " + e.getMessage() + " ]");
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);
        }
    }

    @Transactional
    public  AuthResponse refreshToken(String refreshToken) {

        return jwtService.findByToken(refreshToken)
                .map(token -> {
                    jwtService.verifyExpiration(token); // Check if expired

                    // Generate new Access Token
                    String newAccessToken = jwtService.generateAccessToken(token.getUserInfo().getEmail());
                    // Generate and save a new Refresh Token
                    String newRefreshToken = jwtService.generateRefreshToken(token.getUserInfo().getEmail());

                    // Return new tokens and user details
                    return new AuthResponse(
                            token.getUserInfo().getId(),
                            token.getUserInfo().getFullName(),
                            token.getUserInfo().getEmail(),
                            token.getUserInfo().getCommitteeRole().toString(),
                            newAccessToken,
                            newRefreshToken
                    );
                })
                .orElseThrow(() -> new RuntimeException("Refresh token is not in database!"));
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/AuthServices/JwtService.java">
package org.RRA.tax_appeal_system.Services.AuthServices;

import io.jsonwebtoken.*;
import io.jsonwebtoken.io.Decoders;
import io.jsonwebtoken.security.Keys;
import io.jsonwebtoken.security.SignatureException;
import lombok.extern.slf4j.Slf4j;
import org.RRA.tax_appeal_system.Models.RefreshToken;
import org.RRA.tax_appeal_system.Models.UserInfo;
import org.RRA.tax_appeal_system.Repositories.RefreshTokenRepository;
import org.RRA.tax_appeal_system.Repositories.UserInfoRepo;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.stereotype.Component;

import javax.crypto.SecretKey;
import java.security.Key;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;
import java.util.Optional;
import java.util.function.Function;

@Component
@Slf4j
public class JwtService {
    @Autowired
    private RefreshTokenRepository refreshTokenRepository;
    @Autowired
    private UserInfoRepo userInfoRepo;

    @Value("${app.jwt.secret}")
    private String JWT_SECRET;
    @Value("${app.jwt.expiration}")
    private long jwtExpirationInMs;
    @Value("${app.jwt.refresh-expiration}")
    private long refreshExpirationInMs;

    Date now=new Date();

    // generating Access Token
    public String generateAccessToken(String email) { // Use email as username
        Map<String, Object> claims = new HashMap<>();
        return generateToken(email,jwtExpirationInMs,claims);
    }



    //Generating Refresh token
    public String generateRefreshToken(String email) { // Use email as username
        Map<String, String> claims = new HashMap<>();
        claims.put("tokenType", "refresh_token");
        String refreshTokenString = generateToken(email, refreshExpirationInMs, claims);
        UserInfo userInfo = userInfoRepo.findByEmail(email).orElse(null);

        // Check if a refresh token already exists for this user
        Optional<RefreshToken> existingToken = refreshTokenRepository.findByUserInfo(userInfo);

        RefreshToken refreshToken;
        if (existingToken.isPresent()) {

            //updating the existing token
            refreshToken = existingToken.get();
            refreshToken.setToken(refreshTokenString);
            refreshToken.setExpiryDate(new Date(now.getTime() + jwtExpirationInMs));
        } else {
            //create a new Token
            refreshToken = RefreshToken.builder()
                    .userInfo(userInfo)
                    .token(refreshTokenString)
                    // Note: Use the dedicated refreshExpirationInMs property
                    .expiryDate(new Date(now.getTime() + refreshExpirationInMs))
                    .build();


        }
        refreshTokenRepository.save(refreshToken);
        return refreshTokenString;
    }

    // Method to find the stored token by its string value
    public Optional<RefreshToken> findByToken(String token) {
        return refreshTokenRepository.findByToken(token);
    }

    // Method to verify if the stored refresh token is expired
    public void verifyExpiration(RefreshToken token) {
        if (token.getExpiryDate().before(new Date())) {
            refreshTokenRepository.delete(token);
            throw new RuntimeException("Refresh token was expired. Please make a new sign-in request");
        }
    }
    // Token generation
    private String generateToken(String email,long expirationInMs,Map<String,?> claims) {
        return Jwts.builder()
                .setClaims(claims)
                .setSubject(email)
                .setIssuedAt(now)
                .setExpiration(new Date(now.getTime()+expirationInMs)) // our token will last for 60 minutes
                .signWith(getSignKey(), SignatureAlgorithm.HS256)
                .compact();
    }

    private Key getSignKey() {
        byte[] keyBytes = Decoders.BASE64.decode(JWT_SECRET);
        return Keys.hmacShaKeyFor(keyBytes);
    }

    public String extractUsername(String token) {
        return extractClaim(token, Claims::getSubject);
    }

    public Date extractExpiration(String token) {
        return extractClaim(token, Claims::getExpiration);
    }

    public <T> T extractClaim(String token, Function<Claims, T> claimsResolver) {
        final Claims claims = extractAllClaims(token);
        return claimsResolver.apply(claims);
    }

    private Claims extractAllClaims(String token) {
        return Jwts.parser()
                // Use verifyWith() or parserWith() - Both are valid in 0.12.5
                .verifyWith((SecretKey) getSignKey())
                .build()
                .parseSignedClaims(token) // Use parseSignedClaims for claims
                .getPayload();
    }


    private Boolean isTokenExpired(String token) {
        return extractExpiration(token).before(now);
    }

    public Boolean validateToken(String token, UserDetails userDetails) {
        final String username = extractUsername(token);
        if (username.equals(userDetails.getUsername()) && !isTokenExpired(token)){
            try {
                Jwts.parser().verifyWith((SecretKey) getSignKey()).build().parseSignedClaims(token);
                return true;
            }catch (SignatureException e){
                log.error("Invalid JWT signature", e.getMessage());
            }catch (MalformedJwtException e){
                log.error("Invalid JWT token", e.getMessage());
            }catch (ExpiredJwtException e){
                log.error("JWT token is expired", e.getMessage());
            }catch (UnsupportedJwtException e){
                log.error("JWT token is unsupported", e.getMessage());
            }catch (IllegalArgumentException e){
                log.error("JWT claims string is empty", e.getMessage());
            }
        }
        return false;
    };

    //  Validate if the token is refresh token
    public boolean isRefreshTokenValid(String token) {
        Claims claims = Jwts.parser()
                .verifyWith((SecretKey) getSignKey())
                .build()
                .parseSignedClaims(token)
                .getPayload();
        return "refresh_token".equals(claims.getSubject());
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/ExplanatoryNoteService.java">
package org.RRA.tax_appeal_system.Services;

import org.RRA.tax_appeal_system.Models.*;
import org.RRA.tax_appeal_system.Repositories.*;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageImpl;
import org.springframework.data.domain.Pageable;

import java.time.LocalDate;
import java.time.temporal.ChronoUnit;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Comparator;
import java.util.List;
import jakarta.transaction.Transactional;
import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.DTOS.requests.AppealDetailsDTO;
import org.RRA.tax_appeal_system.DTOS.requests.AuditedTaxDTO;
import org.RRA.tax_appeal_system.DTOS.responses.*;
import org.RRA.tax_appeal_system.Enums.CaseStatus;
import org.RRA.tax_appeal_system.Exceptions.CaseNotFoundException;
import org.RRA.tax_appeal_system.Exceptions.DuplicateCaseSubmissionException;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import org.springframework.stereotype.Service;


import java.util.UUID;
import java.util.stream.Collectors;

@Service
@RequiredArgsConstructor
public class ExplanatoryNoteService {

    private final CaseInfoRepo caseInfoRepo;
    private final MyCasesRepo myCasesRepo;
    private final AppealsRepo appealsRepo;
    private final TaxAuditedRepo taxAuditedRepo;
    private final UserInfoRepo userInfoRepo;
    private final CommitteeVoteRepository committeeVoteRepository;
    // logger used with logs that helps with Auditing
    private static final Logger logger = LoggerFactory.getLogger(ExplanatoryNoteService.class);

    //EXPLANATORY NOTE
    //Generating a new explanatory note
    @Transactional
    public void generateExplanatoryNote(ExplanatoryNoteDTO explanatoryNote,String notePreparatorEmail) {
        LocalDate now = LocalDate.now();
        // Check if an explanatory note wit the same case Id it was not submitted already
        if(caseInfoRepo.existsByCaseId(explanatoryNote.caseId())) {
            throw new DuplicateCaseSubmissionException(explanatoryNote.caseId());
        }


        // saving for Case Info
        CaseInfo caseInfoEntity = CaseInfo.builder()
                .caseId(explanatoryNote.caseId())
                .auditorsNames(explanatoryNote.auditorsName())
                .taxAssessmentAcknowledgementDateByTaxpayer(explanatoryNote.taxAssessmentAcknowledgementDateByTaxpayer())
                .taxAssessmentTime(explanatoryNote.taxAssessmentTime())
                .appealDate(explanatoryNote.appealDate())
                .appealExpireDate(explanatoryNote.appealExpireDate())
                .casePresenter(explanatoryNote.casePresenter())
                .status(CaseStatus.SUBMITTED)  // Changed from PRE_APPEAL to SUBMITTED
                .preparatorSubmissionDate(now)
                .tin(explanatoryNote.tin())
                .attachmentLink(explanatoryNote.attachmentLink())
                .build();

        CaseInfo savedCaseInfo = caseInfoRepo.save(caseInfoEntity);


        //Saving for audited Tax by mapping through them
        for (AuditedTaxDTO auditedTaxDTO: explanatoryNote.taxAudited()) {

            TaxAudited taxAuditedEntity = TaxAudited.builder()
                    .auditedTaxType(auditedTaxDTO.taxTypeAudited())
                    .principalAmountToBePaid(auditedTaxDTO.principalAmountToBePaid())
                    .understatementFines(auditedTaxDTO.understatementFines())
                    .fixedAdministrativeFines(auditedTaxDTO.fixedAdministrativeFines())
                    .dischargedAmount(auditedTaxDTO.dischargedAmount())
                    .otherFines(auditedTaxDTO.otherFines())
                    .totalTaxAndFinesToBePaid(auditedTaxDTO.totalTaxAndFinesToBePaid())
                    .caseId(savedCaseInfo)
                    .build();

            TaxAudited savedTaxAudited = taxAuditedRepo.save(taxAuditedEntity);


            //saving for appeals by mapping through them
            for (AppealDetailsDTO appealDetailsDTO : auditedTaxDTO.appeals()){
                Appeals appealsEntity =  Appeals.builder()
                        .appealPoint(appealDetailsDTO.appealPoint())
                        .summarisedProblem(appealDetailsDTO.summarisedProblem())
                        .auditorsOpinion(appealDetailsDTO.auditorsOpinion())
                        .proposedSolution(appealDetailsDTO.proposedSolution())
                        .taxAuditedId(savedTaxAudited)
                        .build();


                appealsRepo.save(appealsEntity);
            }
        }

        // saving in MyCases Entity
        saveMyCases(explanatoryNote.caseId(), notePreparatorEmail);

    }

    @Transactional
    // Getting Explanatory note by caseId
    public ExplanatoryNoteResponseDTO getExplanatoryNoteByCaseId(String caseId) {
        // Find the case info by caseId
        CaseInfo caseInfo = caseInfoRepo.findByCaseId(caseId)
                .orElseThrow(() -> new CaseNotFoundException("Case with ID " + caseId + " not found"));

        // Find all tax audited records for this case
        List<TaxAudited> taxAuditedList = taxAuditedRepo.findByCaseId(caseInfo);

        // Convert to DTOs
        List<TaxAuditedDTO> taxAuditedDTOs = taxAuditedList.stream()
                .map(this::convertToAuditedTaxDTO)
                .collect(Collectors.toList());

        // Build and return the main explanatory note response
        return new ExplanatoryNoteResponseDTO(
                caseInfo.getCaseId(),
                caseInfo.getAuditorsNames(),
                caseInfo.getTaxAssessmentAcknowledgementDateByTaxpayer(),
                caseInfo.getTaxAssessmentTime(),
                caseInfo.getAppealDate(),
                caseInfo.getAppealExpireDate(),
                caseInfo.getCasePresenter(),
                caseInfo.getTin(),
                caseInfo.getAttachmentLink(),
                caseInfo.getStatus(),
                caseInfo.getPreparatorSubmissionDate(),
                taxAuditedDTOs
        );
    }

    private TaxAuditedDTO convertToAuditedTaxDTO(TaxAudited taxAudited) {
        // Find all appeals for this tax audited record
        List<Appeals> appealsList = appealsRepo.findByTaxAuditedId(taxAudited);

        // Convert appeals to DTOs
        List<AppealDTO> appealDTOs = appealsList.stream()
                .map(this::convertToAppealDetailsDTO)
                .collect(Collectors.toList());

        return new TaxAuditedDTO(
                taxAudited.getId(),
                taxAudited.getAuditedTaxType(),
                taxAudited.getPrincipalAmountToBePaid(),
                taxAudited.getUnderstatementFines(),
                taxAudited.getFixedAdministrativeFines(),
                taxAudited.getDischargedAmount(),
                taxAudited.getOtherFines(),
                taxAudited.getTotalTaxAndFinesToBePaid(),
                appealDTOs
        );
    }

    private AppealDTO convertToAppealDetailsDTO(Appeals appeal) {
        return new AppealDTO(
                appeal.getAppealId(),
                appeal.getAppealPoint(),
                appeal.getSummarisedProblem(),
                appeal.getAuditorsOpinion(),
                appeal.getProposedSolution()

        );
    }

    @Transactional
    public void deleteExplanatoryNoteByCaseId(String caseId) {


            // finding CaseInfo with that CaseId
            CaseInfo caseInfo = caseInfoRepo.findByCaseId(caseId).orElseThrow(() -> new CaseNotFoundException("Case with ID " + caseId + " not found"));

            //finding All Related Tax Audited
            List<TaxAudited> taxAuditedList = taxAuditedRepo.findByCaseId(caseInfo);

            for (TaxAudited taxAudited : taxAuditedList) {
                List<Appeals> appeals = appealsRepo.findByTaxAuditedId(taxAudited);
                //deleted All Appeals in Each taxAudited
                appealsRepo.deleteAll(appeals);
            }

            //Deleting Tax Audited
            taxAuditedRepo.deleteAll(taxAuditedList);

            //we have to delete the Records in My Cases with the caseInfo with the provided ID
            if (caseInfo.getMyCases() != null) {
                MyCases case1 = myCasesRepo.findByCaseId(caseInfo.getCaseId()).orElseThrow(() -> new CaseNotFoundException("Case with ID " + caseInfo + " not found in My Cases Entity"));
                myCasesRepo.delete(case1);
            }

            // finally deleting Case Info
             caseInfoRepo.delete(caseInfo);
    }

    @Transactional
    public void updatingExplanatoryNoteByCaseId(String caseId,ExplanatoryNoteDTO newExplanatoryNote,String notePreparator) {
        // Find the case
        CaseInfo caseInfo = caseInfoRepo.findByCaseId(caseId)
                .orElseThrow(() -> new CaseNotFoundException("Case with ID " + caseId + " not found in My Cases Entity"));

        // Get the current status
        CaseStatus currentStatus = caseInfo.getStatus();

        // Deleting the Existing Explanatory Note
        deleteExplanatoryNoteByCaseId(caseId);

        // Registering new Note
        generateExplanatoryNote(newExplanatoryNote, notePreparator);

        // Restore the original status
        CaseInfo updatedCaseInfo = caseInfoRepo.findByCaseId(caseId)
                .orElseThrow(() -> new CaseNotFoundException("Case with ID " + caseId + " not found"));
        updatedCaseInfo.setStatus(currentStatus);
        caseInfoRepo.save(updatedCaseInfo);

        // Update the status in MyCases as well
        MyCases myCases = myCasesRepo.findByCaseId(caseId)
                .orElseThrow(() -> new CaseNotFoundException("Case with ID " + caseId + " not found in My Cases"));
        myCases.setStatus(currentStatus);
        myCasesRepo.save(myCases);
    }



    // MY CASES
    @Transactional
    public void saveMyCases(String caseId,String email){
        CaseInfo caseInfo = caseInfoRepo.findByCaseId(caseId).orElseThrow();

        // saving also in myCases Entity
        MyCases myCasesEntity = MyCases.builder()
                .caseId(caseInfo)
                .notePreparator(email)
                .status(CaseStatus.SUBMITTED)  // Using SUBMITTED as the initial status
                .build();
        myCasesRepo.save(myCasesEntity);
    }

    //AGENDA

    public Page<AgendaDTO> agenda(Pageable pageable) {
        // Fetch cases with READY_FOR_AGENDA, PENDING, or RESOLVED status with pagination
        // This ensures cases remain in the Agenda even after resolution
        List<CaseStatus> agendaStatuses = Arrays.asList(CaseStatus.READY_FOR_AGENDA, CaseStatus.PENDING, CaseStatus.RESOLVED);
        Page<CaseInfo> allCases = caseInfoRepo.findByStatusIn(agendaStatuses, pageable);

        List<AgendaDTO> agendaDTOList = new ArrayList<>();
        LocalDate today = LocalDate.now();

        // Process each case in the current page
        for(CaseInfo caseInfo : allCases.getContent()){


            // Calculate days left
            long daysLeft = 0;
            if (caseInfo.getAppealExpireDate() != null) {
                daysLeft = ChronoUnit.DAYS.between(today, caseInfo.getAppealExpireDate());
                daysLeft = Math.max(daysLeft, 0);
            }

            // Calculate tax amounts
            List<TaxAudited> taxAuditedList = taxAuditedRepo.findByCaseId(caseInfo);
            double amountDischarged = 0;
            double taxOriginallyAssessed = 0;

            for (TaxAudited taxAudited : taxAuditedList){
                amountDischarged += taxAudited.getDischargedAmount();
                taxOriginallyAssessed += taxAudited.getTotalTaxAndFinesToBePaid();
            }

            double taxToBePaid = taxOriginallyAssessed - amountDischarged;
            if (taxToBePaid < 0) {
                throw new ArithmeticException("Tax To Be Paid can't be Negative");
            }

            // Create DTO
            AgendaDTO agendaDTO = new AgendaDTO(
                    caseInfo.getCaseId(),
                    "taxPayerName", // hardcoded
                    caseInfo.getCasePresenter(),
                    caseInfo.getTin(),
                    caseInfo.getStatus(),
                    daysLeft,
                    caseInfo.getAppealDate(),
                    amountDischarged,
                    taxToBePaid,
                    caseInfo.getAuditorsNames()
            );

            agendaDTOList.add(agendaDTO);
        }

        // Sort by daysLeft (ascending - cases with least days left first)
        agendaDTOList.sort(Comparator.comparingLong(AgendaDTO::daysLeft));
        agendaDTOList.sort(
                // 1. Primary Sort: Sort by Status
                Comparator.comparing((AgendaDTO agenda) -> agenda.caseStatus() != CaseStatus.PENDING)
                        // 2. Secondary Sort: Sort by daysLeft
                        .thenComparingLong(AgendaDTO::daysLeft)
        );

        // Return proper Page implementation
        return new PageImpl<>(
                agendaDTOList,
                pageable,
                allCases.getTotalElements()
        );
    }
    public String getCommentOnAppealPoint(UUID appealId) {
        List<CommitteeVote> votes = committeeVoteRepository.findByAppeal_AppealId(appealId);

        if (votes.isEmpty()) {
            return null;  // No votes found for this appeal
        }

        StringBuilder commentsBuilder = new StringBuilder();

        for (CommitteeVote vote : votes) {
            String comment = vote.getVoteComment();
            if (comment != null && !comment.trim().isEmpty()) {
                if (commentsBuilder.length() > 0) {
                    commentsBuilder.append("\n\n");  // Separate multiple comments with new lines
                }
                commentsBuilder.append(comment);
            }
        }

        String finalComments = commentsBuilder.toString().trim();
        return finalComments.isEmpty() ? null : finalComments;
    }

    // PRE-APPEAL METHODS

    /**
     * Get all cases in pre-appeal status
     */
    public Page<AgendaDTO> getPreAppealCases(Pageable pageable) {
        // Fetch all cases with PRE_APPEAL status with pagination
        Page<CaseInfo> preAppealCases = caseInfoRepo.findByStatus(CaseStatus.PRE_APPEAL, pageable);

        List<AgendaDTO> agendaDTOList = new ArrayList<>();
        LocalDate today = LocalDate.now();

        // Process each case in the current page
        for(CaseInfo caseInfo : preAppealCases.getContent()){
            // Calculate days left
            long daysLeft = 0;
            if (caseInfo.getAppealExpireDate() != null) {
                daysLeft = ChronoUnit.DAYS.between(today, caseInfo.getAppealExpireDate());
                daysLeft = Math.max(daysLeft, 0);
            }

            // Calculate tax amounts
            List<TaxAudited> taxAuditedList = taxAuditedRepo.findByCaseId(caseInfo);
            double amountDischarged = 0;
            double taxOriginallyAssessed = 0;

            for (TaxAudited taxAudited : taxAuditedList){
                amountDischarged += taxAudited.getDischargedAmount();
                taxOriginallyAssessed += taxAudited.getTotalTaxAndFinesToBePaid();
            }

            double taxToBePaid = taxOriginallyAssessed - amountDischarged;
            if (taxToBePaid < 0) {
                throw new ArithmeticException("Tax To Be Paid can't be Negative");
            }

            // Create DTO
            AgendaDTO agendaDTO = new AgendaDTO(
                    caseInfo.getCaseId(),
                    "taxPayerName", // hardcoded
                    caseInfo.getCasePresenter(),
                    caseInfo.getTin(),
                    caseInfo.getStatus(),
                    daysLeft,
                    caseInfo.getAppealDate(),
                    amountDischarged,
                    taxToBePaid,
                    caseInfo.getAuditorsNames()
            );

            agendaDTOList.add(agendaDTO);
        }

        // Sort by daysLeft (ascending - cases with least days left first)
        agendaDTOList.sort(Comparator.comparingLong(AgendaDTO::daysLeft));

        // Return proper Page implementation
        return new PageImpl<>(
                agendaDTOList,
                pageable,
                preAppealCases.getTotalElements()
        );
    }

    /**
     * Move a case from pre-appeal to agenda
     */
    @Transactional
    public void moveToAgenda(String caseId) {
        // Find the case
        CaseInfo caseInfo = caseInfoRepo.findByCaseId(caseId)
                .orElseThrow(() -> new CaseNotFoundException("Case with ID " + caseId + " not found"));

        // Check if the case is in pre-appeal status
        if (caseInfo.getStatus() != CaseStatus.PRE_APPEAL) {
            throw new IllegalStateException("Case is not in PRE_APPEAL status");
        }

        // Update the status to READY_FOR_AGENDA
        caseInfo.setStatus(CaseStatus.READY_FOR_AGENDA);
        caseInfoRepo.save(caseInfo);

        // Update the status in MyCases as well
        MyCases myCases = myCasesRepo.findByCaseId(caseId)
                .orElseThrow(() -> new CaseNotFoundException("Case with ID " + caseId + " not found in My Cases"));
        myCases.setStatus(CaseStatus.READY_FOR_AGENDA);
        myCasesRepo.save(myCases);
    }

    /**
     * Save updated note without changing status
     */
    @Transactional
    public void saveNote(String caseId, ExplanatoryNoteDTO explanatoryNote, String notePreparator) {
        // Find the case
        CaseInfo caseInfo = caseInfoRepo.findByCaseId(caseId)
                .orElseThrow(() -> new CaseNotFoundException("Case with ID " + caseId + " not found"));

        // Get the current status
        CaseStatus currentStatus = caseInfo.getStatus();

        // Delete the existing note
        deleteExplanatoryNoteByCaseId(caseId);

        // Generate a new note
        generateExplanatoryNote(explanatoryNote, notePreparator);

        // Restore the original status
        CaseInfo updatedCaseInfo = caseInfoRepo.findByCaseId(caseId)
                .orElseThrow(() -> new CaseNotFoundException("Case with ID " + caseId + " not found"));
        updatedCaseInfo.setStatus(currentStatus);
        caseInfoRepo.save(updatedCaseInfo);

        // Update the status in MyCases as well
        MyCases myCases = myCasesRepo.findByCaseId(caseId)
                .orElseThrow(() -> new CaseNotFoundException("Case with ID " + caseId + " not found in My Cases"));
        myCases.setStatus(currentStatus);
        myCasesRepo.save(myCases);
    }

    /**
     * Move a case to pre-appeal status
     */
    @Transactional
    public void moveToPreAppeal(String caseId) {
        // Find the case
        CaseInfo caseInfo = caseInfoRepo.findByCaseId(caseId)
                .orElseThrow(() -> new CaseNotFoundException("Case with ID " + caseId + " not found"));

        // Update the status to PRE_APPEAL
        caseInfo.setStatus(CaseStatus.PRE_APPEAL);
        caseInfoRepo.save(caseInfo);

        // Update the status in MyCases as well
        MyCases myCases = myCasesRepo.findByCaseId(caseId)
                .orElseThrow(() -> new CaseNotFoundException("Case with ID " + caseId + " not found in My Cases"));
        myCases.setStatus(CaseStatus.PRE_APPEAL);
        myCasesRepo.save(myCases);
    }

}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/GoogleCalendarService.java">
package org.RRA.tax_appeal_system.Services;

import com.google.api.client.auth.oauth2.Credential;
import com.google.api.client.googleapis.auth.oauth2.GoogleCredential;
import com.google.api.client.http.javanet.NetHttpTransport;
import com.google.api.client.json.gson.GsonFactory;
import com.google.api.client.util.DateTime;
import com.google.api.services.calendar.Calendar;
import com.google.api.services.calendar.model.*;
import org.springframework.stereotype.Service;

import java.io.IOException;
import java.util.Arrays;
import java.util.Date;

@Service
public class GoogleCalendarService {

    public String createEventWithMeetLink(String accessToken) throws IOException {
        Credential credential = new GoogleCredential().setAccessToken(accessToken);
        Calendar service = new Calendar.Builder(new NetHttpTransport(), GsonFactory.getDefaultInstance(), credential)
                .setApplicationName("Tax Appeal System")
                .build();

        Event event = new Event()
                .setSummary("Tax Appeal Discussion")
                .setDescription("Meeting to discuss the case details.");

        // Set start and end time (e.g., now for 1 hour)
        long now = System.currentTimeMillis();
        DateTime startDateTime = new DateTime(new Date(now));
        DateTime endDateTime = new DateTime(new Date(now + 3600000)); // 1 hour later

        EventDateTime start = new EventDateTime().setDateTime(startDateTime);
        EventDateTime end = new EventDateTime().setDateTime(endDateTime);
        event.setStart(start);
        event.setEnd(end);


        // --- THIS IS THE CORRECTED SECTION ---
        // The modern way to request a Google Meet link.
        // It's much simpler than the old method.
        ConferenceData conferenceData = new ConferenceData();
        ConferenceSolutionKey conferenceSolutionKey = new ConferenceSolutionKey();
        conferenceSolutionKey.setType("hangoutsMeet"); // This specifies Google Meet

        CreateConferenceRequest createConferenceRequest = new CreateConferenceRequest();
        createConferenceRequest.setRequestId("random-string-" + now); // A unique ID
        createConferenceRequest.setConferenceSolutionKey(conferenceSolutionKey);

        conferenceData.setCreateRequest(createConferenceRequest);
        event.setConferenceData(conferenceData);
        // --- END OF CORRECTION ---

        String calendarId = "primary"; // Use the user's primary calendar
        try {
            event = service.events().insert(calendarId, event)
                    .setConferenceDataVersion(1)
                    .execute();
            System.out.println("Google Meet created successfully: " + event.getHangoutLink());
            return event.getHangoutLink();
        } catch (Exception e) {  // Catch Exception to be safe
            System.err.println("GOOGLE API ERROR: " + e.getClass().getName() + " - " + e.getMessage());
            e.printStackTrace();  // Full stack trace
            throw e;  // Re-throw so controller catches it
        }
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/MyCasesService.java">
package org.RRA.tax_appeal_system.Services;

import jakarta.transaction.Transactional;
import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.DTOS.DashboardAnalyticsDto;
import org.RRA.tax_appeal_system.DTOS.responses.MyCaseDTO;
import org.RRA.tax_appeal_system.Enums.CaseStatus;
import org.RRA.tax_appeal_system.Enums.CommitteeGroup;
import org.RRA.tax_appeal_system.Models.CaseInfo;
import org.RRA.tax_appeal_system.Models.MyCases;
import org.RRA.tax_appeal_system.Models.UserInfo;
import org.RRA.tax_appeal_system.Repositories.MyCasesRepo;
import org.RRA.tax_appeal_system.Repositories.UserInfoRepo;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;
import java.time.format.DateTimeFormatter;
import java.text.SimpleDateFormat;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.time.format.TextStyle;
import java.time.temporal.ChronoUnit;
import java.util.ArrayList;
import java.util.List;
import java.util.Locale;


@Service
@RequiredArgsConstructor
public class MyCasesService {
    private final MyCasesRepo myCasesRepo;
    private final UserInfoRepo userInfoRepo;


    @Transactional
    public List<MyCaseDTO> getMyCasesByPreparator(String notePreparator) {
        List<MyCases> myCasesList = myCasesRepo.findByNotePreparator(notePreparator);

        return myCasesList.stream()
                .map(this::convertToMyCaseDTO)
                .toList();
    }


    public DashboardAnalyticsDto getDashboardAnalytics(String committeeEmail) {
        //finding that User
        UserInfo committee = userInfoRepo.findByEmail(committeeEmail).orElseThrow(()->new UsernameNotFoundException("User with email: "+ committeeEmail + " not found"));
        CommitteeGroup committeeGroup = committee.getCommitteeGroup();

        DashboardAnalyticsDto analytics = new DashboardAnalyticsDto();

        int totalCases = (int) myCasesRepo.count();
        analytics.setTotalCases(totalCases);

        int pendingCases = myCasesRepo.countByStatus(CaseStatus.PENDING);
        analytics.setPendingCases(pendingCases);

        int reviewedCases = myCasesRepo.countReviewedCases();
        double reviewRate = totalCases > 0 ? (reviewedCases * 100.0 / totalCases) : 0.0;
        analytics.setReviewRate(Math.round(reviewRate * 100.0) / 100.0);

        List<Object[]> monthlyData = myCasesRepo.getCaseAnalyticsByMonth();
        List<DashboardAnalyticsDto.CaseAnalyticsData> caseAnalytics = new ArrayList<>();

        for (Object[] data : monthlyData) {
            int month = ((Number) data[0]).intValue();
            long casesWithBasisCount = ((Number) data[1]).longValue();
            long casesWithoutBasisCount = ((Number) data[2]).longValue();

            String monthName = java.time.Month.of(month).getDisplayName(TextStyle.SHORT, Locale.ENGLISH);

            caseAnalytics.add(new DashboardAnalyticsDto.CaseAnalyticsData(monthName, (int) casesWithBasisCount, (int) casesWithoutBasisCount));
        }
        analytics.setCaseAnalytics(caseAnalytics);
        int totalMembers = userInfoRepo.countAllByCommitteeGroup(committeeGroup);
        int availableMembers = userInfoRepo.countByCommitteeGroupAndAvailabilityStatus(committeeGroup,true);
        analytics.setAttendanceList(
                new DashboardAnalyticsDto.AttendanceData(totalMembers, availableMembers)
        );

        return analytics;
    }

    public List<MyCaseDTO> getCasesForThisWeek() {
        LocalDate startOfWeek = LocalDate.now()
                .with(java.time.DayOfWeek.MONDAY);

        List<MyCases> weekCases = myCasesRepo.findCasesThisWeek(startOfWeek);

        return weekCases.stream()
                .map(this::convertToMyCaseDTO)
                .toList();
    }

    private MyCaseDTO convertToMyCaseDTO(MyCases myCase) {
        CaseInfo caseInfo = myCase.getCaseId();
        LocalDate today = LocalDate.now();
        long daysLeftCalc = 0,daysLeft;
            daysLeftCalc = ChronoUnit.DAYS.between(today, caseInfo.getAppealExpireDate());
            daysLeft = Math.max(daysLeftCalc, 0);

//        long milliseconds = caseInfo.getAppealExpireDate().getTime() - System.currentTimeMillis();
//        int daysLeft = milliseconds > 0 ? (int) (milliseconds / (1000 * 60 * 60 * 24)) : 0;

//        String submittedAt = new SimpleDateFormat("yyyy-MM-dd").format(caseInfo.getAppealDate());
        String submittedAt = caseInfo.getAppealDate().format(java.time.format.DateTimeFormatter.ofPattern("yyyy-MM-dd"));

        return new MyCaseDTO(
                caseInfo.getCaseId(),
                caseInfo.getTin(),
                submittedAt,
                String.valueOf(daysLeft),
                myCase.getStatus()
        );
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/UserInfoDetails.java">
package org.RRA.tax_appeal_system.Services;

import org.RRA.tax_appeal_system.Models.UserInfo;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.UserDetails;

import java.util.Collection;
import java.util.List;


public class UserInfoDetails implements UserDetails {
    private String username;
    private String password;
    private List<GrantedAuthority> authorities;
    public UserInfoDetails(UserInfo userInfo) {
        this.username = userInfo.getEmail(); // we will use email in place of the user name
        this.password = userInfo.getPassword();
        this.authorities = List.of(new SimpleGrantedAuthority(userInfo.getCommitteeRole().name()));
    }

    @Override
    public Collection<? extends GrantedAuthority> getAuthorities() {
        return authorities;
    }

    @Override
    public String getPassword() {
        return password;
    }

    @Override
    public String getUsername() {
        return username;
    }


    @Override
    public boolean isAccountNonExpired() {
        return true;
    }

    @Override
    public boolean isAccountNonLocked() {
        return true;
    }

    @Override
    public boolean isCredentialsNonExpired() {
        return true;
    }

    @Override
    public boolean isEnabled() {
        return true;
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/UserInfoDetailsService.java">
package org.RRA.tax_appeal_system.Services;

import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.Models.UserInfo;
import org.RRA.tax_appeal_system.Repositories.UserInfoRepo;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Component;

import java.util.Optional;

@Component
@RequiredArgsConstructor
public class UserInfoDetailsService implements UserDetailsService {
    private final UserInfoRepo userInfoRepo;

    @Override
    public UserDetails loadUserByUsername(String email) throws UsernameNotFoundException {
        Optional<UserInfo> userInfo = userInfoRepo.findByEmail(email); // Find user by username/email
        return userInfo.map(UserInfoDetails::new)
                .orElseThrow(() -> new UsernameNotFoundException("user not found " + email));
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/UserInfoService.java">
package org.RRA.tax_appeal_system.Services;

import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.DTOS.requests.UpdateUserRequest;
import org.RRA.tax_appeal_system.Enums.CommitteeGroup;
import org.RRA.tax_appeal_system.Enums.Privilege;
import org.RRA.tax_appeal_system.Models.UserInfo;
import org.RRA.tax_appeal_system.Repositories.UserInfoRepo;
import org.springframework.http.HttpStatus;
import org.springframework.security.access.AccessDeniedException;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.server.ResponseStatusException;

import java.util.Comparator;
import java.util.List;
import java.util.UUID;
import java.util.stream.Collectors;

@Service
@RequiredArgsConstructor

public class UserInfoService {
    private final UserInfoRepo userRepo;

    public boolean doesUserExist(UUID userId) {
        return userRepo.existsById(userId);
    }

    public List<UserInfo> getUsersByCommitteeGroup(CommitteeGroup committeeGroup) {
        List<UserInfo> users = userRepo.findAllByCommitteeGroup(committeeGroup);
    return users;
    }

    public UserInfo getUserById(UUID userId) {
        return userRepo.findById(userId).orElseThrow(() -> new UsernameNotFoundException("User not found"));
    }

    public UserInfo getUserByEmail(String email) {
        return userRepo.findByEmail(email).orElseThrow(() -> new UsernameNotFoundException("User not found"));
    }

    @Transactional
    public UserInfo updateUserInfo(UUID id, UpdateUserRequest userInfo) throws UsernameNotFoundException {

            UserInfo user = userRepo.findById(id).orElseThrow(()->new IllegalArgumentException("User with "+ id +" not found"));

            // updating user
            //checking whether the names are not empty
            if (userInfo.fullName() != null && !userInfo.fullName().trim().isEmpty()) {
                user.setFullName(userInfo.fullName());
            };

            //checkin whether the email is not empty
            if(userInfo.email() != null && !userInfo.email().trim().isEmpty()) {
                user.setEmail(userInfo.email());
            }

            user.setCommitteeRole(userInfo.committee_role());
            user.setTitle(userInfo.title());

            //checking whether committee group is not empty
            if (userInfo.committeeGroup() != null && !userInfo.committeeGroup().toString().trim().isEmpty()) {
                user.setCommitteeGroup(userInfo.committeeGroup());
            }
            //checking that phone number is not empty
            user.setPhoneNumber(userInfo.phoneNumber());

            userRepo.save(user);

            System.out.println("User Updated successfully");

            return user;
        }

    @Transactional
    public void updateUserAvailabilityStatus(UUID id,boolean newAvailabilityStatus){
        // first check whether the user exists
        UserInfo user = userRepo.findById(id).orElseThrow(()->new IllegalArgumentException("User not found"));

        //then update the user Availability Statu
        user.setAvailabilityStatus(newAvailabilityStatus);
    }


    // dto/MemberAvailabilityDTO.java
    public record MemberAvailabilityDTO(
            UUID id,
            String fullName,
            String title,
            String committeeRole,
            boolean availabilityStatus
    ) {}

    // In your UserInfoService or CommitteeService
    @Transactional(readOnly = true)
    public List<MemberAvailabilityDTO> getAllMemberAndTheirAvailabilityStatus(String leaderEmail) {
        UserInfo leader = userRepo.findByEmail(leaderEmail)
                .orElseThrow(() -> new ResponseStatusException(HttpStatus.UNAUTHORIZED, "Leader not found"));

        if (leader.getCommitteeRole() != Privilege.COMMITTEE_LEADER) {
            throw new ResponseStatusException(HttpStatus.FORBIDDEN, "Only COMMITTEE_LEADER can access this feature");
        }

        CommitteeGroup group = leader.getCommitteeGroup();

        return userRepo.findByCommitteeGroup(group).stream()
                .map(user -> new MemberAvailabilityDTO(
                        user.getId(),
                        user.getFullName(),
                        user.getTitle() != null ? user.getTitle() : "",
                        user.getCommitteeRole().name(),
                        user.isAvailabilityStatus()
                ))
                .sorted((a, b) -> a.fullName().compareToIgnoreCase(b.fullName())) // optional: sort by name
                .toList();
    }



    @Transactional
    public void updateMemberAvailabilityAsLeader(String leaderEmail, UUID targetUserId, boolean newStatus) {
        UserInfo leader = userRepo.findByEmail(leaderEmail)
                .orElseThrow(() -> new ResponseStatusException(HttpStatus.UNAUTHORIZED, "Leader not found"));

        if (leader.getCommitteeRole() != Privilege.COMMITTEE_LEADER) {
            throw new ResponseStatusException(HttpStatus.FORBIDDEN, "Access denied");
        }

        UserInfo targetUser = userRepo.findById(targetUserId)
                .orElseThrow(() -> new ResponseStatusException(HttpStatus.NOT_FOUND, "User not found"));

        if (!targetUser.getCommitteeGroup().equals(leader.getCommitteeGroup())) {
            throw new ResponseStatusException(HttpStatus.FORBIDDEN, "Cannot update user from another committee");
        }

        // Reuse your existing method!
        updateUserAvailabilityStatus(targetUserId, newStatus);
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/Services/VotingService.java">
package org.RRA.tax_appeal_system.Services;

import jakarta.transaction.Transactional;
import lombok.AllArgsConstructor;
import lombok.RequiredArgsConstructor;
import org.RRA.tax_appeal_system.DTOS.requests.VoteRequest;
import org.RRA.tax_appeal_system.DTOS.responses.AppealDTO;
import org.RRA.tax_appeal_system.DTOS.responses.ExplanatoryNoteDTO;
import org.RRA.tax_appeal_system.DTOS.responses.ExplanatoryNoteResponseDTO;
import org.RRA.tax_appeal_system.DTOS.responses.TaxAuditedDTO;
import org.RRA.tax_appeal_system.Enums.CaseStatus;
import org.RRA.tax_appeal_system.Enums.CommitteeGroup;
import org.RRA.tax_appeal_system.Enums.Privilege;
import org.RRA.tax_appeal_system.Enums.VoteDecision;
import org.RRA.tax_appeal_system.Exceptions.CaseNotFoundException;
import org.RRA.tax_appeal_system.Models.*;
import org.RRA.tax_appeal_system.Repositories.*;
import org.springframework.security.access.AccessDeniedException;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;


import java.time.LocalDateTime;
import java.util.*;

@Service
@RequiredArgsConstructor
public class VotingService {
    private final AppealsRepo appealsRepo;
    private final CommitteeVoteRepository voteRepository;
    private final UserInfoRepo userInfoRepo;
    private final CommitteeVoteRepository committeeVoteRepo;
    private final CaseInfoRepo caseInfoRepo;


    public List<Appeals> getAllAppeals() {
        return appealsRepo.findAll();
    }

    public Appeals getAppealById(UUID appealId) {
        return appealsRepo.findByAppealId(appealId).orElseThrow(() -> new RuntimeException("Appeal not found" + appealId));
    }


    public Map<UUID, Boolean> hasUserVotedAllTheAppeals(String committeeEmail, List<UUID> appealsList) {
        Optional<UserInfo> optUser = userInfoRepo.findByEmail(committeeEmail);
        if (optUser.isEmpty()) {
            throw new UsernameNotFoundException("User not found " + committeeEmail);
        }
        UserInfo user = optUser.get();
        UUID memberId = user.getId();
        Map<UUID, Boolean> result = new HashMap<>();
        for (UUID appeal : appealsList) {
            Appeals appealObj = getAppealById(appeal);
            Optional<CommitteeVote> vote = committeeVoteRepo.findByAppealIdAndCommitteeMemberId(appeal, memberId);
            result.put(appeal, vote.isPresent());
        }
        return result;
    }

    @Transactional
    public CommitteeVote submitVote(UUID appealId, VoteRequest voteRequest,String memberEmail) {
        Appeals appeal = getAppealById(appealId);
        System.out.println("DEBUG: The class of committeeMemberId is: " + voteRequest.getCommitteeMemberId().getClass().getName());

        voteRepository.findByAppealIdAndCommitteeMemberId(appealId, voteRequest.getCommitteeMemberId()).ifPresent(vote -> {
            throw new RuntimeException("Committee member has already voted on this appeal");});

        CommitteeVote vote = new CommitteeVote();
        vote.setAppeal(appeal);
        vote.setCommitteeMemberId(voteRequest.getCommitteeMemberId());
        vote.setCommitteeMemberName(voteRequest.getCommitteeMemberName());
        vote.setCommitteeDecision(voteRequest.getCommitteeDecision());
        vote.setVoteComment(voteRequest.getVoteComment());
        CommitteeVote voteResults =voteRepository.saveAndFlush(vote);

        // check and update the Case status if resolved
        //but first let us get the Committee group correspondance for the committee we have
        UserInfo user = userInfoRepo.findByEmail(memberEmail).orElseThrow(() -> new RuntimeException("User not found" + memberEmail));
        CommitteeGroup membershipGroup = user.getCommitteeGroup();

        CaseInfo caseInfo = appeal.getTaxAuditedId().getCaseId();  // Traverse relationships
        if (isCaseResolved(caseInfo,membershipGroup)) {
            caseInfo.setStatus(CaseStatus.RESOLVED);
            caseInfoRepo.save(caseInfo);
        }


        return voteResults;
    }

    private int getPresentMembersForMeeting(CommitteeGroup membership){
        return userInfoRepo.countByCommitteeGroupAndAvailabilityStatus(membership,true);
    }

    private boolean isAppealFullyVoted(Appeals appeal,CommitteeGroup membershipGroup) {
        int requiredVotes = getPresentMembersForMeeting(membershipGroup);  // Logic to fetch quorum, e.g., 5 members
        long voteCount = committeeVoteRepo.countByAppeal(appeal);
        return voteCount >= requiredVotes;
    }

    // Checking that all appeals have been voted
    private boolean isCaseResolved(CaseInfo caseInfo,CommitteeGroup membershipGroup) {
        return caseInfo.getTaxAudited().stream()
                .allMatch(taxAudited -> taxAudited.getAppeals().stream()
                        .allMatch(appeal -> isAppealFullyVoted(appeal, membershipGroup)));
    }

    // In VotingService.java
    public List<SimpleVoteDTO> getAllVotesForAppeal(UUID appealId, String requesterEmail) {
        UserInfo requester = userInfoRepo.findByEmail(requesterEmail)
                .orElseThrow(() -> new UsernameNotFoundException("User not found"));

        if (requester.getCommitteeRole() != Privilege.COMMITTEE_LEADER) {
            throw new AccessDeniedException("Only COMMITTEE_LEADER can view all votes");
        }

        Appeals appeal = appealsRepo.findByAppealId(appealId)
                .orElseThrow(() -> new RuntimeException("Appeal not found"));

        List<CommitteeVote> votes = committeeVoteRepo.findByAppeal(appeal);

        return votes.stream()
                .map(vote -> new SimpleVoteDTO(
                        vote.getCommitteeMemberName(),
                        vote.getCommitteeDecision()
                ))
                .sorted((a, b) -> a.committeeMemberName().compareToIgnoreCase(b.committeeMemberName()))
                .toList();
    }

    public record SimpleVoteDTO(
            String committeeMemberName,
            VoteDecision committeeDecision  // WITHBASIS or NOBASIS
    ) {}


}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/sms/SmsController.java">
//package org.RRA.tax_appeal_system.sms;
//
//import org.springframework.beans.factory.annotation.Autowired;
//import org.springframework.http.HttpStatus;
//import org.springframework.http.ResponseEntity;
//import org.springframework.web.bind.annotation.*;
//import org.RRA.tax_appeal_system.DTOS.responses.GenericResponse;
//
//import jakarta.validation.Valid;
//
///**
// * Controller for sending SMS messages.
// */
//@RestController
//@RequestMapping("/api/v1/sms")
//public class SmsController {
//
//    private final SmsService smsService;
//
//    @Autowired
//    public SmsController(SmsService smsService) {
//        this.smsService = smsService;
//    }
//
//    /**
//     * Send an SMS message using the provided request details.
//     *
//     * @param smsRequest The SMS request containing recipient phone number and message
//     * @return Response indicating success or failure
//     */
//    @PostMapping("/send")
//    public ResponseEntity<GenericResponse<String>> sendSms(@Valid @RequestBody SmsRequest smsRequest) {
//        try {
//            String messageSid = smsService.sendSms(smsRequest);
//
//            GenericResponse<String> response = new GenericResponse<>(
//                    200,
//                    "SMS sent successfully",
//                    messageSid
//            );
//
//            return ResponseEntity.ok(response);
//        } catch (Exception e) {
//            GenericResponse<String> errorResponse = new GenericResponse<>(
//                    500,
//                    "Failed to send SMS: " + e.getMessage(),
//                    null
//            );
//
//            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);
//        }
//    }
//
//    /**
//     * Simple endpoint to test sending a predefined SMS message.
//     *
//     * @param phoneNumber The recipient's phone number
//     * @return Response indicating success or failure
//     */
//    @GetMapping("/test")
//    public ResponseEntity<GenericResponse<String>> testSms(@RequestParam String phoneNumber) {
//        try {
//            SmsRequest smsRequest = new SmsRequest(phoneNumber, "Hello from RRA Tax Appeal System! This is a test message.");
//            String messageSid = smsService.sendSms(smsRequest);
//
//            GenericResponse<String> response = new GenericResponse<>(
//                    200,
//                    "Test SMS sent successfully",
//                    messageSid
//            );
//
//            return ResponseEntity.ok(response);
//        } catch (Exception e) {
//            GenericResponse<String> errorResponse = new GenericResponse<>(
//                    500,
//                    "Failed to send test SMS: " + e.getMessage(),
//                    null
//            );
//
//            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);
//        }
//    }
//}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/sms/SmsRequest.java">
//package org.RRA.tax_appeal_system.sms;
//
//import lombok.AllArgsConstructor;
//import lombok.Data;
//import lombok.NoArgsConstructor;
//
//import jakarta.validation.constraints.NotBlank;
//
///**
// * Represents an SMS request with a recipient phone number and message content.
// */
//@Data
//@NoArgsConstructor
//@AllArgsConstructor
//public class SmsRequest {
//
//    @NotBlank(message = "Phone number is required")
//    private String phoneNumber;
//
//    @NotBlank(message = "Message content is required")
//    private String message;
//}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/sms/SmsService.java">
//package org.RRA.tax_appeal_system.sms;
//
//import com.twilio.Twilio;
//import com.twilio.rest.api.v2010.account.Message;
//import com.twilio.type.PhoneNumber;
//import org.springframework.beans.factory.annotation.Value;
//import org.springframework.stereotype.Service;
//import jakarta.annotation.PostConstruct;
//
///**
// * Service for sending SMS messages using Twilio.
// */
//@Service
//public class SmsService {
//
//    @Value("${twilio.account.sid}")
//    private String twilioAccountSid;
//
//    @Value("${twilio.auth.token}")
//    private String twilioAuthToken;
//
//    @Value("${twilio.phone.number}")
//    private String twilioPhoneNumber;
//
//    /**
//     * Initialize Twilio with account credentials.
//     */
//    @PostConstruct
//    private void initTwilio() {
//        Twilio.init(twilioAccountSid, twilioAuthToken);
//    }
//
//    /**
//     * Send an SMS message to the specified phone number.
//     *
//     * @param smsRequest The SMS request containing the recipient phone number and message
//     * @return The SID of the sent message
//     */
//    public String sendSms(SmsRequest smsRequest) {
//        Message message = Message.creator(
//                new PhoneNumber(smsRequest.getPhoneNumber()),
//                new PhoneNumber(twilioPhoneNumber),
//                smsRequest.getMessage()
//        ).create();
//
//        return message.getSid();
//    }
//}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/swagger/SwaggerConfig.java">
package org.RRA.tax_appeal_system.swagger;

import io.swagger.v3.oas.models.Components;
import io.swagger.v3.oas.models.OpenAPI;
import io.swagger.v3.oas.models.info.Info;
import io.swagger.v3.oas.models.security.SecurityRequirement;
import io.swagger.v3.oas.models.security.SecurityScheme;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class SwaggerConfig {

    @Bean
    public OpenAPI customOpenAPI() {
        final String securitySchemeName = "bearerAuth";

        return new OpenAPI()
                .info(new Info()
                        .title("Tax Appeal System API")
                        .version("v1.0")
                        .description("API documentation for Tax Appeal System")
                        .termsOfService("http://swagger.io/terms/")
                        .license(new io.swagger.v3.oas.models.info.License()
                                .name("Apache 2.0")
                                .url("http://springdoc.org")))
                .addSecurityItem(new SecurityRequirement().addList(securitySchemeName))
                .components(new Components()
                        .addSecuritySchemes(securitySchemeName,
                                new SecurityScheme()
                                        .name(securitySchemeName)
                                        .type(SecurityScheme.Type.HTTP)
                                        .scheme("bearer")
                                        .bearerFormat("JWT")
                                        .description("Enter JWT token in the format: Bearer <token>")));
    }
}
</file>

<file path="backend/Tax_appeal_system/src/main/java/org/RRA/tax_appeal_system/TaxAppealSystemApplication.java">
package org.RRA.tax_appeal_system;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.data.jpa.repository.config.EnableJpaRepositories;
import org.springframework.scheduling.annotation.EnableScheduling;

@SpringBootApplication
@EnableJpaRepositories
@EnableScheduling
public class TaxAppealSystemApplication {

    public static void main(String[] args) {
        SpringApplication.run(TaxAppealSystemApplication.class, args);
    }

}
</file>

<file path="backend/Tax_appeal_system/src/main/resources/application.properties">
spring.application.name=Tax_appeal_system
server.port=${SERVER_PORT:8084}

# database connection
spring.datasource.url= jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:8080}/${DB_NAME:tax_claim_system}
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD:Mugisha@2007}
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=true


# Date format
spring.jackson.date-format=yyyy-MM-dd
spring.jackson.serialization.write-dates-as-timestamps=false

#Jwt Configuration
app.jwt.secret =${JWT_SECRET:"Y2FuMlVfZ3U2c3NfbXlfNG9ybWFsX3NlN2NyZTlfdGV4dA"}
# 12 hrs
app.jwt.expiration =43200000
# 3 day
app.jwt.refresh-expiration=259200000

#Logging
# Hibernate logging
logging.level.org.hibernate=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# Transaction logging
#logging.level.org.springframework.orm.jpa=DEBUG
#logging.level.org.springframework.transaction=DEBUG

# Swagger Configurations
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.config-url=/api-docs/swagger-config
springdoc.swagger-ui.url=/api-docs
springdoc.swagger-ui.operations-sorter=alpha
springdoc.swagger-ui.tags-sorter=alpha
springdoc.swagger-ui.disable-swagger-default-url=true
springdoc.swagger-ui.display-request-duration=true
springdoc.swagger-ui.doc-expansion=list

# SMT configuration
spring.mail.host=${MAIL_HOST:smtp.gmail.com}
spring.mail.port=${MAIL_PORT:587}
spring.mail.username=${EMAIL_USERNAME:shamiinnocent123@gmail.com}
spring.mail.password=${EMAIL_PASSWORD:xyfhzoqzphyntehx}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true

# Google OAuth2 Client Properties
spring.security.oauth2.client.registration.google.client-id=444776077257-vmkuoavlt3b4vec3pgjk5r8egki53u4o.apps.googleusercontent.com
spring.security.oauth2.client.registration.google.client-secret=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
spring.security.oauth2.client.registration.google.scope=openid,email,profile,https://www.googleapis.com/auth/calendar.events
spring.security.oauth2.client.registration.google.redirect-uri=http://localhost:8084/login/oauth2/code/google
</file>

<file path="backend/Tax_appeal_system/src/main/resources/templates/invitationEmail.html">
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:remove="all">Appeals Meeting Invitation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin: 0; padding: 0;">
<div style="max-width: 600px; margin: 0 auto; background-color: #ffffff;">
    <!-- Header with Image -->
    <div style="text-align: center; padding: 20px 0;">
        <!-- Replace the src with your actual image URL -->
        <img src="https://excisestamps.rra.gov.rw/images/RRA_Logo_home.png"
             alt="RRA Official Header"
             style="max-width: 100%; height: auto; display: block; margin: 0 auto;">
    </div>

    <!-- Email Content -->
    <div style="font-family: 'Segoe UI', Arial, sans-serif; line-height: 1.6; color: #333333; padding: 30px;">
        <!-- Subject -->
        <div style="border-bottom: 2px solid #134E70; padding-bottom: 15px; margin-bottom: 25px;">
            <h2 style="color: #134E70; margin: 0; font-size: 24px;" th:text="${subject}">Appeals Meeting Invitation</h2>
        </div>

        <!-- Salutation -->
        <p style="margin-bottom: 20px;">Dear <strong th:text="${name}">Valued Colleague</strong>,</p>

        <!-- Main Content -->
        <div style="background-color: #f8f9fa; padding: 20px; border-radius: 5px; margin: 20px 0;">
            <p style="margin: 0 0 15px 0;">On behalf of the Commissioner General, we are pleased to extend an invitation for you to attend a physical appeals meeting scheduled as follows:</p>

            <div style="background: white; padding: 15px; border-left: 4px solid #134E70; margin: 15px 0;">
                <p style="margin: 5px 0;"><strong>Meeting Type:</strong> In-Person (Face to Face)</p>
                <p style="margin: 5px 0;"><strong>Date:</strong> <span th:text="${meetingDate}">Thursday</span></p>
                <p style="margin: 5px 0;"><strong>Time:</strong> <span th:text="${meetingHour}">Meeting Time</span></p>
                <p style="margin: 5px 0;"><strong>Venue:</strong> <span th:text="${venue}">RRA New Head Office - Sonatubes/Silverback Mall</span></p>
            </div>
        </div>

        <!-- Additional Information -->
        <p style="margin: 20px 0;">We recommend reviewing Pending Cases in Meeting dash on the application tax claim system. Review these materials in preparation for the meeting.</p>
        <p> Please Indicate your Availability this Week :</p>
        <button style="background-color: seagreen; color: white; font-size: x-large; padding: 10px; border:none;">
            Availability Status
        </button>


        <!-- Closing -->
        <div style="border-top: 1px solid #eaeaea; padding-top: 20px; margin-top: 25px;">
            <p style="margin: 5px 0;">Best regards,</p>
            <p style="margin: 5px 0;"><strong>Fridah</strong></p>
            <p style="margin: 5px 0; color: #666; font-size: 14px;">Tel: 0788678808</p>
        </div>

        <!-- Footer with Logo -->
        <div style="text-align: center; margin-top: 30px; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
            <img src="https://scontent-mba2-1.xx.fbcdn.net/v/t39.30808-6/271708994_232359985744810_5026211307313265684_n.jpg?_nc_cat=107&ccb=1-7&_nc_sid=6ee11a&_nc_ohc=XkAwf29laaIQ7kNvwF3kXWK&_nc_oc=AdlaDMKtwWSXns9IBt-xNDfiTRFDSubB-6HT4adLMkIuF5rVsYZNCwea8OfuTGUF0ws&_nc_zt=23&_nc_ht=scontent-mba2-1.xx&_nc_gid=2bYS75vyDDFE6eTwZxVzJg&oh=00_AfeIHc4UM4GidKlleOg4yE5VF1QPfpNDWWnjH128dshjSA&oe=68FC08A8"
                 alt="RRA Logo"
                 style="max-width: 150px; height: auto; margin-bottom: 10px;">
            <p style="font-size: 12px; color: #666; margin: 5px 0;">Rwanda Revenue Authority</p>

        </div>
    </div>
</div>
</body>
</html>
</file>

<file path="backend/Tax_appeal_system/src/test/java/org/RRA/tax_appeal_system/TaxAppealSystemApplicationTests.java">
package org.RRA.tax_appeal_system;

import org.junit.jupiter.api.Disabled;
import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
@Disabled
class TaxAppealSystemApplicationTests {

    @Test
    void contextLoads() {
    }

}
</file>

<file path="frontend/.gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="frontend/components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "src/app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "iconLibrary": "lucide",
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "registries": {}
}
</file>

<file path="frontend/eslint.config.mjs">
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
  {
    ignores: [
      "node_modules/**",
      ".next/**",
      "out/**",
      "build/**",
      "next-env.d.ts",
    ],
  },
  {
    rules: {
      "@typescript-eslint/no-explicit-any": "off",
        'react/no-unescaped-entities': 'off',
      '@next/next/no-page-custom-font': 'off',
    }
  }
];

export default eslintConfig;
</file>

<file path="frontend/next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {

};

export default nextConfig;
</file>

<file path="frontend/package.json">
{
  "name": "shadcn_nextjs",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev --turbopack",
    "build": "next build --turbopack",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@hookform/resolvers": "^5.2.2",
    "@radix-ui/react-avatar": "^1.1.10",
    "@radix-ui/react-checkbox": "^1.3.3",
    "@radix-ui/react-dialog": "^1.1.15",
    "@radix-ui/react-label": "^2.1.7",
    "@radix-ui/react-select": "^2.2.6",
    "@radix-ui/react-slot": "^1.2.3",
    "@radix-ui/react-switch": "^1.2.6",
    "axios": "^1.12.2",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "date-fns": "^4.1.0",
    "firebase": "^12.5.0",
    "jspdf": "^3.0.4",
    "lucide-react": "^0.543.0",
    "next": "15.5.3",
    "react": "19.1.0",
    "react-day-picker": "^9.10.0",
    "react-dom": "19.1.0",
    "react-dropzone": "^14.3.8",
    "react-hook-form": "^7.62.0",
    "react-icons": "^5.5.0",
    "tailwind-merge": "^3.3.1",
    "zod": "^4.1.8"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3",
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "15.5.3",
    "tailwindcss": "^4",
    "tw-animate-css": "^1.3.8",
    "typescript": "^5"
  }
}
</file>

<file path="frontend/postcss.config.mjs">
const config = {
  plugins: ["@tailwindcss/postcss"],
};

export default config;
</file>

<file path="frontend/public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="frontend/public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="frontend/public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="frontend/public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="frontend/public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="frontend/README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

<file path="frontend/repomix-output.xml">
This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
components.json
eslint.config.mjs
next.config.ts
package.json
postcss.config.mjs
public/file.svg
public/globe.svg
public/next.svg
public/profile.png
public/Rralogo.png
public/vercel.svg
public/window.svg
README.md
src/app/admin/page.tsx
src/app/cases/all-cases/explanatory-note/page.tsx
src/app/cases/all-cases/page.tsx
src/app/cases/new-case/appealpoint/page.tsx
src/app/cases/new-case/page.tsx
src/app/cases/page.tsx
src/app/chat/page.tsx
src/app/favicon.ico
src/app/globals.css
src/app/layout.tsx
src/app/meetings/case-details/page.tsx
src/app/meetings/case-details/tax-type-details/[appealId]/page.tsx
src/app/meetings/case-details/tax-type-details/page.tsx
src/app/meetings/page.tsx
src/app/page.tsx
src/app/profile/page.tsx
src/app/reports/new-minutes/page.tsx
src/app/reports/page.tsx
src/app/staff-login/page.tsx
src/app/staff-register/page.tsx
src/app/types/case.ts
src/app/types/meetingminutes.ts
src/app/types/minutes-mock-data.ts
src/app/types/mock-data.ts
src/app/vote/page.tsx
src/components/AdminGuard.tsx
src/components/AnalyticsDashboard.tsx
src/components/appealpoint.tsx
src/components/AppealPointDetails.tsx
src/components/AppealVote.tsx
src/components/attendance-list.tsx
src/components/authguard.tsx
src/components/case-analytics-chart.tsx
src/components/casedetails.tsx
src/components/cases.tsx
src/components/casesubmitted.tsx
src/components/explanatorynote.tsx
src/components/InvitationTemplateModal.tsx
src/components/meetingminutes.tsx
src/components/minutesform.tsx
src/components/navbar.tsx
src/components/profile.tsx
src/components/sidebar.tsx
src/components/taxForm.tsx
src/components/TaxTypeDetails.tsx
src/components/ui/avatar.tsx
src/components/ui/button.tsx
src/components/ui/calendar.tsx
src/components/ui/card.tsx
src/components/ui/checkbox.tsx
src/components/ui/dialog.tsx
src/components/ui/form.tsx
src/components/ui/input.tsx
src/components/ui/label.tsx
src/components/ui/pagination.tsx
src/components/ui/select.tsx
src/components/ui/shadcn-io/dropzone/index.tsx
src/components/ui/switch.tsx
src/components/ui/table.tsx
src/components/ui/textarea.tsx
src/components/vote.tsx
src/components/yourcases.tsx
src/lib/api.ts
src/lib/firebase.ts
src/lib/utils.ts
tsconfig.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "src/app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "iconLibrary": "lucide",
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "registries": {}
}
</file>

<file path="eslint.config.mjs">
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
  {
    ignores: [
      "node_modules/**",
      ".next/**",
      "out/**",
      "build/**",
      "next-env.d.ts",
    ],
  },
  {
    rules: {
      "@typescript-eslint/no-explicit-any": "off",
        'react/no-unescaped-entities': 'off',
      '@next/next/no-page-custom-font': 'off',
    }
  }
];

export default eslintConfig;
</file>

<file path="next.config.ts">
import type { NextConfig } from "next";

const nextConfig: NextConfig = {

};

export default nextConfig;
</file>

<file path="package.json">
{
  "name": "shadcn_nextjs",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev --turbopack",
    "build": "next build --turbopack",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@hookform/resolvers": "^5.2.2",
    "@radix-ui/react-avatar": "^1.1.10",
    "@radix-ui/react-checkbox": "^1.3.3",
    "@radix-ui/react-dialog": "^1.1.15",
    "@radix-ui/react-label": "^2.1.7",
    "@radix-ui/react-select": "^2.2.6",
    "@radix-ui/react-slot": "^1.2.3",
    "@radix-ui/react-switch": "^1.2.6",
    "axios": "^1.12.2",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "date-fns": "^4.1.0",
    "firebase": "^12.5.0",
    "lucide-react": "^0.543.0",
    "next": "15.5.3",
    "react": "19.1.0",
    "react-day-picker": "^9.10.0",
    "react-dom": "19.1.0",
    "react-dropzone": "^14.3.8",
    "react-hook-form": "^7.62.0",
    "react-icons": "^5.5.0",
    "tailwind-merge": "^3.3.1",
    "zod": "^4.1.8"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3",
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "15.5.3",
    "tailwindcss": "^4",
    "tw-animate-css": "^1.3.8",
    "typescript": "^5"
  }
}
</file>

<file path="postcss.config.mjs">
const config = {
  plugins: ["@tailwindcss/postcss"],
};

export default config;
</file>

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

<file path="src/app/admin/page.tsx">
"use client";
import AdminGuard from "@/components/AdminGuard";
import { AnalyticsDashboard } from "@/components/AnalyticsDashboard";
import AuthGuard from "@/components/authguard";
import Navbar from "@/components/navbar";
import Sidebar from "@/components/sidebar";

export default function AdminHomePage() {
  return (
    <AuthGuard>
      <AdminGuard>
    <div className="flex flex-col min-h-screen bg-gray-50">
      <main className="flex flex-1">
        <Sidebar />
        <div className="w-full px-8 py-6">
          <AnalyticsDashboard />
        </div>
      </main>
    </div>
    </AdminGuard>
    </AuthGuard>
  );
}
</file>

<file path="src/app/cases/all-cases/explanatory-note/page.tsx">
"use client";
import Sidebar from "@/components/sidebar";
import { ExplanatoryNote } from "@/components/explanatorynote";
import {CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import AuthGuard from "@/components/authguard";

export default function ExplanatoryNotePage() {

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className=" w-full px-16 bg-[#F9FAFB]">
            <CardHeader>
        <CardTitle className="text-2xl font-bold text-gray-900 mt-2">Explanatory Note</CardTitle>
        <p className="text-lg text-gray-500 mb-12">Look in details</p>
      </CardHeader>
         <ExplanatoryNote/>
         <Button type="submit" className="bg-[#18668D]">
              Back
            </Button>
        </div>
      </main>
    
    </div>
    </AuthGuard>
  );
}
</file>

<file path="src/app/cases/all-cases/page.tsx">
"use client";
import Sidebar from "@/components/sidebar";
import YourCasesPage from "@/components/yourcases";
import AuthGuard from "@/components/authguard";

export default function AllCasesPage() {

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className=" w-full px-16 bg-[#F9FAFB]">
         <YourCasesPage/>
        </div>
      </main>
    
    </div>
    </AuthGuard>
  );
}
</file>

<file path="src/app/cases/new-case/appealpoint/page.tsx">
"use client";
import Sidebar from "@/components/sidebar";
import { AppealPointForm } from "@/components/appealpoint";
import AuthGuard from "@/components/authguard";

export default function AppealPointPage() {

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className=" w-full px-16 bg-[#F9FAFB]">
          <h1 className="text-2xl font-bold text-gray-900 mt-2">
                Details
            </h1>
        <p className="text-lg text-gray-500 mb-12">
            provide appeal point details
        </p>
           <AppealPointForm/>
        </div>
      </main>
    
    </div>
    </AuthGuard>
  );
}
</file>

<file path="src/app/cases/new-case/page.tsx">
"use client";
import Sidebar from "@/components/sidebar";
import { TaxForm } from "@/components/taxForm";
import AuthGuard from "@/components/authguard";

export default function NewCasePage() {

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className=" w-full px-16 pt-6 bg-[#F9FAFB]">
            <h1 className="text-2xl font-bold text-gray-900 mt-2">
                Submit a new case
            </h1>
        <p className="text-lg text-gray-500 mb-12">
            Fill out the  form below to generate an exoplanatory note
        </p>
        <TaxForm/>
        </div>
      </main>
    
    </div>
    </AuthGuard>
  );
}
</file>

<file path="src/app/cases/page.tsx">
"use client";

import Link from "next/link";
import { useState, useEffect } from "react";
import Sidebar from "@/components/sidebar";
import { Card, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { PlusCircle, FolderKanban } from "lucide-react";
import AuthGuard from "@/components/authguard";

export default function CasesPage() {
  const [userName, setUserName] = useState("User");

  // Load user name from localStorage
  useEffect(() => {
    const name = localStorage.getItem("staff_name");
    if (name) setUserName(name);
  }, []);

  return (
    <AuthGuard>
      <div className="flex flex-col min-h-screen">
        <main className="flex flex-1">
          <Sidebar />
          <div className="w-full pt-6 bg-[#F9FAFB]">
            <h1 className="text-4xl font-bold text-center text-gray-900 mt-2">
              Welcome, {userName}
            </h1>
            <p className="text-lg text-center text-gray-500 mb-12">
              What would you like to do today?
            </p>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-2xl mx-auto">
              <Link href={"/cases/new-case"}>
                <Card className="text-center p-6 transition-transform transform hover:scale-105 hover:shadow-lg">
                  <CardHeader className="flex flex-col items-center p-0">
                    <div className="p-4 rounded-full bg-yellow-100 text-yellow-600 mb-4">
                      <PlusCircle className="h-10 w-10" />
                    </div>
                    <CardTitle className="text-xl font-semibold mb-2">Submit New Case</CardTitle>
                    <CardDescription className="text-gray-500">
                      Generate an explanatory note for your case.
                    </CardDescription>
                  </CardHeader>
                </Card>
              </Link>

              <Link href={"/cases/all-cases"}>
                <Card className="text-center p-6 transition-transform transform hover:scale-105 hover:shadow-lg">
                  <CardHeader className="flex flex-col items-center p-0">
                    <div className="p-4 rounded-full bg-blue-100 text-blue-600 mb-4">
                      <FolderKanban className="h-10 w-10" />
                    </div>
                    <CardTitle className="text-xl font-semibold mb-2">View All My Cases</CardTitle>
                    <CardDescription className="text-gray-500">
                      Check the status of your existing cases.
                    </CardDescription>
                  </CardHeader>
                </Card>
              </Link>
            </div>
          </div>
        </main>
      </div>
    </AuthGuard>
  );
}
</file>

<file path="src/app/chat/page.tsx">
"use client";
import Sidebar from "@/components/sidebar";
import AuthGuard from "@/components/authguard";
import { Card, CardContent } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Video } from "lucide-react";
import { MdVideoCall } from "react-icons/md";
import { useState } from "react";
import api from "@/lib/api";

import { useEffect } from "react";

export default function ChatPage() {
  const [meetingUrl, setMeetingUrl] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const handleNewMeeting = async () => {
    setIsLoading(true);
    setError(null);
    try {
      const response = await api.post('/api/v1/meetings/create');
      if (response.data && response.data.meetLink) {
        const link = response.data.meetLink;
        setMeetingUrl(link);
        window.open(link, '_blank');
        // Clear pending flag on success
        localStorage.removeItem("pendingMeeting");
      } else {
        throw new Error("Did not receive a meeting link from the server.");
      }
    } catch (err: any) {
      console.error("Failed to create meeting:", err);
      if (err.response && err.response.status === 401) {
        // Remember we wanted to create a meeting
        localStorage.setItem("pendingMeeting", "true");
        window.location.href = `${process.env.NEXT_PUBLIC_API_URL}/oauth2/authorization/google`;
      } else {
        setError("Failed to create a new meeting. Please try again.");
      }
    } finally {
      setIsLoading(false);
    }
  };

  // Auto-create meeting after Google login redirect
  useEffect(() => {
    const pending = localStorage.getItem("pendingMeeting");
    if (pending === "true" && !meetingUrl && !isLoading) {
      handleNewMeeting();
    }
  }, []);

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className="flex items-center justify-center h-full">
      <Card className="w-full max-w-lg p-8 shadow-xl rounded-2xl">
        <CardContent className="flex flex-col items-center text-center p-0">
          <h1 className="text-3xl font-bold text-gray-800">Video Calls and meetings</h1>
          <p className="mt-2 text-gray-500">Connect, Share and Collaborate</p>
          
          <div className="flex items-center w-full max-w-md mt-8 space-x-2">
            <Button variant="outline" size="icon" className="h-10 w-10 text-[#0a608b]"><MdVideoCall size={32} /></Button>
            <Input type="text" placeholder="Enter a link to join" className="h-10" />
            <Button className="h-10 bg-[#0a608b] hover:bg-[#084a6e]">Join</Button>
          </div>

          <div className="flex items-center w-full max-w-md my-6"><div className="flex-grow border-t border-gray-200"></div><span className="mx-4 text-xs text-gray-400">OR</span><div className="flex-grow border-t border-gray-200"></div></div>
          
          <Button onClick={handleNewMeeting} disabled={isLoading} className="h-10 bg-[#0a608b] hover:bg-[#084a6e] px-6">
            <Video className="mr-2 h-4 w-4" />
            {isLoading ? "Creating..." : "New meeting"}
          </Button>
          {error && <p className="mt-4 text-sm text-red-600">{error}</p>}
        </CardContent>
      </Card>
    </div>
      </main>
    
    </div>
    </AuthGuard>
  );
}
</file>

<file path="src/app/globals.css">
@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar: var(--sidebar);
  --color-chart-5: var(--chart-5);
  --color-chart-4: var(--chart-4);
  --color-chart-3: var(--chart-3);
  --color-chart-2: var(--chart-2);
  --color-chart-1: var(--chart-1);
  --color-ring: var(--ring);
  --color-input: var(--input);
  --color-border: var(--border);
  --color-destructive: var(--destructive);
  --color-accent-foreground: var(--accent-foreground);
  --color-accent: var(--accent);
  --color-muted-foreground: var(--muted-foreground);
  --color-muted: var(--muted);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-secondary: var(--secondary);
  --color-primary-foreground: var(--primary-foreground);
  --color-primary: var(--primary);
  --color-popover-foreground: var(--popover-foreground);
  --color-popover: var(--popover);
  --color-card-foreground: var(--card-foreground);
  --color-card: var(--card);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
}

:root {
  --radius: 0.625rem;
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.97 0 0);
  --secondary-foreground: oklch(0.205 0 0);
  --muted: oklch(0.97 0 0);
  --muted-foreground: oklch(0.556 0 0);
  --accent: oklch(0.97 0 0);
  --accent-foreground: oklch(0.205 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --border: oklch(0.922 0 0);
  --input: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: oklch(0.205 0 0);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.205 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.205 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.922 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.704 0.191 22.216);
  --border: oklch(1 0 0 / 10%);
  --input: oklch(1 0 0 / 15%);
  --ring: oklch(0.556 0 0);
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(1 0 0 / 10%);
  --sidebar-ring: oklch(0.556 0 0);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}
</file>

<file path="src/app/layout.tsx">
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Rwanda Revenue Authority",
  description: "Tax claim review system",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      suppressHydrationWarning>
        {children}
      </body>
    </html>
  );
}
</file>

<file path="src/app/meetings/case-details/page.tsx">
"use client";

import { Suspense } from 'react';
import Sidebar from "@/components/sidebar";
import { CaseDetailsPage } from "@/components/casedetails";
import { useSearchParams } from 'next/navigation';
import AuthGuard from "@/components/authguard";

// A wrapper component to access search params
function CaseDetailsContent() {
  const searchParams = useSearchParams();
  const caseId = searchParams.get('caseId');

  if (!caseId) {
    return (
      <div className="text-center text-red-500">
        Error: Case ID is missing from the URL.
      </div>
    );
  }

  return <CaseDetailsPage caseId={caseId} />;
}

export default function MeetingsPage() {
  return (
    <AuthGuard>
      <div className="flex flex-col min-h-screen">
        <main className="flex flex-1">
          <Sidebar />
          <div className="w-full px-16 bg-[#F9FAFB]">
            <h1 className="text-2xl font-bold text-gray-900 mt-2">
              Case Details
            </h1>
            <p className="text-lg text-gray-500 mb-12">
              Look the Claim in details
            </p>
            {/* Suspense is good practice for components that read search params */}
            <Suspense fallback={<div>Loading...</div>}>
              <CaseDetailsContent />
            </Suspense>
          </div>
        </main>
      </div>
    </AuthGuard>
  );
}
</file>

<file path="src/app/meetings/case-details/tax-type-details/[appealId]/page.tsx">
"use client"; // 1. Make the entire page a Client Component

import Sidebar from "@/components/sidebar";
import AuthGuard from "@/components/authguard";
import { AppealPointDetails } from "@/components/AppealPointDetails";
import { useSearchParams } from "next/navigation";
import { Suspense } from "react";

// A small wrapper is still good practice to handle the Suspense boundary correctly
function AppealPointPageContent({ params }: { params: { appealId: string } }) {
  // 2. Access both the route param and search param here
  const searchParams = useSearchParams();
  const caseId = searchParams.get('caseId');

  if (!caseId) {
    return <div className="text-red-500 font-bold p-8">Error: Case ID is missing from the URL.</div>;
  }
  
  // 3. Pass the clean, unwrapped values as props
  return <AppealPointDetails caseId={caseId} appealId={params.appealId} />;
}

export default function DynamicAppealDetailsPage({ params }: { params: { appealId: string } }) {
  return (
    <AuthGuard>
      <div className="flex flex-col min-h-screen">
        <main className="flex flex-1">
          <Sidebar />
          <div className="w-full px-16 py-6 bg-gray-50">
             {/* Wrap the component that uses searchParams in Suspense */}
             <Suspense fallback={<div className="text-center p-8">Loading...</div>}>
                <AppealPointPageContent params={params} />
             </Suspense>
          </div>
        </main>
      </div>
    </AuthGuard>
  );
}
</file>

<file path="src/app/meetings/case-details/tax-type-details/page.tsx">
"use client";

import { Suspense } from 'react';
import Sidebar from "@/components/sidebar";
import AuthGuard from "@/components/authguard";
import { TaxTypeDetails } from '@/components/TaxTypeDetails'; 
import { useSearchParams } from 'next/navigation';


function TaxTypeDetailsContent() {
  const searchParams = useSearchParams();
  const caseId = searchParams.get('caseId');
  const taxAuditedId = searchParams.get('taxAuditedId');

  if (!caseId || !taxAuditedId) {
    return (
      <div className="text-center text-red-500 font-semibold p-8">
        Error: Missing required case information in the URL.
      </div>
    );
  }

  return <TaxTypeDetails caseId={caseId} taxAuditedId={taxAuditedId} />;
}

export default function NestedTaxTypeDetailsPage() {
  return (
    <AuthGuard>
      <div className="flex flex-col min-h-screen">
        <main className="flex flex-1">
          <Sidebar />
          <div className="w-full px-16 py-6 bg-[#F9FAFB]">
            <Suspense fallback={<div className="text-center">Loading Details...</div>}>
              <TaxTypeDetailsContent />
            </Suspense>
          </div>
        </main>
      </div>
    </AuthGuard>
  );
}
</file>

<file path="src/app/meetings/page.tsx">
"use client";
import Sidebar from "@/components/sidebar";
import CasesPage from "@/components/cases";
import AuthGuard from "@/components/authguard";

export default function MeetingsPage() {

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className=" w-full px-16 bg-[#F9FAFB]">
         <CasesPage/>
        </div>
      </main>
    
    </div>
    </AuthGuard>
  );
}
</file>

<file path="src/app/page.tsx">
import { redirect } from "next/navigation";

export default function Home() {
  redirect("/staff-login"); // sends users to login by default
}
</file>

<file path="src/app/profile/page.tsx">
"use client";
import Link from "next/link";
import Navbar from "@/components/navbar";
import Sidebar from "@/components/sidebar";
import { TaxForm } from "@/components/taxForm";
import YourCasesPage from "@/components/yourcases";
import ProfilePage from "@/components/profile";
import AuthGuard from "@/components/authguard";

export default function AllCasesPage() {

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className=" w-full px-16 bg-[#F9FAFB]">
          <ProfilePage/>
        </div>
      </main>
    
    </div>
    </AuthGuard>
  );
}
</file>

<file path="src/app/reports/new-minutes/page.tsx">
"use client";

import Sidebar from "@/components/sidebar";
import { MinutesForm } from "@/components/minutesform";
import AuthGuard from "@/components/authguard";

export default function CasesPage() {

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className=" w-full px-16 bg-[#F9FAFB]">
                    <h1 className="text-2xl font-bold text-gray-900 mt-2">
                        Meeting Minutes
                    </h1>
                <p className="text-lg text-gray-500 mb-12">
                    Fill out the  form bellow to generate a meeting minutes
                </p>
                <MinutesForm/>
                </div>
      </main>
    
    </div>
    </AuthGuard>
  );
}
</file>

<file path="src/app/reports/page.tsx">
"use client";
import Link from "next/link";
import Navbar from "@/components/navbar";
import Sidebar from "@/components/sidebar";
import { Card, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { PlusCircle, FolderKanban } from "lucide-react";
import MeetingMinutesPage from "@/components/meetingminutes";
import AuthGuard from "@/components/authguard";

export default function CasesPage() {

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className="w-full bg-[#F9FAFB]">
          <MeetingMinutesPage/>
        </div>
      </main>
    
    </div>
    </AuthGuard>
  );
}
</file>

<file path="src/app/staff-login/page.tsx">
"use client";

import { useState, useEffect, FormEvent } from "react";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Checkbox } from "@/components/ui/checkbox";
import Link from "next/link";
import api from "@/lib/api";
import { useRouter } from "next/navigation";
import { log } from "console";


export default function StaffLoginPage() {
  const router = useRouter();

  const [email, setEmail] = useState<string>("");
  const [password, setPassword] = useState<string>("");
  const [rememberMe, setRememberMe] = useState<boolean>(false);
  const [errorMsg, setErrorMsg] = useState<string>("");
  const [loading, setLoading] = useState<boolean>(false);
    

  // Load remembered credentials
  useEffect(() => {
    const remembered = localStorage.getItem("staff_login_remember");
    if (remembered) {
      const savedData = JSON.parse(remembered);
      setEmail(savedData.email || "");
      setPassword(savedData.password || "");
      setRememberMe(true);
    }
  }, []);

  const handleSubmit = async (e: FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    setErrorMsg("");

    if (!email || !password) {
      setErrorMsg("Email and password are required.");
      return;
    }

    setLoading(true);
    try {
  const res = await api.post("/api/v1/auth/login", { email, password });
  console.log(api);
  

  // Save token if returned
  if (res.data.accessToken) {
    localStorage.setItem("staff_token", res.data.accessToken);
  }

  if (res.data.refreshToken) { 
    localStorage.setItem("staff_refresh_token", res.data.refreshToken); 
  }
  

  if (res.data.fullNames) localStorage.setItem("staff_name", res.data.fullNames);
  if (res.data.id) {
  localStorage.setItem("staff_id", res.data.id);
  }
  if (res.data.role) {
      localStorage.setItem("staff_role", res.data.role); 
    }

  
  if (rememberMe) {
    localStorage.setItem(
      "staff_login_remember",
      JSON.stringify({ email, password })
    );
  } else {
    localStorage.removeItem("staff_login_remember");
  }

  if (res.data.role === "COMMITTEE_LEADER") {
    router.push("/admin");
  } else {
    router.push("/cases");
  }

} catch (error: any) {
  if (error.response && error.response.data) {
    setErrorMsg(error.response.data.message || "Login failed.");
  } else {
    setErrorMsg(error.message || "Login failed.");
  }
} finally {
  setLoading(false);
}
  };

  return (
    <div className="flex min-h-screen">
      {/* Left side */}
      <div className="flex w-1/2 flex-col items-center justify-center px-10">
        {/* Logo */}
        <div className="flex flex-row items-center">
          <img src="/Rralogo.png" alt="Logo" className="h-14 w-auto"/>
          <h1 className="text-2xl font-bold text-[#1d3557]">
            Tax Claim Management System
          </h1>
        </div>

        <div className="flex space-x-2 mb-4">
          <div className="h-[6px] w-40 rounded-full bg-[#338ABE]" />
          <div className="h-[6px] w-24 rounded-full bg-[#F8BD00]" />
          <div className="h-[6px] w-12 rounded-full bg-[#319F43]" />
        </div>

        <h2 className="text-2xl font-semibold mb-1">Welcome back</h2>
        <p className="text-lg font-semibold text-gray-500 mb-6">staff portal</p>

        <form onSubmit={handleSubmit} className="w-full max-w-sm space-y-4">
          <div>
            <label className="text-sm font-medium text-gray-700">
              Staff email
            </label>
            <Input
              type="email"
              placeholder="email or username"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="mt-1"
              required
            />
          </div>

          <div>
            <label className="text-sm font-medium text-gray-700">
              Password
            </label>
            <Input
              type="password"
              placeholder="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="mt-1"
              required
            />
          </div>

          <div className="flex items-center justify-between text-sm">
            <div className="flex items-center space-x-2">
              <Checkbox
                id="remember"
                checked={rememberMe}
                onCheckedChange={(checked) =>
                  setRememberMe(checked === true)
                }
              />
              <label htmlFor="remember">Remember me</label>
            </div>
            <Link href="/forgot-password" className="text-[#18668D] underline">
              Forgot password
            </Link>
          </div>

          {errorMsg && <p className="text-red-600 text-sm">{errorMsg}</p>}

          <Button
            type="submit"
            className="w-full bg-[#18668D] hover:bg-[#134d66]"
            disabled={loading}
          >
            {loading ? "Logging in..." : "Login"}
          </Button>
        </form>

        <p className="text-sm text-gray-500 mt-6">
          Dont have an account?{" "}
          <Link href="/staff-register" className="text-[#18668D]">
            Register
          </Link>
        </p>
      </div>

      {/* Right side */}
      <div className="w-1/2 bg-[#1b4965] text-white flex flex-col justify-center items-center px-12 relative">
        <div className="absolute left-0 top-0 bottom-0 w-[6px] bg-[#338ABE]" />
        <div className="absolute left-[6px] top-0 bottom-0 w-[6px] bg-[#F8BD00]" />
        <div className="absolute left-[12px] top-0 bottom-0 w-[6px] bg-[#319F43]" />

        <div className="max-w-md text-center">
          <div className="flex justify-center mb-6">
            <img
              src="/Rralogo.png"
              alt="Logo"
              className="h-20 w-20 p-2 rounded-full bg-white"
            />
          </div>
          <h2 className="text-2xl font-bold mb-4">
            Efficient Tax Administration Starts Here
          </h2>
          <p className="text-gray-200">
            Empowering Automation tools for seamless tax claim processing and
            management.
          </p>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/app/staff-register/page.tsx">
"use client";

import { useEffect, useState } from "react";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { useRouter } from "next/navigation";
import Link from "next/link";
import * as Select from "@radix-ui/react-select";
import api from "@/lib/api"; 


export default function StaffRegisterPage() {
  const [formData, setFormData] = useState({
    fullName: "",
    title: "",
    committeeRole: "",
    committeeGroup: "",
    email: "",
    phoneNumber: "",
    password: "",
    confirmPassword: "",
  });

  console.log(api);
  

  const router = useRouter();
  const [rememberMe, setRememberMe] = useState(false);
  const [loading, setLoading] = useState(false);
  const [errorMsg, setErrorMsg] = useState("");
  const [successMsg, setSuccessMsg] = useState("");

  // Load remembered credentials
  useEffect(() => {
    const remembered = localStorage.getItem("staff_register_remember");
    if (remembered) {
      const savedData = JSON.parse(remembered);
      setFormData((prev) => ({
        ...prev,
        email: savedData.email || "",
        password: savedData.password || "",
      }));
      setRememberMe(true);
    }
  }, []);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setFormData((prev) => ({ ...prev, [e.target.id]: e.target.value }));
  };

  const handleCommitteeRoleChange = (value: string) => {
  setFormData((prev) => ({ ...prev, committeeRole: value }));
};

  const handleCommitteeChange = (value: string) => {
    setFormData((prev) => ({ ...prev, committeeGroup: value }));
  };

  // Password validation
  const passwordChecks = {
    length: formData.password.length >= 8,
    letter: /[A-Za-z]/.test(formData.password),
    number: /\d/.test(formData.password),
    symbol: /[^A-Za-z0-9]/.test(formData.password),
  };

  const isValidPassword =
    passwordChecks.length &&
    passwordChecks.letter &&
    passwordChecks.number &&
    passwordChecks.symbol;

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setErrorMsg("");
    setSuccessMsg("");
    if (formData.password !== formData.confirmPassword) {
      setErrorMsg("Passwords do not match.");
      return;
    }

    if (!isValidPassword) {
      setErrorMsg(
        "Password must be at least 8 characters, include letters, numbers, and symbols."
      );
      return;
    }

    // Handle Remember Me storage
    if (rememberMe) {
      localStorage.setItem(
        "staff_register_remember",
        JSON.stringify({ email: formData.email, password: formData.password })
      );
    } else {
      localStorage.removeItem("staff_register_remember");
    }

      try {
        setLoading(true);
        const res = await api.post("/api/v1/auth/register", formData);
        console.log(api);
        
        setSuccessMsg(res.data.message || "Registration successful!");
        setErrorMsg("");
        setLoading(false);
        router.push("/cases");

      } catch (error: any) {
        if (error.response && error.response.data) {
          setErrorMsg(error.response.data.message || "Something went wrong.");
        } else {
          setErrorMsg(error.message || "Something went wrong.");
        }
        setLoading(false);
      }
    };

  return (
    <div className="flex min-h-screen">
      {/* Left side */}
      <div className="flex w-1/2 flex-col items-center justify-center px-10">
        <div className="flex flex-row items-center">
          <img src="/Rralogo.png" alt="Logo" className="h-14 w-auto" />
          <h1 className="text-2xl font-bold text-[#1d3557] ml-2">
            Tax Claim Management System
          </h1>
        </div>

        <div className="flex space-x-2 mb-4">
          <div className="h-[6px] w-40 rounded-full bg-[#338ABE]" />
          <div className="h-[6px] w-24 rounded-full bg-[#F8BD00]" />
          <div className="h-[6px] w-12 rounded-full bg-[#319F43]" />
        </div>

        <h2 className="text-2xl font-semibold mb-1">Welcome back</h2>
        <p className="text-lg font-semibold text-gray-500 mb-6">staff portal</p>

        <form className="space-y-4 w-full max-w-sm" onSubmit={handleSubmit}>
          <div>
            <label>Full names</label>
            <Input
              id="fullName"
              placeholder="Full names"
              value={formData.fullName}
              onChange={handleChange}
              required
            />
          </div>

          <div>
            <label>Title</label>
            <Input
              id="title"
              placeholder="type your title"
              value={formData.title}
              onChange={handleChange}
              required
            />
          </div>

          <div className="flex flex-col space-y-1">
            <label className="text-sm font-medium text-gray-700">Role</label>
            <Select.Root value={formData.committeeRole} onValueChange={handleCommitteeRoleChange}>
              <Select.Trigger
                className="h-8 w-full bg-white border border-gray-300 rounded px-3 flex items-center justify-between"
                aria-label="Role"
              >
                <Select.Value placeholder="Choose your Role" />
              </Select.Trigger>
              <Select.Content className="bg-white border border-gray-300 rounded mt-1">
                <Select.Viewport>
                  <Select.Item
                    value="COMMITTEE_LEADER"
                    className="px-3 py-2 hover:bg-gray-100"
                  >
                    <Select.ItemText>COMMITTEE LEADER</Select.ItemText>
                  </Select.Item>
                  <Select.Item
                    value="COMMITTEE_MEMBER"
                    className="px-3 py-2 hover:bg-gray-100"
                  >
                    <Select.ItemText>
                      COMMITTEE MEMBER
                    </Select.ItemText>
                  </Select.Item>
                  <Select.Item
                    value="COMMITTEE_MEMBER_T3_TAM"
                    className="px-3 py-2 hover:bg-gray-100"
                  >
                    <Select.ItemText>
                      COMMITTEE MEMBER T3 TAM
                    </Select.ItemText>
                  </Select.Item>
                </Select.Viewport>
              </Select.Content>
            </Select.Root>
          </div>

          <div className="flex flex-col space-y-1">
            <label className="text-sm font-medium text-gray-700">
              Committee group
            </label>
            <Select.Root
              value={formData.committeeGroup}
              onValueChange={handleCommitteeChange}
            >
              <Select.Trigger
                className="h-8 w-full bg-white border border-gray-300 rounded px-3 flex items-center justify-between"
                aria-label="Committee group"
              >
                <Select.Value placeholder="choose your group" />
              </Select.Trigger>
              <Select.Content className="bg-white border border-gray-300 rounded mt-1">
                <Select.Viewport>
                  <Select.Item
                    value="APPEAL_COMMITTEE"
                    className="px-3 py-2 hover:bg-gray-100"
                  >
                    <Select.ItemText>Appeal Committee</Select.ItemText>
                  </Select.Item>
                  <Select.Item
                    value="AMICABLE_SETTLEMENT_COMMITTEE"
                    className="px-3 py-2 hover:bg-gray-100"
                  >
                    <Select.ItemText>Amicable Settlement Committee</Select.ItemText>
                  </Select.Item>
                </Select.Viewport>
              </Select.Content>
            </Select.Root>
          </div>

          <div>
            <label>Staff email</label>
            <Input
              id="email"
              type="email"
              placeholder="email"
              value={formData.email}
              onChange={handleChange}
              required
            />
          </div>

          <div>
            <label>Phone</label>
            <Input
              id="phoneNumber"
              type="tel"
              placeholder="Phone"
              value={formData.phoneNumber}
              onChange={handleChange}
              required
            />
          </div>

          <div>
            <label>Password</label>
            <Input
              id="password"
              type="password"
              placeholder="password"
              value={formData.password}
              onChange={handleChange}
              required
            />
          </div>

          <div>
            <label>Confirm Password</label>
            <Input
              id="confirmPassword"
              type="password"
              placeholder="password"
              value={formData.confirmPassword}
              onChange={handleChange}
              required
            />
          </div>

          <div className="flex items-center justify-between">
            <label className="flex items-center space-x-2 text-gray-700">
              <input
                type="checkbox"
                checked={rememberMe}
                onChange={(e) => setRememberMe(e.target.checked)}
                className="accent-[#18668D] w-4 h-4"
              />
              <span>Remember Me</span>
            </label>

            <Link
              href="/forgot-password"
              className="text-sm text-[#18668D] hover:underline"
            >
              Forgot password?
            </Link>
          </div>

          {errorMsg && <p className="text-red-600 text-sm">{errorMsg}</p>}
          {successMsg && <p className="text-green-600 text-sm">{successMsg}</p>}

          <Button
            type="submit"
            className="w-full bg-[#18668D] hover:bg-[#134d66]"
            disabled={loading}
          >
            {loading ? "Registering..." : "Register"}
          </Button>
        </form>

        <p className="text-sm text-gray-500 mb-3">
          Have an account?{" "}
          <Link href="/staff-login" className="text-[#18668D]">
            Login
          </Link>
        </p>
      </div>

      {/* Right side */}
      <div className="w-1/2 bg-[#1b4965] text-white flex flex-col justify-center items-center px-12 relative">
        <div className="absolute left-0 top-0 bottom-0 w-[6px] bg-[#338ABE]" />
        <div className="absolute left-[6px] top-0 bottom-0 w-[6px] bg-[#F8BD00]" />
        <div className="absolute left-[12px] top-0 bottom-0 w-[6px] bg-[#319F43]" />

        <div className="max-w-md text-center">
          <div className="flex justify-center mb-6">
            <img
              src="/Rralogo.png"
              alt="Logo"
              className="h-20 w-20 p-2 rounded-full bg-white"
            />
          </div>
          <h2 className="text-2xl font-bold mb-4">
            Efficient Tax Administration Starts Here
          </h2>
          <p className="text-gray-200">
            Empowering automation tools for seamless tax claim processing and
            management.
          </p>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/app/types/case.ts">
// types/case.ts
export interface Case {
  taxOriginal: string;
  amountDischarged: string;
  taxToBePaid: string;
  casePresenter: string;
  auditor: string;
  caseId: string;
  taxPayer: string;
  submittedAt: string;
  daysLeft: number;
  status: "Pending" | "Approved" | "Rejected";
}
</file>

<file path="src/app/types/meetingminutes.ts">
// types/case.ts
export interface MeetingMinutes {
  preparedBy: string;
  date: string;
  type: string;
  doc: string;
}
</file>

<file path="src/app/types/minutes-mock-data.ts">
// mock-data/cases.ts
import { MeetingMinutes } from "./meetingminutes";

export const meetingminutes: MeetingMinutes[] = [
  {
  preparedBy: "John Doe",
  date: "March,23,2025",
  type: "meeting minutes",
  doc: "view"
  },
  {
  preparedBy: "Smith george",
  date: "May,3,2025",
  type: "meeting minutes",
  doc: "view"
  },
  {
  preparedBy: "joseph nerd",
  date: "september,09,2025",
  type: "meeting minutes",
  doc: "view"
  },
  {
  preparedBy: "Laura keating",
  date: "January,11,2025",
  type: "meeting minutes",
  doc: "view"
  },
];
</file>

<file path="src/app/types/mock-data.ts">
// mock-data/cases.ts
import { Case } from "./case";

export const cases: Case[] = [
  {
    caseId: "#AUDDTD2023",
    taxPayer: "NKINKA BIGABWA RODNEY",
    submittedAt: "Feb 5, 2023",
    daysLeft: 28,
    status: "Pending",
    taxOriginal: '300,000frw',
    amountDischarged: '100,000frw',
    taxToBePaid: '200,000frw',
    casePresenter: 'Catherine',
    auditor: 'Kanyambo Beatrice'
  },
  {
    caseId: "#AUDDTD2023",
    taxPayer: "NKINKA BIGABWA RODNEY",
    submittedAt: "Feb 5, 2023",
    daysLeft: 28,
    status: "Rejected",
    taxOriginal: '300,000frw',
    amountDischarged: '100,000frw',
    taxToBePaid: '200,000frw',
    casePresenter: 'Catherine',
    auditor: 'Kanyambo Beatrice'
  },
  {
    caseId: "#AUDDTD2023",
    taxPayer: "NKINKA BIGABWA RODNEY",
    submittedAt: "Feb 5, 2023",
    daysLeft: 28,
    status: "Approved",
    taxOriginal: '300,000frw',
    amountDischarged: '100,000frw',
    taxToBePaid: '200,000frw',
    casePresenter: 'Catherine',
    auditor: 'Kanyambo Beatrice'
  },
  {
    caseId: "#AUDDTD2023",
    taxPayer: "NKINKA BIGABWA RODNEY",
    submittedAt: "Feb 5, 2023",
    daysLeft: 28,
    status: "Pending",
    taxOriginal: '300,000frw',
    amountDischarged: '100,000frw',
    taxToBePaid: '200,000frw',
    casePresenter: 'Catherine',
    auditor: 'Kanyambo Beatrice'
  },
  {
    caseId: "#AUDDTD2023",
    taxPayer: "NKINKA BIGABWA RODNEY",
    submittedAt: "Feb 5, 2023",
    daysLeft: 28,
    status: "Pending",
    taxOriginal: '300,000frw',
    amountDischarged: '100,000frw',
    taxToBePaid: '200,000frw',
    casePresenter: 'Catherine',
    auditor: 'Kanyambo Beatrice'
  },
  {
    caseId: "#AUDDTD2023",
    taxPayer: "NKINKA BIGABWA RODNEY",
    submittedAt: "Feb 5, 2023",
    daysLeft: 28,
    status: "Pending",
    taxOriginal: '300,000frw',
    amountDischarged: '100,000frw',
    taxToBePaid: '200,000frw',
    casePresenter: 'Catherine',
    auditor: 'Kanyambo Beatrice'
  },
];
</file>

<file path="src/app/vote/page.tsx">
"use client";

import Sidebar from "@/components/sidebar";
import VotePage from "@/components/vote";
import AuthGuard from "@/components/authguard";

export default function MeetingsPage() {

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className=" w-full px-16">
            <h1 className="text-2xl font-bold text-gray-900 mt-2">
                Vote
            </h1>
        <p className="text-lg text-gray-500 mb-12">
            Vote
        </p>
         <VotePage/>
        </div>
      </main>
    </div>
    </AuthGuard>
  );
}
</file>

<file path="src/components/AdminGuard.tsx">
"use client";

import { useEffect, useState } from "react";
import { useRouter } from "next/navigation";

interface AdminGuardProps {
  children: React.ReactNode;
}

export default function AdminGuard({ children }: AdminGuardProps) {
  const router = useRouter();
  const [isAuthorized, setIsAuthorized] = useState<boolean | null>(null);

  useEffect(() => {
    // Get the stored role from localStorage
    const userRole = localStorage.getItem("staff_role");

    if (userRole === "COMMITTEE_LEADER") {
      setIsAuthorized(true);
    } else {
      // If the role is incorrect or doesn't exist, redirect
      setIsAuthorized(false);
      router.replace("/cases"); 
    }
  }, [router]);

  if (isAuthorized === null) {
    return <div className="h-screen flex items-center justify-center">Verifying access...</div>;
  }

  if (isAuthorized) {
    return <>{children}</>;
  }

  return null;
}
</file>

<file path="src/components/AnalyticsDashboard.tsx">
"use client";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { TrendingUp, CheckCircle2, Clock } from "lucide-react";
import { CaseAnalyticsChart } from "./case-analytics-chart";
import { AttendanceList } from "./attendance-list";
import AgendaCasesPage from "./cases";
import { useEffect, useState } from "react";
import api from "@/lib/api"; 


interface AnalyticsData {
  totalCases: number;
  reviewRate: number;
  pendingCases: number;
}

export function AnalyticsDashboard() {
  
  const [data, setData] = useState<AnalyticsData | null>(null);
  
  const [loading, setLoading] = useState(true);
  
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    
    const fetchAnalyticsData = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await api.get('/api/v1/my-cases/analytics');
        if (response.data && response.data.data) {
          setData(response.data.data);
        } else {
          throw new Error("Analytics data not found in the response.");
        }
      } catch (err) {
        console.error("Failed to fetch analytics:", err);
        setError("Could not load analytics data.");
      } finally {
        setLoading(false);
      }
    };

    fetchAnalyticsData();
  }, []);

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-3xl font-bold text-gray-900">Analytics</h1>
        <p className="text-gray-600 mt-1">Track Assigned Cases in One Place</p>
      </div>

      {error && <p className="text-red-600">{error}</p>}
      
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        {/* Total Cases Card */}
        <Card className="bg-blue-50 border-blue-100">
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-700">
              Total cases
            </CardTitle>
            <TrendingUp className="h-4 w-4 text-blue-600" />
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-bold text-gray-900">
              {/* Display loading state or the fetched data */}
              {loading ? "..." : data?.totalCases ?? 0}
            </div>
          </CardContent>
        </Card>

        {/* Review Rate Card */}
        <Card className="bg-green-50 border-green-100">
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-700">
              Review Rate
            </CardTitle>
            <CheckCircle2 className="h-4 w-4 text-green-600" />
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-bold text-gray-900">
               {/* Display loading state or the fetched data, formatted as a percentage */}
              {loading ? "..." : `${data?.reviewRate ?? 0} %`}
            </div>
          </CardContent>
        </Card>

        {/* Pending Cases Card */}
        <Card className="bg-purple-50 border-purple-100">
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-700">
              Pending Cases
            </CardTitle>
            <Clock className="h-4 w-4 text-purple-600" />
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-bold text-gray-900">
              {/* Display loading state or the fetched data */}
              {loading ? "..." : data?.pendingCases ?? 0}
            </div>
          </CardContent>
        </Card>
      </div>
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div className="lg:col-span-2">
          <CaseAnalyticsChart />
        </div>
        <div>
          <AttendanceList />
        </div>
      </div>
      <AgendaCasesPage />
    </div>
  );
}
</file>

<file path="src/components/appealpoint.tsx">
"use client";

import { zodResolver } from "@hookform/resolvers/zod";
import { useFieldArray, useForm } from "react-hook-form";
import * as z from "zod";
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Textarea } from "@/components/ui/textarea";
import { PlusCircle } from "lucide-react";

// Schema for a single appeal point
const appealPointSchema = z.object({
  appealPoint: z.string().min(1, { message: "Appeal point is required." }),
  auditorsOpinion: z.string().min(1, { message: "Auditor's opinion is required" }),
  problemSummary: z.string().min(1, { message: "Problem summary is required." }),
  proposedSolution: z.string().min(1, { message: "Proposed solution is required." }),
});

// Main form schema
const formSchema = z.object({
  caseId: z.string().min(1, { message: "Case ID is required." }),
  appealPoints: z.array(appealPointSchema).min(1, { message: "You must add at least one appeal point." }),
});

export function AppealPointForm() {
  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
    defaultValues: {  
      appealPoints: [
        {
          appealPoint: "",
          auditorsOpinion: "",
          problemSummary: "",
          proposedSolution: "",
        },
      ],
    },
  });

  const { fields: appealFields, append: appendAppeal, remove: removeAppeal } = useFieldArray({
    control: form.control,
    name: "appealPoints",
  });

  function onSubmit(values: z.infer<typeof formSchema>) {
    console.log(values);
    alert("Form submitted! Check console for values.");
  }

  return (
    <div className="container p-4 max-w-2xl">
      <Form {...form}>
        <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-8">
          <>
                <div className="grid grid-cols-2 md:grid-cols-1 gap-4 bg-white">
                 <div className="rounded-lg border p-6 space-y-4">
                <h2 className="text-xl font-semibold">Details</h2>
                <h1 className="text-gray-500 font-medium">Appeal point 1</h1>
                {appealFields.map((field, index) => (
                  <div key={field.id} className="space-y-4 border-b pb-4">
                    <FormField control={form.control} name={`appealPoints.${index}.appealPoint`} render={({ field }) => (
                      <FormItem>
                        <FormLabel>Appeal Point</FormLabel>
                        <FormControl><Input {...field} placeholder="Enter appeal point" /></FormControl>
                        <FormMessage />
                      </FormItem>
                    )} />
                    <FormField control={form.control} name={`appealPoints.${index}.problemSummary`} render={({ field }) => (
                      <FormItem>
                        <FormLabel>Problem Summary</FormLabel>
                        <FormControl><Textarea {...field} placeholder="problem summary goes here . . . "/></FormControl>
                        <FormMessage />
                      </FormItem>
                    )} />
                    <FormField control={form.control} name={`appealPoints.${index}.auditorsOpinion`} render={({ field }) => (
                      <FormItem>
                        <FormLabel>Basis of Tax assessment by Auditor</FormLabel>
                        <FormControl><Textarea {...field} placeholder="auditors comments go here . . ."/></FormControl>
                        <FormMessage />
                      </FormItem>
                    )} />
                    <FormField control={form.control} name={`appealPoints.${index}.proposedSolution`} render={({ field }) => (
                      <FormItem>
                        <FormLabel>Proposed Solution in accordance with the laws</FormLabel>
                        <FormControl><Textarea {...field} placeholder="Your proposed solution goes here . . . " /></FormControl>
                        <FormMessage />
                      </FormItem>
                    )} />
                    
                  </div>
                ))}
                
              </div>
            </div>
            <Button
                    type="button"
                    variant="outline" 
                    className="w-full justify-center text-lg font-bold text-[#18668D] hover:bg-blue-50 hover:text-[#0f567a] border-gray-200 h-10" // Tailor the look
                    onClick={() =>
                        appendAppeal({
                        appealPoint: "",
                        auditorsOpinion: "",
                        problemSummary: "",
                        proposedSolution: "",
                        })
                    }
                    >
                    <PlusCircle className="mr-3 h-6 w-6" /> 
                    Add appeal point
                </Button>
            <div className="flex justify-between">
                <Button type="button"  className="bg-[#18668D]">
                    <a href="/cases/new-case">Back</a>
                </Button>
                <Button type="submit" className="bg-[#18668D]">
                    <a href="/cases/new-case">Done</a>
                </Button>
            </div>
            </>
        </form>
      </Form>
    </div>
  );
}
</file>

<file path="src/components/AppealPointDetails.tsx">
"use client";

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import api from '@/lib/api';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { AppealVote } from './AppealVote';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from './ui/dialog';

// Interfaces to match our data structure
interface AppealDTO {
  AppealId: string;
  appealPoint: string;
  summarisedProblem: string;
  auditorsOpinion: string;
  proposedSolution: string;
}

type Tab = 'appeal' | 'opinion' | 'solution';

export function AppealPointDetails({ caseId, appealId }: { caseId: string, appealId: string }) {
  const [appeal, setAppeal] = useState<AppealDTO | null>(null);
  const [taxTypeName, setTaxTypeName] = useState('');
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [activeTab, setActiveTab] = useState<Tab>('appeal');
  const [hasVoted, setHasVoted] = useState(false); // 1. State to track vote status
  const router = useRouter();

  // Function to check vote status from localStorage
  const checkVoteStatus = () => {
    const votedAppeals = JSON.parse(localStorage.getItem('votedAppeals') || '[]');
    if (votedAppeals.includes(appealId)) {
      setHasVoted(true);
    }
  };

  useEffect(() => {
    // 2. Check vote status when the component first loads
    checkVoteStatus();

    const fetchAppealDetails = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await api.get(`/api/v1/auth/explanatory_note/${caseId}`);
        const caseData = response.data.data;
        
        let foundAppeal: AppealDTO | undefined;
        let foundTaxType = '';

        for (const taxItem of caseData.taxAudited) {
          foundAppeal = taxItem.appeals.find((a: AppealDTO) => a.AppealId === appealId);
          if (foundAppeal) {
            foundTaxType = taxItem.taxTypeAudited;
            break;
          }
        }

        if (foundAppeal) {
          setAppeal(foundAppeal);
          setTaxTypeName(foundTaxType);
        } else {
          throw new Error("Appeal point not found in this case.");
        }
      } catch (err) {
        console.error("Failed to fetch appeal details:", err);
        setError("Could not load the appeal point details.");
      } finally {
        setLoading(false);
      }
    };

    fetchAppealDetails();
  }, [caseId, appealId]);

  const handleVoteSuccess = () => {
    setHasVoted(true);
  };

  if (loading) return <div className="text-center p-8">Loading Appeal Details...</div>;
  if (error || !appeal) return <div className="text-center text-red-500 p-8">{error}</div>;

  const TabButton = ({ tab, label }: { tab: Tab, label: string }) => (
    <button
      onClick={() => setActiveTab(tab)}
      className={`pb-2 px-4 text-sm font-medium ${
        activeTab === tab
          ? 'border-b-2 border-blue-600 text-blue-600'
          : 'text-gray-500 hover:text-gray-700'
      }`}
    >
      {label}
    </button>
  );

  return (
    <div className="w-full max-w-4xl mx-auto space-y-6">
      <div>
        <h1 className="text-3xl font-bold">{taxTypeName}</h1>
        <p className="text-lg text-gray-500">Appeal Point Details</p>
      </div>

      <Card className="p-8">
        <CardContent className="p-0">
          {/* Tab Navigation */}
          <div className="border-b border-gray-200 mb-6">
            <nav className="flex space-x-4">
              <TabButton tab="appeal" label="Appeal point" />
              <TabButton tab="opinion" label="Auditors opinion" />
              <TabButton tab="solution" label="Commissioner proposed solution" />
            </nav>
          </div>

          {/* Tab Content */}
          <div className="space-y-4">
            {activeTab === 'appeal' && (
              <div>
                <h3 className="font-bold text-lg mb-2">Appeal point</h3>
                <p className="text-gray-700">{appeal.appealPoint}</p>
                <h3 className="font-bold text-lg mt-4 mb-2">Description</h3>
                <p className="text-gray-700 whitespace-pre-line">{appeal.summarisedProblem}</p>
              </div>
            )}
            {activeTab === 'opinion' && (
              <div>
                <h3 className="font-bold text-lg mb-2">Auditors Opinion</h3>
                <p className="text-gray-700 whitespace-pre-line">{appeal.auditorsOpinion}</p>
              </div>
            )}
            {activeTab === 'solution' && (
              <div>
                <h3 className="font-bold text-lg mb-2">Commissioner Proposed Solution</h3>
                <p className="text-gray-700 whitespace-pre-line">{appeal.proposedSolution}</p>
              </div>
            )}
          </div>
        </CardContent>
      </Card>

      <div className="flex justify-between items-center">
        <Button 
          onClick={() => router.back()}
          variant="outline"
          className="border-2 border-gray-700 text-gray-700 font-bold hover:bg-gray-100"
        >
          Back
        </Button>
        
        {!hasVoted && (
          <Dialog onOpenChange={(isOpen) => {
            
            if (!isOpen) {
              checkVoteStatus();
            }
          }}>
            <DialogTrigger asChild>
              <Button className="bg-[#18668D] hover:bg-[#134d66] font-bold">Vote</Button>
            </DialogTrigger>
            <DialogContent className="sm:max-w-[425px]">
              <DialogHeader>
                <DialogTitle>Vote on Appeal Point</DialogTitle>
              </DialogHeader>
              <div className="py-4">
                <p className="font-medium mb-4">{appeal.appealPoint}</p>
                <AppealVote appealId={appeal.AppealId} onVoteSuccess={handleVoteSuccess} />
              </div>
            </DialogContent>
          </Dialog>
        )}
      </div>
    </div>
  );
}
</file>

<file path="src/components/AppealVote.tsx">
"use client";

import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Clock, ThumbsDown, BadgeCheck, CheckCircle } from 'lucide-react';
import { Textarea } from '@/components/ui/textarea';

interface AppealVoteProps {
  appealId: string;
  onVoteSuccess: () => void;
}

type VoteStatus = 'idle' | 'voting' | 'voted' | 'error';
type VoteDecision = 'NOTJUSTIFIED' | 'JUSTIFIED' | 'ABSTAIN';

const isUUID = (str: string | null | undefined): boolean => {
  if (!str) return false;
  const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
  return uuidRegex.test(str);
};

export function AppealVote({ appealId }: AppealVoteProps) {
  const [status, setStatus] = useState<VoteStatus>('idle');
  const [feedback, setFeedback] = useState('');
  const [voteComment, setVoteComment] = useState(""); 
  const [userRole, setUserRole] = useState<string | null>(null);
  
  const [hasVoted, setHasVoted] = useState<boolean>(false);
  
  useEffect(() => {
    const votedAppeals = JSON.parse(localStorage.getItem('votedAppeals') || '[]');
    if (votedAppeals.includes(appealId)) {
      setHasVoted(true);
      setFeedback('You have already cast your vote on this appeal point.');
    }
    setUserRole(localStorage.getItem('staff_role'));
  }, [appealId]);
  

  const handleVote = async (decision: VoteDecision) => {
    setStatus('voting');
    setFeedback('');

    const rawCommitteeMemberId = localStorage.getItem('staff_id');
    const committeeMemberId = rawCommitteeMemberId ? rawCommitteeMemberId.replace(/"/g, '') : null;
    const committeeMemberName = localStorage.getItem('staff_name');

    if (!isUUID(committeeMemberId) || !committeeMemberName) {
      const errorMessage = `Authentication Error: Your user ID is invalid. Please log out and log back in.`;
      setFeedback(errorMessage);
      setStatus('error');
      return;
    }

    const payload = {
      committeeMemberId,
      committeeMemberName,
      committeeDecision: decision,
      voteComment: userRole === 'COMMITTEE_LEADER' ? voteComment : `${decision}d via web interface.`
    };

    try {
      const token = localStorage.getItem("staff_token");
      const url = `${process.env.NEXT_PUBLIC_API_URL}/api/appeals/${appealId}/vote`;

      const response = await fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(payload)
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || `Request failed with status ${response.status}`);
      }
      
      const votedAppeals = JSON.parse(localStorage.getItem('votedAppeals') || '[]');
      if (!votedAppeals.includes(appealId)) {
        votedAppeals.push(appealId);
        localStorage.setItem('votedAppeals', JSON.stringify(votedAppeals));
      }
      setHasVoted(true);
      setStatus('voted');
      let decisionText = '';
      if (decision === 'JUSTIFIED') decisionText = 'justified';
      else if (decision === 'NOTJUSTIFIED') decisionText = 'not justified';
      else decisionText = 'abstained';
      setFeedback(`You have successfully voted that the appeal is ${decisionText}.`);
    } catch (err: any) {
      const errorMessage = err.message || 'An error occurred while submitting your vote.';
      setStatus('error');
      setFeedback(errorMessage);
      console.error('Vote submission error:', err);
    }
  };
  if (hasVoted) {
    return (
      <div className="flex flex-col items-center justify-center text-center p-4">
        <CheckCircle className="h-12 w-12 text-green-500 mb-4" />
        <h3 className="text-lg font-semibold">Vote Cast</h3>
        <p className="text-sm text-gray-600">{feedback}</p>
      </div>
    );
  }
  if (status === 'voted') {
    return (
      <div className="flex flex-col items-center justify-center text-center p-4">
        <CheckCircle className="h-12 w-12 text-green-500 mb-4" />
        <h3 className="text-lg font-semibold">Vote Cast Successfully</h3>
        <p className="text-sm text-gray-600">{feedback}</p>
      </div>
    );
  }
 return (
    <div className="space-y-4 ">
      <h3 className="text-lg font-bold text-left">Cast Your Vote</h3>
      {userRole === 'COMMITTEE_LEADER' && (
        <div className="space-y-2">
          <label htmlFor="voteComment" className="text-sm font-medium">
            Comment
          </label>
          <Textarea
            id="voteComment"
            placeholder="Provide your insights on the appeal"
            value={voteComment}
            onChange={(e) => setVoteComment(e.target.value)}
            className="min-h-[100px]"
          />
        </div>
      )}
      <div className='flex justify-between items-center space-x-2'>
        <Button 
          variant='ghost'
          className='flex-1 justify-center bg-slate-100 text-slate-700 hover:bg-slate-200 ring-1 ring-inset ring-slate-300 space-x-2 rounded-lg'
          disabled={status === 'voting'}
          onClick={() => handleVote('ABSTAIN')}
        >
          <Clock className='h-4 w-4' />
          <span>Abstain</span>
        </Button>
        
        <Button 
          variant='ghost' 
          className='flex-1 justify-center bg-red-100 text-red-600 hover:bg-red-200 space-x-2 rounded-lg'
          disabled={status === 'voting'}
          onClick={() => handleVote('NOTJUSTIFIED')}
        >
          <ThumbsDown className='h-4 w-4' />
          <span> Not justified</span>
        </Button>

        <Button 
          className='flex-1 justify-center bg-green-500 hover:bg-green-600 text-white space-x-2 rounded-lg'
          disabled={status === 'voting'}
          onClick={() => handleVote('JUSTIFIED')}
        >
          <BadgeCheck className='h-4 w-4' />
          <span>Justified</span>
        </Button>
      </div>
      {status === 'error' && <p className="mt-2 text-sm text-red-600">{feedback}</p>}
      {status === 'voting' && <p className="mt-2 text-sm text-gray-600 animate-pulse">Submitting vote...</p>}
    </div>
  );
}
</file>

<file path="src/components/attendance-list.tsx">
"use client";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Users } from "lucide-react";
import { useEffect, useState } from "react"; // Import hooks for state and effects
import api from "@/lib/api"; // Import your configured API instance

// 1. Define an interface for the attendance data structure
interface AttendanceData {
  totalMembers: number;
  availableMembers: number;
}

export function AttendanceList() {
  // 2. Set up state for data, loading, and errors
  const [attendanceData, setAttendanceData] = useState<AttendanceData | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    // 3. Fetch data when the component mounts
    const fetchAttendanceData = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await api.get('/api/v1/my-cases/analytics');
        const analyticsData = response.data?.data;

        if (analyticsData && analyticsData.attendanceList) {
          setAttendanceData(analyticsData.attendanceList);
        } else {
          throw new Error("Attendance data is missing in the API response.");
        }
      } catch (err) {
        console.error("Failed to fetch attendance data:", err);
        setError("Could not load attendance data.");
      } finally {
        setLoading(false);
      }
    };

    fetchAttendanceData();
  }, []); // Empty dependency array ensures this runs only once on mount

  // 4. Helper function to render content based on the current state
  const renderContent = () => {
    if (loading) {
      return <p className="text-sm font-medium">Loading attendance...</p>;
    }

    if (error) {
      return <p className="text-sm font-medium text-red-500">{error}</p>;
    }

    if (attendanceData) {
      return (
        <p className="text-sm font-medium">
          {attendanceData.availableMembers} / {attendanceData.totalMembers} members will be available
        </p>
      );
    }

    return <p className="text-sm font-medium">No attendance data found.</p>;
  };

  return (
    <Card>
      <CardHeader>
        <CardTitle className="text-lg font-semibold">Attendance List</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="flex items-center justify-center h-32">
          <div className="text-center text-gray-500">
            <Users className="h-12 w-12 mx-auto mb-2 text-gray-400" />
            {renderContent()}
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/components/authguard.tsx">
"use client";
import { useEffect, useState } from "react";
import { useRouter } from "next/navigation";

interface Props {
  children: React.ReactNode;
}

export default function AuthGuard({ children }: Props) {
  const router = useRouter();
  const [isAuthenticated, setIsAuthenticated] = useState<boolean | null>(null);

  useEffect(() => {
    const token = localStorage.getItem("staff_token"); 
    if (token) {
      setIsAuthenticated(true);
    } else {
      setIsAuthenticated(false);
      router.replace("/staff-login");
    }
  }, [router]);

  if (isAuthenticated === null) {
  return <div className="h-screen flex items-center justify-center">Loading...</div>;
}

if (!isAuthenticated) {
  // still redirecting
  return null;
}

return <>{children}</>;
}
</file>

<file path="src/components/case-analytics-chart.tsx">
"use client";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { useEffect, useState } from "react";
import api from "@/lib/api";

// Interface for the data structure from the API
interface CaseAnalyticsItem {
  month: string;
  justifiedCases: number;
  unJustifiedCases: number;
}

// Interface for the chart's internal data format
interface ChartDataItem {
  month: string;
  unjustified: number; // Renamed for clarity
  justified: number;   // Renamed for clarity
}

export function CaseAnalyticsChart() {
  const [chartData, setChartData] = useState<ChartDataItem[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchChartData = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await api.get('/api/v1/my-cases/analytics');
        const analyticsData = response.data?.data;

        if (analyticsData && analyticsData.caseAnalytics) {
          const formattedData: ChartDataItem[] = analyticsData.caseAnalytics.map((item: CaseAnalyticsItem) => ({
            month: item.month,
            justified: item.justifiedCases,
            unjustified: item.unJustifiedCases,
          }));
          setChartData(formattedData);
        } else {
          // Keep the component from breaking if the data is missing
          setChartData([]);
        }
      } catch (err) {
        console.error("Failed to fetch chart data:", err);
        setError("Could not load case analytics.");
      } finally {
        setLoading(false);
      }
    };

    fetchChartData();
  }, []);

  // Dynamically calculate the maximum value for the chart's Y-axis
  const maxValue = chartData.reduce((max, item) => {
    const currentMax = Math.max(item.justified, item.unjustified);
    return currentMax > max ? currentMax : max;
  }, 0) * 1.25; // Add a 25% buffer for spacing

  const renderContent = () => {
    if (loading) {
      return <div className="flex items-center justify-center h-64 text-gray-500">Loading Chart Data...</div>;
    }

    if (error) {
      return <div className="flex items-center justify-center h-64 text-red-500">{error}</div>;
    }
    
    if (chartData.length === 0) {
        return <div className="flex items-center justify-center h-64 text-gray-500">No analytics data available.</div>;
    }

    return (
      <div className="relative h-64">
        {/* Background Grid Lines */}
        <div className="absolute inset-0 grid grid-rows-4 w-full h-full">
          <div className="border-b border-dashed border-gray-200"></div>
          <div className="border-b border-dashed border-gray-200"></div>
          <div className="border-b border-dashed border-gray-200"></div>
          <div className="border-b border-dashed border-gray-200"></div>
        </div>

        {/* Chart Bars */}
        <div className="relative flex items-end justify-around h-full px-4">
          {chartData.map((data, index) => (
            <div key={index} className="flex flex-col items-center flex-1 gap-2 h-full justify-end">
              <div className="flex items-end gap-2 h-full">
                {/* Unjustified bar */}
                <div
                  className="bg-[#9381ff] rounded-t-lg w-5 transition-all hover:opacity-80"
                  style={{ height: `${(data.unjustified / maxValue) * 100}%` }}
                  title={`Unjustified: ${data.unjustified}`}
                ></div>
                {/* Justified bar */}
                <div
                  className="bg-[#84b082] rounded-t-lg w-5 transition-all hover:opacity-80"
                  style={{ height: `${(data.justified / maxValue) * 100}%` }}
                  title={`Justified: ${data.justified}`}
                ></div>
              </div>
              {/* Label */}
              <span className="text-xs font-medium text-gray-700">{data.month}</span>
            </div>
          ))}
        </div>
      </div>
    );
  };

  return (
    <Card className="border-none shadow-sm">
      <CardHeader>
        <div className="flex items-center justify-between">
          <CardTitle className="text-lg font-semibold text-[#0a4f78]">Case Analytics</CardTitle>
          <div className="flex items-center gap-4 text-sm">
            <div className="flex items-center gap-2">
              <div className="w-3 h-3 rounded-full bg-[#9381ff]"></div>
              <span className="text-gray-600">Unjustified</span>
            </div>
            <div className="flex items-center gap-2">
              <div className="w-3 h-3 rounded-full bg-[#84b082]"></div>
              <span className="text-gray-600">Justified</span>
            </div>
          </div>
        </div>
      </CardHeader>
      <CardContent className="px-2">
        {renderContent()}
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/components/casedetails.tsx">
"use client";

import { useEffect, useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { ExplanatoryNote } from "./explanatorynote";
import api from "@/lib/api";
import Link from "next/link";
import { useRouter } from 'next/navigation';
import { File as FileIcon } from "lucide-react";


interface TaxAuditedDTO {
  taxAuditedId: string;
  taxTypeAudited: string;
  principalAmountToBePaid: number;
  understatementFines: number;
  fixedAdministrativeFines: number;
  dischargedAmount: number;
  totalTaxAndFinesToBePaid: number;
  appeals: any[];
}

interface CaseDetailsData {
  caseId: string;
  auditorsName: string;
  appealDate: string;
  tin: string;
  taxAudited: TaxAuditedDTO[];
  attachmentLink: string;
}

export function CaseDetailsPage({ caseId }: { caseId: string }) {
  const [caseDetails, setCaseDetails] = useState<CaseDetailsData | null>(null);
  const [loading, setLoading] = useState<boolean>(true);
  const [error, setError] = useState<string | null>(null);
  const router = useRouter();

  useEffect(() => {
    if (caseId) {
      const fetchCaseDetails = async () => {
        setLoading(true);
        setError(null);
        try {
          const response = await api.get(`/api/v1/auth/explanatory_note/${caseId}`);
          if (response.data && response.data.data) {
            setCaseDetails(response.data.data);
          } else {
            throw new Error("Case data not found in API response.");
          }
        } catch (err) {
          console.error("Failed to fetch case details:", err);
          setError("Failed to load case details. Please try again.");
        } finally {
          setLoading(false);
        }
      };

      fetchCaseDetails();
    }
  }, [caseId]);

  if (loading) {
    return <div className="text-center p-8">Loading case details...</div>;
  }

  if (error || !caseDetails) {
    return <div className="text-center text-red-500 p-8">{error || "Case not found."}</div>;
  }
  
  const totalTaxToBePaid = caseDetails.taxAudited.reduce(
    (sum, item) => sum + item.totalTaxAndFinesToBePaid, 0
  );

  return (
    <>
      {/* --- 2. RESTORE THE FULL UI FOR THE CASE DETAILS PAGE --- */}
      <Card className="w-full max-w-4xl mx-auto my-8 p-6 shadow-lg">
        <CardContent className="p-0">
          {/* Case Information Section */}
          <div className="grid md:grid-cols-2 gap-8 mb-8">
            <div>
              <h2 className="text-xl font-bold mb-4">Case Information</h2>
              <hr className="border-1" />
              <div className="mt-3 grid grid-cols-2 gap-y-2 text-sm">
                <p className="text-gray-600">Case ID</p>
                <p className="font-medium">{caseDetails.caseId}</p>

                <p className="text-gray-600">Appeal Date</p>
                <p className="font-medium">{new Date(caseDetails.appealDate).toLocaleDateString()}</p>

                <p className="text-gray-600">Tax to be paid</p>
                <p className="font-bold text-red-500">{totalTaxToBePaid.toLocaleString()} RWF</p>
              </div>
            </div>

            {/* Taxpayer Details Section */}
            <div>
              <h2 className="text-xl font-bold mb-4">Taxpayer Details</h2>
              <hr className="border-1" />
              <div className="mt-3 grid grid-cols-2 gap-y-2 text-sm">
                <p className="text-gray-600">Taxpayer TIN</p>
                <p className="font-medium">{caseDetails.tin}</p>
                
                <p className="text-gray-600">Auditor</p>
                <p className="font-medium">{caseDetails.auditorsName}</p>
              </div>
            </div>
          </div>

          {/* Audited Tax Types Section (with corrected links) */}
          <div className="mb-8">
            <h2 className="text-xl font-bold mb-4">Audited Tax Types</h2>
            <hr className="border-1" />
            <div className="grid md:grid-cols-4 gap-4 p-2 mt-3">
              {caseDetails.taxAudited.map((taxItem) => (
                <Link
                  key={taxItem.taxAuditedId}
                  href={`/meetings/case-details/tax-type-details?caseId=${caseDetails.caseId}&taxAuditedId=${taxItem.taxAuditedId}`}
                  className="bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition duration-150 ease-in-out cursor-pointer flex justify-center items-center py-4 text-center"
                >
                  <span className="text-lg font-semibold text-[#18668D] underline">
                    {taxItem.taxTypeAudited}
                  </span>
                </Link>
              ))}
            </div>
          </div>

          {/* Attachment Section */}
          <div>
            <h2 className="text-xl font-bold mb-4">Attachments</h2>
            <hr className="border-gray-200" />
            <div className="mt-4">
              {caseDetails.attachmentLink ? (
                <a
                  href={caseDetails.attachmentLink}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="inline-flex items-center gap-2 bg-gray-100 border border-gray-300 rounded-full px-4 py-2 text-sm font-medium text-gray-800 hover:bg-gray-200 transition-colors"
                >
                  <FileIcon className="h-4 w-4 text-gray-600" />
                  <span>Attachment Preview</span>
                </a>
              ) : (
                <p className="text-sm text-gray-500 italic">
                  No attachment was provided for this case.
                </p>
              )}
            </div>
          </div>
        </CardContent>
      </Card>
      
      {/* Back Button */}
      <Button 
        onClick={() => router.back()}
        className="bg-[#18668D] hover:bg-[#134d66]"
      >
        Back
      </Button>
    </>
  );
}
</file>

<file path="src/components/cases.tsx">
"use client";

import { useState, useEffect } from "react";
import Link from 'next/link';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import {
  Pagination,
  PaginationContent,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
} from "@/components/ui/pagination";
import api from "@/lib/api";

// Interface for a single case from the API
interface AgendaCase {
  caseId: string;
  taxpayerName: string;
  casePresenter: string;
  tin: string;
  caseStatus: "PENDING" | "RESOLVED" | "SUBMITTED";
  daysLeft: number;
  appealDate: string;
  amountDischarged: number;
  taxToBePaid: number;
  auditor: string;
}

// Interface for the paginated response from the API
interface Page<T> {
  content: T[];
  totalPages: number;
  totalElements: number;
  number: number; // current page number (0-indexed)
}

export default function AgendaCasesPage() {
  const [pageData, setPageData] = useState<Page<AgendaCase> | null>(null);
  const [currentPage, setCurrentPage] = useState(0);
  const [loading, setLoading] = useState<boolean>(true);
  const [error, setError] = useState<string | null>(null);
  
  const [searchQuery, setSearchQuery] = useState("");
  const [showFilters, setShowFilters] = useState(false); // State for filter visibility
  const [statusFilter, setStatusFilter] = useState("All");
  const PAGE_SIZE = 5;

  useEffect(() => {
    const fetchAgenda = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await api.get<Page<AgendaCase>>("/api/v1/agenda/", {
          params: { page: currentPage, size: PAGE_SIZE },
        });
        setPageData(response.data);
      } catch (err: any) {
        const message = err.response?.data?.message || err.message || "Failed to fetch agenda.";
        setError(`Error: ${message}`);
        console.error("Failed to fetch agenda:", err);
      } finally {
        setLoading(false);
      }
    };

    fetchAgenda();
  }, [currentPage]);

  const filteredCases = pageData?.content.filter((_case) => {
    const matchesSearch =
      _case.caseId.toLowerCase().includes(searchQuery.toLowerCase()) ||
      (_case.taxpayerName?.toLowerCase() || '').includes(searchQuery.toLowerCase()) ||
      _case.tin.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesStatus = statusFilter === "All" || _case.caseStatus === statusFilter;
    return matchesSearch && matchesStatus;
  }) || [];

  const handlePageChange = (newPage: number) => {
    if (pageData && newPage >= 0 && newPage < pageData.totalPages) {
      setCurrentPage(newPage);
    }
  };
  
  // Restore the handleFilterByStatus function
  const handleFilterByStatus = (status: string) => {
    setStatusFilter(status);
  };

  // Restore the getStatusStyle function
  const getStatusStyle = (status: string) => {
    switch (status) {
      case "PENDING": return "bg-yellow-100 text-yellow-800";
      case "RESOLVED": return "bg-green-100 text-green-800";
      case "SUBMITTED": return "bg-blue-100 text-blue-800";
      default: return "bg-gray-100 text-gray-800";
    }
  };

  return (
    <div className="container mx-auto p-4 max-w-4xl">
      <div className="space-y-2 mb-8">
        <h1 className="text-3xl font-bold">Agenda</h1>
        <p className="text-gray-600">View all cases to be discussed this week</p>
      </div>

      {/* --- THIS IS YOUR ORIGINAL FILTER UI --- */}
      <div className="flex items-center space-x-2 mb-4">
        <Input
          placeholder="Search by Case ID, Name, or TIN..."
          className="max-w-xs flex-grow bg-white"
          value={searchQuery}
          onChange={(e) => setSearchQuery(e.target.value)}
        />
        <Button
          variant="outline"
          size="icon"
          className="h-10 w-10"
          onClick={() => setShowFilters(!showFilters)}
        >
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
            <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
        </Button>
      </div>
      
      {showFilters && (
        <div className="rounded-lg border p-4 mb-4 bg-white">
          <h3 className="font-semibold mb-2">Filter by Status</h3>
          <div className="flex space-x-2">
            <Button variant="secondary" className="hover:bg-[#18668D] hover:text-white" onClick={() => handleFilterByStatus("All")}>All</Button>
            <Button variant="secondary" className="hover:bg-[#18668D] hover:text-white" onClick={() => handleFilterByStatus("PENDING")}>Pending</Button>
            <Button variant="secondary" className="hover:bg-[#18668D] hover:text-white" onClick={() => handleFilterByStatus("RESOLVED")}>Resolved</Button>
            <Button variant="secondary" className="hover:bg-[#18668D] hover:text-white" onClick={() => handleFilterByStatus("SUBMITTED")}>Submitted</Button>
          </div>
        </div>
      )}
      {/* --- END OF FILTER UI --- */}

      <div className="rounded-lg border overflow-x-auto bg-white">
        <Table className="w-full">
          <TableHeader>
            <TableRow className="bg-white hover:bg-gray-50">
              <TableHead>No</TableHead>
              <TableHead>Tax Payer</TableHead>
              <TableHead>Days Left</TableHead>
              <TableHead>Tax Assessed (RWF)</TableHead>
              <TableHead>Amount Discharged</TableHead>
              <TableHead>Tax To Be Paid (RWF)</TableHead>
              <TableHead>Case Presenter</TableHead>
              <TableHead>Auditor</TableHead>
              <TableHead>Case</TableHead>
              <TableHead>Status</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {loading ? (
              <TableRow><TableCell colSpan={10} className="h-24 text-center">Loading agenda cases...</TableCell></TableRow>
            ) : error ? (
              <TableRow><TableCell colSpan={10} className="h-24 text-center text-red-600">{error}</TableCell></TableRow>
            ) : filteredCases.length > 0 ? (
              filteredCases.map((_case, index) => {
                const taxOriginal = (_case.taxToBePaid || 0) + (_case.amountDischarged || 0);
                return (
                <TableRow key={_case.caseId}>
                  <TableCell className="font-medium">{(currentPage * PAGE_SIZE) + index + 1}</TableCell>
                  <TableCell>{_case.taxpayerName || 'N/A'}</TableCell>
                  <TableCell>{_case.daysLeft} days</TableCell>
                  <TableCell>{taxOriginal.toLocaleString()}</TableCell>
                  <TableCell>{_case.amountDischarged.toLocaleString()}</TableCell>
                  <TableCell>{_case.taxToBePaid.toLocaleString()}</TableCell>
                  <TableCell>{_case.casePresenter}</TableCell>
                  <TableCell>{_case.auditor}</TableCell>
                  <TableCell className="text-blue-500 cursor-pointer hover:underline">
                    <Link href={`/meetings/case-details?caseId=${_case.caseId}`}>
                      view case
                    </Link>
                  </TableCell>
                  <TableCell>
                    <span className={`px-3 py-1.5 rounded-full text-xs font-semibold ${getStatusStyle(_case.caseStatus)}`}>
                      {_case.caseStatus}
                    </span>
                  </TableCell>
                </TableRow>
              )})
            ) : (
              <TableRow><TableCell colSpan={10} className="h-24 text-center">No cases found.</TableCell></TableRow>
            )}
          </TableBody>
        </Table>
      </div>
      
      <div className="flex justify-between items-center mt-4 text-sm text-gray-500">
        <span>
            Showing {filteredCases.length} of {pageData?.totalElements || 0} cases
        </span>
        {pageData && pageData.totalPages > 1 && (
            <Pagination>
              <PaginationContent>
                <PaginationItem>
                  <PaginationPrevious 
                    href="#" 
                    onClick={(e) => { e.preventDefault(); handlePageChange(currentPage - 1); }}
                    aria-disabled={currentPage === 0}
                    className={currentPage === 0 ? 'pointer-events-none opacity-50' : ''}
                  />
                </PaginationItem>
                {[...Array(pageData.totalPages).keys()].map(pageNumber => (
                  <PaginationItem key={pageNumber}>
                    <PaginationLink 
                      href="#"
                      onClick={(e) => { e.preventDefault(); handlePageChange(pageNumber); }}
                      isActive={currentPage === pageNumber}
                    >
                      {pageNumber + 1}
                    </PaginationLink>
                  </PaginationItem>
                ))}
                <PaginationItem>
                  <PaginationNext 
                    href="#" 
                    onClick={(e) => { e.preventDefault(); handlePageChange(currentPage + 1); }}
                    aria-disabled={currentPage >= pageData.totalPages - 1}
                    className={currentPage >= pageData.totalPages - 1 ? 'pointer-events-none opacity-50' : ''}
                  />
                </PaginationItem>
              </PaginationContent>
            </Pagination>
        )}
      </div>
    </div>
  );
}
</file>

<file path="src/components/casesubmitted.tsx">
// app/components/SubmissionSuccessModal.tsx
"use client";

import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";
import { Button } from "@/components/ui/button";

interface SubmissionSuccessModalProps {
  caseId: string;
  isOpen: boolean;
  onBack: () => void;
}

export function CaseSubmissionSuccess({
  caseId,
  isOpen,
  onBack,
}: SubmissionSuccessModalProps) {
  return (
    <Dialog open={isOpen} onOpenChange={() => {}}>
      <DialogContent className="sm:max-w-[425px]">
        <div className="h-2 w-full flex">
          <div className="h-full w-1/3 bg-[#18668D]"></div>
          <div className="h-full w-1/3 bg-[#FDBB2A]"></div>
          <div className="h-full w-1/3 bg-[#4BAF4F]"></div>
        </div>
        <DialogHeader>
          <DialogTitle className="text-xl font-bold">Tax Case Form</DialogTitle>
          <DialogDescription className="text-lg text-gray-700 mt-2">
            Your explanatory note for case **{caseId}** has been successfully submitted! You&apos;ve been notified for any updates.
          </DialogDescription>
        </DialogHeader>
        <div className="flex justify-center">
          <Button onClick={onBack} className="bg-[#18668D]">
            Back
          </Button>
        </div>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/components/explanatorynote.tsx">
// components/ExplanatoryNote.tsx
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";

export function ExplanatoryNote() {
  return (
    <Card className="max-w-3xl mx-auto my-8 p-6 shadow-lg">
      
      <CardContent>
        <div className="space-y-6">
          <p className="font-semibold">Writing tax case summary - How to Write a Case Note</p>
          <p className="text-sm">
            Once you have read a case and feel you have a grasp of some of its
            major issues, you will need to organise them as a case note.
          </p>

          <ol className="list-decimal list-inside space-y-4">
            <li>
              <p className="font-semibold">Case Notes for Assessment</p>
              <p className="text-sm mt-1">
                If you are being assessed on your ability to make a thorough case note 
                beyond the basic summary you can create of your own study notes  you
                are really being asked for your critical analysis of the case. That is,
                whether the case, in your opinion and by reference to your own logical
                and legal analysis, was correctly decided. What follows is merely one
                approach to addressing this kind of an assessment; there are many
                approaches to writing case notes, each suited to different and individual
                styles. Below is a list of other guides and examples to which you may
                refer.
              </p>
            </li>
            <li>
              <p className="font-semibold">Begin by introducing the case</p>
              <p className="text-sm mt-1">
                State its name, which court it in which it was decided and its legal
                significance  what did it change? Perhaps offer some context, such as
                prior law it affected. Outline whether you think the case was a good
                case, why decided or not  and give your reasons. In general, a good
                introduction is succinct, compelling and provides a &quot;bird&apos;s eye view&quot; of
                your whole argument.
              </p>
            </li>
            <li>
              <p className="font-semibold">Outline the key facts</p>
              <p className="text-sm mt-1">
                Dont forget to include any contradictory facts or evidence that arose in
                the judgement. The purpose of this section is to provide a broad-sweeping
                background to your analysis, so stick to relevant facts and keep it stay
                brief. Case notes are often quite short, and it is in your analysis that you
                will score well, as this demonstrates your ability to argue in a legal
                context.
              </p>
            </li>
          </ol>
        </div>
      </CardContent>
    </Card>
  );
}
</file>

<file path="src/components/InvitationTemplateModal.tsx">
"use client";

import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import { useState } from "react";
import api from "@/lib/api";

import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
} from "@/components/ui/dialog";
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";

// Zod schema for form validation (keeps user-friendly HH:mm format)
const formSchema = z.object({
  venue: z.string().min(3, {
    message: "Venue must be at least 3 characters long.",
  }),
  meetingTime: z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/, {
    message: "Please enter a valid time in HH:mm format (e.g., 14:30).",
  }),
});

type FormValues = z.infer<typeof formSchema>;

interface InvitationTemplateModalProps {
  isOpen: boolean;
  onClose: () => void;
}

export function InvitationTemplateModal({ isOpen, onClose }: InvitationTemplateModalProps) {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const form = useForm<FormValues>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      venue: "",
      meetingTime: "",
    },
  });

  // Function to handle form submission
  async function onSubmit(values: FormValues) {
    setLoading(true);
    setError(null);

    // --- THIS IS THE MODIFIED PART ---
    // Construct the payload to match the backend's "HH:mm:ss" format
    const payload = {
      venue: values.venue,
      meetingTime: `${values.meetingTime}:00`, // Append seconds to the time string
    };
    // --- END OF MODIFICATION ---

    try {
      await api.put('/api/v1/meeting-info/3', payload); 
      
      alert("Invitation details updated successfully!");
      onClose(); // Close the modal on success
    } catch (err) {
      console.error("Failed to update invitation details:", err);
      setError("Failed to update details. Please try again.");
    } finally {
      setLoading(false);
    }
  }

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="sm:max-w-[425px]">
        <DialogHeader>
          <DialogTitle>Invitation Date-Venue</DialogTitle>
          <DialogDescription>
            Update the default venue and time for meeting invitations.
          </DialogDescription>
        </DialogHeader>
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
            <div className="p-4 border rounded-lg bg-white">
                <h3 className="font-semibold mb-4">Email information</h3>
                <div className="space-y-4">
                    <FormField
                    control={form.control}
                    name="venue"
                    render={({ field }) => (
                        <FormItem>
                        <FormLabel>Venue</FormLabel>
                        <FormControl>
                            <Input placeholder="e.g., RRA Headquarters, Room 501" {...field} />
                        </FormControl>
                        <FormMessage />
                        </FormItem>
                    )}
                    />
                    <FormField
                    control={form.control}
                    name="meetingTime"
                    render={({ field }) => (
                        <FormItem>
                        <FormLabel>Meeting Hour</FormLabel>
                        <FormControl>
                            <Input placeholder="HH:mm (e.g., 14:30)" {...field} />
                        </FormControl>
                        <FormMessage />
                        </FormItem>
                    )}
                    />
                </div>
            </div>

             {error && <p className="text-sm text-red-600">{error}</p>}

            <DialogFooter>
              <Button 
                type="submit" 
                className="bg-[#18668D] hover:bg-[#134d66]"
                disabled={loading}
              >
                {loading ? "Updating..." : "Update"}
              </Button>
            </DialogFooter>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/components/meetingminutes.tsx">
"use client";

import { useState } from "react";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";
import { Download } from "lucide-react";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import {
  Pagination,
  PaginationContent,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
} from "@/components/ui/pagination";
import { meetingminutes } from "@/app/types/minutes-mock-data";
import Link from "next/link";

export default function MeetingMinutesPage() {
  const [searchQuery, setSearchQuery] = useState("");
  const [showFilters, setShowFilters] = useState(false);
  const [filterPreparedBy, setFilterPreparedBy] = useState("");
  const [filterDate, setFilterDate] = useState("");

  // Filtering logic
  const filteredCases = meetingminutes.filter((m) =>
    (filterPreparedBy === "" ||
      m.preparedBy.toLowerCase().includes(filterPreparedBy.toLowerCase())) &&
    (filterDate === "" || m.date === filterDate)
  );

  return (
    <div className="container mx-auto p-4 max-w-4xl">
      <div className="space-y-2 mb-8">
        <h1 className="text-3xl font-bold">This week Cases</h1>
        <p className="text-gray-600">
          View all minutes of cases discussed this week
        </p>
      </div>

      <div className="flex items-center space-x-2 mb-4">
        <Input
          placeholder="Search minutes ..."
          className="max-w-xs flex-grow bg-white"
          value={searchQuery}
          onChange={(e) => setSearchQuery(e.target.value)}
        />
        <Button
          variant="outline"
          size="icon"
          className="h-10 w-10"
          onClick={() => setShowFilters(!showFilters)}
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            strokeWidth={1.5}
            stroke="currentColor"
            className="w-5 h-5"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
            />
          </svg>
        </Button>
      </div>

      {/* Filter Section */}
      {showFilters && (
        <div className="rounded-lg border p-4 mb-4 bg-white">
          <h3 className="font-semibold mb-2">Filter Options</h3>
          <div className="flex flex-col md:flex-row md:items-center md:space-x-4 space-y-2 md:space-y-0">
            {/* Filter by Prepared By */}
            <div className="flex flex-col space-y-1">
              <label className="text-sm font-medium text-gray-600">
                Prepared By
              </label>
              <Input
                type="text"
                placeholder="Enter name..."
                className="bg-white border-gray-300"
                value={filterPreparedBy}
                onChange={(e) => setFilterPreparedBy(e.target.value)}
              />
            </div>

            {/* Filter by Date */}
            <div className="flex flex-col space-y-1">
              <label className="text-sm font-medium text-gray-600">Date</label>
              <Input
                type="date"
                className="bg-white border-gray-300"
                value={filterDate}
                onChange={(e) => setFilterDate(e.target.value)}
              />
            </div>
          </div>
        </div>
      )}

      {/* Table Section */}
      <div className="rounded-lg border overflow-x-auto bg-white">
        <Table className="w-full">
          <TableHeader>
            <TableRow className="bg-white hover:bg-gray-50">
              <TableHead className="w-[50px] text-gray-500 font-normal whitespace-normal">
                No
              </TableHead>
              <TableHead className="text-gray-500 font-normal whitespace-normal">
                Prepared By
              </TableHead>
              <TableHead className="text-gray-500 font-normal whitespace-normal">
                Date
              </TableHead>
              <TableHead className="text-gray-500 font-normal whitespace-normal">
                Type
              </TableHead>
              <TableHead className="text-gray-500 font-normal whitespace-normal">
                Doc
              </TableHead>
              <TableHead className="text-gray-500 font-normal whitespace-normal">
                Action
              </TableHead>
            </TableRow>
          </TableHeader>

          <TableBody>
            {filteredCases.length > 0 ? (
              filteredCases.map((_minute, index) => (
                <TableRow key={index}>
                  <TableCell className="font-medium whitespace-normal">
                    {index + 1}
                  </TableCell>
                  <TableCell className="whitespace-normal">
                    {_minute.preparedBy}
                  </TableCell>
                  <TableCell>{_minute.date}</TableCell>
                  <TableCell className="whitespace-normal">
                    {_minute.type}
                  </TableCell>
                  <TableCell className="text-blue-500 cursor-pointer">
                    <a href="/reports/minute-details">view minute</a>
                  </TableCell>
                  <TableCell className="whitespace-normal">
                    <Button
                      asChild
                      variant="outline"
                      size="sm"
                      className="flex items-center gap-2"
                    >
                      <Link href="/file.pdf" download>
                        <Download className="h-4 w-4" />
                      </Link>
                    </Button>
                  </TableCell>
                </TableRow>
              ))
            ) : (
              <TableRow>
                <TableCell colSpan={10} className="h-24 text-center">
                  No matching minutes found.
                </TableCell>
              </TableRow>
            )}
          </TableBody>
        </Table>
      </div>

      {/* Generate Button */}
      <Button className="my-4 bg-[#18668D] hover:bg-[#053852] hover:underline">
        <a href="/reports/new-minutes">Generate Meeting minutes</a>
      </Button>

      {/* Pagination */}
      <div className="flex justify-between items-center mt-4 text-sm text-gray-500">
        <span>showing 3 of 5 pages</span>
        <Pagination className="w-auto mx-0">
          <PaginationContent>
            <PaginationItem>
              <PaginationPrevious href="#" />
            </PaginationItem>
            <PaginationItem>
              <PaginationLink href="#" isActive>
                1
              </PaginationLink>
            </PaginationItem>
            <PaginationItem>
              <PaginationLink href="#">2</PaginationLink>
            </PaginationItem>
            <PaginationItem>
              <PaginationLink href="#">3</PaginationLink>
            </PaginationItem>
            <PaginationItem>
              <PaginationNext href="#" />
            </PaginationItem>
          </PaginationContent>
        </Pagination>
      </div>
    </div>
  );
}
</file>

<file path="src/components/minutesform.tsx">
"use client";

import { zodResolver } from "@hookform/resolvers/zod";
import { useFieldArray, useForm } from "react-hook-form";
import * as z from "zod";
import { useState } from "react";

import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Textarea } from "@/components/ui/textarea";

// Schema for a single agenda item
const agendaItemSchema = z.object({
  tin: z.string().min(1, { message: "TIN is required." }),
  taxPayer: z.string().min(1, { message: "Taxpayer is required." }),
  taxAudited: z.string().min(1, { message: "Tax audited is required." }),
  subject: z.string().min(1, { message: "Subject is required." }),
  decision: z.string().min(1, { message: "Decision is required." }),
});

// Main form schema
const formSchema = z.object({
  leader: z.string().min(1, { message: "Leader of meeting is required." }),
  date: z.string().min(1, { message: "Date is required." }),
  time: z.string().min(1, { message: "Time is required." }),
  agendaItems: z.array(agendaItemSchema).min(1, { message: "You must add at least one agenda item." }),
});

export function MinutesForm() {
  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      leader: "",
      date: "",
      time: "",
      agendaItems: [
        {
          tin: "",
          taxPayer: "",
          taxAudited: "",
          subject: "",
          decision: "",
        },
      ],
    },
  });

  const { fields: agendaFields, append: appendAgenda, remove: removeAgenda } = useFieldArray({
    control: form.control,
    name: "agendaItems",
  });

  const [step, setStep] = useState(1);

  function onSubmit(values: z.infer<typeof formSchema>) {
    console.log(values);
    alert("Form submitted! Check console for values.");
  }

  return (
    <div className="container p-4 max-w-2xl ">
      <Form {...form}>
        <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-8">
          {step === 1 && (
            <>
              {/* Basic Info */}
              <div className="rounded-lg border p-6 space-y-4 bg-white">
                <h2 className="text-xl font-semibold">Basic Info</h2>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <FormField control={form.control} name="leader" render={({ field }) => (
                    <FormItem>
                      <FormLabel>Leader of meeting</FormLabel>
                      <FormControl>
                        <Input placeholder="names..." {...field} />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )} />
                  <FormField control={form.control} name="date" render={({ field }) => (
                    <FormItem>
                      <FormLabel>Date</FormLabel>
                      <FormControl><Input placeholder="MM/DD/YYYY" {...field} /></FormControl>
                      <FormMessage />
                    </FormItem>
                  )} />
                  <FormField control={form.control} name="time" render={({ field }) => (
                    <FormItem>
                      <FormLabel>Time</FormLabel>
                      <FormControl><Input placeholder="hh:mm:ss" {...field} /></FormControl>
                      <FormMessage />
                    </FormItem>
                  )} />
                </div>
              </div>

              <div className="flex justify-end">
                <Button type="button" onClick={() => setStep(2)} className="bg-[#18668D]">
                  Next
                </Button>
              </div>
            </>
          )}

          {step === 2 && (
            <>
              {/* Agenda Items */}
              <div className="rounded-lg border p-6 space-y-4 bg-white">
                <h2 className="text-xl font-semibold">Agenda Items</h2>
                {agendaFields.map((field, index) => (
                  <div key={field.id} className="grid grid-cols-1 md:grid-cols-1 gap-4 border-b pb-4">
                    <FormField control={form.control} name={`agendaItems.${index}.tin`} render={({ field }) => (
                      <FormItem>
                        <FormLabel>TIN</FormLabel>
                        <FormControl><Input placeholder="TIN number here" {...field} /></FormControl>
                        <FormMessage />
                      </FormItem>
                    )} />

                    <FormField control={form.control} name={`agendaItems.${index}.taxPayer`} render={({ field }) => (
                      <FormItem>
                        <FormLabel>Taxpayer</FormLabel>
                        <FormControl><Input placeholder="Taxpayer name" {...field} /></FormControl>
                        <FormMessage />
                      </FormItem>
                    )} />

                    <FormField control={form.control} name={`agendaItems.${index}.taxAudited`} render={({ field }) => (
                      <FormItem>
                        <FormLabel>Tax Audited</FormLabel>
                        <FormControl><Input placeholder="Amount here" {...field} /></FormControl>
                        <FormMessage />
                      </FormItem>
                    )} />

                    <FormField control={form.control} name={`agendaItems.${index}.subject`} render={({ field }) => (
                      <FormItem>
                        <FormLabel>Subject requested for consensus</FormLabel>
                        <FormControl><Textarea placeholder="Subject description goes here ..." {...field} /></FormControl>
                        <FormMessage />
                      </FormItem>
                    )} />

                    <FormField control={form.control} name={`agendaItems.${index}.decision`} render={({ field }) => (
                      <FormItem>
                        <FormLabel>Decision taken</FormLabel>
                        <FormControl><Textarea placeholder="Decision goes here" {...field} /></FormControl>
                        <FormMessage />
                      </FormItem>
                    )} />

                    {agendaFields.length > 1 && (
                      <Button
                        className="bg-[#cb2d2d] text-white"
                        type="button"
                        variant="ghost"
                        onClick={() => removeAgenda(index)}
                      >
                        Remove
                      </Button>
                    )}
                  </div>
                ))}
                <Button
                  className="bg-[#18668D] text-white"
                  type="button"
                  variant="outline"
                  onClick={() => appendAgenda({ tin: "", taxPayer: "", taxAudited: "", subject: "", decision: "" })}
                >
                  Add Item
                </Button>
              </div>

              <div className="flex justify-between">
                <Button type="button" variant="outline" onClick={() => setStep(1)}>
                  Back
                </Button>
                <Button type="submit" className="bg-[#18668D]">
                  Submit
                </Button>
              </div>
            </>
          )}
        </form>
      </Form>
    </div>
  );
}
</file>

<file path="src/components/navbar.tsx">
"use client";
import { Button } from "@/components/ui/button";
import Image from "next/image";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { SelectIcon } from "@radix-ui/react-select";
import Link from "next/link";
import { usePathname } from "next/navigation";

export default function Navbar() {

  const pathname = usePathname();
  const linkHref = pathname === "/staff-register" ? "/staff-login" : "/staff-register";
  return (
    <header className="w-full flex items-center justify-between px-8 py-4 bg-white shadow-sm">
      
      <div className="flex items-center space-x-2">
        <Image src="/Rralogo.png" alt="RRA Logo" width={40} height={40} />
        <span className="text-xl font-bold text-[#18668D]">
          Tax Claim Review System
        </span>
      </div>
      <div className="flex items-center space-x-4">
        <Link href={linkHref}>
        <Button className="bg-white border-[#18668D] border-2 rounded-2xl text-[#18668D] hover:bg-[#18668D] hover:text-white">
          {pathname === "/staff-register" ? "Login" : "Register"}
        </Button>
        </Link>
        <Select >
              <SelectTrigger className="border-[#18668D] border-2 rounded-2xl text-white bg-[#18668D] hover:border-[#18668D] hover:border-2 hover:text-[#18668D] hover:bg-white">
                <SelectValue className="text-white" placeholder=" Kinyarwanda" />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="kinyarwanda">Kinyarwanda</SelectItem>
                <SelectItem value="english">English</SelectItem>
                <SelectItem value="french">French</SelectItem>
              </SelectContent>
            </Select>
      </div>
    </header>
  );
}
</file>

<file path="src/components/profile.tsx">
"use client";

import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import { useEffect, useState } from "react";
import { useRouter } from "next/navigation";
import api from "@/lib/api";

import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Switch } from "@/components/ui/switch";
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { InvitationTemplateModal } from "./InvitationTemplateModal"; // 1. Import the modal

// Zod schema for form validation
const profileFormSchema = z.object({
  fullName: z.string().min(2, {
    message: "Full name must be at least 2 characters.",
  }),
  email: z.string().email({
    message: "Invalid email address.",
  }),
  phoneNumber: z.string().optional(),
});

type ProfileFormValues = z.infer<typeof profileFormSchema>;


interface UserData {
  id: string;
  fullName: string;
  email: string;
  title: string;
  phoneNumber: string;
  committeeRole: string;
  committeeGroup: string;
  availabilityStatus: boolean;
}

const mockUser = {
  passwordLastChanged: "2 months ago",
  emailNotifications: true,
  smsNotifications: false,
  availabilityStatus:false,
};

export default function ProfilePage() {
  const router = useRouter();
  const [userData, setUserData] = useState<UserData | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false); 
  const [isAvailable, setIsAvailable] = useState(false);
  const [isUpdatingAvailability, setIsUpdatingAvailability] = useState(false);

  const form = useForm<ProfileFormValues>({
    resolver: zodResolver(profileFormSchema),
    defaultValues: {
      fullName: "",
      email: "",
      phoneNumber: "",
    },
    mode: "onChange",
  });

  useEffect(() => {
    const fetchUserData = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await api.get('/api/v1/user/');
        if (response.data && response.data.data) {
          const fetchedUser: UserData = response.data.data;
          setUserData(fetchedUser);
          setIsAvailable(fetchedUser.availabilityStatus);
          form.reset({
            fullName: fetchedUser.fullName,
            email: fetchedUser.email,
            phoneNumber: fetchedUser.phoneNumber,
          });
        } else {
          throw new Error("User data not found.");
        }
      } catch (err) {
        console.error("Failed to fetch user data:", err);
        setError("Could not load your profile.");
      } finally {
        setLoading(false);
      }
    };

    fetchUserData();
  }, [form]);

  const handleAvailabilityChange = async (newStatus: boolean) => {
    if (!userData) return;

    // Disable the switch to prevent multiple clicks
    setIsUpdatingAvailability(true);
    
    // Optimistic UI update for instant feedback
    const originalStatus = isAvailable;
    setIsAvailable(newStatus);

    try {
      // Send the boolean value directly in the request body
      await api.put(`/api/v1/user/${userData.id}/availability-status`, newStatus, {
        headers: {
          // Explicitly set content type for raw boolean
          'Content-Type': 'application/json',
        },
      });
      // Optionally show a success toast/message here
    } catch (error) {
      console.error("Failed to update availability status:", error);
      alert("Failed to update status. Reverting change.");
      // Rollback UI on error
      setIsAvailable(originalStatus);
    } finally {
      // Re-enable the switch
      setIsUpdatingAvailability(false);
    }
  };

  async function onSubmit(values: ProfileFormValues) {
    if (!userData) return;
    try {
      const payload = {
        fullName: values.fullName,
        email: values.email,
        phoneNumber: values.phoneNumber,
        title: userData.title,
        committee_role: userData.committeeRole,
        committeeGroup: userData.committeeGroup,
      };
      await api.put(`/api/v1/user/${userData.id}`, payload);
      localStorage.setItem("staff_name", values.fullName);
      alert("Profile updated successfully!");
      setUserData(prev => prev ? { ...prev, ...values } : null);
    } catch (err) {
      console.error("Failed to update profile:", err);
      alert("Error updating profile.");
    }
  }

  const handleLogout = async () => {
    try {
      await api.post('/api/v1/auth/logout');
    } catch (error) {
       console.error("Server logout failed, clearing session locally.", error);
    } finally {
      localStorage.clear();
      router.push('/staff-login');
    }
  };

  if (loading) {
    return <div className="container mx-auto p-4 max-w-2xl space-y-8 text-center">Loading Profile...</div>;
  }

  if (error) {
    return <div className="container mx-auto p-4 max-w-2xl space-y-8 text-center text-red-500">{error}</div>;
  }
  
  const getAvatarFallback = (name: string) => name.split(' ').map(n => n[0]).join('').toUpperCase();
  const formatRole = (role: string = "") => role.replace(/_/g, ' ').replace(/\b\w/g, char => char.toUpperCase());

  return (
    // Use a Fragment to wrap the page content and the modal
    <>
      <div className="container mx-auto p-4 max-w-2xl space-y-8">
        {/* Profile Header */}
        <div className="rounded-lg border p-6 flex items-center space-x-4 bg-white">
          <Avatar className="h-20 w-20">
            <AvatarImage src="/profile.png" alt={userData?.fullName || ''} />
            <AvatarFallback>{userData ? getAvatarFallback(userData.fullName) : 'U'}</AvatarFallback>
          </Avatar>
          <div>
            <h1 className="text-2xl font-bold">{userData?.fullName}</h1>
            <p className="text-gray-600">{userData?.title}</p>
            <div className="flex items-center text-gray-500 mt-1 text-sm">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4 mr-1">
                <rect width="20" height="14" x="2" y="7" rx="2" ry="2" />
                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
              </svg>
              <span>{formatRole(userData?.committeeRole)}</span>
            </div>
          </div>
        </div>
        
        {/* Personal Information Section */}
        <div className="rounded-lg border p-6 space-y-4 bg-white">
          <h2 className="text-xl font-semibold">Personal Information</h2>
          <p className="text-gray-600 text-sm">Update your personal details and profile information.</p>
          <Form {...form}>
            <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <FormField control={form.control} name="fullName" render={({ field }) => (
                  <FormItem>
                    <FormLabel>Full Names</FormLabel>
                    <FormControl><Input {...field} /></FormControl>
                    <FormMessage />
                  </FormItem>
                )} />
                <FormField control={form.control} name="email" render={({ field }) => (
                  <FormItem>
                    <FormLabel>Email</FormLabel>
                    <FormControl><Input {...field} /></FormControl>
                    <FormMessage />
                  </FormItem>
                )} />
                <FormField control={form.control} name="phoneNumber" render={({ field }) => (
                  <FormItem>
                    <FormLabel>Phone</FormLabel>
                    <FormControl><Input {...field} /></FormControl>
                    <FormMessage />
                  </FormItem>
                )} />
              </div>
              <Button type="submit" className="bg-[#18668D]">edit profile</Button>
            </form>
          </Form>
        </div>

        {/* Security Settings Section */}
        <div className="rounded-lg border p-6 space-y-4 bg-white">
          <h2 className="text-xl font-semibold">Security Settings</h2>
          <p className="text-gray-600 text-sm">Manage your account security and authentication.</p>
          <div className="flex justify-between items-center">
            <div>
              <h3 className="font-medium">Password</h3>
              <p className="text-sm text-gray-500">Last changed {mockUser.passwordLastChanged}</p>
            </div>
            <Button variant="outline" className="flex items-center space-x-2">
              <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M15 6V3a3 3 0 00-6 0v3m0 0a3 3 0 00-6 0v3a3 3 0 006 0m0 0v3a3 3 0 006 0v-3m0 0a3 3 0 00-6 0" />
              </svg>
              <span>change Password</span>
            </Button>
          </div>
        </div>
        
        {/* Notification Preferences Section */}
        <div className="rounded-lg border p-6 space-y-4 bg-white">
          <h2 className="text-xl font-semibold">Notification Preferences</h2>
          <p className="text-gray-600 text-sm">Choose what notifications you want to receive.</p>
          <div className="flex justify-between items-center py-2">
            <div>
              <h3 className="font-medium">Email notification</h3>
              <p className="text-sm text-gray-500">receive notifications via email</p>
            </div>
            <Switch defaultChecked={mockUser.emailNotifications} />
          </div>
          <div className="flex justify-between items-center py-2">
            <div>
              <h3 className="font-medium">SMS notification</h3>
              <p className="text-sm text-gray-500">receive notifications via SMS</p>
            </div>
            <Switch defaultChecked={mockUser.smsNotifications} />
          </div>
          <div className="flex justify-between items-center py-2 border-t pt-4 mt-2">
            <div>
              <h3 className="font-medium">Availability Status</h3>
              <p className="text-sm text-gray-500">Indicate this Week availability</p>
            </div>
            <Switch 
              checked={isAvailable}
              onCheckedChange={handleAvailabilityChange}
              disabled={isUpdatingAvailability}
            />
          </div>
          
          {userData?.committeeRole === 'COMMITTEE_LEADER' && (
            <div className="flex justify-between items-center py-2 border-t pt-4 mt-2">
              <div>
                <h3 className="font-medium">Invitation Template</h3>
                <p className="text-sm text-gray-500">Edit invitation hour and Venue</p>
              </div>
              {/* 3. This button now opens the modal */}
              <Button 
                variant="outline" 
                className="flex items-center space-x-2"
                onClick={() => setIsModalOpen(true)}
              >
                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4">
                    <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                    <path d="m15 5 4 4"/>
                  </svg>
                <span>Edit</span>
              </Button>
            </div>
          )}
        </div>

        {/* Log out button */}
        <div className="flex justify-end mt-8">
          <Button onClick={handleLogout} variant="ghost" className="text-red-600 hover:text-white hover:bg-red-500  bg-red-200">
            <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4" />
              <polyline points="16 17 21 12 16 7" />
              <line x1="21" y1="21" y2="12" x2="9" />
            </svg>
            Log out
          </Button>
        </div>
      </div>
      
      {/* 4. Render the modal and pass state to control it */}
      <InvitationTemplateModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} />
    </>
  );
}
</file>

<file path="src/components/sidebar.tsx">
"use client";
import { Button } from "@/components/ui/button";
import { usePathname, useRouter } from "next/navigation";
import { FileText, FolderKanban, LayoutDashboard, MessageSquare } from "lucide-react";
import Link from "next/link";
import { useEffect, useState } from "react";


export default function Sidebar() {
    const pathname = usePathname();
    const router = useRouter();
    const [userName, setUserName] = useState("User");
    const [userRole, setUserRole] = useState<string | null>(null);

    const allNavItems = [
    { name: "Cases", icon: FolderKanban, path: "/cases" },
    { name: "Meetings", icon: LayoutDashboard, path: "/meetings" },
    { name: "Reports", icon: FileText, path: "/reports" },
    { name: "Chat", icon: MessageSquare, path: "/chat" },
  ];

   // Load user name and role from localStorage
  useEffect(() => {
    const name = localStorage.getItem("staff_name");
    const role = localStorage.getItem("staff_role");
    if (name) setUserName(name);
    if (role) setUserRole(role);
  }, []);

// Filter out "Cases" for regular COMMITTEE_MEMBER
// Filter based on role

  const navItems = allNavItems.filter((item) => {
    // Hide "Cases" for regular COMMITTEE_MEMBER
    if (item.name === "Cases" && userRole === "COMMITTEE_MEMBER") {
      return false;
    }
    // Hide "Chat" for everyone except COMMITTEE_LEADER
    if (item.name === "Chat" && userRole !== "COMMITTEE_LEADER") {
      return false;
    }
    return true;
  });

  return (
    <div>
<aside className=" w-64 h-full p-4 border-r border-gray-300 bg-white flex flex-col justify-between">
  <div className="flex justify-center mb-6">
    <img src="/Rralogo.png" alt="Logo" className="h-20 w-20 p-2 bg-white" />
  </div>

  <nav className="flex flex-col space-y-0">
      {navItems.map((item) => {
        const isActive = pathname.startsWith(item.path);

        return (
          <Button
            key={item.name}
            variant={isActive ? "default" : "ghost"}
            className={`w-full justify-start space-x-2 ${
              isActive
                ? "bg-[#134E70] text-white hover:bg-[#063854]"
                : "text-gray-600 hover:bg-gray-100"
            }`}
            onClick={() => router.push(item.path)}
          >
            <item.icon className="h-4 w-4" />
            <span>{item.name}</span>
          </Button>
        );
      })}
    </nav>
    <Link href={"/profile"} className="flex items-center mt-auto shadow-lg rounded-md p-3">
  <img src="/profile.png" alt="Profile" className="rounded-full h-10 w-10" />
  <div className="ml-3 ">
    <h1 className="font-bold">{userName}</h1>
  </div>
</Link>
  
</aside>

    </div>
    
  );
}
</file>

<file path="src/components/taxForm.tsx">
"use client";

import { zodResolver } from "@hookform/resolvers/zod";
import { useFieldArray, useForm } from "react-hook-form";
import * as z from "zod";
import { useEffect, useState } from "react";
import { useRouter } from "next/navigation";
import { Dropzone, DropzoneContent, DropzoneEmptyState } from '@/components/ui/shadcn-io/dropzone';

import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Textarea } from "./ui/textarea";
import { PlusCircle } from "lucide-react";
import { storage } from "@/lib/firebase";
import { ref, uploadBytes, getDownloadURL } from "firebase/storage";

const API_URL = process.env.NEXT_PUBLIC_API_URL;

// Schema for a single tax item
const taxItemSchema = z.object({
  auditedTaxType: z.string().min(1, { message: "Tax type is required." }),
  principalAmount: z.number().min(0, { message: "Must be a positive number." }),
  understatementFines: z.number().min(0, { message: "Must be a positive number." }),
  fixedAdministrativeFines: z.number().min(0, { message: "Must be a positive number." }),
  dischargedAmount: z.number().min(0, { message: "Must be a positive number." }),
});

// Schema for a single appeal point
const appealPointSchema = z.object({
  appealPoint: z.string().min(1, { message: "Appeal point is required." }),
  auditorsOpinion: z.string().min(1, { message: "Auditor's opinion is required." }),
  summarisedProblem: z.string().min(1, { message: "Problem summary is required." }),
  proposedSolution: z.string().min(1, { message: "Proposed solution is required." }),
});

// Main form schema (removed unnecessary fields)
const formSchema = z.object({
  taxItems: z.array(taxItemSchema).min(1, { message: "You must add at least one tax item." }),
  taxPayerTIN: z.string().min(1, { message: "TIN is required." }),
  taxAssessmentTime: z.string().min(1, { message: "Assessment time is required." }),
  phone: z.string().optional().or(z.literal("")),
  dateAssessmentReceived: z.string().min(1, { message: "Date is required." }),
  appealDate: z.string()
    .optional()
    .or(z.literal(""))
    .refine((val) => !val || /^\d{4}-\d{2}-\d{2}$/.test(val), {
        message: "Date must be in YYYY-MM-DD format.",
    }),
  appealExpireDate: z.string()
    .optional()
    .or(z.literal(""))
    .refine((val) => !val || /^\d{4}-\d{2}-\d{2}$/.test(val), {
        message: "Date must be in YYYY-MM-DD format.",
    }),
  caseId: z.string().min(1, { message: "Case ID is required." }),
  auditorNames: z.string().min(1, { message: "Auditor name is required." }),
  appealPoints: z.array(appealPointSchema).min(1, { message: "You must add at least one appeal point." }),
});

export function TaxForm() {
  const router = useRouter();
  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      taxPayerTIN: "",
      phone: "",
      caseId: "",
      auditorNames: "",
      dateAssessmentReceived: "",
      appealDate: "",
      appealExpireDate: "",
      taxItems: [
        {
          auditedTaxType: "",
          principalAmount: 0,
          understatementFines: 0,
          fixedAdministrativeFines: 0,
          dischargedAmount: 0,
        },
      ],
      appealPoints: [
        {
          appealPoint: "",
          summarisedProblem: "",
          auditorsOpinion:"",
          proposedSolution: "",
        },
      ],
    },
  });

  const { fields: taxFields, append: appendTax, remove: removeTax } = useFieldArray({
    control: form.control,
    name: "taxItems",
  });

  const { fields: appealFields, append: appendAppeal, remove: removeAppeal } = useFieldArray({
    control: form.control,
    name: "appealPoints",
  });

  const [total, setTotal] = useState(0);
  const [step, setStep] = useState(1);
  const [files, setFiles] = useState<File[] | undefined>();
  const [userName, setUserName] = useState("Unknown");
  const [isSubmitting, setIsSubmitting] = useState(false);

  useEffect(() => {
  const name = localStorage.getItem("staff_name");
  if (name) setUserName(name);
}, []);


  const currentYear = new Date().getFullYear();
  const years = Array.from({ length: 10 }, (_, i) => currentYear - i);

  const taxTypes = [
    { value: "VAT", label: "VAT" },
    { value: "CIT", label: "Corporate Income Tax" },
    { value: "PAYE", label: "PAYE" },
  ];

  const calculateTotal = () => {
    const values = form.getValues().taxItems;
    const newTotal = values.reduce((sum, item) => {
      return sum + (item.principalAmount || 0) + (item.understatementFines || 0) + (item.fixedAdministrativeFines || 0);
    }, 0);
    setTotal(newTotal);
  };

  useEffect(() => {
    const subscription = form.watch(() => {
      calculateTotal();
    });
    return () => subscription.unsubscribe();
  }, [form.watch]);

  const handleDrop = (files: File[]) => {
    setFiles(files);
  };

async function onSubmit(values: z.infer<typeof formSchema>) {

  setIsSubmitting(true);
    let uploadedFileUrl = "";

    // Step 1: Upload file to Firebase Storage
    if (files && files.length > 0) {
      const file = files[0];
      const storageRef = ref(storage, `attachments/${Date.now()}_${file.name}`);

      try {
        const snapshot = await uploadBytes(storageRef, file);
        uploadedFileUrl = await getDownloadURL(snapshot.ref);
      } catch (err) {
        console.error("Firebase upload error:", err);
        alert("Error uploading attachment. Please try again.");
        setIsSubmitting(false);
        return;
      }
    }
  const toISOString = (dateString: string | undefined | null): string | null => {
  if (!dateString) return null;
  try {
      const parts = dateString.split('-');
      const year = parseInt(parts[0], 10);
      const month = parseInt(parts[1], 10) - 1;
      const day = parseInt(parts[2], 10);
      return new Date(year, month, day).toISOString();
  } catch (e) {
      console.error("Could not parse date:", dateString);
      return null;
  }
};

  try {
    const payload = {
      caseId: values.caseId,
      auditorsName: values.auditorNames,
      taxAssessmentAcknowledgementDateByTaxpayer: toISOString(values.dateAssessmentReceived),
      taxAssessmentTime: values.taxAssessmentTime,
      appealDate: toISOString(values.appealDate),
      appealExpireDate: toISOString(values.appealExpireDate),
      casePresenter: userName,
      tin: values.taxPayerTIN,
      attachmentLink: uploadedFileUrl,
      taxAudited: values.taxItems.map(taxItem => ({
        taxTypeAudited: taxItem.auditedTaxType,
        principalAmountToBePaid: taxItem.principalAmount,
        understatementFines: taxItem.understatementFines,
        fixedAdministrativeFines: taxItem.fixedAdministrativeFines,
        dischargedAmount: taxItem.dischargedAmount,
        totalTaxAndFinesToBePaid:
          (taxItem.principalAmount || 0) +
          (taxItem.understatementFines || 0) +
          (taxItem.fixedAdministrativeFines || 0) - 
          (taxItem.dischargedAmount || 0),
        appeals: values.appealPoints.map(ap => ({
          appealPoint: ap.appealPoint,
          summarisedProblem: ap.summarisedProblem,
          auditorsOpinion: ap.auditorsOpinion, 
          proposedSolution: ap.proposedSolution
        }))
      }))
    };

    console.log("Payload to send:", JSON.stringify(payload, null, 2));

    const res = await fetch(
      `${API_URL}/api/v1/auth/explanatory_note/`,
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${localStorage.getItem("staff_token")}`
        },
        body: JSON.stringify(payload)
      }
    );

    console.log("Response status:", res.status);

    if (!res.ok) {
        // This improved error handling will show you the exact error from the backend.
        const errorBody = await res.text();
        console.error("Backend error response:", errorBody);
        throw new Error("Failed to submit case. Server responded with an error.");
    }

    const data = await res.json();
    console.log("Backend response:", data);

    alert("Case submitted successfully!");
    router.push('/cases/all-cases');
  } catch (err) {
    console.error(err);
    alert("Error submitting case. Check the browser console for details.");
  }
}

    return (
  <div className="container p-4 max-w-2xl">
    <Form {...form} >
      <form
  onSubmit={form.handleSubmit(onSubmit)}>
      {step === 1 && (
        <>
          {/* Case Info */}
          <div className="rounded-lg border p-6 space-y-4 bg-white shadow-md">
            <h2 className="text-xl font-semibold">Case Info</h2>
            <FormField control={form.control} name="caseId" render={({ field }) => (
              <FormItem>
                <FormLabel>Case ID</FormLabel>
                <FormControl>
                  <Input placeholder="e.g., TAX-2023-001" {...field} value={field.value ?? ""} />
                </FormControl>
                <FormMessage />
              </FormItem>
            )} />
            <FormField control={form.control} name="auditorNames" render={({ field }) => (
              <FormItem>
                <FormLabel>Auditor Names</FormLabel>
                <FormControl>
                  <Input placeholder="e.g., John Doe" {...field} value={field.value ?? ""} />
                </FormControl>
                <FormMessage />
              </FormItem>
            )} />
            <FormField control={form.control} name="taxPayerTIN" render={({ field }) => (
              <FormItem>
                <FormLabel>Tax payer TIN</FormLabel>
                <FormControl>
                  <Input placeholder="NNN-NN-NNNNN" {...field} value={field.value ?? ""} />
                </FormControl>
                <FormMessage />
              </FormItem>
            )} />
          </div>

          {/* Dates */}
          <div className="rounded-lg border p-6 space-y-4 bg-white shadow-md">
            <h2 className="text-xl font-semibold">Dates</h2>
            <div className="grid grid-cols-1 md:grid-cols-1 gap-4">
              <FormField control={form.control} name="taxAssessmentTime" render={({ field }) => (
                <FormItem>
                  <FormLabel>Tax Assessment Time</FormLabel>
                  <FormControl>
                    <Input placeholder="Input here" {...field} value={field.value ?? ""} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )} />
              <FormField control={form.control} name="dateAssessmentReceived" render={({ field }) => (
                <FormItem>
                  <FormLabel>Date Tax Assessment Received</FormLabel>
                  <FormControl>
                    <Input type="date" placeholder="YYYY-MM-DD" {...field} value={field.value ?? ""} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )} />
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <FormField control={form.control} name="appealDate" render={({ field }) => (
                  <FormItem>
                    <FormLabel>Appeal Date</FormLabel>
                    <FormControl>
                      <Input type="date" placeholder="YYYY-MM-DD" {...field} value={field.value ?? ""} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )} />
                <FormField control={form.control} name="appealExpireDate" render={({ field }) => (
                  <FormItem>
                    <FormLabel>Appeal Expire Date</FormLabel>
                    <FormControl>
                      <Input type="date" placeholder="YYYY-MM-DD" {...field} value={field.value ?? ""} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )} />
              </div>
            </div>
          </div>

          <div className="flex justify-end">
            <Button type="button" onClick={() => setStep(2)} className="bg-[#18668D]">
              Next
            </Button>
          </div>
        </>
      )}

      {step === 2 && (
        <>
          {/* Page 2: Tax Info */}
          <div className="rounded-lg border p-6 space-y-4 bg-white">
            <h2 className="text-xl font-semibold">Tax Info</h2>
            {taxFields.map((field, index) => (
              <div key={field.id} className="grid grid-cols-1 md:grid-cols-2 gap-4 border-b pb-4">
                <FormField control={form.control} name={`taxItems.${index}.auditedTaxType`} render={({ field }) => (
                  <FormItem className="col-span-full w-full">
                    <FormLabel>Audited Tax Type</FormLabel>
                    <Select onValueChange={field.onChange} value={field.value ?? ""}>
                      <FormControl>
                        <SelectTrigger className="w-full">
                          <SelectValue placeholder="Select Tax Type" />
                        </SelectTrigger>
                      </FormControl>
                      <SelectContent>
                        {taxTypes.map((type) => (
                          <SelectItem key={type.value} value={type.value}>
                            {type.label}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                    <FormMessage />
                  </FormItem>
                )} />
                <FormField control={form.control} name={`taxItems.${index}.principalAmount`} render={({ field }) => (
                  <FormItem className="col-span-full">
                    <FormLabel>Principal Amount of tax to be paid</FormLabel>
                    <FormControl>
                      <Input type="number" {...field} value={field.value ?? 0} onChange={(e) => field.onChange(Number(e.target.value))} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )} />
                <FormField control={form.control} name={`taxItems.${index}.understatementFines`} render={({ field }) => (
                  <FormItem>
                    <FormLabel>Understatement Fines</FormLabel>
                    <FormControl>
                      <Input type="number" {...field} value={field.value ?? 0} onChange={(e) => field.onChange(Number(e.target.value))} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )} />
                <FormField control={form.control} name={`taxItems.${index}.fixedAdministrativeFines`} render={({ field }) => (
                  <FormItem>
                    <FormLabel>Fixed Administrative Fines</FormLabel>
                    <FormControl>
                      <Input type="number" {...field} value={field.value ?? 0} onChange={(e) => field.onChange(Number(e.target.value))} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )} />
                <FormField control={form.control} name={`taxItems.${index}.dischargedAmount`} render={({ field }) => (
                  <FormItem className="col-span-full">
                    <FormLabel>Discharged Amount</FormLabel>
                    <FormControl>
                      <Input type="number" {...field} value={field.value ?? 0} onChange={(e) => field.onChange(Number(e.target.value))} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )} />
                <FormField render={({ field }) => (
                  <FormItem className="md:col-span-2">
                    <FormLabel>Add Appeal points for this tax type</FormLabel>
                    <FormControl>
                      <Button
                        type="button"
                        variant="outline"
                        className="text-blue-500 underline hover:text-blue-600 font-normal"
                        onClick={() => setStep(3)}
                      >
                        Click here to add appeal points
                      </Button>
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )} name={""} />
              </div>
            ))}
          </div>

          <Button className="bg-[#18668D] text-white" type="button" variant="outline" onClick={() => appendTax({
            auditedTaxType: "",
            principalAmount: 0,
            understatementFines: 0,
            fixedAdministrativeFines: 0,
            dischargedAmount: 0,
          })}>
            Add Tax Type
          </Button>

          <Dropzone
            accept={{
              'image/*': [],
              'application/pdf': [],
              'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': [],
              'application/vnd.ms-excel': [],
              'application/vnd.openxmlformats-officedocument.wordprocessingml.document': [],
              'application/msword': [],
            }}
            maxFiles={10}
            maxSize={1024 * 1024 * 10}
            minSize={1024}
            onDrop={handleDrop}
            onError={console.error}
            src={files}
            className="border-[#18668D] border-2 border-dashed text-[#18668D]"
          >
            <DropzoneEmptyState />
            <DropzoneContent />
          </Dropzone>

          <div className="rounded-lg border p-6 space-y-4 bg-white">
            <div className="text-lg font-bold">
              Total taxes and fines to be paid: {total.toLocaleString()} RWF
            </div>
          </div>

          <div className="flex justify-between">
            <Button type="button" variant="outline" onClick={() => setStep(1)}>
              Back
            </Button>
            <Button 
              type="submit" 
              className="bg-[#18668D]"
              disabled={isSubmitting}
            >
              {isSubmitting ? 'Submitting...' : 'Submit'}
            </Button>
          </div>
        </>
      )}
      {step === 3 && (
      <>
    {/* Step 3: Appeal Points */}
    <div className="rounded-lg border p-6 space-y-4 bg-white shadow-md">
      <h1 className="text-2xl font-bold text-gray-900 mt-2">
                Details
            </h1>
        <p className="text-lg text-gray-500 mb-12">
            provide appeal point details
        </p>
      <h2 className="text-xl font-semibold">Appeal Points</h2>
      {appealFields.map((field, index) => (
        <div key={field.id} className="space-y-4 border-b pb-4">
          <FormField
            control={form.control}
            name={`appealPoints.${index}.appealPoint`}
            render={({ field }) => (
              <FormItem>
                <FormLabel>Appeal Point {index + 1}</FormLabel>
                <FormControl>
                  <Input {...field} placeholder="Enter appeal point" />
                </FormControl>
                <FormMessage />
              </FormItem>
            )}
          />
          <FormField
            control={form.control}
            name={`appealPoints.${index}.summarisedProblem`}
            render={({ field }) => (
              <FormItem>
                <FormLabel>Problem Summary</FormLabel>
                <FormControl>
                  <Textarea {...field} placeholder="Problem summary goes here..." />
                </FormControl>
                <FormMessage />
              </FormItem>
            )}
          />
          <FormField
            control={form.control}
            name={`appealPoints.${index}.auditorsOpinion`}
            render={({ field }) => (
              <FormItem>
                <FormLabel>Basis of Tax assessment by Auditor</FormLabel>
                <FormControl>
                  <Textarea {...field} placeholder="Auditor's comments go here..." />
                </FormControl>
                <FormMessage />
              </FormItem>
            )}
          />
          <FormField
            control={form.control}
            name={`appealPoints.${index}.proposedSolution`}
            render={({ field }) => (
              <FormItem>
                <FormLabel>Proposed Solution</FormLabel>
                <FormControl>
                  <Textarea {...field} placeholder="Proposed solution goes here..." />
                </FormControl>
                <FormMessage />
              </FormItem>
            )}
          />
          <div className="flex justify-end">
            <Button
              type="button"
              variant="outline"
              onClick={() => removeAppeal(index)}
              className="text-red-500 hover:text-red-600"
            >
              Remove
            </Button>
          </div>
        </div>
      ))}

      <Button
        type="button"
        variant="outline"
        className="w-full justify-center text-lg font-bold text-[#18668D] hover:bg-blue-50 hover:text-[#0f567a] border-gray-200 h-10"
        onClick={() =>
          appendAppeal({
            appealPoint: "",
            auditorsOpinion: "",
            summarisedProblem: "",
            proposedSolution: "",
          })
        }
      >
        <PlusCircle className="mr-3 h-6 w-6" />
        Add appeal point
      </Button>

      <div className="flex justify-between">
        <Button type="button" variant="outline" onClick={() => setStep(2)}>
          Back
        </Button>
        <Button 
              type="submit" 
              className="bg-[#18668D]"
              disabled={isSubmitting}
            >
              {isSubmitting ? 'Submitting...' : 'Submit'}
            </Button>
      </div>
    </div>
  </>
      )}
      </form>
    </Form>
  </div>
);
}
</file>

<file path="src/components/TaxTypeDetails.tsx">
"use client";

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import api from '@/lib/api';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { FileText, HandCoins, Banknote, Coins, CheckCircle2 } from 'lucide-react';
import Link from 'next/link';

interface AppealDTO {
  AppealId: string;
  appealPoint: string;
  summarisedProblem: string;
  auditorsOpinion: string;
  proposedSolution: string;
}

interface TaxAuditedDTO {
  taxAuditedId: string;
  taxTypeAudited: string;
  principalAmountToBePaid: number;
  understatementFines: number;
  fixedAdministrativeFines: number;
  appeals: AppealDTO[];
}

interface InfoCardProps {
  icon: React.ElementType;
  title: string;
  amount?: number;
  color: string;
}

const InfoCard = ({ icon: Icon, title, amount = 0, color }: InfoCardProps) => (
  <div className="flex items-center space-x-4">
    <div className={`p-3 rounded-full ${color}`}>
      <Icon className="h-6 w-6 text-white" />
    </div>
    <div>
      <p className="text-sm text-gray-500">{title}</p>
      <p className="font-bold">{amount.toLocaleString()} frw</p>
    </div>
  </div>
);

export function TaxTypeDetails({ caseId, taxAuditedId }: { caseId: string, taxAuditedId: string }) {
  const [taxItem, setTaxItem] = useState<TaxAuditedDTO | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [votedAppeals, setVotedAppeals] = useState<string[]>([]);
  const router = useRouter();

  useEffect(() => {
    const storedVotedAppeals = JSON.parse(localStorage.getItem('votedAppeals') || '[]');
    setVotedAppeals(storedVotedAppeals);

    const fetchDetails = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await api.get(`/api/v1/auth/explanatory_note/${caseId}`);
        const caseData = response.data.data;
        const specificTaxItem = caseData.taxAudited.find(
          (item: TaxAuditedDTO) => item.taxAuditedId === taxAuditedId
        );
        if (specificTaxItem) {
          setTaxItem(specificTaxItem);
        } else {
          throw new Error("Audited tax item not found for the given ID.");
        }
      } catch (err) {
        console.error("Failed to fetch tax type details:", err);
        setError("Could not load the details for this tax type.");
      } finally {
        setLoading(false);
      }
    };
    fetchDetails();
  }, [caseId, taxAuditedId]);

  if (loading) return <div className="text-center p-8">Loading...</div>;
  if (error || !taxItem) return <div className="text-center text-red-500 p-8">{error || "Data not found"}</div>;

  return (
    <div className="w-full max-w-4xl mx-auto space-y-6">
      <p className="text-sm text-gray-500">
        meeting &gt; {caseId} &gt; {taxItem.taxTypeAudited}
      </p>

      <Card className="p-6">
        <CardContent className="p-0">
          <div className="flex items-center space-x-3 mb-6">
            <div className="bg-blue-100 p-2 rounded-full">
              <FileText className="h-6 w-6 text-blue-600" />
            </div>
            <h1 className="text-2xl font-bold">{taxItem.taxTypeAudited}</h1>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6 p-4 bg-green-50 rounded-lg">
            <InfoCard icon={HandCoins} title="Principal amount to be paid" amount={taxItem.principalAmountToBePaid} color="bg-green-400" />
            <InfoCard icon={Banknote} title="Understatement fines" amount={taxItem.understatementFines} color="bg-purple-400" />
            <InfoCard icon={Coins} title="Fixed administrative fines" amount={taxItem.fixedAdministrativeFines} color="bg-orange-400" />
          </div>
        </CardContent>
      </Card>

      <Card className="p-6">
        <CardContent className="p-0">
          <div className="flex items-center space-x-3 mb-4">
            <div className="bg-blue-100 p-2 rounded-full">
               <FileText className="h-6 w-6 text-blue-600" />
            </div>
            <h2 className="text-xl font-bold">Appeal points</h2>
          </div>
          <div className="space-y-3">
            {taxItem.appeals.map((appeal, index) => (
              <Link
                key={appeal.AppealId}
                href={`/meetings/case-details/tax-type-details/${appeal.AppealId}?caseId=${caseId}`}
                className="block"
              >
                <div className="flex items-center justify-between p-4 border rounded-lg bg-white shadow-sm hover:bg-gray-100 transition-colors">
                  <div className="flex items-center space-x-4">
                    <div className="flex items-center justify-center h-8 w-8 rounded-full bg-blue-600 text-white font-bold text-sm">
                      {index + 1}
                    </div>
                    <span className="font-medium">{appeal.appealPoint}</span>
                  </div>
                  {votedAppeals.includes(appeal.AppealId) && (
                    <CheckCircle2 className="h-6 w-6 text-green-500" />
                  )}
                </div>
              </Link>
            ))}
          </div>
        </CardContent>
      </Card>

      <Button onClick={() => router.back()} className="bg-[#18668D] hover:bg-[#134d66]">
        Back
      </Button>
    </div>
  );
}
</file>

<file path="src/components/ui/avatar.tsx">
"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

function Avatar({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Root>) {
  return (
    <AvatarPrimitive.Root
      data-slot="avatar"
      className={cn(
        "relative flex size-8 shrink-0 overflow-hidden rounded-full",
        className
      )}
      {...props}
    />
  )
}

function AvatarImage({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Image>) {
  return (
    <AvatarPrimitive.Image
      data-slot="avatar-image"
      className={cn("aspect-square size-full", className)}
      {...props}
    />
  )
}

function AvatarFallback({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Fallback>) {
  return (
    <AvatarPrimitive.Fallback
      data-slot="avatar-fallback"
      className={cn(
        "bg-muted flex size-full items-center justify-center rounded-full",
        className
      )}
      {...props}
    />
  )
}

export { Avatar, AvatarImage, AvatarFallback }
</file>

<file path="src/components/ui/button.tsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default:
          "bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",
        destructive:
          "bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
        secondary:
          "bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",
        ghost:
          "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean
  }) {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Button, buttonVariants }
</file>

<file path="src/components/ui/calendar.tsx">
"use client"

import * as React from "react"
import {
  ChevronDownIcon,
  ChevronLeftIcon,
  ChevronRightIcon,
} from "lucide-react"
import { DayButton, DayPicker, getDefaultClassNames } from "react-day-picker"

import { cn } from "@/lib/utils"
import { Button, buttonVariants } from "@/components/ui/button"

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  captionLayout = "label",
  buttonVariant = "ghost",
  formatters,
  components,
  ...props
}: React.ComponentProps<typeof DayPicker> & {
  buttonVariant?: React.ComponentProps<typeof Button>["variant"]
}) {
  const defaultClassNames = getDefaultClassNames()

  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn(
        "bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",
        String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,
        String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,
        className
      )}
      captionLayout={captionLayout}
      formatters={{
        formatMonthDropdown: (date) =>
          date.toLocaleString("default", { month: "short" }),
        ...formatters,
      }}
      classNames={{
        root: cn("w-fit", defaultClassNames.root),
        months: cn(
          "flex gap-4 flex-col md:flex-row relative",
          defaultClassNames.months
        ),
        month: cn("flex flex-col w-full gap-4", defaultClassNames.month),
        nav: cn(
          "flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between",
          defaultClassNames.nav
        ),
        button_previous: cn(
          buttonVariants({ variant: buttonVariant }),
          "size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",
          defaultClassNames.button_previous
        ),
        button_next: cn(
          buttonVariants({ variant: buttonVariant }),
          "size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",
          defaultClassNames.button_next
        ),
        month_caption: cn(
          "flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",
          defaultClassNames.month_caption
        ),
        dropdowns: cn(
          "w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",
          defaultClassNames.dropdowns
        ),
        dropdown_root: cn(
          "relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",
          defaultClassNames.dropdown_root
        ),
        dropdown: cn(
          "absolute bg-popover inset-0 opacity-0",
          defaultClassNames.dropdown
        ),
        caption_label: cn(
          "select-none font-medium",
          captionLayout === "label"
            ? "text-sm"
            : "rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",
          defaultClassNames.caption_label
        ),
        table: "w-full border-collapse",
        weekdays: cn("flex", defaultClassNames.weekdays),
        weekday: cn(
          "text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",
          defaultClassNames.weekday
        ),
        week: cn("flex w-full mt-2", defaultClassNames.week),
        week_number_header: cn(
          "select-none w-(--cell-size)",
          defaultClassNames.week_number_header
        ),
        week_number: cn(
          "text-[0.8rem] select-none text-muted-foreground",
          defaultClassNames.week_number
        ),
        day: cn(
          "relative w-full h-full p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",
          defaultClassNames.day
        ),
        range_start: cn(
          "rounded-l-md bg-accent",
          defaultClassNames.range_start
        ),
        range_middle: cn("rounded-none", defaultClassNames.range_middle),
        range_end: cn("rounded-r-md bg-accent", defaultClassNames.range_end),
        today: cn(
          "bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",
          defaultClassNames.today
        ),
        outside: cn(
          "text-muted-foreground aria-selected:text-muted-foreground",
          defaultClassNames.outside
        ),
        disabled: cn(
          "text-muted-foreground opacity-50",
          defaultClassNames.disabled
        ),
        hidden: cn("invisible", defaultClassNames.hidden),
        ...classNames,
      }}
      components={{
        Root: ({ className, rootRef, ...props }) => {
          return (
            <div
              data-slot="calendar"
              ref={rootRef}
              className={cn(className)}
              {...props}
            />
          )
        },
        Chevron: ({ className, orientation, ...props }) => {
          if (orientation === "left") {
            return (
              <ChevronLeftIcon className={cn("size-4", className)} {...props} />
            )
          }

          if (orientation === "right") {
            return (
              <ChevronRightIcon
                className={cn("size-4", className)}
                {...props}
              />
            )
          }

          return (
            <ChevronDownIcon className={cn("size-4", className)} {...props} />
          )
        },
        DayButton: CalendarDayButton,
        WeekNumber: ({ children, ...props }) => {
          return (
            <td {...props}>
              <div className="flex size-(--cell-size) items-center justify-center text-center">
                {children}
              </div>
            </td>
          )
        },
        ...components,
      }}
      {...props}
    />
  )
}

function CalendarDayButton({
  className,
  day,
  modifiers,
  ...props
}: React.ComponentProps<typeof DayButton>) {
  const defaultClassNames = getDefaultClassNames()

  const ref = React.useRef<HTMLButtonElement>(null)
  React.useEffect(() => {
    if (modifiers.focused) ref.current?.focus()
  }, [modifiers.focused])

  return (
    <Button
      ref={ref}
      variant="ghost"
      size="icon"
      data-day={day.date.toLocaleDateString()}
      data-selected-single={
        modifiers.selected &&
        !modifiers.range_start &&
        !modifiers.range_end &&
        !modifiers.range_middle
      }
      data-range-start={modifiers.range_start}
      data-range-end={modifiers.range_end}
      data-range-middle={modifiers.range_middle}
      className={cn(
        "data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70",
        defaultClassNames.day,
        className
      )}
      {...props}
    />
  )
}

export { Calendar, CalendarDayButton }
</file>

<file path="src/components/ui/card.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn(
        "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",
        className
      )}
      {...props}
    />
  )
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
        className
      )}
      {...props}
    />
  )
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-title"
      className={cn("leading-none font-semibold", className)}
      {...props}
    />
  )
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
        className
      )}
      {...props}
    />
  )
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-content"
      className={cn("px-6", className)}
      {...props}
    />
  )
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-footer"
      className={cn("flex items-center px-6 [.border-t]:pt-6", className)}
      {...props}
    />
  )
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
}
</file>

<file path="src/components/ui/checkbox.tsx">
"use client"

import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { CheckIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Checkbox({
  className,
  ...props
}: React.ComponentProps<typeof CheckboxPrimitive.Root>) {
  return (
    <CheckboxPrimitive.Root
      data-slot="checkbox"
      className={cn(
        "peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <CheckboxPrimitive.Indicator
        data-slot="checkbox-indicator"
        className="flex items-center justify-center text-current transition-none"
      >
        <CheckIcon className="size-3.5" />
      </CheckboxPrimitive.Indicator>
    </CheckboxPrimitive.Root>
  )
}

export { Checkbox }
</file>

<file path="src/components/ui/dialog.tsx">
"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { XIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Dialog({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Root>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />
}

function DialogTrigger({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />
}

function DialogPortal({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Portal>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />
}

function DialogClose({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />
}

function DialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function DialogContent({
  className,
  children,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Content> & {
  showCloseButton?: boolean
}) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        {showCloseButton && (
          <DialogPrimitive.Close
            data-slot="dialog-close"
            className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4"
          >
            <XIcon />
            <span className="sr-only">Close</span>
          </DialogPrimitive.Close>
        )}
      </DialogPrimitive.Content>
    </DialogPortal>
  )
}

function DialogHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  )
}

function DialogFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className
      )}
      {...props}
    />
  )
}

function DialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  )
}

function DialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
}
</file>

<file path="src/components/ui/form.tsx">
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  FormProvider,
  useFormContext,
  useFormState,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState } = useFormContext()
  const formState = useFormState({ name: fieldContext.name })
  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

function FormItem({ className, ...props }: React.ComponentProps<"div">) {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div
        data-slot="form-item"
        className={cn("grid gap-2", className)}
        {...props}
      />
    </FormItemContext.Provider>
  )
}

function FormLabel({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  const { error, formItemId } = useFormField()

  return (
    <Label
      data-slot="form-label"
      data-error={!!error}
      className={cn("data-[error=true]:text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
}

function FormControl({ ...props }: React.ComponentProps<typeof Slot>) {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      data-slot="form-control"
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
}

function FormDescription({ className, ...props }: React.ComponentProps<"p">) {
  const { formDescriptionId } = useFormField()

  return (
    <p
      data-slot="form-description"
      id={formDescriptionId}
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function FormMessage({ className, ...props }: React.ComponentProps<"p">) {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message ?? "") : props.children

  if (!body) {
    return null
  }

  return (
    <p
      data-slot="form-message"
      id={formMessageId}
      className={cn("text-destructive text-sm", className)}
      {...props}
    >
      {body}
    </p>
  )
}

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}
</file>

<file path="src/components/ui/input.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Input({ className, type, ...props }: React.ComponentProps<"input">) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
        "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
        className
      )}
      {...props}
    />
  )
}

export { Input }
</file>

<file path="src/components/ui/label.tsx">
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"

import { cn } from "@/lib/utils"

function Label({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        "flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",
        className
      )}
      {...props}
    />
  )
}

export { Label }
</file>

<file path="src/components/ui/pagination.tsx">
import * as React from "react"
import {
  ChevronLeftIcon,
  ChevronRightIcon,
  MoreHorizontalIcon,
} from "lucide-react"

import { cn } from "@/lib/utils"
import { Button, buttonVariants } from "@/components/ui/button"

function Pagination({ className, ...props }: React.ComponentProps<"nav">) {
  return (
    <nav
      role="navigation"
      aria-label="pagination"
      data-slot="pagination"
      className={cn("mx-auto flex w-full justify-center", className)}
      {...props}
    />
  )
}

function PaginationContent({
  className,
  ...props
}: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="pagination-content"
      className={cn("flex flex-row items-center gap-1", className)}
      {...props}
    />
  )
}

function PaginationItem({ ...props }: React.ComponentProps<"li">) {
  return <li data-slot="pagination-item" {...props} />
}

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<React.ComponentProps<typeof Button>, "size"> &
  React.ComponentProps<"a">

function PaginationLink({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) {
  return (
    <a
      aria-current={isActive ? "page" : undefined}
      data-slot="pagination-link"
      data-active={isActive}
      className={cn(
        buttonVariants({
          variant: isActive ? "outline" : "ghost",
          size,
        }),
        className
      )}
      {...props}
    />
  )
}

function PaginationPrevious({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to previous page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pl-2.5", className)}
      {...props}
    >
      <ChevronLeftIcon />
      <span className="hidden sm:block">Previous</span>
    </PaginationLink>
  )
}

function PaginationNext({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to next page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pr-2.5", className)}
      {...props}
    >
      <span className="hidden sm:block">Next</span>
      <ChevronRightIcon />
    </PaginationLink>
  )
}

function PaginationEllipsis({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      aria-hidden
      data-slot="pagination-ellipsis"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontalIcon className="size-4" />
      <span className="sr-only">More pages</span>
    </span>
  )
}

export {
  Pagination,
  PaginationContent,
  PaginationLink,
  PaginationItem,
  PaginationPrevious,
  PaginationNext,
  PaginationEllipsis,
}
</file>

<file path="src/components/ui/select.tsx">
"use client"

import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { CheckIcon, ChevronDownIcon, ChevronUpIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Select({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Root>) {
  return <SelectPrimitive.Root data-slot="select" {...props} />
}

function SelectGroup({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Group>) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />
}

function SelectValue({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Value>) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />
}

function SelectTrigger({
  className,
  size = "default",
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
  size?: "sm" | "default"
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  )
}

function SelectContent({
  className,
  children,
  position = "popper",
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",
          position === "popper" &&
            "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
          className
        )}
        position={position}
        {...props}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            "p-1",
            position === "popper" &&
              "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  )
}

function SelectLabel({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Label>) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn("text-muted-foreground px-2 py-1.5 text-xs", className)}
      {...props}
    />
  )
}

function SelectItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Item>) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",
        className
      )}
      {...props}
    >
      <span className="absolute right-2 flex size-3.5 items-center justify-center">
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  )
}

function SelectSeparator({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Separator>) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn("bg-border pointer-events-none -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function SelectScrollUpButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className
      )}
      {...props}
    >
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  )
}

function SelectScrollDownButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className
      )}
      {...props}
    >
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  )
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
}
</file>

<file path="src/components/ui/shadcn-io/dropzone/index.tsx">
'use client';

import { UploadIcon } from 'lucide-react';
import type { ReactNode } from 'react';
import { createContext, useContext } from 'react';
import type { DropEvent, DropzoneOptions, FileRejection } from 'react-dropzone';
import { useDropzone } from 'react-dropzone';
import { Button } from '@/components/ui/button';
import { cn } from '@/lib/utils';

type DropzoneContextType = {
  src?: File[];
  accept?: DropzoneOptions['accept'];
  maxSize?: DropzoneOptions['maxSize'];
  minSize?: DropzoneOptions['minSize'];
  maxFiles?: DropzoneOptions['maxFiles'];
};

const renderBytes = (bytes: number) => {
  const units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB'];
  let size = bytes;
  let unitIndex = 0;

  while (size >= 1024 && unitIndex < units.length - 1) {
    size /= 1024;
    unitIndex++;
  }

  return `${size.toFixed(2)}${units[unitIndex]}`;
};

const DropzoneContext = createContext<DropzoneContextType | undefined>(
  undefined
);

export type DropzoneProps = Omit<DropzoneOptions, 'onDrop'> & {
  src?: File[];
  className?: string;
  onDrop?: (
    acceptedFiles: File[],
    fileRejections: FileRejection[],
    event: DropEvent
  ) => void;
  children?: ReactNode;
};

export const Dropzone = ({
  accept,
  maxFiles = 1,
  maxSize,
  minSize,
  onDrop,
  onError,
  disabled,
  src,
  className,
  children,
  ...props
}: DropzoneProps) => {
  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    accept,
    maxFiles,
    maxSize,
    minSize,
    onError,
    disabled,
    onDrop: (acceptedFiles, fileRejections, event) => {
      if (fileRejections.length > 0) {
        const message = fileRejections.at(0)?.errors.at(0)?.message;
        onError?.(new Error(message));
        return;
      }

      onDrop?.(acceptedFiles, fileRejections, event);
    },
    ...props,
  });

  return (
    <DropzoneContext.Provider
      key={JSON.stringify(src)}
      value={{ src, accept, maxSize, minSize, maxFiles }}
    >
      <Button
        className={cn(
          'relative h-auto w-full flex-col overflow-hidden p-8',
          isDragActive && 'outline-none ring-1 ring-ring',
          className
        )}
        disabled={disabled}
        type="button"
        variant="outline"
        {...getRootProps()}
      >
        <input {...getInputProps()} disabled={disabled} />
        {children}
      </Button>
    </DropzoneContext.Provider>
  );
};

const useDropzoneContext = () => {
  const context = useContext(DropzoneContext);

  if (!context) {
    throw new Error('useDropzoneContext must be used within a Dropzone');
  }

  return context;
};

export type DropzoneContentProps = {
  children?: ReactNode;
  className?: string;
};

const maxLabelItems = 3;

export const DropzoneContent = ({
  children,
  className,
}: DropzoneContentProps) => {
  const { src } = useDropzoneContext();

  if (!src) {
    return null;
  }

  if (children) {
    return children;
  }

  return (
    <div className={cn('flex flex-col items-center justify-center', className)}>
      <div className="flex size-8 items-center justify-center rounded-md bg-muted text-muted-foreground">
        <UploadIcon size={16} />
      </div>
      <p className="my-2 w-full truncate font-medium text-sm">
        {src.length > maxLabelItems
          ? `${new Intl.ListFormat('en').format(
              src.slice(0, maxLabelItems).map((file) => file.name)
            )} and ${src.length - maxLabelItems} more`
          : new Intl.ListFormat('en').format(src.map((file) => file.name))}
      </p>
      <p className="w-full text-wrap text-muted-foreground text-xs">
        Drag and drop or click to replace
      </p>
    </div>
  );
};

export type DropzoneEmptyStateProps = {
  children?: ReactNode;
  className?: string;
};

export const DropzoneEmptyState = ({
  children,
  className,
}: DropzoneEmptyStateProps) => {
  const { src, accept, maxSize, minSize, maxFiles } = useDropzoneContext();

  if (src) {
    return null;
  }

  if (children) {
    return children;
  }

  let caption = '';

  if (accept) {
    caption += 'Accepts ';
    caption += new Intl.ListFormat('en').format(Object.keys(accept));
  }

  if (minSize && maxSize) {
    caption += ` between ${renderBytes(minSize)} and ${renderBytes(maxSize)}`;
  } else if (minSize) {
    caption += ` at least ${renderBytes(minSize)}`;
  } else if (maxSize) {
    caption += ` less than ${renderBytes(maxSize)}`;
  }

  return (
    <div className={cn('flex flex-col items-center justify-center', className)}>
      <div className="flex size-8 items-center justify-center rounded-md bg-muted text-muted-foreground">
        <UploadIcon size={16} />
      </div>
      <p className="my-2 w-full truncate text-wrap font-medium text-sm">
        Upload {maxFiles === 1 ? 'a file' : 'files'}
      </p>
      <p className="w-full truncate text-wrap text-muted-foreground text-xs">
        Drag and drop or click to upload
      </p>
      {caption && (
        <p className="text-wrap text-muted-foreground text-xs">{caption}.</p>
      )}
    </div>
  );
};
</file>

<file path="src/components/ui/switch.tsx">
"use client"

import * as React from "react"
import * as SwitchPrimitive from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

function Switch({
  className,
  ...props
}: React.ComponentProps<typeof SwitchPrimitive.Root>) {
  return (
    <SwitchPrimitive.Root
      data-slot="switch"
      className={cn(
        "peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <SwitchPrimitive.Thumb
        data-slot="switch-thumb"
        className={cn(
          "bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0"
        )}
      />
    </SwitchPrimitive.Root>
  )
}

export { Switch }
</file>

<file path="src/components/ui/table.tsx">
"use client"

import * as React from "react"

import { cn } from "@/lib/utils"

function Table({ className, ...props }: React.ComponentProps<"table">) {
  return (
    <div
      data-slot="table-container"
      className="relative w-full overflow-x-auto"
    >
      <table
        data-slot="table"
        className={cn("w-full caption-bottom text-sm", className)}
        {...props}
      />
    </div>
  )
}

function TableHeader({ className, ...props }: React.ComponentProps<"thead">) {
  return (
    <thead
      data-slot="table-header"
      className={cn("[&_tr]:border-b", className)}
      {...props}
    />
  )
}

function TableBody({ className, ...props }: React.ComponentProps<"tbody">) {
  return (
    <tbody
      data-slot="table-body"
      className={cn("[&_tr:last-child]:border-0", className)}
      {...props}
    />
  )
}

function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn(
        "bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",
        className
      )}
      {...props}
    />
  )
}

function TableRow({ className, ...props }: React.ComponentProps<"tr">) {
  return (
    <tr
      data-slot="table-row"
      className={cn(
        "hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",
        className
      )}
      {...props}
    />
  )
}

function TableHead({ className, ...props }: React.ComponentProps<"th">) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        "text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCell({ className, ...props }: React.ComponentProps<"td">) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        "p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCaption({
  className,
  ...props
}: React.ComponentProps<"caption">) {
  return (
    <caption
      data-slot="table-caption"
      className={cn("text-muted-foreground mt-4 text-sm", className)}
      {...props}
    />
  )
}

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}
</file>

<file path="src/components/ui/textarea.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Textarea({ className, ...props }: React.ComponentProps<"textarea">) {
  return (
    <textarea
      data-slot="textarea"
      className={cn(
        "border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className
      )}
      {...props}
    />
  )
}

export { Textarea }
</file>

<file path="src/components/vote.tsx">
'use client';

import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
} from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Check, X, Clock } from 'lucide-react';

const VotePage = () => {
  return (
      <div>
        {/* Main Card */}
        <Card className='shadow-lg'>
          <CardHeader className='grid grid-cols-2 gap-4 border-b pb-4'>
            <CardTitle>Case Info</CardTitle>
            <CardTitle className='border-l pl-4'>Taxpayer Details</CardTitle>
          </CardHeader>
          <CardContent className='pt-6 grid grid-cols-2 gap-4'>
            {/* Case Info Section */}
            <div className='space-y-4 pr-4'>
              <div className='grid grid-cols-2'>
                <div className='text-sm text-gray-500'>Case ID</div>
                <div className='text-sm font-medium'>Cuid - 2023-12343</div>
              </div>
              <div className='grid grid-cols-2'>
                <div className='text-sm text-gray-500'>Tax Type</div>
                <div className='text-sm font-medium'>EBM Fines</div>
              </div>
              <div className='grid grid-cols-2'>
                <div className='text-sm text-gray-500'>Tax to be paid</div>
                <div className='text-sm font-semibold text-red-500'>300,000 frw</div>
              </div>
            </div>

            {/* Taxpayer Details Section */}
            <div className='space-y-4 border-l pl-4'>
              <div className='grid grid-cols-2'>
                <div className='text-sm text-gray-500'>Taxpayer Name</div>
                <div className='text-sm font-medium'>Tonie Justin</div>
              </div>
              <div className='grid grid-cols-2'>
                <div className='text-sm text-gray-500'>Taxpayer TIN</div>
                <div className='text-sm font-medium'>TIN-123456790</div>
              </div>
              <div className='grid grid-cols-2'>
                <div className='text-sm text-gray-500'>Tel</div>
                <div className='text-sm font-medium'>+(250) 567 567 789</div>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Action Buttons */}
        <div className='flex justify-center space-x-4 pt-4'>
          <Button variant='outline' className='flex items-center space-x-2 bg-gray-400 text-[#255069]'>
            <Clock className='h-4 w-4 text-gray-500' />
            <span>Abstain</span>
          </Button>
          <Button variant='destructive' className='flex items-center space-x-2'>
            <X className='h-4 w-4' />
            <span>Unjustify</span>
          </Button>
          <Button className='bg-green-600 hover:bg-green-700 flex items-center space-x-2'>
            <Check className='h-4 w-4' />
            <span>Justify</span>
          </Button>
        </div>
      </div>
  );
};

export default VotePage;
</file>

<file path="src/components/yourcases.tsx">
"use client";

import { useState, useEffect } from "react";
import Link from 'next/link';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import {
  Pagination,
  PaginationContent,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
} from "@/components/ui/pagination";
import api from "@/lib/api"; 

interface Case {
  caseId: string;
  taxPayer: string; 
  submittedAt: string;
  daysLeft: string;
  status: "SUBMITTED" | "DISCUSSED"; 
}

export default function YourCasesPage() {
  const [allCases, setAllCases] = useState<Case[]>([]);
  const [loading, setLoading] = useState<boolean>(true);
  const [error, setError] = useState<string | null>(null);

  const [searchQuery, setSearchQuery] = useState("");
  const [showFilters, setShowFilters] = useState(false);
  const [statusFilter, setStatusFilter] = useState("All");

  useEffect(() => {
    const fetchCases = async () => {
      try {
        setLoading(true);
        setError(null);
        const token = localStorage.getItem("staff_token");
        if (!token) {
          throw new Error("Authentication token not found. Please log in again.");
        }

        const response = await api.get("/api/v1/my-cases/my-cases", {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        });

        if (response.data && response.data.data) {
          setAllCases(response.data.data);
        } else {
          setAllCases([]);
        }
      } catch (err: any) {
        if (err.response) {
          setError(`Error: ${err.response.data.message || 'Failed to fetch cases.'}`);
        } else {
          setError(err.message || "An unknown error occurred.");
        }
        console.error(err);
      } finally {
        setLoading(false);
      }
    };

    fetchCases();
  }, []); 

  const handleFilterByStatus = (status: string) => {
    setStatusFilter(status);
  };

  const filteredCases = allCases.filter((_case) => {
    const matchesSearch =
      _case.caseId.toLowerCase().includes(searchQuery.toLowerCase()) ||
      _case.taxPayer.toLowerCase().includes(searchQuery.toLowerCase());

    const matchesStatus =
      statusFilter === "All" || _case.status === statusFilter;

    return matchesSearch && matchesStatus;
  });

  const getStatusStyle = (status: string) => {
    switch (status) {
      case "SUBMITTED":
        return "bg-blue-100 text-blue-800";
      case "DISCUSSED":
        return "bg-green-100 text-green-800";
      default:
        return "bg-gray-100 text-gray-800";
    }
  };

  return (
    <div className="container mx-auto p-4 max-w-4xl">
      <div className="space-y-2 mb-8">
        <h1 className="text-3xl font-bold">Your cases</h1>
        <p className="text-gray-600">Track explanatory note for each of your case</p>
      </div>

      <div className="flex items-center space-x-2 mb-4 ">
        <Input
          placeholder="Search by Case ID or TIN..."
          className="max-w-xs flex-grow bg-white"
          value={searchQuery}
          onChange={(e) => setSearchQuery(e.target.value)}
        />
        <Button
          variant="outline"
          size="icon"
          className="h-10 w-10"
          onClick={() => setShowFilters(!showFilters)}
        >
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
            <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
        </Button>
      </div>
      
      {showFilters && (
        <div className="rounded-lg border p-4 mb-4 bg-white">
          <h3 className="font-semibold mb-2 ">Filter by Status</h3>
          <div className="flex space-x-2">
            <Button variant="secondary" className="hover:bg-[#18668D] hover:text-white" onClick={() => handleFilterByStatus("All")}>All</Button>
            <Button variant="secondary" className="hover:bg-[#18668D] hover:text-white" onClick={() => handleFilterByStatus("SUBMITTED")}>Submitted</Button>
            <Button variant="secondary" className="hover:bg-[#18668D] hover:text-white" onClick={() => handleFilterByStatus("DISCUSSED")}>Discussed</Button>
          </div>
        </div>
      )}

      <div className="rounded-lg border bg-white">
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>Case ID</TableHead>
              <TableHead>Tax Payer TIN</TableHead>
              <TableHead>Submitted At</TableHead>
              <TableHead>Days left</TableHead>
              <TableHead>Explanatory note</TableHead>
              <TableHead>Status</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {loading ? (
              <TableRow>
                <TableCell colSpan={6} className="h-24 text-center">
                  Loading cases...
                </TableCell>
              </TableRow>
            ) : error ? (
              <TableRow>
                <TableCell colSpan={6} className="h-24 text-center text-red-600">
                  {error}
                </TableCell>
              </TableRow>
            ) : filteredCases.length > 0 ? (
              filteredCases.map((_case, index) => (
                <TableRow key={index}>
                  <TableCell className="font-medium">{_case.caseId}</TableCell>
                  <TableCell>{_case.taxPayer}</TableCell>
                  <TableCell>{_case.submittedAt}</TableCell>
                  <TableCell>{_case.daysLeft} days</TableCell>
                  <TableCell className="text-blue-600 underline cursor-pointer">
                    <Link href={`/cases/all-cases/explanatory-note?caseId=${_case.caseId}`}>
                      view note
                    </Link>
                  </TableCell>
                  <TableCell>
                    <span className={`px-2 py-1 rounded-full text-xs font-semibold ${getStatusStyle(_case.status)}`}>
                      {_case.status}
                    </span>
                  </TableCell>
                </TableRow>
              ))
            ) : (
              <TableRow>
                <TableCell colSpan={6} className="h-24 text-center">
                  No cases found.
                </TableCell>
              </TableRow>
            )}
          </TableBody>
        </Table>
      </div>

      <div className="flex justify-between items-center mt-4 text-sm text-gray-500">
        <span>Showing {filteredCases.length} of {allCases.length} cases</span>
        <Pagination className="w-auto mx-0">
          <PaginationContent>
            <PaginationItem>
              <PaginationPrevious href="#" />
            </PaginationItem>
            <PaginationItem>
              <PaginationLink href="#" isActive>
                1
              </PaginationLink>
            </PaginationItem>
            <PaginationItem>
              <PaginationNext href="#" />
            </PaginationItem>
          </PaginationContent>
        </Pagination>
      </div>
    </div>
  );
}
</file>

<file path="src/lib/api.ts">
// frontend/src/lib/api.ts

import axios from "axios";

const api = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL,
  headers: {
    "Content-Type": "application/json",
  },
  withCredentials: true, // Include cookies for cross-origin requests
});

// Request Interceptor: Attaches the access token to every outgoing request.
api.interceptors.request.use(
  (config) => {
    if (typeof window !== "undefined") {
      // Skip for auth endpoints
      const authEndpoints = ['/api/v1/auth/login', '/api/v1/auth/refresh-token'];
      if (!authEndpoints.some(endpoint => config.url.includes(endpoint))) {
        const token = localStorage.getItem("staff_token");
        if (token) {
          config.headers.Authorization = `Bearer ${token}`;
        }
      }
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// Response Interceptor: The core logic for handling token expiration.
api.interceptors.response.use(
  (response) => {
    // If the request was successful, just return the response.
    return response;
  },
  async (error) => {
    const originalRequest = error.config;
        const isMeetingAuthEndpoint = originalRequest.url.includes('/api/v1/meetings/create');


    // Check if the error is due to an expired access token (e.g., a 401 or 500 error from the filter)
    // and that we haven't already tried to refresh the token for this request.
    if (error.response?.status === 401 && !originalRequest._retry && !isMeetingAuthEndpoint) {
      originalRequest._retry = true; // Mark the request to prevent infinite retry loops.

      try {
        const refreshToken = localStorage.getItem("staff_refresh_token");

        // If there's no refresh token, the user must log in.
        if (!refreshToken) {
          localStorage.clear();
          window.location.href = '/staff-login';
          return Promise.reject(new Error("No refresh token available."));
        }

        // Attempt to get a new access token using the refresh token.
        const response = await axios.post(
          `${process.env.NEXT_PUBLIC_API_URL}/api/v1/auth/refresh-token`,
          { refreshToken: refreshToken }
        );
        
        const { accessToken: newAccessToken, refreshToken: newRefreshToken } = response.data;

        // If successful, update the tokens in local storage.
        localStorage.setItem("staff_token", newAccessToken);
        localStorage.setItem("staff_refresh_token", newRefreshToken);

        // Update the header on the original request and retry it.
        originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;
        return api(originalRequest);
        
      } catch (refreshError) {
        // THIS IS THE CRITICAL BLOCK FOR YOUR REQUIREMENT
        // This block will execute if the refresh token API call fails for ANY reason.
        
        console.error("Refresh token is invalid or expired. Logging out.", refreshError);

        // 1. Delete all tokens (access and refresh) from local storage.
        localStorage.clear(); 

        // 2. Redirect the user to the login page to start over.
        window.location.href = '/staff-login'; 

        // 3. Reject the promise to stop the original failed request.
        return Promise.reject(refreshError);
      }
    }

    // For any other errors, just pass them along.
    return Promise.reject(error);
  }
);

export default api;
</file>

<file path="src/lib/firebase.ts">
import { initializeApp, getApps, getApp } from "firebase/app";
import { getStorage } from "firebase/storage";

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,
  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,
  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,
  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,
};

// Initialize Firebase
const app = !getApps().length ? initializeApp(firebaseConfig) : getApp();
const storage = getStorage(app);

export { app, storage };
</file>

<file path="src/lib/utils.ts">
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
</file>

</files>
</file>

<file path="frontend/src/app/admin/page.tsx">
"use client";
import AdminGuard from "@/components/AdminGuard";
import { AnalyticsDashboard } from "@/components/AnalyticsDashboard";
import AuthGuard from "@/components/authguard";
import Navbar from "@/components/navbar";
import Sidebar from "@/components/sidebar";

export default function AdminHomePage() {
  return (
    <AuthGuard>
      <AdminGuard>
    <div className="flex flex-col min-h-screen bg-gray-50">
      <main className="flex flex-1">
        <Sidebar />
        <div className="w-full px-8 py-6">
          <AnalyticsDashboard />
        </div>
      </main>
    </div>
    </AdminGuard>
    </AuthGuard>
  );
}
</file>

<file path="frontend/src/app/cases/all-cases/explanatory-note/page.tsx">
"use client";
import Sidebar from "@/components/sidebar";
import { ExplanatoryNoteGenerator } from "@/components/ExplanatoryNoteGenerator"; 
import AuthGuard from "@/components/authguard";

export default function ExplanatoryNotePage() {
  return (
    <AuthGuard>
      <div className="flex flex-col min-h-screen">
        <main className="flex flex-1">
          <Sidebar />
          <div className="w-full px-16 bg-[#F9FAFB] py-8">
            <ExplanatoryNoteGenerator />
          </div>
        </main>
      </div>
    </AuthGuard>
  );
}
</file>

<file path="frontend/src/app/cases/all-cases/page.tsx">
"use client";
import Sidebar from "@/components/sidebar";
import YourCasesPage from "@/components/yourcases";
import AuthGuard from "@/components/authguard";

export default function AllCasesPage() {

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className=" w-full px-16 bg-[#F9FAFB]">
         <YourCasesPage/>
        </div>
      </main>
    
    </div>
    </AuthGuard>
  );
}
</file>

<file path="frontend/src/app/cases/new-case/appealpoint/page.tsx">
"use client";
import Sidebar from "@/components/sidebar";
import { AppealPointForm } from "@/components/appealpoint";
import AuthGuard from "@/components/authguard";

export default function AppealPointPage() {

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className=" w-full px-16 bg-[#F9FAFB]">
          <h1 className="text-2xl font-bold text-gray-900 mt-2">
                Details
            </h1>
        <p className="text-lg text-gray-500 mb-12">
            provide appeal point details
        </p>
           <AppealPointForm/>
        </div>
      </main>
    
    </div>
    </AuthGuard>
  );
}
</file>

<file path="frontend/src/app/cases/new-case/page.tsx">
"use client";

import { Suspense } from 'react';
import { useSearchParams } from 'next/navigation';
import Sidebar from "@/components/sidebar";
import { TaxForm } from "@/components/taxForm";
import AuthGuard from "@/components/authguard";

// A wrapper component is the standard Next.js pattern for using search params.
// It ensures that only this part of the page is client-rendered and waits for the URL data.
function NewCaseForm() {
  const searchParams = useSearchParams();
  const caseIdToEdit = searchParams.get('editCaseId');

  // Determine if we are in "edit" mode
  const isEditMode = !!caseIdToEdit;

  return (
    <>
      <h1 className="text-2xl font-bold text-gray-900 mt-2">
        {/* Change the title based on the mode */}
        {isEditMode ? `Edit Case: ${caseIdToEdit}` : "Submit a New Case"}
      </h1>
      <p className="text-lg text-gray-500 mb-12">
        {isEditMode ? "Update the details below." : "Fill out the form below to generate an explanatory note."}
      </p>
      
      {/* Pass the caseIdToEdit prop to your TaxForm component */}
      <TaxForm caseIdToEdit={caseIdToEdit} />
    </>
  );
}

export default function NewCasePage() {
  return (
    <AuthGuard>
      <div className="flex flex-col min-h-screen">
        <main className="flex flex-1">
          <Sidebar/>
          <div className="w-full px-16 pt-6 bg-[#F9FAFB]">
            {/* Wrap the component in Suspense as required by Next.js for useSearchParams */}
            <Suspense fallback={<div>Loading form...</div>}>
              <NewCaseForm />
            </Suspense>
          </div>
        </main>
      </div>
    </AuthGuard>
  );
}
</file>

<file path="frontend/src/app/cases/page.tsx">
"use client";

import Link from "next/link";
import { useState, useEffect } from "react";
import Sidebar from "@/components/sidebar";
import { Card, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { PlusCircle, FolderKanban } from "lucide-react";
import AuthGuard from "@/components/authguard";

export default function CasesPage() {
  const [userName, setUserName] = useState("User");

  // Load user name from localStorage
  useEffect(() => {
    const name = localStorage.getItem("staff_name");
    if (name) setUserName(name);
  }, []);

  return (
    <AuthGuard>
      <div className="flex flex-col min-h-screen">
        <main className="flex flex-1">
          <Sidebar />
          <div className="w-full pt-6 bg-[#F9FAFB]">
            <h1 className="text-4xl font-bold text-center text-gray-900 mt-2">
              Welcome, {userName}
            </h1>
            <p className="text-lg text-center text-gray-500 mb-12">
              What would you like to do today?
            </p>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-2xl mx-auto">
              <Link href={"/cases/new-case"}>
                <Card className="text-center p-6 transition-transform transform hover:scale-105 hover:shadow-lg">
                  <CardHeader className="flex flex-col items-center p-0">
                    <div className="p-4 rounded-full bg-yellow-100 text-yellow-600 mb-4">
                      <PlusCircle className="h-10 w-10" />
                    </div>
                    <CardTitle className="text-xl font-semibold mb-2">Submit New Case</CardTitle>
                    <CardDescription className="text-gray-500">
                      Generate an explanatory note for your case.
                    </CardDescription>
                  </CardHeader>
                </Card>
              </Link>

              <Link href={"/cases/all-cases"}>
                <Card className="text-center p-6 transition-transform transform hover:scale-105 hover:shadow-lg">
                  <CardHeader className="flex flex-col items-center p-0">
                    <div className="p-4 rounded-full bg-blue-100 text-blue-600 mb-4">
                      <FolderKanban className="h-10 w-10" />
                    </div>
                    <CardTitle className="text-xl font-semibold mb-2">View All My Cases</CardTitle>
                    <CardDescription className="text-gray-500">
                      Check the status of your existing cases.
                    </CardDescription>
                  </CardHeader>
                </Card>
              </Link>
            </div>
          </div>
        </main>
      </div>
    </AuthGuard>
  );
}
</file>

<file path="frontend/src/app/chat/page.tsx">
"use client";
import Sidebar from "@/components/sidebar";
import AuthGuard from "@/components/authguard";
import { Card, CardContent } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Video } from "lucide-react";
import { MdVideoCall } from "react-icons/md";
import { useState } from "react";
import api from "@/lib/api";

import { useEffect } from "react";

export default function ChatPage() {
  const [meetingUrl, setMeetingUrl] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const handleNewMeeting = async () => {
    setIsLoading(true);
    setError(null);
    try {
      const response = await api.post('/api/v1/meetings/create');
      if (response.data && response.data.meetLink) {
        const link = response.data.meetLink;
        setMeetingUrl(link);
        window.open(link, '_blank');
        // Clear pending flag on success
        localStorage.removeItem("pendingMeeting");
      } else {
        throw new Error("Did not receive a meeting link from the server.");
      }
    } catch (err: any) {
      console.error("Failed to create meeting:", err);
      if (err.response && err.response.status === 401) {
        // Remember we wanted to create a meeting
        localStorage.setItem("pendingMeeting", "true");
        window.location.href = `${process.env.NEXT_PUBLIC_API_URL}/oauth2/authorization/google`;
      } else {
        setError("Failed to create a new meeting. Please try again.");
      }
    } finally {
      setIsLoading(false);
    }
  };

  // Auto-create meeting after Google login redirect
  useEffect(() => {
    const pending = localStorage.getItem("pendingMeeting");
    if (pending === "true" && !meetingUrl && !isLoading) {
      handleNewMeeting();
    }
  }, []);

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className="flex flex-1 items-center justify-center">
      <Card className="w-full max-w-lg p-8 shadow-xl rounded-2xl">
        <CardContent className="flex flex-col items-center text-center p-0">
          <h1 className="text-3xl font-bold text-gray-800">Video Calls and meetings</h1>
          <p className="mt-2 text-gray-500">Connect, Share and Collaborate</p>
          
          <div className="flex items-center w-full max-w-md mt-8 space-x-2">
            <Button variant="outline" size="icon" className="h-10 w-10 text-[#0a608b]"><MdVideoCall size={32} /></Button>
            <Input type="text" placeholder="Enter a link to join" className="h-10" />
            <Button className="h-10 bg-[#0a608b] hover:bg-[#084a6e]">Join</Button>
          </div>

          <div className="flex items-center w-full max-w-md my-6"><div className="flex-grow border-t border-gray-200"></div><span className="mx-4 text-xs text-gray-400">OR</span><div className="flex-grow border-t border-gray-200"></div></div>
          
          <Button onClick={handleNewMeeting} disabled={isLoading} className="h-10 bg-[#0a608b] hover:bg-[#084a6e] px-6">
            <Video className="mr-2 h-4 w-4" />
            {isLoading ? "Creating..." : "New meeting"}
          </Button>
          {error && <p className="mt-4 text-sm text-red-600">{error}</p>}
        </CardContent>
      </Card>
    </div>
      </main>
    
    </div>
    </AuthGuard>
  );
}
</file>

<file path="frontend/src/app/globals.css">
@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar: var(--sidebar);
  --color-chart-5: var(--chart-5);
  --color-chart-4: var(--chart-4);
  --color-chart-3: var(--chart-3);
  --color-chart-2: var(--chart-2);
  --color-chart-1: var(--chart-1);
  --color-ring: var(--ring);
  --color-input: var(--input);
  --color-border: var(--border);
  --color-destructive: var(--destructive);
  --color-accent-foreground: var(--accent-foreground);
  --color-accent: var(--accent);
  --color-muted-foreground: var(--muted-foreground);
  --color-muted: var(--muted);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-secondary: var(--secondary);
  --color-primary-foreground: var(--primary-foreground);
  --color-primary: var(--primary);
  --color-popover-foreground: var(--popover-foreground);
  --color-popover: var(--popover);
  --color-card-foreground: var(--card-foreground);
  --color-card: var(--card);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
}

:root {
  --radius: 0.625rem;
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.97 0 0);
  --secondary-foreground: oklch(0.205 0 0);
  --muted: oklch(0.97 0 0);
  --muted-foreground: oklch(0.556 0 0);
  --accent: oklch(0.97 0 0);
  --accent-foreground: oklch(0.205 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --border: oklch(0.922 0 0);
  --input: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: oklch(0.205 0 0);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.205 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.205 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.922 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.704 0.191 22.216);
  --border: oklch(1 0 0 / 10%);
  --input: oklch(1 0 0 / 15%);
  --ring: oklch(0.556 0 0);
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(1 0 0 / 10%);
  --sidebar-ring: oklch(0.556 0 0);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}
</file>

<file path="frontend/src/app/layout.tsx">
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata: Metadata = {
  title: "Rwanda Revenue Authority",
  description: "Tax claim review system",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased`}
      suppressHydrationWarning>
        {children}
      </body>
    </html>
  );
}
</file>

<file path="frontend/src/app/meetings/case-details/page.tsx">
"use client";

import { Suspense } from 'react';
import Sidebar from "@/components/sidebar";
import { CaseDetailsPage } from "@/components/casedetails";
import { useSearchParams } from 'next/navigation';
import AuthGuard from "@/components/authguard";

// A wrapper component to access search params
function CaseDetailsContent() {
  const searchParams = useSearchParams();
  const caseId = searchParams.get('caseId');

  if (!caseId) {
    return (
      <div className="text-center text-red-500">
        Error: Case ID is missing from the URL.
      </div>
    );
  }

  return <CaseDetailsPage caseId={caseId} />;
}

export default function MeetingsPage() {
  return (
    <AuthGuard>
      <div className="flex flex-col min-h-screen">
        <main className="flex flex-1">
          <Sidebar />
          <div className="w-full px-16 bg-[#F9FAFB]">
            <h1 className="text-2xl font-bold text-gray-900 mt-2">
              Case Details
            </h1>
            <p className="text-lg text-gray-500 mb-12">
              Look the Claim in details
            </p>
            {/* Suspense is good practice for components that read search params */}
            <Suspense fallback={<div>Loading...</div>}>
              <CaseDetailsContent />
            </Suspense>
          </div>
        </main>
      </div>
    </AuthGuard>
  );
}
</file>

<file path="frontend/src/app/meetings/case-details/tax-type-details/[appealId]/page.tsx">
"use client";

import Sidebar from "@/components/sidebar";
import AuthGuard from "@/components/authguard";
import { AppealPointDetails } from "@/components/AppealPointDetails";
import { useSearchParams } from "next/navigation";
import { Suspense, use } from "react"; // Added 'use' import

function AppealPointPageContent({ appealId }: { appealId: string }) {
  const searchParams = useSearchParams();
  const caseId = searchParams.get('caseId');

  if (!caseId) {
    return <div className="text-red-500 font-bold p-8">Error: Case ID is missing from the URL.</div>;
  }
  
  return <AppealPointDetails caseId={caseId} appealId={appealId} />;
}

// Define params as a Promise
export default function DynamicAppealDetailsPage({ params }: { params: Promise<{ appealId: string }> }) {
  // Unwrap the params using 'use'
  const resolvedParams = use(params);

  return (
    <AuthGuard>
      <div className="flex flex-col min-h-screen">
        <main className="flex flex-1">
          <Sidebar />
          <div className="w-full px-16 py-6 bg-gray-50">
             <Suspense fallback={<div className="text-center p-8">Loading...</div>}>
                <AppealPointPageContent appealId={resolvedParams.appealId} />
             </Suspense>
          </div>
        </main>
      </div>
    </AuthGuard>
  );
}
</file>

<file path="frontend/src/app/meetings/case-details/tax-type-details/page.tsx">
"use client";

import { Suspense } from 'react';
import Sidebar from "@/components/sidebar";
import AuthGuard from "@/components/authguard";
import { TaxTypeDetails } from '@/components/TaxTypeDetails'; 
import { useSearchParams } from 'next/navigation';


function TaxTypeDetailsContent() {
  const searchParams = useSearchParams();
  const caseId = searchParams.get('caseId');
  const taxAuditedId = searchParams.get('taxAuditedId');

  if (!caseId || !taxAuditedId) {
    return (
      <div className="text-center text-red-500 font-semibold p-8">
        Error: Missing required case information in the URL.
      </div>
    );
  }

  return <TaxTypeDetails caseId={caseId} taxAuditedId={taxAuditedId} />;
}

export default function NestedTaxTypeDetailsPage() {
  return (
    <AuthGuard>
      <div className="flex flex-col min-h-screen">
        <main className="flex flex-1">
          <Sidebar />
          <div className="w-full px-16 py-6 bg-[#F9FAFB]">
            <Suspense fallback={<div className="text-center">Loading Details...</div>}>
              <TaxTypeDetailsContent />
            </Suspense>
          </div>
        </main>
      </div>
    </AuthGuard>
  );
}
</file>

<file path="frontend/src/app/meetings/page.tsx">
"use client";
import Sidebar from "@/components/sidebar";
import CasesPage from "@/components/cases";
import AuthGuard from "@/components/authguard";

export default function MeetingsPage() {

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className=" w-full px-16 bg-[#F9FAFB]">
         <CasesPage/>
        </div>
      </main>
    
    </div>
    </AuthGuard>
  );
}
</file>

<file path="frontend/src/app/page.tsx">
import { redirect } from "next/navigation";

export default function Home() {
  redirect("/staff-login"); // sends users to login by default
}
</file>

<file path="frontend/src/app/pre-appeal/page.tsx">
"use client";

import { Suspense } from 'react';
import Sidebar from "@/components/sidebar";
import AuthGuard from "@/components/authguard";
import PreAppealCases from "@/components/preappealcases";

export default function PreAppealPage() {
  return (
    <AuthGuard>
      <div className="flex flex-col min-h-screen">
        <main className="flex flex-1">
          <Sidebar/>
          <div className="w-full px-16 pt-6 bg-[#F9FAFB]">
            <Suspense fallback={<div>Loading pre-appeal cases...</div>}>
              <PreAppealCases />
            </Suspense>
          </div>
        </main>
      </div>
    </AuthGuard>
  );
}
</file>

<file path="frontend/src/app/profile/page.tsx">
"use client";
import Link from "next/link";
import Navbar from "@/components/navbar";
import Sidebar from "@/components/sidebar";
import { TaxForm } from "@/components/taxForm";
import YourCasesPage from "@/components/yourcases";
import ProfilePage from "@/components/profile";
import AuthGuard from "@/components/authguard";

export default function AllCasesPage() {

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className=" w-full px-16 bg-[#F9FAFB]">
          <ProfilePage/>
        </div>
      </main>
    
    </div>
    </AuthGuard>
  );
}
</file>

<file path="frontend/src/app/reports/new-minutes/page.tsx">
"use client";

import Sidebar from "@/components/sidebar";
import { MinutesForm } from "@/components/minutesform";
import AuthGuard from "@/components/authguard";

export default function CasesPage() {

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className=" w-full px-16 bg-[#F9FAFB]">
                    <h1 className="text-2xl font-bold text-gray-900 mt-2">
                        Meeting Minutes
                    </h1>
                <p className="text-lg text-gray-500 mb-12">
                    Fill out the  form bellow to generate a meeting minutes
                </p>
                <MinutesForm/>
                </div>
      </main>
    
    </div>
    </AuthGuard>
  );
}
</file>

<file path="frontend/src/app/reports/page.tsx">
"use client";
import Link from "next/link";
import Navbar from "@/components/navbar";
import Sidebar from "@/components/sidebar";
import { Card, CardHeader, CardTitle, CardDescription } from "@/components/ui/card";
import { PlusCircle, FolderKanban } from "lucide-react";
import MeetingMinutesPage from "@/components/meetingminutes";
import AuthGuard from "@/components/authguard";

export default function CasesPage() {

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className="w-full bg-[#F9FAFB]">
          <MeetingMinutesPage/>
        </div>
      </main>
    
    </div>
    </AuthGuard>
  );
}
</file>

<file path="frontend/src/app/staff-login/page.tsx">
"use client";

import { useState, useEffect, FormEvent } from "react";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Checkbox } from "@/components/ui/checkbox";
import Link from "next/link";
import api from "@/lib/api";
import { useRouter } from "next/navigation";
import { log } from "console";


export default function StaffLoginPage() {
  const router = useRouter();

  const [email, setEmail] = useState<string>("");
  const [password, setPassword] = useState<string>("");
  const [rememberMe, setRememberMe] = useState<boolean>(false);
  const [errorMsg, setErrorMsg] = useState<string>("");
  const [loading, setLoading] = useState<boolean>(false);
    

  // Load remembered credentials
  useEffect(() => {
    const remembered = localStorage.getItem("staff_login_remember");
    if (remembered) {
      const savedData = JSON.parse(remembered);
      setEmail(savedData.email || "");
      setPassword(savedData.password || "");
      setRememberMe(true);
    }
  }, []);

  const handleSubmit = async (e: FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    setErrorMsg("");

    if (!email || !password) {
      setErrorMsg("Email and password are required.");
      return;
    }

    setLoading(true);
    try {
  const res = await api.post("/api/v1/auth/login", { email, password });
  console.log(api);
  

  // Save token if returned
  if (res.data.accessToken) {
    localStorage.setItem("staff_token", res.data.accessToken);
  }

  if (res.data.refreshToken) { 
    localStorage.setItem("staff_refresh_token", res.data.refreshToken); 
  }
  

  if (res.data.fullNames) localStorage.setItem("staff_name", res.data.fullNames);
  if (res.data.id) {
  localStorage.setItem("staff_id", res.data.id);
  }
  if (res.data.role) {
      localStorage.setItem("staff_role", res.data.role); 
    }

  
  if (rememberMe) {
    localStorage.setItem(
      "staff_login_remember",
      JSON.stringify({ email, password })
    );
  } else {
    localStorage.removeItem("staff_login_remember");
  }

  if (res.data.role === "COMMITTEE_LEADER") {
    router.push("/admin");
  } else {
    router.push("/cases");
  }

} catch (error: any) {
  if (error.response && error.response.data) {
    setErrorMsg(error.response.data.message || "Login failed.");
  } else {
    setErrorMsg(error.message || "Login failed.");
  }
} finally {
  setLoading(false);
}
  };

  return (
    <div className="flex min-h-screen">
      {/* Left side */}
      <div className="flex w-1/2 flex-col items-center justify-center px-10">
        {/* Logo */}
        <div className="flex flex-row items-center">
          <img src="/Rralogo.png" alt="Logo" className="h-14 w-auto"/>
          <h1 className="text-2xl font-bold text-[#1d3557]">
            Tax Claim Management System
          </h1>
        </div>

        <div className="flex space-x-2 mb-4">
          <div className="h-[6px] w-40 rounded-full bg-[#338ABE]" />
          <div className="h-[6px] w-24 rounded-full bg-[#F8BD00]" />
          <div className="h-[6px] w-12 rounded-full bg-[#319F43]" />
        </div>

        <h2 className="text-2xl font-semibold mb-1">Welcome back</h2>
        <p className="text-lg font-semibold text-gray-500 mb-6">staff portal</p>

        <form onSubmit={handleSubmit} className="w-full max-w-sm space-y-4">
          <div>
            <label className="text-sm font-medium text-gray-700">
              Staff email
            </label>
            <Input
              type="email"
              placeholder="email or username"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="mt-1"
              required
            />
          </div>

          <div>
            <label className="text-sm font-medium text-gray-700">
              Password
            </label>
            <Input
              type="password"
              placeholder="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="mt-1"
              required
            />
          </div>

          <div className="flex items-center justify-between text-sm">
            <div className="flex items-center space-x-2">
              <Checkbox
                id="remember"
                checked={rememberMe}
                onCheckedChange={(checked) =>
                  setRememberMe(checked === true)
                }
              />
              <label htmlFor="remember">Remember me</label>
            </div>
            <Link href="/forgot-password" className="text-[#18668D] underline">
              Forgot password
            </Link>
          </div>

          {errorMsg && <p className="text-red-600 text-sm">{errorMsg}</p>}

          <Button
            type="submit"
            className="w-full bg-[#18668D] hover:bg-[#134d66]"
            disabled={loading}
          >
            {loading ? "Logging in..." : "Login"}
          </Button>
        </form>

        <p className="text-sm text-gray-500 mt-6">
          Dont have an account?{" "}
          <Link href="/staff-register" className="text-[#18668D]">
            Register
          </Link>
        </p>
      </div>

      {/* Right side */}
      <div className="w-1/2 bg-[#1b4965] text-white flex flex-col justify-center items-center px-12 relative">
        <div className="absolute left-0 top-0 bottom-0 w-[6px] bg-[#338ABE]" />
        <div className="absolute left-[6px] top-0 bottom-0 w-[6px] bg-[#F8BD00]" />
        <div className="absolute left-[12px] top-0 bottom-0 w-[6px] bg-[#319F43]" />

        <div className="max-w-md text-center">
          <div className="flex justify-center mb-6">
            <img
              src="/Rralogo.png"
              alt="Logo"
              className="h-20 w-20 p-2 rounded-full bg-white"
            />
          </div>
          <h2 className="text-2xl font-bold mb-4">
            Efficient Tax Administration Starts Here
          </h2>
          <p className="text-gray-200">
            Empowering Automation tools for seamless tax claim processing and
            management.
          </p>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="frontend/src/app/staff-register/page.tsx">
"use client";

import { useEffect, useState } from "react";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { useRouter } from "next/navigation";
import Link from "next/link";
import * as Select from "@radix-ui/react-select";
import api from "@/lib/api"; 


export default function StaffRegisterPage() {
  const [formData, setFormData] = useState({
    fullName: "",
    title: "",
    committeeRole: "",
    committeeGroup: "",
    email: "",
    phoneNumber: "",
    password: "",
    confirmPassword: "",
  });

  console.log(api);
  

  const router = useRouter();
  const [rememberMe, setRememberMe] = useState(false);
  const [loading, setLoading] = useState(false);
  const [errorMsg, setErrorMsg] = useState("");
  const [successMsg, setSuccessMsg] = useState("");

  // Load remembered credentials
  useEffect(() => {
    const remembered = localStorage.getItem("staff_register_remember");
    if (remembered) {
      const savedData = JSON.parse(remembered);
      setFormData((prev) => ({
        ...prev,
        email: savedData.email || "",
        password: savedData.password || "",
      }));
      setRememberMe(true);
    }
  }, []);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setFormData((prev) => ({ ...prev, [e.target.id]: e.target.value }));
  };

  const handleCommitteeRoleChange = (value: string) => {
  setFormData((prev) => ({ ...prev, committeeRole: value }));
};

  const handleCommitteeChange = (value: string) => {
    setFormData((prev) => ({ ...prev, committeeGroup: value }));
  };

  // Password validation
  const passwordChecks = {
    length: formData.password.length >= 8,
    letter: /[A-Za-z]/.test(formData.password),
    number: /\d/.test(formData.password),
    symbol: /[^A-Za-z0-9]/.test(formData.password),
  };

  const isValidPassword =
    passwordChecks.length &&
    passwordChecks.letter &&
    passwordChecks.number &&
    passwordChecks.symbol;

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setErrorMsg("");
    setSuccessMsg("");
    if (formData.password !== formData.confirmPassword) {
      setErrorMsg("Passwords do not match.");
      return;
    }

    if (!isValidPassword) {
      setErrorMsg(
        "Password must be at least 8 characters, include letters, numbers, and symbols."
      );
      return;
    }

    // Handle Remember Me storage
    if (rememberMe) {
      localStorage.setItem(
        "staff_register_remember",
        JSON.stringify({ email: formData.email, password: formData.password })
      );
    } else {
      localStorage.removeItem("staff_register_remember");
    }

      try {
        setLoading(true);
        const res = await api.post("/api/v1/auth/register", formData);
        console.log(api);
        
        setSuccessMsg(res.data.message || "Registration successful!");
        setErrorMsg("");
        setLoading(false);
        router.push("/cases");

      } catch (error: any) {
        if (error.response && error.response.data) {
          setErrorMsg(error.response.data.message || "Something went wrong.");
        } else {
          setErrorMsg(error.message || "Something went wrong.");
        }
        setLoading(false);
      }
    };

  return (
    <div className="flex min-h-screen">
      {/* Left side */}
      <div className="flex w-1/2 flex-col items-center justify-center px-10">
        <div className="flex flex-row items-center">
          <img src="/Rralogo.png" alt="Logo" className="h-14 w-auto" />
          <h1 className="text-2xl font-bold text-[#1d3557] ml-2">
            Tax Claim Management System
          </h1>
        </div>

        <div className="flex space-x-2 mb-4">
          <div className="h-[6px] w-40 rounded-full bg-[#338ABE]" />
          <div className="h-[6px] w-24 rounded-full bg-[#F8BD00]" />
          <div className="h-[6px] w-12 rounded-full bg-[#319F43]" />
        </div>

        <h2 className="text-2xl font-semibold mb-1">Welcome back</h2>
        <p className="text-lg font-semibold text-gray-500 mb-6">staff portal</p>

        <form className="space-y-4 w-full max-w-sm" onSubmit={handleSubmit}>
          <div>
            <label>Full names</label>
            <Input
              id="fullName"
              placeholder="Full names"
              value={formData.fullName}
              onChange={handleChange}
              required
            />
          </div>

          <div>
            <label>Title</label>
            <Input
              id="title"
              placeholder="type your title"
              value={formData.title}
              onChange={handleChange}
              required
            />
          </div>

          <div className="flex flex-col space-y-1">
            <label className="text-sm font-medium text-gray-700">Role</label>
            <Select.Root value={formData.committeeRole} onValueChange={handleCommitteeRoleChange}>
              <Select.Trigger
                className="h-8 w-full bg-white border border-gray-300 rounded px-3 flex items-center justify-between"
                aria-label="Role"
              >
                <Select.Value placeholder="Choose your Role" />
              </Select.Trigger>
              <Select.Content className="bg-white border border-gray-300 rounded mt-1">
                <Select.Viewport>
                  <Select.Item
                    value="COMMITTEE_LEADER"
                    className="px-3 py-2 hover:bg-gray-100"
                  >
                    <Select.ItemText>COMMITTEE LEADER</Select.ItemText>
                  </Select.Item>
                  <Select.Item
                    value="COMMITTEE_MEMBER"
                    className="px-3 py-2 hover:bg-gray-100"
                  >
                    <Select.ItemText>
                      COMMITTEE MEMBER
                    </Select.ItemText>
                  </Select.Item>
                  <Select.Item
                    value="COMMITTEE_MEMBER_T3_TAM"
                    className="px-3 py-2 hover:bg-gray-100"
                  >
                    <Select.ItemText>
                      COMMITTEE MEMBER T3 TAM
                    </Select.ItemText>
                  </Select.Item>
                </Select.Viewport>
              </Select.Content>
            </Select.Root>
          </div>

          <div className="flex flex-col space-y-1">
            <label className="text-sm font-medium text-gray-700">
              Committee group
            </label>
            <Select.Root
              value={formData.committeeGroup}
              onValueChange={handleCommitteeChange}
            >
              <Select.Trigger
                className="h-8 w-full bg-white border border-gray-300 rounded px-3 flex items-center justify-between"
                aria-label="Committee group"
              >
                <Select.Value placeholder="choose your group" />
              </Select.Trigger>
              <Select.Content className="bg-white border border-gray-300 rounded mt-1">
                <Select.Viewport>
                  <Select.Item
                    value="APPEAL_COMMITTEE"
                    className="px-3 py-2 hover:bg-gray-100"
                  >
                    <Select.ItemText>Appeal Committee</Select.ItemText>
                  </Select.Item>
                  <Select.Item
                    value="AMICABLE_SETTLEMENT_COMMITTEE"
                    className="px-3 py-2 hover:bg-gray-100"
                  >
                    <Select.ItemText>Amicable Settlement Committee</Select.ItemText>
                  </Select.Item>
                </Select.Viewport>
              </Select.Content>
            </Select.Root>
          </div>

          <div>
            <label>Staff email</label>
            <Input
              id="email"
              type="email"
              placeholder="email"
              value={formData.email}
              onChange={handleChange}
              required
            />
          </div>

          <div>
            <label>Phone</label>
            <Input
              id="phoneNumber"
              type="tel"
              placeholder="Phone"
              value={formData.phoneNumber}
              onChange={handleChange}
              required
            />
          </div>

          <div>
            <label>Password</label>
            <Input
              id="password"
              type="password"
              placeholder="password"
              value={formData.password}
              onChange={handleChange}
              required
            />
          </div>

          <div>
            <label>Confirm Password</label>
            <Input
              id="confirmPassword"
              type="password"
              placeholder="password"
              value={formData.confirmPassword}
              onChange={handleChange}
              required
            />
          </div>

          <div className="flex items-center justify-between">
            <label className="flex items-center space-x-2 text-gray-700">
              <input
                type="checkbox"
                checked={rememberMe}
                onChange={(e) => setRememberMe(e.target.checked)}
                className="accent-[#18668D] w-4 h-4"
              />
              <span>Remember Me</span>
            </label>

            <Link
              href="/forgot-password"
              className="text-sm text-[#18668D] hover:underline"
            >
              Forgot password?
            </Link>
          </div>

          {errorMsg && <p className="text-red-600 text-sm">{errorMsg}</p>}
          {successMsg && <p className="text-green-600 text-sm">{successMsg}</p>}

          <Button
            type="submit"
            className="w-full bg-[#18668D] hover:bg-[#134d66]"
            disabled={loading}
          >
            {loading ? "Registering..." : "Register"}
          </Button>
        </form>

        <p className="text-sm text-gray-500 mb-3">
          Have an account?{" "}
          <Link href="/staff-login" className="text-[#18668D]">
            Login
          </Link>
        </p>
      </div>

      {/* Right side */}
      <div className="w-1/2 bg-[#1b4965] text-white flex flex-col justify-center items-center px-12 relative">
        <div className="absolute left-0 top-0 bottom-0 w-[6px] bg-[#338ABE]" />
        <div className="absolute left-[6px] top-0 bottom-0 w-[6px] bg-[#F8BD00]" />
        <div className="absolute left-[12px] top-0 bottom-0 w-[6px] bg-[#319F43]" />

        <div className="max-w-md text-center">
          <div className="flex justify-center mb-6">
            <img
              src="/Rralogo.png"
              alt="Logo"
              className="h-20 w-20 p-2 rounded-full bg-white"
            />
          </div>
          <h2 className="text-2xl font-bold mb-4">
            Efficient Tax Administration Starts Here
          </h2>
          <p className="text-gray-200">
            Empowering automation tools for seamless tax claim processing and
            management.
          </p>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="frontend/src/app/types/case.ts">
// types/case.ts
export interface Case {
  taxOriginal: string;
  amountDischarged: string;
  taxToBePaid: string;
  casePresenter: string;
  auditor: string;
  caseId: string;
  taxPayer: string;
  submittedAt: string;
  daysLeft: number;
  status: "Pending" | "Approved" | "Rejected";
}
</file>

<file path="frontend/src/app/types/meetingminutes.ts">
// types/case.ts
export interface MeetingMinutes {
  preparedBy: string;
  date: string;
  type: string;
  doc: string;
}
</file>

<file path="frontend/src/app/types/minutes-mock-data.ts">
// mock-data/cases.ts
import { MeetingMinutes } from "./meetingminutes";

export const meetingminutes: MeetingMinutes[] = [
  {
  preparedBy: "John Doe",
  date: "March,23,2025",
  type: "meeting minutes",
  doc: "view"
  },
  {
  preparedBy: "Smith george",
  date: "May,3,2025",
  type: "meeting minutes",
  doc: "view"
  },
  {
  preparedBy: "joseph nerd",
  date: "september,09,2025",
  type: "meeting minutes",
  doc: "view"
  },
  {
  preparedBy: "Laura keating",
  date: "January,11,2025",
  type: "meeting minutes",
  doc: "view"
  },
];
</file>

<file path="frontend/src/app/types/mock-data.ts">
// mock-data/cases.ts
import { Case } from "./case";

export const cases: Case[] = [
  {
    caseId: "#AUDDTD2023",
    taxPayer: "NKINKA BIGABWA RODNEY",
    submittedAt: "Feb 5, 2023",
    daysLeft: 28,
    status: "Pending",
    taxOriginal: '300,000frw',
    amountDischarged: '100,000frw',
    taxToBePaid: '200,000frw',
    casePresenter: 'Catherine',
    auditor: 'Kanyambo Beatrice'
  },
  {
    caseId: "#AUDDTD2023",
    taxPayer: "NKINKA BIGABWA RODNEY",
    submittedAt: "Feb 5, 2023",
    daysLeft: 28,
    status: "Rejected",
    taxOriginal: '300,000frw',
    amountDischarged: '100,000frw',
    taxToBePaid: '200,000frw',
    casePresenter: 'Catherine',
    auditor: 'Kanyambo Beatrice'
  },
  {
    caseId: "#AUDDTD2023",
    taxPayer: "NKINKA BIGABWA RODNEY",
    submittedAt: "Feb 5, 2023",
    daysLeft: 28,
    status: "Approved",
    taxOriginal: '300,000frw',
    amountDischarged: '100,000frw',
    taxToBePaid: '200,000frw',
    casePresenter: 'Catherine',
    auditor: 'Kanyambo Beatrice'
  },
  {
    caseId: "#AUDDTD2023",
    taxPayer: "NKINKA BIGABWA RODNEY",
    submittedAt: "Feb 5, 2023",
    daysLeft: 28,
    status: "Pending",
    taxOriginal: '300,000frw',
    amountDischarged: '100,000frw',
    taxToBePaid: '200,000frw',
    casePresenter: 'Catherine',
    auditor: 'Kanyambo Beatrice'
  },
  {
    caseId: "#AUDDTD2023",
    taxPayer: "NKINKA BIGABWA RODNEY",
    submittedAt: "Feb 5, 2023",
    daysLeft: 28,
    status: "Pending",
    taxOriginal: '300,000frw',
    amountDischarged: '100,000frw',
    taxToBePaid: '200,000frw',
    casePresenter: 'Catherine',
    auditor: 'Kanyambo Beatrice'
  },
  {
    caseId: "#AUDDTD2023",
    taxPayer: "NKINKA BIGABWA RODNEY",
    submittedAt: "Feb 5, 2023",
    daysLeft: 28,
    status: "Pending",
    taxOriginal: '300,000frw',
    amountDischarged: '100,000frw',
    taxToBePaid: '200,000frw',
    casePresenter: 'Catherine',
    auditor: 'Kanyambo Beatrice'
  },
];
</file>

<file path="frontend/src/app/vote/page.tsx">
"use client";

import Sidebar from "@/components/sidebar";
import VotePage from "@/components/vote";
import AuthGuard from "@/components/authguard";

export default function MeetingsPage() {

  return (
    <AuthGuard>
    <div className="flex flex-col min-h-screen">
      <main className="flex flex-1">
        <Sidebar/>
        <div className=" w-full px-16">
            <h1 className="text-2xl font-bold text-gray-900 mt-2">
                Vote
            </h1>
        <p className="text-lg text-gray-500 mb-12">
            Vote
        </p>
         <VotePage/>
        </div>
      </main>
    </div>
    </AuthGuard>
  );
}
</file>

<file path="frontend/src/components/AdminGuard.tsx">
"use client";

import { useEffect, useState } from "react";
import { useRouter } from "next/navigation";

interface AdminGuardProps {
  children: React.ReactNode;
}

export default function AdminGuard({ children }: AdminGuardProps) {
  const router = useRouter();
  const [isAuthorized, setIsAuthorized] = useState<boolean | null>(null);

  useEffect(() => {
    // Get the stored role from localStorage
    const userRole = localStorage.getItem("staff_role");

    if (userRole === "COMMITTEE_LEADER") {
      setIsAuthorized(true);
    } else {
      // If the role is incorrect or doesn't exist, redirect
      setIsAuthorized(false);
      router.replace("/cases"); 
    }
  }, [router]);

  if (isAuthorized === null) {
    return <div className="h-screen flex items-center justify-center">Verifying access...</div>;
  }

  if (isAuthorized) {
    return <>{children}</>;
  }

  return null;
}
</file>

<file path="frontend/src/components/AnalyticsDashboard.tsx">
"use client";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { TrendingUp, CheckCircle2, Clock } from "lucide-react";
import { CaseAnalyticsChart } from "./case-analytics-chart";
import { AttendanceList } from "./attendance-list";
import AgendaCasesPage from "./cases";
import { useEffect, useState } from "react";
import api from "@/lib/api"; 


interface AnalyticsData {
  totalCases: number;
  reviewRate: number;
  pendingCases: number;
}

export function AnalyticsDashboard() {
  
  const [data, setData] = useState<AnalyticsData | null>(null);
  
  const [loading, setLoading] = useState(true);
  
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    
    const fetchAnalyticsData = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await api.get('/api/v1/my-cases/analytics');
        if (response.data && response.data.data) {
          setData(response.data.data);
        } else {
          throw new Error("Analytics data not found in the response.");
        }
      } catch (err) {
        console.error("Failed to fetch analytics:", err);
        setError("Could not load analytics data.");
      } finally {
        setLoading(false);
      }
    };

    fetchAnalyticsData();
  }, []);

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-3xl font-bold text-gray-900">Analytics</h1>
        <p className="text-gray-600 mt-1">Track Assigned Cases in One Place</p>
      </div>

      {error && <p className="text-red-600">{error}</p>}
      
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        {/* Total Cases Card */}
        <Card className="bg-blue-50 border-blue-100">
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-700">
              Total cases
            </CardTitle>
            <TrendingUp className="h-4 w-4 text-blue-600" />
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-bold text-gray-900">
              {/* Display loading state or the fetched data */}
              {loading ? "..." : data?.totalCases ?? 0}
            </div>
          </CardContent>
        </Card>

        {/* Review Rate Card */}
        <Card className="bg-green-50 border-green-100">
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-700">
              Review Rate
            </CardTitle>
            <CheckCircle2 className="h-4 w-4 text-green-600" />
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-bold text-gray-900">
               {/* Display loading state or the fetched data, formatted as a percentage */}
              {loading ? "..." : `${data?.reviewRate ?? 0} %`}
            </div>
          </CardContent>
        </Card>

        {/* Pending Cases Card */}
        <Card className="bg-purple-50 border-purple-100">
          <CardHeader className="flex flex-row items-center justify-between pb-2">
            <CardTitle className="text-sm font-medium text-gray-700">
              Pending Cases
            </CardTitle>
            <Clock className="h-4 w-4 text-purple-600" />
          </CardHeader>
          <CardContent>
            <div className="text-3xl font-bold text-gray-900">
              {/* Display loading state or the fetched data */}
              {loading ? "..." : data?.pendingCases ?? 0}
            </div>
          </CardContent>
        </Card>
      </div>
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div className="lg:col-span-2">
          <CaseAnalyticsChart />
        </div>
        <div>
          <AttendanceList />
        </div>
      </div>
      <AgendaCasesPage />
    </div>
  );
}
</file>

<file path="frontend/src/components/appealpoint.tsx">
"use client";

import { zodResolver } from "@hookform/resolvers/zod";
import { useFieldArray, useForm } from "react-hook-form";
import * as z from "zod";
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Textarea } from "@/components/ui/textarea";
import { PlusCircle } from "lucide-react";

// Schema for a single appeal point
const appealPointSchema = z.object({
  appealPoint: z.string().min(1, { message: "Appeal point is required." }),
  auditorsOpinion: z.string().min(1, { message: "Auditor's opinion is required" }),
  problemSummary: z.string().min(1, { message: "Problem summary is required." }),
  proposedSolution: z.string().min(1, { message: "Proposed solution is required." }),
});

// Main form schema
const formSchema = z.object({
  caseId: z.string().min(1, { message: "Case ID is required." }),
  appealPoints: z.array(appealPointSchema).min(1, { message: "You must add at least one appeal point." }),
});

export function AppealPointForm() {
  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
    defaultValues: {  
      appealPoints: [
        {
          appealPoint: "",
          auditorsOpinion: "",
          problemSummary: "",
          proposedSolution: "",
        },
      ],
    },
  });

  const { fields: appealFields, append: appendAppeal, remove: removeAppeal } = useFieldArray({
    control: form.control,
    name: "appealPoints",
  });

  function onSubmit(values: z.infer<typeof formSchema>) {
    console.log(values);
    alert("Form submitted! Check console for values.");
  }

  return (
    <div className="container p-4 max-w-2xl">
      <Form {...form}>
        <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-8">
          <>
                <div className="grid grid-cols-2 md:grid-cols-1 gap-4 bg-white">
                 <div className="rounded-lg border p-6 space-y-4">
                <h2 className="text-xl font-semibold">Details</h2>
                <h1 className="text-gray-500 font-medium">Appeal point 1</h1>
                {appealFields.map((field, index) => (
                  <div key={field.id} className="space-y-4 border-b pb-4">
                    <FormField control={form.control} name={`appealPoints.${index}.appealPoint`} render={({ field }) => (
                      <FormItem>
                        <FormLabel>Appeal Point</FormLabel>
                        <FormControl><Input {...field} placeholder="Enter appeal point" /></FormControl>
                        <FormMessage />
                      </FormItem>
                    )} />
                    <FormField control={form.control} name={`appealPoints.${index}.problemSummary`} render={({ field }) => (
                      <FormItem>
                        <FormLabel>Problem Summary</FormLabel>
                        <FormControl><Textarea {...field} placeholder="problem summary goes here . . . "/></FormControl>
                        <FormMessage />
                      </FormItem>
                    )} />
                    <FormField control={form.control} name={`appealPoints.${index}.auditorsOpinion`} render={({ field }) => (
                      <FormItem>
                        <FormLabel>Basis of Tax assessment by Auditor</FormLabel>
                        <FormControl><Textarea {...field} placeholder="auditors comments go here . . ."/></FormControl>
                        <FormMessage />
                      </FormItem>
                    )} />
                    <FormField control={form.control} name={`appealPoints.${index}.proposedSolution`} render={({ field }) => (
                      <FormItem>
                        <FormLabel>Proposed Solution in accordance with the laws</FormLabel>
                        <FormControl><Textarea {...field} placeholder="Your proposed solution goes here . . . " /></FormControl>
                        <FormMessage />
                      </FormItem>
                    )} />
                    
                  </div>
                ))}
                
              </div>
            </div>
            <Button
                    type="button"
                    variant="outline" 
                    className="w-full justify-center text-lg font-bold text-[#18668D] hover:bg-blue-50 hover:text-[#0f567a] border-gray-200 h-10" // Tailor the look
                    onClick={() =>
                        appendAppeal({
                        appealPoint: "",
                        auditorsOpinion: "",
                        problemSummary: "",
                        proposedSolution: "",
                        })
                    }
                    >
                    <PlusCircle className="mr-3 h-6 w-6" /> 
                    Add appeal point
                </Button>
            <div className="flex justify-between">
                <Button type="button"  className="bg-[#18668D]">
                    <a href="/cases/new-case">Back</a>
                </Button>
                <Button type="submit" className="bg-[#18668D]">
                    <a href="/cases/new-case">Done</a>
                </Button>
            </div>
            </>
        </form>
      </Form>
    </div>
  );
}
</file>

<file path="frontend/src/components/AppealPointDetails.tsx">
"use client";

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import api from '@/lib/api';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Avatar, AvatarFallback } from '@/components/ui/avatar';
import { AppealVote } from './AppealVote';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';

// Types
interface AppealDTO {
  AppealId: string;
  appealPoint: string;
  summarisedProblem: string;
  auditorsOpinion: string;
  proposedSolution: string;
}

interface SimpleVote {
  committeeMemberName: string;
  committeeDecision: "WITHBASIS" | "NOBASIS";
}

type Tab = 'appeal' | 'opinion' | 'solution' | 'comments' | 'votes';

export function AppealPointDetails({ caseId, appealId }: { caseId: string; appealId: string }) {
  const [appeal, setAppeal] = useState<AppealDTO | null>(null);
  const [taxTypeName, setTaxTypeName] = useState('');
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [activeTab, setActiveTab] = useState<Tab>('appeal');
  const [hasVoted, setHasVoted] = useState(false);
  const [comment, setComment] = useState<string>('');
  const [loadingComment, setLoadingComment] = useState(false);

  // Leader-only
  const [isLeader, setIsLeader] = useState(false);
  const [allVotes, setAllVotes] = useState<SimpleVote[]>([]);
  const [loadingVotes, setLoadingVotes] = useState(false);

  const router = useRouter();

  // Check if user is COMMITTEE_LEADER
  useEffect(() => {
    const role = localStorage.getItem("staff_role");
    setIsLeader(role === "COMMITTEE_LEADER");
  }, []);

  // Check if current user has voted
  const checkVoteStatus = async () => {
    try {
      const response = await api.post(`/api/appeals/are-all-appeals-voted`, [appealId]);
      const data = response.data;
      setHasVoted(data[appealId] === true);
    } catch (err) {
      console.error("Error checking vote status:", err);
    }
  };

  // Fetch decision comment
  const fetchComment = async () => {
    setLoadingComment(true);
    try {
      const response = await api.post(`/api/v1/auth/explanatory_note/appeal/comment/${appealId}`);
      setComment(response.data?.comment || '');
    } catch (err) {
      console.error("Failed to fetch comment:", err);
      setComment('');
    } finally {
      setLoadingComment(false);
    }
  };

  // Fetch all votes (only for leader)
  const fetchAllVotes = async () => {
    if (!isLeader) return;
    setLoadingVotes(true);
    try {
      const res = await api.get(`/api/appeals/${appealId}/all-votes`);
      setAllVotes(res.data);
    } catch (err) {
      console.error("Failed to load votes:", err);
    } finally {
      setLoadingVotes(false);
    }
  };

  useEffect(() => {
    checkVoteStatus();
    fetchComment();

    const fetchAppealDetails = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await api.get(`/api/v1/auth/explanatory_note/${caseId}`);
        const caseData = response.data.data;

        let foundAppeal: AppealDTO | undefined;
        let foundTaxType = '';

        for (const taxItem of caseData.taxAudited) {
          foundAppeal = taxItem.appeals.find((a: any) => a.AppealId === appealId);
          if (foundAppeal) {
            foundTaxType = taxItem.taxTypeAudited || taxItem.auditedTaxType || 'Unknown Tax Type';
            break;
          }
        }

        if (foundAppeal) {
          setAppeal(foundAppeal);
          setTaxTypeName(foundTaxType);
        } else {
          throw new Error("Appeal point not found.");
        }
      } catch (err: any) {
        setError(err.message || "Failed to load appeal details.");
      } finally {
        setLoading(false);
      }
    };

    fetchAppealDetails();
  }, [caseId, appealId]);

  // Fetch votes when "votes" tab is opened
  useEffect(() => {
    if (activeTab === 'votes' && isLeader) {
      fetchAllVotes();
    }
  }, [activeTab, isLeader, appealId]);

  const handleVoteSuccess = () => {
    setHasVoted(true);
    fetchComment();
  };

  if (loading) return <div className="text-center p-12 text-gray-600">Loading appeal details...</div>;
  if (error || !appeal) return <div className="text-center p-12 text-red-500">{error || "Appeal not found"}</div>;

  const withBasisCount = allVotes.filter(v => v.committeeDecision === "WITHBASIS").length;
  const noBasisCount = allVotes.filter(v => v.committeeDecision === "NOBASIS").length;

  const TabButton = ({ tab, label }: { tab: Tab; label: string }) => (
    <button
      onClick={() => setActiveTab(tab)}
      className={`pb-3 px-6 text-sm font-medium transition-all border-b-2 ${
        activeTab === tab
          ? 'border-blue-600 text-blue-600'
          : 'border-transparent text-gray-500 hover:text-gray-700'
      }`}
    >
      {label}
      {tab === 'votes' && isLeader && ` (${allVotes.length})`}
    </button>
  );

  return (
    <div className="w-full max-w-5xl mx-auto space-y-8 py-6">
      <div>
        <h1 className="text-3xl font-bold text-gray-900">{taxTypeName}</h1>
        <p className="text-lg text-gray-500 mt-1">Appeal Point Details</p>
      </div>

      <Card>
        <CardContent className="p-8">
          {/* Tabs */}
          <div className="border-b border-gray-200 mb-8">
            <nav className="flex space-x-8 overflow-x-auto">
              <TabButton tab="appeal" label="Appeal Point" />
              <TabButton tab="opinion" label="Auditor's Opinion" />
              <TabButton tab="solution" label="Proposed Solution" />
              <TabButton tab="comments" label="Decision Comment" />
              {isLeader && <TabButton tab="votes" label="Committee Votes" />}
            </nav>
          </div>

          {/* Content */}
          <div className="min-h-[400px]">
            {activeTab === 'appeal' && (
              <div className="space-y-6">
                <div>
                  <h3 className="text-xl font-bold text-gray-800 mb-3">Appeal Point</h3>
                  <p className="text-gray-700 leading-relaxed">{appeal.appealPoint}</p>
                </div>
                <div>
                  <h3 className="text-xl font-bold text-gray-800 mb-3">Description</h3>
                  <p className="text-gray-700 whitespace-pre-line leading-relaxed">{appeal.summarisedProblem}</p>
                </div>
              </div>
            )}

            {activeTab === 'opinion' && (
              <div>
                <h3 className="text-xl font-bold text-gray-800 mb-4">Auditor's Opinion</h3>
                <p className="text-gray-700 whitespace-pre-line leading-relaxed">{appeal.auditorsOpinion}</p>
              </div>
            )}

            {activeTab === 'solution' && (
              <div>
                <h3 className="text-xl font-bold text-gray-800 mb-4">Commissioner's Proposed Solution</h3>
                <p className="text-gray-700 whitespace-pre-line leading-relaxed">{appeal.proposedSolution}</p>
              </div>
            )}

            {activeTab === 'comments' && (
              <div className="space-y-6">
                <h3 className="text-xl font-bold text-gray-800 mb-4">Decision Comment</h3>
                {loadingComment ? (
                  <p className="text-gray-500 italic">Loading comment...</p>
                ) : !comment ? (
                  <p className="text-gray-500 italic">No decision comment available.</p>
                ) : (
                  <div className="p-6 bg-gray-50 border rounded-lg">
                    <p className="whitespace-pre-wrap text-gray-800 leading-relaxed">{comment}</p>
                  </div>
                )}
              </div>
            )}

            {/* LEADER ONLY: All Votes Tab */}
            {activeTab === 'votes' && isLeader && (
              <div className="space-y-6">
                <h3 className="text-2xl font-bold text-gray-800">Committee Decisions</h3>

                {/* Summary */}
                <div className="flex items-center gap-8 text-lg font-semibold">
                  <div className="flex items-center gap-3">
                    <span className="w-5 h-5 bg-green-600 rounded"></span>
                    <span>With Basis:</span>
                    <span className="text-green-700">{withBasisCount}</span>
                  </div>
                  <div className="flex items-center gap-3">
                    <span className="w-5 h-5 bg-red-600 rounded"></span>
                    <span>No Basis:</span>
                    <span className="text-red-700">{noBasisCount}</span>
                  </div>
                  <div className="ml-auto text-gray-600">
                    Total: <span className="font-bold">{allVotes.length}</span>
                  </div>
                </div>

                {/* Table */}
                {loadingVotes ? (
                  <p className="text-gray-500 italic">Loading votes...</p>
                ) : allVotes.length === 0 ? (
                  <div className="text-center py-16 bg-gray-50 rounded-lg border border-dashed">
                    <p className="text-gray-500 text-lg">No votes recorded yet</p>
                  </div>
                ) : (
                  <div className="overflow-hidden rounded-lg border">
                    <table className="w-full">
                      <thead className="bg-gray-50">
                        <tr>
                          <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Committee Member</th>
                          <th className="px-6 py-4 text-left text-sm font-semibold text-gray-700">Decision</th>
                        </tr>
                      </thead>
                      <tbody className="divide-y divide-gray-200">
                        {allVotes.map((vote, i) => (
                          <tr key={i} className="hover:bg-gray-50 transition">
                            <td className="px-6 py-4 text-sm font-medium text-gray-900">
                              {vote.committeeMemberName}
                            </td>
                            <td className="px-6 py-4">
                              <span className={`inline-flex px-4 py-2 rounded-full text-xs font-bold text-white ${
                                vote.committeeDecision === "WITHBASIS" ? "bg-green-600" : "bg-red-600"
                              }`}>
                                {vote.committeeDecision === "WITHBASIS" ? "WITH BASIS" : "NO BASIS"}
                              </span>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}
              </div>
            )}
          </div>
        </CardContent>
      </Card>

      {/* Action Buttons */}
      <div className="flex justify-between items-center">
        <Button onClick={() => router.back()} variant="outline" size="lg">
          Back
        </Button>

        {!hasVoted && (
          <Dialog>
            <DialogTrigger asChild>
              <Button size="lg" className="bg-[#18668D] hover:bg-[#134d66] font-bold">
                Vote
              </Button>
            </DialogTrigger>
            <DialogContent className="sm:max-w-lg">
              <DialogHeader>
                <DialogTitle className="text-xl">Vote on Appeal Point</DialogTitle>
              </DialogHeader>
              <div className="py-6">
                <p className="font-medium text-sm bg-gray-100 p-4 rounded mb-6">
                  {appeal.appealPoint}
                </p>
                <AppealVote appealId={appeal.AppealId} onVoteSuccess={handleVoteSuccess} />
              </div>
            </DialogContent>
          </Dialog>
        )}
      </div>
    </div>
  );
}
</file>

<file path="frontend/src/components/AppealVote.tsx">
"use client";

import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Clock, ThumbsDown, BadgeCheck, CheckCircle } from 'lucide-react';
import { Textarea } from '@/components/ui/textarea';

interface AppealVoteProps {
  appealId: string;
  onVoteSuccess: () => void;
}

type VoteStatus = 'idle' | 'voting' | 'voted' | 'error';
type VoteDecision = 'WITHBASIS' | 'NOBASIS' | 'ABSTAIN';

const isUUID = (str: string | null | undefined): boolean => {
  if (!str) return false;
  const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
  return uuidRegex.test(str);
};

export function AppealVote({ appealId }: AppealVoteProps) {
  const [status, setStatus] = useState<VoteStatus>('idle');
  const [feedback, setFeedback] = useState('');
  const [voteComment, setVoteComment] = useState(""); 
  const [userRole, setUserRole] = useState<string | null>(null);
  const [hasVoted, setHasVoted] = useState<boolean>(false);

  useEffect(() => {
    // Set user role
    const role = localStorage.getItem('staff_role');
    setUserRole(role);

    const checkVoteStatus = async () => {
      const checkVoteStatusUrl = `${process.env.NEXT_PUBLIC_API_URL}/api/appeals/are-all-appeal-voted`;
      const token = localStorage.getItem("staff_token");
      
      let committeeMemberId = localStorage.getItem('staff_id');
      // Clean up ID if it was stored with quotes
      if (committeeMemberId) {
        committeeMemberId = committeeMemberId.replace(/['"]+/g, '');
      }

      if (!token || !committeeMemberId) return;

      // Payload for checking status - typically requires the appeal and the member
      const payload = {
        appealId: appealId,
        committeeMemberId: committeeMemberId
      };

      try {
        const response = await fetch(checkVoteStatusUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(payload)
        });

        if (response.ok) {
          const data = await response.json();
          // Assuming the API returns a boolean true/false or an object { voted: true }
          // Adjust 'data === true' based on your exact API response structure
          if (data === true || data.hasVoted === true) {
            setHasVoted(true);
            setFeedback('You have already cast your vote on this appeal point.');
          }
        }
      } catch (error) {
        console.error("Error checking vote status:", error);
      }
    };

    checkVoteStatus();
  }, [appealId]);
  

  const handleVote = async (decision: VoteDecision) => {
    setStatus('voting');
    setFeedback('');

    let committeeMemberId = localStorage.getItem('staff_id');
    // Clean up ID if it was stored with quotes
    if (committeeMemberId) {
      committeeMemberId = committeeMemberId.replace(/['"]+/g, '');
    }
    
    const committeeMemberName = localStorage.getItem('staff_name');

    if (!isUUID(committeeMemberId) || !committeeMemberName) {
      const errorMessage = `Authentication Error: Your user ID is invalid. Please log out and log back in.`;
      setFeedback(errorMessage);
      setStatus('error');
      return;
    }

    const payload = {
      committeeMemberId,
      committeeMemberName,
      committeeDecision: decision,
      voteComment: userRole === 'COMMITTEE_LEADER' ? voteComment : ''
    };

    try {
      const token = localStorage.getItem("staff_token");
      const url = `${process.env.NEXT_PUBLIC_API_URL}/api/appeals/${appealId}/vote`;

      const response = await fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(payload)
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || `Request failed with status ${response.status}`);
      }
      
      // Update state on success
      setHasVoted(true);
      setStatus('voted');
      
      let decisionText = '';
      if (decision === 'WITHBASIS') decisionText = 'with basis';
      else if (decision === 'NOBASIS') decisionText = 'not basis';
      else decisionText = 'abstained';
      
      setFeedback(`You have successfully voted that the appeal is ${decisionText}.`);

    } catch (err: any) {
      const errorMessage = err.message || 'An error occurred while submitting your vote.';
      setStatus('error');
      setFeedback(errorMessage);
      console.error('Vote submission error:', err);
    }
  };

  if (hasVoted) {
    return (
      <div className="flex flex-col items-center justify-center text-center p-4">
        <CheckCircle className="h-12 w-12 text-green-500 mb-4" />
        <h3 className="text-lg font-semibold">Vote Cast</h3>
        <p className="text-sm text-gray-600">{feedback}</p>
      </div>
    );
  }

  if (status === 'voted') {
    return (
      <div className="flex flex-col items-center justify-center text-center p-4">
        <CheckCircle className="h-12 w-12 text-green-500 mb-4" />
        <h3 className="text-lg font-semibold">Vote Cast Successfully</h3>
        <p className="text-sm text-gray-600">{feedback}</p>
      </div>
    );
  }

  return (
    <div className="space-y-4 ">
      <h3 className="text-lg font-bold text-left">Cast Your Vote</h3>
      {userRole === 'COMMITTEE_LEADER' && (
        <div className="space-y-2">
          <label htmlFor="voteComment" className="text-sm font-medium">
            Comment
          </label>
          <Textarea
            id="voteComment"
            placeholder="Provide your insights on the appeal"
            value={voteComment}
            onChange={(e) => setVoteComment(e.target.value)}
            className="min-h-[100px]"
          />
        </div>
      )}
      <div className='flex justify-between items-center space-x-2'>
        <Button 
          variant='ghost'
          className='flex-1 justify-center bg-slate-100 text-slate-700 hover:bg-slate-200 ring-1 ring-inset ring-slate-300 space-x-2 rounded-lg'
          disabled={status === 'voting'}
          onClick={() => handleVote('ABSTAIN')}
        >
          <Clock className='h-4 w-4' />
          <span>Abstain</span>
        </Button>
        
        <Button 
          variant='ghost' 
          className='flex-1 justify-center bg-red-100 text-red-600 hover:bg-red-200 space-x-2 rounded-lg'
          disabled={status === 'voting'}
          onClick={() => handleVote('NOBASIS')}
        >
          <ThumbsDown className='h-4 w-4' />
          <span> No Basis</span>
        </Button>

        <Button 
          className='flex-1 justify-center bg-green-500 hover:bg-green-600 text-white space-x-2 rounded-lg'
          disabled={status === 'voting'}
          onClick={() => handleVote('WITHBASIS')}
        >
          <BadgeCheck className='h-4 w-4' />
          <span>With Basis</span>
        </Button>
      </div>
      {status === 'error' && <p className="mt-2 text-sm text-red-600">{feedback}</p>}
      {status === 'voting' && <p className="mt-2 text-sm text-gray-600 animate-pulse">Submitting vote...</p>}
    </div>
  );
}
</file>

<file path="frontend/src/components/attendance-list.tsx">
"use client";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Users } from "lucide-react";
import { useEffect, useState } from "react"; // Import hooks for state and effects
import api from "@/lib/api"; // Import your configured API instance

// 1. Define an interface for the attendance data structure
interface AttendanceData {
  totalMembers: number;
  availableMembers: number;
}

export function AttendanceList() {
  // 2. Set up state for data, loading, and errors
  const [attendanceData, setAttendanceData] = useState<AttendanceData | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    // 3. Fetch data when the component mounts
    const fetchAttendanceData = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await api.get('/api/v1/my-cases/analytics');
        const analyticsData = response.data?.data;

        if (analyticsData && analyticsData.attendanceList) {
          setAttendanceData(analyticsData.attendanceList);
        } else {
          throw new Error("Attendance data is missing in the API response.");
        }
      } catch (err) {
        console.error("Failed to fetch attendance data:", err);
        setError("Could not load attendance data.");
      } finally {
        setLoading(false);
      }
    };

    fetchAttendanceData();
  }, []); // Empty dependency array ensures this runs only once on mount

  // 4. Helper function to render content based on the current state
  const renderContent = () => {
    if (loading) {
      return <p className="text-sm font-medium">Loading attendance...</p>;
    }

    if (error) {
      return <p className="text-sm font-medium text-red-500">{error}</p>;
    }

    if (attendanceData) {
      return (
        <p className="text-sm font-medium">
          {attendanceData.availableMembers} / {attendanceData.totalMembers} members will be available
        </p>
      );
    }

    return <p className="text-sm font-medium">No attendance data found.</p>;
  };

  return (
    <Card>
      <CardHeader>
        <CardTitle className="text-lg font-semibold">Attendance List</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="flex items-center justify-center h-32">
          <div className="text-center text-gray-500">
            <Users className="h-12 w-12 mx-auto mb-2 text-gray-400" />
            {renderContent()}
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
</file>

<file path="frontend/src/components/authguard.tsx">
"use client";
import { useEffect, useState } from "react";
import { useRouter } from "next/navigation";

interface Props {
  children: React.ReactNode;
}

export default function AuthGuard({ children }: Props) {
  const router = useRouter();
  const [isAuthenticated, setIsAuthenticated] = useState<boolean | null>(null);

  useEffect(() => {
    const token = localStorage.getItem("staff_token"); 
    if (token) {
      setIsAuthenticated(true);
    } else {
      setIsAuthenticated(false);
      router.replace("/staff-login");
    }
  }, [router]);

  if (isAuthenticated === null) {
  return <div className="h-screen flex items-center justify-center">Loading...</div>;
}

if (!isAuthenticated) {
  // still redirecting
  return null;
}

return <>{children}</>;
}
</file>

<file path="frontend/src/components/case-analytics-chart.tsx">
"use client";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { useEffect, useState } from "react";
import api from "@/lib/api";

// 1. CORRECTED: Interface to match the backend DTO (casesWithBases, casesWithoutBases)
interface CaseAnalyticsItem {
  month: string;
  casesWithBases: number;
  casesWithoutBases: number;
}

// 2. IMPROVED: Renamed for better clarity
interface ChartDataItem {
  month: string;
  unjustified: number;
  justified: number;
}

export function CaseAnalyticsChart() {
  const [chartData, setChartData] = useState<ChartDataItem[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchChartData = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await api.get('/api/v1/my-cases/analytics');
        const analyticsData = response.data?.data;

        if (analyticsData && analyticsData.caseAnalytics) {
          // 3. CORRECTED: Map from the correct backend properties
          const formattedData: ChartDataItem[] = analyticsData.caseAnalytics.map((item: CaseAnalyticsItem) => ({
            month: item.month,
            justified: item.casesWithBases,       // Use casesWithBases
            unjustified: item.casesWithoutBases, // Use casesWithoutBases
          }));
          setChartData(formattedData);
        } else {
          setChartData([]);
        }
      } catch (err) {
        console.error("Failed to fetch chart data:", err);
        setError("Could not load case analytics.");
      } finally {
        setLoading(false);
      }
    };

    fetchChartData();
  }, []);

  const maxValue = chartData.reduce((max, item) => {
    // 4. IMPROVED: Use clearer variable names here as well
    const currentMax = Math.max(item.justified, item.unjustified);
    return currentMax > max ? currentMax : max;
  }, 0) * 1.25 || 10; // Ensure maxValue is at least 10 to prevent division by zero and give a baseline

  const renderContent = () => {
    if (loading) {
      return <div className="flex items-center justify-center h-64 text-gray-500">Loading Chart Data...</div>;
    }

    if (error) {
      return <div className="flex items-center justify-center h-64 text-red-500">{error}</div>;
    }
    
    if (chartData.length === 0) {
        return <div className="flex items-center justify-center h-64 text-gray-500">No analytics data available.</div>;
    }

    return (
      <div className="relative h-64">
        <div className="absolute inset-0 grid grid-rows-4 w-full h-full">
          {[...Array(4)].map((_, i) => (
            <div key={i} className="border-b border-dashed border-gray-200"></div>
          ))}
        </div>

        <div className="relative flex items-end justify-around h-full px-4">
          {chartData.map((data, index) => (
            <div key={index} className="flex flex-col items-center flex-1 gap-2 h-full justify-end">
              <div className="flex items-end gap-2 h-full">
                {/* Unjustified bar */}
                <div
                  className="bg-[#ff8181] rounded-t-lg w-5 transition-all hover:opacity-80"
                  style={{ height: `${(data.unjustified / maxValue) * 100}%` }}
                  title={`Unjustified: ${data.unjustified}`}
                ></div>
                {/* Justified bar */}
                <div
                  className="bg-[#84b082] rounded-t-lg w-5 transition-all hover:opacity-80"
                  style={{ height: `${(data.justified / maxValue) * 100}%` }}
                  title={`Justified: ${data.justified}`}
                ></div>
              </div>
              <span className="text-xs font-medium text-gray-700">{data.month}</span>
            </div>
          ))}
        </div>
      </div>
    );
  };

  return (
    <Card className="border-none shadow-sm">
      <CardHeader>
        <div className="flex items-center justify-between">
          <CardTitle className="text-lg font-semibold text-[#0a4f78]">Case Analytics</CardTitle>
          <div className="flex items-center gap-4 text-sm">
            {/* 5. IMPROVED: Updated labels for clarity */}
            <div className="flex items-center gap-2">
              <div className="w-3 h-3 rounded-full bg-[#ff8181]"></div>
              <span className="text-gray-600">WithoutBasis</span>
            </div>
            <div className="flex items-center gap-2">
              <div className="w-3 h-3 rounded-full bg-[#84b082]"></div>
              <span className="text-gray-600">WithBasis</span>
            </div>
          </div>
        </div>
      </CardHeader>
      <CardContent className="px-2">
        {renderContent()}
      </CardContent>
    </Card>
  );
}
</file>

<file path="frontend/src/components/casedetails.tsx">
"use client";

import { useEffect, useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { ExplanatoryNote } from "./explanatorynote";
import api from "@/lib/api";
import Link from "next/link";
import { useRouter } from 'next/navigation';
import { File as FileIcon } from "lucide-react";


interface TaxAuditedDTO {
  taxAuditedId: string;
  taxTypeAudited: string;
  principalAmountToBePaid: number;
  understatementFines: number;
  fixedAdministrativeFines: number;
  dischargedAmount: number;
  totalTaxAndFinesToBePaid: number;
  appeals: any[];
}

interface CaseDetailsData {
  caseId: string;
  auditorsName: string;
  appealDate: string;
  tin: string;
  taxAudited: TaxAuditedDTO[];
  attachmentLink: string;
}

export function CaseDetailsPage({ caseId }: { caseId: string }) {
  const [caseDetails, setCaseDetails] = useState<CaseDetailsData | null>(null);
  const [loading, setLoading] = useState<boolean>(true);
  const [error, setError] = useState<string | null>(null);
  const router = useRouter();

  useEffect(() => {
    if (caseId) {
      const fetchCaseDetails = async () => {
        setLoading(true);
        setError(null);
        try {
          const response = await api.get(`/api/v1/auth/explanatory_note/${caseId}`);
          if (response.data && response.data.data) {
            setCaseDetails(response.data.data);
          } else {
            throw new Error("Case data not found in API response.");
          }
        } catch (err) {
          console.error("Failed to fetch case details:", err);
          setError("Failed to load case details. Please try again.");
        } finally {
          setLoading(false);
        }
      };

      fetchCaseDetails();
    }
  }, [caseId]);

  if (loading) {
    return <div className="text-center p-8">Loading case details...</div>;
  }

  if (error || !caseDetails) {
    return <div className="text-center text-red-500 p-8">{error || "Case not found."}</div>;
  }
  
  const totalTaxToBePaid = caseDetails.taxAudited.reduce(
    (sum, item) => sum + item.totalTaxAndFinesToBePaid, 0
  );

  return (
    <>
      {/* --- 2. RESTORE THE FULL UI FOR THE CASE DETAILS PAGE --- */}
      <Card className="w-full max-w-4xl mx-auto my-8 p-6 shadow-lg">
        <CardContent className="p-0">
          {/* Case Information Section */}
          <div className="grid md:grid-cols-2 gap-8 mb-8">
            <div>
              <h2 className="text-xl font-bold mb-4">Case Information</h2>
              <hr className="border-1" />
              <div className="mt-3 grid grid-cols-2 gap-y-2 text-sm">
                <p className="text-gray-600">Case ID</p>
                <p className="font-medium">{caseDetails.caseId}</p>

                <p className="text-gray-600">Appeal Date</p>
                <p className="font-medium">{new Date(caseDetails.appealDate).toLocaleDateString()}</p>

                <p className="text-gray-600">Tax to be paid</p>
                <p className="font-bold text-red-500">{totalTaxToBePaid.toLocaleString()} RWF</p>
              </div>
            </div>

            {/* Taxpayer Details Section */}
            <div>
              <h2 className="text-xl font-bold mb-4">Taxpayer Details</h2>
              <hr className="border-1" />
              <div className="mt-3 grid grid-cols-2 gap-y-2 text-sm">
                <p className="text-gray-600">Taxpayer TIN</p>
                <p className="font-medium">{caseDetails.tin}</p>
                
                <p className="text-gray-600">Auditor</p>
                <p className="font-medium">{caseDetails.auditorsName}</p>
              </div>
            </div>
          </div>

          {/* Audited Tax Types Section (with corrected links) */}
          <div className="mb-8">
            <h2 className="text-xl font-bold mb-4">Audited Tax Types</h2>
            <hr className="border-1" />
            <div className="grid md:grid-cols-4 gap-4 p-2 mt-3">
              {caseDetails.taxAudited.map((taxItem) => (
                <Link
                  key={taxItem.taxAuditedId}
                  href={`/meetings/case-details/tax-type-details?caseId=${caseDetails.caseId}&taxAuditedId=${taxItem.taxAuditedId}`}
                  className="bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition duration-150 ease-in-out cursor-pointer flex justify-center items-center py-4 text-center"
                >
                  <span className="text-lg font-semibold text-[#18668D] underline">
                    {taxItem.taxTypeAudited}
                  </span>
                </Link>
              ))}
            </div>
          </div>

          {/* Attachment Section */}
          <div>
            <h2 className="text-xl font-bold mb-4">Attachments</h2>
            <hr className="border-gray-200" />
            <div className="mt-4">
              {caseDetails.attachmentLink ? (
                <a
                  href={caseDetails.attachmentLink}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="inline-flex items-center gap-2 bg-gray-100 border border-gray-300 rounded-full px-4 py-2 text-sm font-medium text-gray-800 hover:bg-gray-200 transition-colors"
                >
                  <FileIcon className="h-4 w-4 text-gray-600" />
                  <span>Attachment Preview</span>
                </a>
              ) : (
                <p className="text-sm text-gray-500 italic">
                  No attachment was provided for this case.
                </p>
              )}
            </div>
          </div>
        </CardContent>
      </Card>
      
      {/* Back Button */}
      <Button 
        onClick={() => router.back()}
        className="bg-[#18668D] hover:bg-[#134d66]"
      >
        Back
      </Button>
    </>
  );
}
</file>

<file path="frontend/src/components/cases.tsx">
"use client";

import { useState, useEffect } from "react";
import Link from 'next/link';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import {
  Pagination,
  PaginationContent,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
} from "@/components/ui/pagination";
import api from "@/lib/api";
import { Trash2 } from "lucide-react";
import { Case } from "@/app/types/case";

// Interface for a single case from the API
interface AgendaCase {
  caseId: string;
  taxpayerName: string;
  casePresenter: string;
  tin: string;
  caseStatus: "PENDING" | "RESOLVED" | "SUBMITTED";
  daysLeft: number;
  appealDate: string;
  amountDischarged: number;
  taxToBePaid: number;
  auditor: string;
}

// Interface for the paginated response from the API
interface Page<T> {
  content: T[];
  totalPages: number;
  totalElements: number;
  number: number; 
}

export default function AgendaCasesPage() {
  const [pageData, setPageData] = useState<Page<AgendaCase> | null>(null);
  const [allCases, setAllCases] = useState<Case[]>([]);
  const [currentPage, setCurrentPage] = useState(0);
  const [loading, setLoading] = useState<boolean>(true);
  const [error, setError] = useState<string | null>(null);
  
  const [searchQuery, setSearchQuery] = useState("");
  const [showFilters, setShowFilters] = useState(false); 
  const [statusFilter, setStatusFilter] = useState("All");
  const PAGE_SIZE = 5;

  useEffect(() => {
    const fetchAgenda = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await api.get<Page<AgendaCase>>("/api/v1/agenda/", {
          params: { page: currentPage, size: PAGE_SIZE },
        });
        setPageData(response.data);
      } catch (err: any) {
        const message = err.response?.data?.message || err.message || "Failed to fetch agenda.";
        setError(`Error: ${message}`);
        console.error("Failed to fetch agenda:", err);
      } finally {
        setLoading(false);
      }
    };

    fetchAgenda();
  }, [currentPage]);

  const handleDeleteCase = async (caseId: string) => {
    // 1. Confirm with the user before deleting
    if (!window.confirm(`Are you sure you want to delete case ${caseId}? This action cannot be undone.`)) {
      return;
    }

    try {
      // 2. Make the API call to the DELETE endpoint
      await api.delete(`/api/v1/auth/explanatory_note/${caseId}`);

      // 3. On success, update the state to remove the case from the UI
      setAllCases(currentCases => currentCases.filter(c => c.caseId !== caseId));
      
      alert("Case deleted successfully.");

    } catch (err: any) {
      console.error("Failed to delete case:", err);
      const errorMessage = err.response?.data?.message || "Failed to delete the case. Please try again.";
      alert(errorMessage);
    }
  };

  const filteredCases = pageData?.content.filter((_case) => {
    const matchesSearch =
      _case.caseId.toLowerCase().includes(searchQuery.toLowerCase()) ||
      (_case.taxpayerName?.toLowerCase() || '').includes(searchQuery.toLowerCase()) ||
      _case.tin.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesStatus = statusFilter === "All" || _case.caseStatus === statusFilter;
    return matchesSearch && matchesStatus;
  }) || [];

  const handlePageChange = (newPage: number) => {
    if (pageData && newPage >= 0 && newPage < pageData.totalPages) {
      setCurrentPage(newPage);
    }
  };
  
  // Restore the handleFilterByStatus function
  const handleFilterByStatus = (status: string) => {
    setStatusFilter(status);
  };

  // Restore the getStatusStyle function
  const getStatusStyle = (status: string) => {
    switch (status) {
      case "PENDING": return "bg-yellow-100 text-yellow-800";
      case "RESOLVED": return "bg-green-100 text-green-800";
      case "SUBMITTED": return "bg-blue-100 text-blue-800";
      default: return "bg-gray-100 text-gray-800";
    }
  };

  return (
    <div className="container mx-auto p-4 max-w-4xl">
      <div className="space-y-2 mb-8">
        <h1 className="text-3xl font-bold">Agenda</h1>
        <p className="text-gray-600">View all cases to be discussed this week</p>
      </div>

      {/* --- THIS IS YOUR ORIGINAL FILTER UI --- */}
      <div className="flex items-center space-x-2 mb-4">
        <Input
          placeholder="Search by Case ID, Name, or TIN..."
          className="max-w-xs flex-grow bg-white"
          value={searchQuery}
          onChange={(e) => setSearchQuery(e.target.value)}
        />
        <Button
          variant="outline"
          size="icon"
          className="h-10 w-10"
          onClick={() => setShowFilters(!showFilters)}
        >
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
            <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
        </Button>
      </div>
      
      {showFilters && (
        <div className="rounded-lg border p-4 mb-4 bg-white">
          <h3 className="font-semibold mb-2">Filter by Status</h3>
          <div className="flex space-x-2">
            <Button variant="secondary" className="hover:bg-[#18668D] hover:text-white" onClick={() => handleFilterByStatus("All")}>All</Button>
            <Button variant="secondary" className="hover:bg-[#18668D] hover:text-white" onClick={() => handleFilterByStatus("PENDING")}>Pending</Button>
            <Button variant="secondary" className="hover:bg-[#18668D] hover:text-white" onClick={() => handleFilterByStatus("RESOLVED")}>Resolved</Button>
            <Button variant="secondary" className="hover:bg-[#18668D] hover:text-white" onClick={() => handleFilterByStatus("SUBMITTED")}>Submitted</Button>
          </div>
        </div>
      )}
      {/* --- END OF FILTER UI --- */}

      <div className="rounded-lg border overflow-x-auto bg-white">
        <Table className="w-full">
          <TableHeader>
            <TableRow className="bg-white hover:bg-gray-50">
              <TableHead>No</TableHead>
              <TableHead>Tax Payer</TableHead>
              <TableHead>Days Left</TableHead>
              <TableHead>Tax Assessed (RWF)</TableHead>
              <TableHead>Amount Discharged</TableHead>
              <TableHead>Tax To Be Paid (RWF)</TableHead>
              <TableHead>Case Presenter</TableHead>
              <TableHead>Auditor</TableHead>
              <TableHead>Case</TableHead>
              <TableHead>Status</TableHead>
              <TableHead>Action</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {loading ? (
              <TableRow><TableCell colSpan={10} className="h-24 text-center">Loading agenda cases...</TableCell></TableRow>
            ) : error ? (
              <TableRow><TableCell colSpan={10} className="h-24 text-center text-red-600">{error}</TableCell></TableRow>
            ) : filteredCases.length > 0 ? (
              filteredCases.map((_case, index) => {
                const taxOriginal = (_case.taxToBePaid || 0) + (_case.amountDischarged || 0);
                return (
                <TableRow key={_case.caseId}>
                  <TableCell className="font-medium">{(currentPage * PAGE_SIZE) + index + 1}</TableCell>
                  <TableCell>{_case.taxpayerName || 'N/A'}</TableCell>
                  <TableCell>{_case.daysLeft} days</TableCell>
                  <TableCell>{taxOriginal.toLocaleString()}</TableCell>
                  <TableCell>{_case.amountDischarged.toLocaleString()}</TableCell>
                  <TableCell>{_case.taxToBePaid.toLocaleString()}</TableCell>
                  <TableCell>{_case.casePresenter}</TableCell>
                  <TableCell>{_case.auditor}</TableCell>
                  <TableCell className="text-blue-500 cursor-pointer hover:underline">
                    <Link href={`/meetings/case-details?caseId=${_case.caseId}`}>
                      view case
                    </Link>
                  </TableCell>
                  <TableCell>
                    <span className={`px-3 py-1.5 rounded-full text-xs font-semibold ${getStatusStyle(_case.caseStatus)}`}>
                      {_case.caseStatus}
                    </span>
                  </TableCell>
                  <TableCell>
                    <Button type="button" variant="ghost" size="icon" onClick={() => handleDeleteCase(_case.caseId)}>
                            <Trash2 className="h-5 w-5 text-red-500" />
                        </Button>
                  </TableCell>
                </TableRow>
              )})
            ) : (
              <TableRow><TableCell colSpan={10} className="h-24 text-center">No cases found.</TableCell></TableRow>
            )}
          </TableBody>
        </Table>
      </div>
      
      <div className="flex justify-between items-center mt-4 text-sm text-gray-500">
        <span>
            Showing {filteredCases.length} of {pageData?.totalElements || 0} cases
        </span>
        {pageData && pageData.totalPages > 1 && (
            <Pagination>
              <PaginationContent>
                <PaginationItem>
                  <PaginationPrevious 
                    href="#" 
                    onClick={(e) => { e.preventDefault(); handlePageChange(currentPage - 1); }}
                    aria-disabled={currentPage === 0}
                    className={currentPage === 0 ? 'pointer-events-none opacity-50' : ''}
                  />
                </PaginationItem>
                {[...Array(pageData.totalPages).keys()].map(pageNumber => (
                  <PaginationItem key={pageNumber}>
                    <PaginationLink 
                      href="#"
                      onClick={(e) => { e.preventDefault(); handlePageChange(pageNumber); }}
                      isActive={currentPage === pageNumber}
                    >
                      {pageNumber + 1}
                    </PaginationLink>
                  </PaginationItem>
                ))}
                <PaginationItem>
                  <PaginationNext 
                    href="#" 
                    onClick={(e) => { e.preventDefault(); handlePageChange(currentPage + 1); }}
                    aria-disabled={currentPage >= pageData.totalPages - 1}
                    className={currentPage >= pageData.totalPages - 1 ? 'pointer-events-none opacity-50' : ''}
                  />
                </PaginationItem>
              </PaginationContent>
            </Pagination>
        )}
      </div>
    </div>
  );
}
</file>

<file path="frontend/src/components/casesubmitted.tsx">
// app/components/SubmissionSuccessModal.tsx
"use client";

import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";
import { Button } from "@/components/ui/button";

interface SubmissionSuccessModalProps {
  caseId: string;
  isOpen: boolean;
  onBack: () => void;
}

export function CaseSubmissionSuccess({
  caseId,
  isOpen,
  onBack,
}: SubmissionSuccessModalProps) {
  return (
    <Dialog open={isOpen} onOpenChange={() => {}}>
      <DialogContent className="sm:max-w-[425px]">
        <div className="h-2 w-full flex">
          <div className="h-full w-1/3 bg-[#18668D]"></div>
          <div className="h-full w-1/3 bg-[#FDBB2A]"></div>
          <div className="h-full w-1/3 bg-[#4BAF4F]"></div>
        </div>
        <DialogHeader>
          <DialogTitle className="text-xl font-bold">Tax Case Form</DialogTitle>
          <DialogDescription className="text-lg text-gray-700 mt-2">
            Your explanatory note for case **{caseId}** has been successfully submitted! You&apos;ve been notified for any updates.
          </DialogDescription>
        </DialogHeader>
        <div className="flex justify-center">
          <Button onClick={onBack} className="bg-[#18668D]">
            Back
          </Button>
        </div>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="frontend/src/components/explanatorynote.tsx">
"use client";

import { useState, useEffect } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import api from "@/lib/api";
import jsPDF from "jspdf";
import { Loader2, FileDown } from "lucide-react";

import { Button } from "@/components/ui/button";
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";

// --- Types ---
interface CaseSummary {
  caseId: string;
  taxPayerName?: string; // Optional depending on your API
}

interface AppealPoint {
  AppealId: string;
  appealPoint: string;
  auditorsOpinion: string;
  proposedSolution: string;
}

interface TaxAudited {
  taxTypeAudited: string;
  appeals: AppealPoint[];
}

// --- Schema ---
const formSchema = z.object({
  caseId: z.string().min(1, "Please select a Case ID"),
  appealPointId: z.string().min(1, "Please select an Appeal Point"),
  additionalComments: z.string().optional(),
});

type FormValues = z.infer<typeof formSchema>;

export function ExplanatoryNoteGenerator() {
  const [cases, setCases] = useState<CaseSummary[]>([]);
  const [availableAppeals, setAvailableAppeals] = useState<AppealPoint[]>([]);
  const [isLoadingCases, setIsLoadingCases] = useState(false);
  const [isLoadingDetails, setIsLoadingDetails] = useState(false);
  
  // We store the full selected objects to use in the PDF later
  const [selectedCaseData, setSelectedCaseData] = useState<any>(null);

  const form = useForm<FormValues>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      caseId: "",
      appealPointId: "",
      additionalComments: "",
    },
  });

  // 1. Fetch All Cases for the dropdown
  useEffect(() => {
    const fetchCases = async () => {
      setIsLoadingCases(true);
      try {
        // NOTE: Using the endpoint you requested. 
        // If this doesn't exist in backend, swap with '/api/v1/my-cases/my-cases' or '/api/v1/agenda/'
        const response = await api.get("/api/v1/all-cases"); 
        
        // Handling different possible response structures based on your previous code
        const data = response.data.data || response.data.content || response.data;
        
        if (Array.isArray(data)) {
          setCases(data);
        }
      } catch (error) {
        console.error("Failed to fetch cases:", error);
      } finally {
        setIsLoadingCases(false);
      }
    };
    fetchCases();
  }, []);

  // 2. Fetch Appeal Points when Case ID changes
  const handleCaseIdChange = async (caseId: string) => {
    form.setValue("caseId", caseId);
    form.setValue("appealPointId", ""); // Reset appeal point
    setAvailableAppeals([]); // Clear previous appeals
    
    if (!caseId) return;

    setIsLoadingDetails(true);
    try {
      const response = await api.get(`/api/v1/auth/explanatory_note/${caseId}`);
      
      if (response.data && response.data.data) {
        const caseData = response.data.data;
        setSelectedCaseData(caseData);

        // Flatten appeals from all tax types
        const allAppeals: AppealPoint[] = [];
        if (caseData.taxAudited && Array.isArray(caseData.taxAudited)) {
          caseData.taxAudited.forEach((taxItem: TaxAudited) => {
            if (taxItem.appeals) {
              allAppeals.push(...taxItem.appeals);
            }
          });
        }
        setAvailableAppeals(allAppeals);
      }
    } catch (error) {
      console.error("Failed to fetch case details:", error);
      alert("Could not fetch appeal points for this case.");
    } finally {
      setIsLoadingDetails(false);
    }
  };

  // 3. PDF Generation Logic
  const generatePDF = (values: FormValues) => {
    const doc = new jsPDF();
    const margin = 20;
    let yPos = 20;

    // Find the specific appeal object for details
    const selectedAppeal = availableAppeals.find(a => a.AppealId === values.appealPointId);

    // Header
    doc.setFontSize(18);
    doc.setTextColor(24, 102, 141); // RRA Blue color
    doc.text("Explanatory Note Report", margin, yPos);
    yPos += 15;

    // Case Info
    doc.setFontSize(12);
    doc.setTextColor(0, 0, 0);
    doc.setFont("helvetica", "bold");
    doc.text(`Case ID: ${values.caseId}`, margin, yPos);
    yPos += 10;
    
    if (selectedCaseData) {
        doc.setFont("helvetica", "normal");
        doc.text(`Taxpayer TIN: ${selectedCaseData.tin || 'N/A'}`, margin, yPos);
        yPos += 10;
        doc.text(`Auditor: ${selectedCaseData.auditorsName || 'N/A'}`, margin, yPos);
        yPos += 15;
    }

    // Line Separator
    doc.setLineWidth(0.5);
    doc.line(margin, yPos, 190, yPos);
    yPos += 10;

    // Appeal Point Details
    if (selectedAppeal) {
        doc.setFont("helvetica", "bold");
        doc.text("Selected Appeal Point:", margin, yPos);
        yPos += 7;
        
        doc.setFont("helvetica", "normal");
        doc.setFontSize(11);
        // splitTextToSize handles wrapping text so it doesn't go off page
        const splitTitle = doc.splitTextToSize(selectedAppeal.appealPoint, 170);
        doc.text(splitTitle, margin, yPos);
        yPos += (splitTitle.length * 6) + 5;

        doc.setFont("helvetica", "bold");
        doc.text("Auditor's Opinion:", margin, yPos);
        yPos += 7;

        doc.setFont("helvetica", "normal");
        const splitOpinion = doc.splitTextToSize(selectedAppeal.auditorsOpinion || "N/A", 170);
        doc.text(splitOpinion, margin, yPos);
        yPos += (splitOpinion.length * 6) + 5;
    }

    // Additional Comments
    if (values.additionalComments) {
        yPos += 5;
        doc.setFont("helvetica", "bold");
        doc.text("Additional Comments:", margin, yPos);
        yPos += 7;
        doc.setFont("helvetica", "normal");
        const splitComments = doc.splitTextToSize(values.additionalComments, 170);
        doc.text(splitComments, margin, yPos);
    }

    // Footer / Date
    const dateStr = new Date().toLocaleDateString();
    doc.setFontSize(10);
    doc.setTextColor(150);
    doc.text(`Generated on: ${dateStr}`, margin, 280);

    // Save
    doc.save(`Explanatory_Note_${values.caseId}.pdf`);
  };

  const onSubmit = (values: FormValues) => {
    generatePDF(values);
  };

  return (
    <Card className="w-full max-w-2xl mx-auto my-8 shadow-lg">
      <CardHeader className="bg-gray-50 border-b">
        <CardTitle className="text-xl text-[#18668D]">Generate Explanatory Note PDF</CardTitle>
      </CardHeader>
      <CardContent className="pt-6">
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
            
            {/* Case ID Selection */}
            <FormField
              control={form.control}
              name="caseId"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Select Case ID</FormLabel>
                  <Select 
                    onValueChange={(val) => handleCaseIdChange(val)} 
                    value={field.value}
                    disabled={isLoadingCases}
                  >
                    <FormControl>
                      <SelectTrigger>
                        <SelectValue placeholder={isLoadingCases ? "Loading cases..." : "Select a case identifier"} />
                      </SelectTrigger>
                    </FormControl>
                    <SelectContent>
                      {cases.map((c) => (
                        <SelectItem key={c.caseId} value={c.caseId}>
                          {c.caseId} {c.taxPayerName ? `- ${c.taxPayerName}` : ""}
                        </SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Appeal Point Selection (Dependent on Case ID) */}
            <FormField
              control={form.control}
              name="appealPointId"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Select Appeal Point</FormLabel>
                  <Select 
                    onValueChange={field.onChange} 
                    value={field.value}
                    disabled={!form.getValues("caseId") || isLoadingDetails}
                  >
                    <FormControl>
                      <SelectTrigger>
                        <SelectValue placeholder={
                          !form.getValues("caseId") 
                            ? "Select a case first" 
                            : isLoadingDetails 
                              ? "Loading appeal points..." 
                              : "Select an appeal point"
                        } />
                      </SelectTrigger>
                    </FormControl>
                    <SelectContent>
                      {availableAppeals.length === 0 && !isLoadingDetails ? (
                        <SelectItem value="none" disabled>No appeal points found</SelectItem>
                      ) : (
                        availableAppeals.map((appeal) => (
                          <SelectItem key={appeal.AppealId} value={appeal.AppealId}>
                            {appeal.appealPoint.substring(0, 60)}{appeal.appealPoint.length > 60 ? "..." : ""}
                          </SelectItem>
                        ))
                      )}
                    </SelectContent>
                  </Select>
                  <FormMessage />
                </FormItem>
              )}
            />

            {/* Additional Comments */}
            <FormField
              control={form.control}
              name="additionalComments"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Additional Comments (Optional)</FormLabel>
                  <FormControl>
                    <Textarea 
                      placeholder="Enter any extra notes to appear in the PDF..." 
                      className="min-h-[100px]" 
                      {...field} 
                    />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            <Button 
              type="submit" 
              className="w-full bg-[#18668D] hover:bg-[#134d66]"
              disabled={!form.formState.isValid}
            >
              <FileDown className="mr-2 h-4 w-4" />
              Generate PDF
            </Button>

          </form>
        </Form>
      </CardContent>
    </Card>
  );
}
</file>

<file path="frontend/src/components/InvitationTemplateModal.tsx">
"use client";

import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import { useState } from "react";
import api from "@/lib/api";

import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
} from "@/components/ui/dialog";
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";

// Zod schema for form validation (keeps user-friendly HH:mm format)
const formSchema = z.object({
  venue: z.string().min(3, {
    message: "Venue must be at least 3 characters long.",
  }),
  meetingTime: z.string().regex(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/, {
    message: "Please enter a valid time in HH:mm format (e.g., 14:30).",
  }),
});

type FormValues = z.infer<typeof formSchema>;

interface InvitationTemplateModalProps {
  isOpen: boolean;
  onClose: () => void;
}

export function InvitationTemplateModal({ isOpen, onClose }: InvitationTemplateModalProps) {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const form = useForm<FormValues>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      venue: "",
      meetingTime: "",
    },
  });

  // Function to handle form submission
  async function onSubmit(values: FormValues) {
    setLoading(true);
    setError(null);

    // --- THIS IS THE MODIFIED PART ---
    // Construct the payload to match the backend's "HH:mm:ss" format
    const payload = {
      venue: values.venue,
      meetingTime: `${values.meetingTime}:00`, // Append seconds to the time string
    };
    // --- END OF MODIFICATION ---

    try {
      await api.put('/api/v1/meeting-info/3', payload); 
      
      alert("Invitation details updated successfully!");
      onClose(); // Close the modal on success
    } catch (err) {
      console.error("Failed to update invitation details:", err);
      setError("Failed to update details. Please try again.");
    } finally {
      setLoading(false);
    }
  }

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="sm:max-w-[425px]">
        <DialogHeader>
          <DialogTitle>Invitation Date-Venue</DialogTitle>
          <DialogDescription>
            Update the default venue and time for meeting invitations.
          </DialogDescription>
        </DialogHeader>
        <Form {...form}>
          <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
            <div className="p-4 border rounded-lg bg-white">
                <h3 className="font-semibold mb-4">Email information</h3>
                <div className="space-y-4">
                    <FormField
                    control={form.control}
                    name="venue"
                    render={({ field }) => (
                        <FormItem>
                        <FormLabel>Venue</FormLabel>
                        <FormControl>
                            <Input placeholder="e.g., RRA Headquarters, Room 501" {...field} />
                        </FormControl>
                        <FormMessage />
                        </FormItem>
                    )}
                    />
                    <FormField
                    control={form.control}
                    name="meetingTime"
                    render={({ field }) => (
                        <FormItem>
                        <FormLabel>Meeting Hour</FormLabel>
                        <FormControl>
                            <Input placeholder="HH:mm (e.g., 14:30)" {...field} />
                        </FormControl>
                        <FormMessage />
                        </FormItem>
                    )}
                    />
                </div>
            </div>

             {error && <p className="text-sm text-red-600">{error}</p>}

            <DialogFooter>
              <Button 
                type="submit" 
                className="bg-[#18668D] hover:bg-[#134d66]"
                disabled={loading}
              >
                {loading ? "Updating..." : "Update"}
              </Button>
            </DialogFooter>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="frontend/src/components/meetingminutes.tsx">
"use client";

import { useState } from "react";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";
import { Download } from "lucide-react";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import {
  Pagination,
  PaginationContent,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
} from "@/components/ui/pagination";
import { meetingminutes } from "@/app/types/minutes-mock-data";
import Link from "next/link";

export default function MeetingMinutesPage() {
  const [searchQuery, setSearchQuery] = useState("");
  const [showFilters, setShowFilters] = useState(false);
  const [filterPreparedBy, setFilterPreparedBy] = useState("");
  const [filterDate, setFilterDate] = useState("");

  // Filtering logic
  const filteredCases = meetingminutes.filter((m) =>
    (filterPreparedBy === "" ||
      m.preparedBy.toLowerCase().includes(filterPreparedBy.toLowerCase())) &&
    (filterDate === "" || m.date === filterDate)
  );

  return (
    <div className="container mx-auto p-4 max-w-4xl">
      <div className="space-y-2 mb-8">
        <h1 className="text-3xl font-bold">This week Cases</h1>
        <p className="text-gray-600">
          View all minutes of cases discussed this week
        </p>
      </div>

      <div className="flex items-center space-x-2 mb-4">
        <Input
          placeholder="Search minutes ..."
          className="max-w-xs flex-grow bg-white"
          value={searchQuery}
          onChange={(e) => setSearchQuery(e.target.value)}
        />
        <Button
          variant="outline"
          size="icon"
          className="h-10 w-10"
          onClick={() => setShowFilters(!showFilters)}
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            strokeWidth={1.5}
            stroke="currentColor"
            className="w-5 h-5"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
            />
          </svg>
        </Button>
      </div>

      {/* Filter Section */}
      {showFilters && (
        <div className="rounded-lg border p-4 mb-4 bg-white">
          <h3 className="font-semibold mb-2">Filter Options</h3>
          <div className="flex flex-col md:flex-row md:items-center md:space-x-4 space-y-2 md:space-y-0">
            {/* Filter by Prepared By */}
            <div className="flex flex-col space-y-1">
              <label className="text-sm font-medium text-gray-600">
                Prepared By
              </label>
              <Input
                type="text"
                placeholder="Enter name..."
                className="bg-white border-gray-300"
                value={filterPreparedBy}
                onChange={(e) => setFilterPreparedBy(e.target.value)}
              />
            </div>

            {/* Filter by Date */}
            <div className="flex flex-col space-y-1">
              <label className="text-sm font-medium text-gray-600">Date</label>
              <Input
                type="date"
                className="bg-white border-gray-300"
                value={filterDate}
                onChange={(e) => setFilterDate(e.target.value)}
              />
            </div>
          </div>
        </div>
      )}

      {/* Table Section */}
      <div className="rounded-lg border overflow-x-auto bg-white">
        <Table className="w-full">
          <TableHeader>
            <TableRow className="bg-white hover:bg-gray-50">
              <TableHead className="w-[50px] text-gray-500 font-normal whitespace-normal">
                No
              </TableHead>
              <TableHead className="text-gray-500 font-normal whitespace-normal">
                Prepared By
              </TableHead>
              <TableHead className="text-gray-500 font-normal whitespace-normal">
                Date
              </TableHead>
              <TableHead className="text-gray-500 font-normal whitespace-normal">
                Type
              </TableHead>
              <TableHead className="text-gray-500 font-normal whitespace-normal">
                Doc
              </TableHead>
              <TableHead className="text-gray-500 font-normal whitespace-normal">
                Action
              </TableHead>
            </TableRow>
          </TableHeader>

          <TableBody>
            {filteredCases.length > 0 ? (
              filteredCases.map((_minute, index) => (
                <TableRow key={index}>
                  <TableCell className="font-medium whitespace-normal">
                    {index + 1}
                  </TableCell>
                  <TableCell className="whitespace-normal">
                    {_minute.preparedBy}
                  </TableCell>
                  <TableCell>{_minute.date}</TableCell>
                  <TableCell className="whitespace-normal">
                    {_minute.type}
                  </TableCell>
                  <TableCell className="text-blue-500 cursor-pointer">
                    <a href="/reports/minute-details">view minute</a>
                  </TableCell>
                  <TableCell className="whitespace-normal">
                    <Button
                      asChild
                      variant="outline"
                      size="sm"
                      className="flex items-center gap-2"
                    >
                      <Link href="/file.pdf" download>
                        <Download className="h-4 w-4" />
                      </Link>
                    </Button>
                  </TableCell>
                </TableRow>
              ))
            ) : (
              <TableRow>
                <TableCell colSpan={10} className="h-24 text-center">
                  No matching minutes found.
                </TableCell>
              </TableRow>
            )}
          </TableBody>
        </Table>
      </div>

      {/* Generate Button */}
      <Button className="my-4 bg-[#18668D] hover:bg-[#053852] hover:underline">
        <a href="/reports/new-minutes">Generate Meeting minutes</a>
      </Button>

      {/* Pagination */}
      <div className="flex justify-between items-center mt-4 text-sm text-gray-500">
        <span>showing 3 of 5 pages</span>
        <Pagination className="w-auto mx-0">
          <PaginationContent>
            <PaginationItem>
              <PaginationPrevious href="#" />
            </PaginationItem>
            <PaginationItem>
              <PaginationLink href="#" isActive>
                1
              </PaginationLink>
            </PaginationItem>
            <PaginationItem>
              <PaginationLink href="#">2</PaginationLink>
            </PaginationItem>
            <PaginationItem>
              <PaginationLink href="#">3</PaginationLink>
            </PaginationItem>
            <PaginationItem>
              <PaginationNext href="#" />
            </PaginationItem>
          </PaginationContent>
        </Pagination>
      </div>
    </div>
  );
}
</file>

<file path="frontend/src/components/minutesform.tsx">
"use client";

import { zodResolver } from "@hookform/resolvers/zod";
import { useFieldArray, useForm } from "react-hook-form";
import * as z from "zod";
import jsPDF from "jspdf";
import { Trash2, PlusCircle, FileDown, Loader2 } from "lucide-react";
import { useState } from "react";

import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Textarea } from "@/components/ui/textarea";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";

// 1. Schema for a SINGLE minute entry
const minuteEntrySchema = z.object({
  caseId: z.string().min(1, { message: "Case ID is required." }),
  taxPayerName: z.string().min(1, { message: "Tax Payer Name is required." }),
  caseIssue: z.string().min(1, { message: "Case issue is required." }),
  resolution: z.string().min(1, { message: "Resolution is required." }),
});

// 2. Main form schema containing an ARRAY of minutes
const formSchema = z.object({
  minutesList: z.array(minuteEntrySchema).min(1, { message: "At least one minute entry is required." }),
});

type FormValues = z.infer<typeof formSchema>;

export function MinutesForm() {
  const [isGenerating, setIsGenerating] = useState(false);

  const form = useForm<FormValues>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      minutesList: [
        {
          caseId: "",
          taxPayerName: "",
          caseIssue: "",
          resolution: "",
        },
      ],
    },
  });

  const { fields, append, remove } = useFieldArray({
    control: form.control,
    name: "minutesList",
  });

  // Helper function to load image from public folder and convert to Base64
  const getImageData = (url: string): Promise<string> => {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.src = url;
      img.crossOrigin = "Anonymous"; 
      img.onload = () => {
        const canvas = document.createElement("canvas");
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext("2d");
        if (ctx) {
          ctx.drawImage(img, 0, 0);
          resolve(canvas.toDataURL("image/png"));
        } else {
          reject(new Error("Canvas context is null"));
        }
      };
      img.onerror = (error) => reject(error);
    });
  };

  async function onSubmit(values: FormValues) {
    setIsGenerating(true);

    try {
      const doc = new jsPDF();
      const pageWidth = doc.internal.pageSize.getWidth();
      const margin = 15;
      let yPos = 15;
      const lineHeight = 6;
      
      // --- 1. ADD LOGO ---
      try {
        // Ensure /Rralogo.png exists in your public folder
        const logoData = await getImageData("/Rralogo.png");
        // Add image (x, y, width, height)
        doc.addImage(logoData, "PNG", margin, yPos, 25, 25); 
      } catch (err) {
        console.error("Could not load logo:", err);
        // Fallback text if logo fails
        doc.setFontSize(10);
        doc.text("[RRA LOGO]", margin, yPos + 10);
      }

      // --- 2. HEADER TEXT ---
      // RRA Blue Color for Header
      doc.setTextColor(24, 102, 141); 
      doc.setFont("helvetica", "bold");
      doc.setFontSize(22);
      doc.text("Rwanda Revenue Authority", 50, yPos + 10);
      
      doc.setFontSize(16);
      doc.setTextColor(100); // Gray
      doc.text("Meeting Minutes Report", 50, yPos + 18);

      doc.setLineWidth(0.5);
      doc.setDrawColor(200);
      doc.line(margin, yPos + 30, pageWidth - margin, yPos + 30);

      yPos += 45; // Move down below header

      // --- 3. CONTENT LOOP ---
      doc.setTextColor(0); // Black text
      doc.setFontSize(11);

      values.minutesList.forEach((item, index) => {
        // Check for page break
        if (yPos > 250) {
          doc.addPage();
          yPos = 20;
        }

        // --- Item Header Box ---
        doc.setFillColor(24, 102, 141); // RRA Blue background
        doc.rect(margin, yPos, pageWidth - (margin * 2), 8, "F");
        
        doc.setTextColor(255, 255, 255); // White text
        doc.setFont("helvetica", "bold");
        doc.text(`Minute Entry #${index + 1}`, margin + 3, yPos + 5.5);
        
        yPos += 14;

        // --- Case Details ---
        doc.setTextColor(0); // Reset to black
        
        // Row 1: Case ID and Taxpayer
        doc.setFont("helvetica", "bold");
        doc.text("Case ID:", margin, yPos);
        doc.setFont("helvetica", "normal");
        doc.text(item.caseId, margin + 25, yPos);

        doc.setFont("helvetica", "bold");
        doc.text("Tax Payer:", margin + 80, yPos);
        doc.setFont("helvetica", "normal");
        doc.text(item.taxPayerName, margin + 105, yPos);

        yPos += 10;

        // Row 2: Issue (Wrapped Text)
        doc.setFont("helvetica", "bold");
        doc.text("Case Issue / Appeal Point:", margin, yPos);
        yPos += 6;
        
        doc.setFont("helvetica", "normal");
        const splitIssue = doc.splitTextToSize(item.caseIssue, pageWidth - (margin * 2));
        doc.text(splitIssue, margin, yPos);
        yPos += (splitIssue.length * lineHeight) + 4;

        // Row 3: Resolution (Wrapped Text)
        // Highlight resolution slightly
        doc.setFillColor(245, 245, 245); // Very light gray bg for resolution
        const resolutionHeight = (doc.splitTextToSize(item.resolution, pageWidth - (margin * 2)).length * lineHeight) + 10;
        
        // Check page break before drawing resolution box
        if (yPos + resolutionHeight > 270) {
            doc.addPage();
            yPos = 20;
        }

        doc.rect(margin, yPos - 4, pageWidth - (margin * 2), resolutionHeight, "F");
        
        doc.setFont("helvetica", "bold");
        doc.text("Committee Resolution:", margin + 2, yPos + 2);
        yPos += 8;

        doc.setFont("helvetica", "normal");
        const splitResolution = doc.splitTextToSize(item.resolution, pageWidth - (margin * 2) - 5);
        doc.text(splitResolution, margin + 2, yPos);
        
        yPos += (splitResolution.length * lineHeight) + 15; // Spacing for next item
      });

      // --- 4. FOOTER ---
      const dateStr = new Date().toLocaleDateString("en-US", { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
      const pageCount = doc.getNumberOfPages();
      
      for (let i = 1; i <= pageCount; i++) {
        doc.setPage(i);
        doc.setFontSize(9);
        doc.setTextColor(150);
        doc.line(margin, 280, pageWidth - margin, 280); // Footer line
        doc.text(`Generated on: ${dateStr}`, margin, 288);
        doc.text(`Page ${i} of ${pageCount}`, pageWidth - margin - 20, 288);
      }

      // Save
      doc.save(`Meeting_Minutes_${new Date().toISOString().slice(0,10)}.pdf`);

    } catch (error) {
      console.error("PDF Generation Error", error);
      alert("Failed to generate PDF. Please check the console.");
    } finally {
      setIsGenerating(false);
    }
  }

  return (
    <div className="container p-4 max-w-3xl mx-auto">
      <Form {...form}>
        <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-8">
          
          {fields.map((field, index) => (
            <Card key={field.id} className="relative border-l-4 border-l-[#18668D] shadow-md bg-white">
              <CardHeader className="pb-2 bg-gray-50/50 border-b mb-4">
                <div className="flex justify-between items-center">
                  <CardTitle className="text-lg font-bold text-[#18668D]">
                    Minute Entry #{index + 1}
                  </CardTitle>
                  {fields.length > 1 && (
                    <Button
                      type="button"
                      variant="ghost"
                      size="icon"
                      className="text-red-500 hover:bg-red-50 hover:text-red-700"
                      onClick={() => remove(index)}
                    >
                      <Trash2 className="h-5 w-5" />
                    </Button>
                  )}
                </div>
              </CardHeader>
              
              <CardContent className="space-y-4">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <FormField
                    control={form.control}
                    name={`minutesList.${index}.caseId`}
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>Case ID</FormLabel>
                        <FormControl>
                          <Input placeholder="e.g. C-12345" {...field} />
                        </FormControl>
                        <FormMessage />
                      </FormItem>
                    )}
                  />

                  <FormField
                    control={form.control}
                    name={`minutesList.${index}.taxPayerName`}
                    render={({ field }) => (
                      <FormItem>
                        <FormLabel>Tax Payer Name</FormLabel>
                        <FormControl>
                          <Input placeholder="e.g. John Doe" {...field} />
                        </FormControl>
                        <FormMessage />
                      </FormItem>
                    )}
                  />
                </div>

                <FormField
                  control={form.control}
                  name={`minutesList.${index}.caseIssue`}
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel>Case Issue / Appeal Point</FormLabel>
                      <FormControl>
                        <Textarea 
                          placeholder="Describe the issue discussed..." 
                          className="resize-none min-h-[80px]" 
                          {...field} 
                        />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />

                <FormField
                  control={form.control}
                  name={`minutesList.${index}.resolution`}
                  render={({ field }) => (
                    <FormItem>
                      <FormLabel className="text-[#18668D] font-bold">Committee Resolution</FormLabel>
                      <FormControl>
                        <Textarea 
                          placeholder="Enter the final decision taken..." 
                          className="min-h-[100px] bg-blue-50/30 border-blue-200 focus-visible:ring-blue-500" 
                          {...field} 
                        />
                      </FormControl>
                      <FormMessage />
                    </FormItem>
                  )}
                />
              </CardContent>
            </Card>
          ))}

          <div className="flex flex-col sm:flex-row gap-4 justify-between pt-4 sticky bottom-4 bg-transparent">
            <Button
              type="button"
              variant="outline"
              className="border-dashed border-2 border-gray-400 hover:border-[#18668D] hover:text-[#18668D] bg-white/80 backdrop-blur-sm"
              onClick={() => append({ caseId: "", taxPayerName: "", caseIssue: "", resolution: "" })}
            >
              <PlusCircle className="mr-2 h-4 w-4" />
              Add New Minutes
            </Button>

            <Button 
              type="submit" 
              className="bg-[#18668D] hover:bg-[#134d66] w-full sm:w-auto shadow-lg"
              disabled={isGenerating}
            >
              {isGenerating ? (
                <>
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" /> Generating...
                </>
              ) : (
                <>
                  <FileDown className="mr-2 h-4 w-4" /> Generate PDF
                </>
              )}
            </Button>
          </div>

        </form>
      </Form>
    </div>
  );
}
</file>

<file path="frontend/src/components/navbar.tsx">
"use client";
import { Button } from "@/components/ui/button";
import Image from "next/image";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { SelectIcon } from "@radix-ui/react-select";
import Link from "next/link";
import { usePathname } from "next/navigation";

export default function Navbar() {

  const pathname = usePathname();
  const linkHref = pathname === "/staff-register" ? "/staff-login" : "/staff-register";
  return (
    <header className="w-full flex items-center justify-between px-8 py-4 bg-white shadow-sm">
      
      <div className="flex items-center space-x-2">
        <Image src="/Rralogo.png" alt="RRA Logo" width={40} height={40} />
        <span className="text-xl font-bold text-[#18668D]">
          Tax Claim Review System
        </span>
      </div>
      <div className="flex items-center space-x-4">
        <Link href={linkHref}>
        <Button className="bg-white border-[#18668D] border-2 rounded-2xl text-[#18668D] hover:bg-[#18668D] hover:text-white">
          {pathname === "/staff-register" ? "Login" : "Register"}
        </Button>
        </Link>
        <Select >
              <SelectTrigger className="border-[#18668D] border-2 rounded-2xl text-white bg-[#18668D] hover:border-[#18668D] hover:border-2 hover:text-[#18668D] hover:bg-white">
                <SelectValue className="text-white" placeholder=" Kinyarwanda" />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="kinyarwanda">Kinyarwanda</SelectItem>
                <SelectItem value="english">English</SelectItem>
                <SelectItem value="french">French</SelectItem>
              </SelectContent>
            </Select>
      </div>
    </header>
  );
}
</file>

<file path="frontend/src/components/preappealcases.tsx">
"use client";

import { useState, useEffect } from "react";
import Link from 'next/link';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import {
  Pagination,
  PaginationContent,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
} from "@/components/ui/pagination";
import api from "@/lib/api";
import { Trash2, ArrowRight } from "lucide-react";
import { Case } from "@/app/types/case";

// Interface for a single case from the API
interface PreAppealCase {
  caseId: string;
  taxpayerName: string;
  casePresenter: string;
  tin: string;
  caseStatus: "PRE_APPEAL" | "READY_FOR_AGENDA" | "PENDING" | "RESOLVED" | "SUBMITTED";
  daysLeft: number;
  appealDate: string;
  amountDischarged: number;
  taxToBePaid: number;
  auditor: string;
}

// Interface for the paginated response from the API
interface Page<T> {
  content: T[];
  totalPages: number;
  totalElements: number;
  number: number; 
}

export default function PreAppealCases() {
  const [pageData, setPageData] = useState<Page<PreAppealCase> | null>(null);
  const [allCases, setAllCases] = useState<Case[]>([]);
  const [currentPage, setCurrentPage] = useState(0);
  const [loading, setLoading] = useState<boolean>(true);
  const [error, setError] = useState<string | null>(null);
  
  const [searchQuery, setSearchQuery] = useState("");
  const [showFilters, setShowFilters] = useState(false); 
  const [statusFilter, setStatusFilter] = useState("All");
  const PAGE_SIZE = 5;

  useEffect(() => {
    const fetchPreAppealCases = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await api.get<Page<PreAppealCase>>("/api/v1/auth/pre-appeal/", {
          params: { page: currentPage, size: PAGE_SIZE },
        });
        setPageData(response.data.data);
      } catch (err: any) {
        const message = err.response?.data?.message || err.message || "Failed to fetch pre-appeal cases.";
        setError(`Error: ${message}`);
        console.error("Failed to fetch pre-appeal cases:", err);
      } finally {
        setLoading(false);
      }
    };

    fetchPreAppealCases();
  }, [currentPage]);

  const handleDeleteCase = async (caseId: string) => {
    // 1. Confirm with the user before deleting
    if (!window.confirm(`Are you sure you want to delete case ${caseId}? This action cannot be undone.`)) {
      return;
    }

    try {
      // 2. Make the API call to the DELETE endpoint
      await api.delete(`/api/v1/auth/explanatory_note/${caseId}`);

      // 3. On success, update the state to remove the case from the UI
      setAllCases(currentCases => currentCases.filter(c => c.caseId !== caseId));
      
      alert("Case deleted successfully.");

    } catch (err: any) {
      console.error("Failed to delete case:", err);
      const errorMessage = err.response?.data?.message || "Failed to delete the case. Please try again.";
      alert(errorMessage);
    }
  };

  const handleMoveToAgenda = async (caseId: string) => {
    try {
      await api.post(`/api/v1/auth/pre-appeal/${caseId}/move-to-agenda`);
      
      // Refresh the data after moving to agenda
      const response = await api.get<Page<PreAppealCase>>("/api/v1/auth/pre-appeal/", {
        params: { page: currentPage, size: PAGE_SIZE },
      });
      setPageData(response.data.data);
      
      alert("Case moved to agenda successfully.");
    } catch (err: any) {
      console.error("Failed to move case to agenda:", err);
      const errorMessage = err.response?.data?.message || "Failed to move the case to agenda. Please try again.";
      alert(errorMessage);
    }
  };

  const filteredCases = pageData?.content.filter((_case) => {
    const matchesSearch =
      _case.caseId.toLowerCase().includes(searchQuery.toLowerCase()) ||
      (_case.taxpayerName?.toLowerCase() || '').includes(searchQuery.toLowerCase()) ||
      _case.tin.toLowerCase().includes(searchQuery.toLowerCase());
    const matchesStatus = statusFilter === "All" || _case.caseStatus === statusFilter;
    return matchesSearch && matchesStatus;
  }) || [];

  const handlePageChange = (newPage: number) => {
    if (pageData && newPage >= 0 && newPage < pageData.totalPages) {
      setCurrentPage(newPage);
    }
  };
  
  const handleFilterByStatus = (status: string) => {
    setStatusFilter(status);
  };

  const getStatusStyle = (status: string) => {
    switch (status) {
      case "PRE_APPEAL": return "bg-purple-100 text-purple-800";
      case "READY_FOR_AGENDA": return "bg-blue-100 text-blue-800";
      case "PENDING": return "bg-yellow-100 text-yellow-800";
      case "RESOLVED": return "bg-green-100 text-green-800";
      case "SUBMITTED": return "bg-blue-100 text-blue-800";
      default: return "bg-gray-100 text-gray-800";
    }
  };

  return (
    <div className="container mx-auto p-4 max-w-4xl">
      <div className="space-y-2 mb-8">
        <h1 className="text-3xl font-bold">Pre Appeal</h1>
        <p className="text-gray-600">View all cases in pre-appeal status</p>
      </div>

      <div className="flex items-center space-x-2 mb-4">
        <Input
          placeholder="Search by Case ID, Name, or TIN..."
          className="max-w-xs flex-grow bg-white"
          value={searchQuery}
          onChange={(e) => setSearchQuery(e.target.value)}
        />
        <Button
          variant="outline"
          size="icon"
          className="h-10 w-10"
          onClick={() => setShowFilters(!showFilters)}
        >
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
            <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
        </Button>
      </div>
      
      {showFilters && (
        <div className="rounded-lg border p-4 mb-4 bg-white">
          <h3 className="font-semibold mb-2">Filter by Status</h3>
          <div className="flex space-x-2">
            <Button variant="secondary" className="hover:bg-[#18668D] hover:text-white" onClick={() => handleFilterByStatus("All")}>All</Button>
            <Button variant="secondary" className="hover:bg-[#18668D] hover:text-white" onClick={() => handleFilterByStatus("PRE_APPEAL")}>Pre Appeal</Button>
          </div>
        </div>
      )}

      <div className="rounded-lg border overflow-x-auto bg-white">
        <Table className="w-full">
          <TableHeader>
            <TableRow className="bg-white hover:bg-gray-50">
              <TableHead>No</TableHead>
              <TableHead>Tax Payer</TableHead>
              <TableHead>Days Left</TableHead>
              <TableHead>Tax Assessed (RWF)</TableHead>
              <TableHead>Amount Discharged</TableHead>
              <TableHead>Tax To Be Paid (RWF)</TableHead>
              <TableHead>Case Presenter</TableHead>
              <TableHead>Auditor</TableHead>
              <TableHead>Case</TableHead>
              <TableHead>Status</TableHead>
              <TableHead>Actions</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {loading ? (
              <TableRow><TableCell colSpan={11} className="h-24 text-center">Loading pre-appeal cases...</TableCell></TableRow>
            ) : error ? (
              <TableRow><TableCell colSpan={11} className="h-24 text-center text-red-600">{error}</TableCell></TableRow>
            ) : filteredCases.length > 0 ? (
              filteredCases.map((_case, index) => {
                const taxOriginal = (_case.taxToBePaid || 0) + (_case.amountDischarged || 0);
                return (
                <TableRow key={_case.caseId}>
                  <TableCell className="font-medium">{(currentPage * PAGE_SIZE) + index + 1}</TableCell>
                  <TableCell>{_case.taxpayerName || 'N/A'}</TableCell>
                  <TableCell>{_case.daysLeft} days</TableCell>
                  <TableCell>{taxOriginal.toLocaleString()}</TableCell>
                  <TableCell>{_case.amountDischarged.toLocaleString()}</TableCell>
                  <TableCell>{_case.taxToBePaid.toLocaleString()}</TableCell>
                  <TableCell>{_case.casePresenter}</TableCell>
                  <TableCell>{_case.auditor}</TableCell>
                  <TableCell className="text-blue-500 cursor-pointer hover:underline">
                    <Link href={`/cases/new-case?editCaseId=${_case.caseId}`}>
                      view note
                    </Link>
                  </TableCell>
                  <TableCell>
                    <span className={`px-3 py-1.5 rounded-full text-xs font-semibold ${getStatusStyle(_case.caseStatus)}`}>
                      {_case.caseStatus}
                    </span>
                  </TableCell>
                  <TableCell>
                    <div className="flex space-x-2">
                      <Button 
                        type="button" 
                        variant="outline" 
                        size="sm" 
                        className="text-blue-600 border-blue-600 hover:bg-blue-50"
                        onClick={() => handleMoveToAgenda(_case.caseId)}
                      >
                        <ArrowRight className="h-4 w-4 mr-1" />
                        Ready for Agenda
                      </Button>
                      <Button type="button" variant="ghost" size="icon" onClick={() => handleDeleteCase(_case.caseId)}>
                        <Trash2 className="h-5 w-5 text-red-500" />
                      </Button>
                    </div>
                  </TableCell>
                </TableRow>
              )})
            ) : (
              <TableRow><TableCell colSpan={11} className="h-24 text-center">No pre-appeal cases found.</TableCell></TableRow>
            )}
          </TableBody>
        </Table>
      </div>
      
      <div className="flex justify-between items-center mt-4 text-sm text-gray-500">
        <span>
            Showing {filteredCases.length} of {pageData?.totalElements || 0} cases
        </span>
        {pageData && pageData.totalPages > 1 && (
            <Pagination>
              <PaginationContent>
                <PaginationItem>
                  <PaginationPrevious 
                    href="#" 
                    onClick={(e) => { e.preventDefault(); handlePageChange(currentPage - 1); }}
                    aria-disabled={currentPage === 0}
                    className={currentPage === 0 ? 'pointer-events-none opacity-50' : ''}
                  />
                </PaginationItem>
                {[...Array(pageData.totalPages).keys()].map(pageNumber => (
                  <PaginationItem key={pageNumber}>
                    <PaginationLink 
                      href="#"
                      onClick={(e) => { e.preventDefault(); handlePageChange(pageNumber); }}
                      isActive={currentPage === pageNumber}
                    >
                      {pageNumber + 1}
                    </PaginationLink>
                  </PaginationItem>
                ))}
                <PaginationItem>
                  <PaginationNext 
                    href="#" 
                    onClick={(e) => { e.preventDefault(); handlePageChange(currentPage + 1); }}
                    aria-disabled={currentPage >= pageData.totalPages - 1}
                    className={currentPage >= pageData.totalPages - 1 ? 'pointer-events-none opacity-50' : ''}
                  />
                </PaginationItem>
              </PaginationContent>
            </Pagination>
        )}
      </div>
    </div>
  );
}
</file>

<file path="frontend/src/components/profile.tsx">
"use client";

import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import * as z from "zod";
import { useEffect, useState } from "react";
import { useRouter } from "next/navigation";
import api from "@/lib/api";

import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Switch } from "@/components/ui/switch";
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { InvitationTemplateModal } from "./InvitationTemplateModal"; // 1. Import the modal

// Zod schema for form validation
const profileFormSchema = z.object({
  fullName: z.string().min(2, {
    message: "Full name must be at least 2 characters.",
  }),
  email: z.string().email({
    message: "Invalid email address.",
  }),
  phoneNumber: z.string().optional(),
});

type ProfileFormValues = z.infer<typeof profileFormSchema>;


interface UserData {
  id: string;
  fullName: string;
  email: string;
  title: string;
  phoneNumber: string;
  committeeRole: string;
  committeeGroup: string;
  availabilityStatus: boolean;
}

interface MemberAvailabilityDTO {
  id: string;
  fullName: string;
  title: string;
  committeeRole: string;
  availabilityStatus: boolean;
}

const mockUser = {
  passwordLastChanged: "2 months ago",
  emailNotifications: true,
  smsNotifications: false,
  availabilityStatus:false,
};

export default function ProfilePage() {
  const router = useRouter();
  const [userData, setUserData] = useState<UserData | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [isModalOpen, setIsModalOpen] = useState(false); 
  const [isAvailable, setIsAvailable] = useState(false);
  const [isUpdatingAvailability, setIsUpdatingAvailability] = useState(false);
  const [committeeMembers, setCommitteeMembers] = useState<MemberAvailabilityDTO[]>([]);
const [loadingMembers, setLoadingMembers] = useState(false);



  const form = useForm<ProfileFormValues>({
    resolver: zodResolver(profileFormSchema),
    defaultValues: {
      fullName: "",
      email: "",
      phoneNumber: "",
    },
    mode: "onChange",
  });

  
  useEffect(() => {
  if (userData?.committeeRole === 'COMMITTEE_LEADER') {
    const fetchMembers = async () => {
      setLoadingMembers(true);
      try {
        const res = await api.get('/api/v1/committee/members-availability');
        setCommitteeMembers(res.data);
      } catch (err) {
        console.error(err);
        alert("Failed to load committee members");
      } finally {
        setLoadingMembers(false);
      }
    };
    fetchMembers();
  }
}, [userData]);

const handleUpdateMemberStatus = async (memberId: string, newStatus: boolean) => {
  const original = committeeMembers.find(m => m.id === memberId);
  if (!original) return;

  // Optimistic update
  setCommitteeMembers(prev =>
    prev.map(m => m.id === memberId ? { ...m, availabilityStatus: newStatus } : m)
  );

  try {
    await api.put(`/api/v1/committee/member/${memberId}/availability`, {
      availabilityStatus: newStatus
    });
  } catch (err) {
    alert("Failed to update status");
    // Revert
    setCommitteeMembers(prev =>
      prev.map(m => m.id === memberId ? { ...m, availabilityStatus: original.availabilityStatus } : m)
    );
  }
};

  useEffect(() => {
    const fetchUserData = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await api.get('/api/v1/user/');
        if (response.data && response.data.data) {
          const fetchedUser: UserData = response.data.data;
          setUserData(fetchedUser);
          setIsAvailable(fetchedUser.availabilityStatus);
          form.reset({
            fullName: fetchedUser.fullName,
            email: fetchedUser.email,
            phoneNumber: fetchedUser.phoneNumber,
          });
        } else {
          throw new Error("User data not found.");
        }
      } catch (err) {
        console.error("Failed to fetch user data:", err);
        setError("Could not load your profile.");
      } finally {
        setLoading(false);
      }
    };

    fetchUserData();
  }, [form]);

  const handleAvailabilityChange = async (newStatus: boolean) => {
    if (!userData) return;

    // Disable the switch to prevent multiple clicks
    setIsUpdatingAvailability(true);
    
    // Optimistic UI update for instant feedback
    const originalStatus = isAvailable;
    setIsAvailable(newStatus);

    try {
      // Send the boolean value directly in the request body
      await api.put(`/api/v1/user/${userData.id}/availability-status`, newStatus, {
        headers: {
          // Explicitly set content type for raw boolean
          'Content-Type': 'application/json',
        },
      });
      // Optionally show a success toast/message here
    } catch (error) {
      console.error("Failed to update availability status:", error);
      alert("Failed to update status. Reverting change.");
      // Rollback UI on error
      setIsAvailable(originalStatus);
    } finally {
      // Re-enable the switch
      setIsUpdatingAvailability(false);
    }
  };

  async function onSubmit(values: ProfileFormValues) {
    if (!userData) return;
    try {
      const payload = {
        fullName: values.fullName,
        email: values.email,
        phoneNumber: values.phoneNumber,
        title: userData.title,
        committee_role: userData.committeeRole,
        committeeGroup: userData.committeeGroup,
      };
      await api.put(`/api/v1/user/${userData.id}`, payload);
      localStorage.setItem("staff_name", values.fullName);
      alert("Profile updated successfully!");
      setUserData(prev => prev ? { ...prev, ...values } : null);
    } catch (err) {
      console.error("Failed to update profile:", err);
      alert("Error updating profile.");
    }
  }

  const handleLogout = async () => {
    try {
      await api.post('/api/v1/auth/logout');
    } catch (error) {
       console.error("Server logout failed, clearing session locally.", error);
    } finally {
      localStorage.clear();
      router.push('/staff-login');
    }
  };

  if (loading) {
    return <div className="container mx-auto p-4 max-w-2xl space-y-8 text-center">Loading Profile...</div>;
  }

  if (error) {
    return <div className="container mx-auto p-4 max-w-2xl space-y-8 text-center text-red-500">{error}</div>;
  }
  
  const getAvatarFallback = (name: string) => name.split(' ').map(n => n[0]).join('').toUpperCase();
  const formatRole = (role: string = "") => role.replace(/_/g, ' ').replace(/\b\w/g, char => char.toUpperCase());

  return (
    // Use a Fragment to wrap the page content and the modal
    <>
      <div className="container mx-auto p-4 max-w-2xl space-y-8">
        {/* Profile Header */}
        <div className="rounded-lg border p-6 flex items-center space-x-4 bg-white">
          <Avatar className="h-20 w-20">
            <AvatarImage src="/profile-image.jpeg" alt={userData?.fullName || ''} />
            <AvatarFallback>{userData ? getAvatarFallback(userData.fullName) : 'U'}</AvatarFallback>
          </Avatar>
          <div>
            <h1 className="text-2xl font-bold">{userData?.fullName}</h1>
            <p className="text-gray-600">{userData?.title}</p>
            <div className="flex items-center text-gray-500 mt-1 text-sm">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4 mr-1">
                <rect width="20" height="14" x="2" y="7" rx="2" ry="2" />
                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
              </svg>
              <span>{formatRole(userData?.committeeRole)}</span>
            </div>
          </div>
        </div>
        
        {/* Personal Information Section */}
        <div className="rounded-lg border p-6 space-y-4 bg-white">
          <h2 className="text-xl font-semibold">Personal Information</h2>
          <p className="text-gray-600 text-sm">Update your personal details and profile information.</p>
          <Form {...form}>
            <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <FormField control={form.control} name="fullName" render={({ field }) => (
                  <FormItem>
                    <FormLabel>Full Names</FormLabel>
                    <FormControl><Input {...field} /></FormControl>
                    <FormMessage />
                  </FormItem>
                )} />
                <FormField control={form.control} name="email" render={({ field }) => (
                  <FormItem>
                    <FormLabel>Email</FormLabel>
                    <FormControl><Input {...field} /></FormControl>
                    <FormMessage />
                  </FormItem>
                )} />
                <FormField control={form.control} name="phoneNumber" render={({ field }) => (
                  <FormItem>
                    <FormLabel>Phone</FormLabel>
                    <FormControl><Input {...field} /></FormControl>
                    <FormMessage />
                  </FormItem>
                )} />
              </div>
              <Button type="submit" className="bg-[#18668D]">edit profile</Button>
            </form>
          </Form>
        </div>

        {/* Security Settings Section */}
        <div className="rounded-lg border p-6 space-y-4 bg-white">
          <h2 className="text-xl font-semibold">Security Settings</h2>
          <p className="text-gray-600 text-sm">Manage your account security and authentication.</p>
          <div className="flex justify-between items-center">
            <div>
              <h3 className="font-medium">Password</h3>
              <p className="text-sm text-gray-500">Last changed {mockUser.passwordLastChanged}</p>
            </div>
            <Button variant="outline" className="flex items-center space-x-2">
              <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M15 6V3a3 3 0 00-6 0v3m0 0a3 3 0 00-6 0v3a3 3 0 006 0m0 0v3a3 3 0 006 0v-3m0 0a3 3 0 00-6 0" />
              </svg>
              <span>change Password</span>
            </Button>
          </div>
        </div>
        {/* Notification Preferences Section */}
        <div className="rounded-lg border p-6 space-y-6 bg-white">
          <div>
            <h2 className="text-xl font-semibold">Notification Preferences</h2>
            <p className="text-gray-600 text-sm mt-1">Choose what notifications you want to receive.</p>
          </div>

          {/* Email & SMS Notifications */}
          <div className="space-y-4">
            <div className="flex justify-between items-center py-2">
              <div>
                <h3 className="font-medium">Email notification</h3>
                <p className="text-sm text-gray-500">Receive notifications via email</p>
              </div>
              <Switch defaultChecked={mockUser.emailNotifications} />
            </div>

            <div className="flex justify-between items-center py-2">
              <div>
                <h3 className="font-medium">SMS notification</h3>
                <p className="text-sm text-gray-500">Receive notifications via SMS</p>
              </div>
              <Switch defaultChecked={mockUser.smsNotifications} />
            </div>

            {/* Personal Availability Status */}
            <div className="flex justify-between items-center py-2 border-t pt-4">
              <div>
                <h3 className="font-medium">Availability Status</h3>
                <p className="text-sm text-gray-500">Indicate your availability this week</p>
              </div>
              <Switch
                checked={isAvailable}
                onCheckedChange={handleAvailabilityChange}
                disabled={isUpdatingAvailability}
              />
            </div>
          </div>

          {/* Leader-Only Features */}
          {userData?.committeeRole === 'COMMITTEE_LEADER' && (
            <>
              {/* Invitation Template */}
              <div className="flex justify-between items-center py-4 border-t">
                <div>
                  <h3 className="font-medium">Invitation Template</h3>
                  <p className="text-sm text-gray-500">Edit invitation hour and venue</p>
                </div>
                <Button
                  variant="outline"
                  className="flex items-center space-x-2"
                  onClick={() => setIsModalOpen(true)}
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="h-4 w-4">
                    <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                    <path d="m15 5 4 4"/>
                  </svg>
                  <span>Edit</span>
                </Button>
              </div>

              {/* Committee Members Availability List */}
              <div className="border-t pt-6">
                <h3 className="text-lg font-semibold mb-4">Committee Members Availability</h3>

                {loadingMembers ? (
                  <p className="text-sm text-gray-500 italic">Loading members...</p>
                ) : committeeMembers.length === 0 ? (
                  <p className="text-sm text-gray-500">No members found in your committee group.</p>
                ) : (
                  <div className="space-y-3 max-h-96 overflow-y-auto pr-1">
                    {committeeMembers.map((member) => (
                      <div
                        key={member.id}
                        className={`flex items-center justify-between p-4 rounded-lg transition-all ${
                          member.id === userData.id ? 'bg-blue-50 border border-blue-200' : 'bg-gray-50 hover:bg-gray-100'
                        }`}
                      >
                        <div className="flex items-center space-x-4">
                          <Avatar className="h-10 w-10">
                            <AvatarFallback>{getAvatarFallback(member.fullName)}</AvatarFallback>
                          </Avatar>
                          <div>
                            <p className="font-medium text-sm">{member.fullName}</p>
                            <p className="text-xs text-gray-500">
                              {member.title || formatRole(member.committeeRole)}
                              {member.id === userData.id && <span className="ml-2 text-blue-600">(You)</span>}
                            </p>
                          </div>
                        </div>

                        <div className="flex items-center gap-4">
                          <span
                            className={`text-sm font-medium ${
                              member.availabilityStatus ? 'text-green-600' : 'text-red-600'
                            }`}
                          >
                            {member.availabilityStatus ? 'Available' : 'Unavailable'}
                          </span>
                          <Switch
                            checked={member.availabilityStatus}
                            onCheckedChange={(checked) =>
                              handleUpdateMemberStatus(member.id, checked)
                            }
                          />
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </>
          )}
        </div>

        {/* Log out button */}
        <div className="flex justify-end mt-8">
          <Button onClick={handleLogout} variant="ghost" className="text-red-600 hover:text-white hover:bg-red-500  bg-red-200">
            <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
              <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4" />
              <polyline points="16 17 21 12 16 7" />
              <line x1="21" y1="21" y2="12" x2="9" />
            </svg>
            Log out
          </Button>
        </div>
      </div>
      
      {/* 4. Render the modal and pass state to control it */}
      <InvitationTemplateModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} />
    </>
  );
}
</file>

<file path="frontend/src/components/sidebar.tsx">
"use client";
import { Button } from "@/components/ui/button";
import { usePathname, useRouter } from "next/navigation";
import { FileText, FolderKanban, LayoutDashboard, MessageSquare, UserCog } from "lucide-react"; // Import a suitable icon
import Link from "next/link";
import { useEffect, useState } from "react";


export default function Sidebar() {
    const pathname = usePathname();
    const router = useRouter();
    const [userName, setUserName] = useState("User");
    const [userRole, setUserRole] = useState<string | null>(null);

    const allNavItems = [
        { name: "Cases", icon: FolderKanban, path: "/cases" },
        { name: "Meetings", icon: LayoutDashboard, path: "/meetings" },
        { name: "Reports", icon: FileText, path: "/reports" },
        { name: "Chat", icon: MessageSquare, path: "/chat" },
    ];

    // Define the new admin navigation item
    const adminNavItem = { name: "Admin", icon: UserCog, path: "/admin" }; // Using UserCog as an example icon

   // Load user name and role from localStorage
  useEffect(() => {
    const name = localStorage.getItem("staff_name");
    const role = localStorage.getItem("staff_role");
    if (name) setUserName(name);
    if (role) setUserRole(role);
  }, []);

    // Filter and conditionally add nav items based on user role
    const navItems = allNavItems.filter((item) => {
        // Hide "Cases" for regular COMMITTEE_MEMBER
        if (item.name === "Cases" && userRole === "COMMITTEE_MEMBER") {
            return false;
        }
        // Hide "Chat" for everyone except COMMITTEE_LEADER
        if (item.name === "Chat" && userRole !== "COMMITTEE_LEADER") {
            return false;
        }
        return true;
    });

    // Add the admin link if the user is a COMMITTEE_LEADER
    if (userRole === "COMMITTEE_LEADER") {
        navItems.push(adminNavItem);
    }


  return (
    <div>
<aside className=" w-64 h-full p-4 border-r border-gray-300 bg-white flex flex-col justify-between">
  <div className="flex justify-center mb-6">
    <img src="/Rralogo.png" alt="Logo" className="h-20 w-20 p-2 bg-white" />
  </div>

  <nav className="flex flex-col space-y-0">
      {navItems.map((item) => {
        const isActive = pathname.startsWith(item.path);

        return (
          
          <Button
            key={item.name}
            variant={isActive ? "default" : "ghost"}
            className={`w-full justify-start space-x-2 ${
              isActive
                ? "bg-[#134E70] text-white hover:bg-[#063854]"
                : "text-gray-600 hover:bg-gray-100"
            }`}
            onClick={() => router.push(item.path)}
          >
            <item.icon className="h-4 w-4" />
            <span>{item.name}</span>
          </Button>
        );
      })}
    </nav>
    <Link href={"/profile"} className="flex items-center mt-auto shadow-lg rounded-md p-3">
  <img src="/profile-image.jpeg" alt="Profile" className="rounded-full h-10 w-10" />
  <div className="ml-3 ">
    <h1 className="font-bold">{userName}</h1>
  </div>
</Link>
  
</aside>

    </div>
    
  );
}
</file>

<file path="frontend/src/components/taxForm.tsx">
"use client";

import { zodResolver } from "@hookform/resolvers/zod";
import { useFieldArray, useForm, useFormContext } from "react-hook-form";
import * as z from "zod";
import { useEffect, useState } from "react";
import { useRouter } from "next/navigation";
import { Dropzone, DropzoneContent, DropzoneEmptyState } from '@/components/ui/shadcn-io/dropzone';

import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "@/components/ui/form";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Textarea } from "./ui/textarea";
import { PlusCircle, Trash2 } from "lucide-react";
import { storage } from "@/lib/firebase";
import { ref, uploadBytes, getDownloadURL } from "firebase/storage";
import api from "@/lib/api";

const API_URL = process.env.NEXT_PUBLIC_API_URL;

// Schema for a single appeal point
const appealPointSchema = z.object({
  appealPoint: z.string().min(1, { message: "Appeal point is required." }),
  auditorsOpinion: z.string().min(1, { message: "Auditor's opinion is required." }),
  summarisedProblem: z.string().min(1, { message: "Problem summary is required." }),
  proposedSolution: z.string().min(1, { message: "Proposed solution is required." }),
});

// Schema for a single tax item now includes its own appeals array
const taxItemSchema = z.object({
  auditedTaxType: z.string().min(1, { message: "Tax type is required." }),
  principalAmount: z.number().min(0, { message: "Must be a positive number." }),
  understatementFines: z.number().min(0, { message: "Must be a positive number." }),
  fixedAdministrativeFines: z.number().min(0, { message: "Must be a positive number." }),
  dischargedAmount: z.number().min(0, { message: "Must be a positive number." }),
  otherFines: z.number().min(0, { message: "Must be a positive number." }),
  appeals: z.array(appealPointSchema).min(1, { message: "At least one appeal point is required for this tax type." }),
});

// Main form schema updated to remove the top-level appealPoints
const formSchema = z.object({
  taxPayerTIN: z.string().min(1, { message: "TIN is required." }),
  taxAssessmentTime: z.string().min(1, { message: "Assessment time is required." }),
  dateAssessmentReceived: z.string().min(1, { message: "Date is required." }),
  appealDate: z.string().optional().or(z.literal("")),
  appealExpireDate: z.string().optional().or(z.literal("")),
  caseId: z.string().min(1, { message: "Case ID is required." }),
  auditorNames: z.string().min(1, { message: "Auditor name is required." }),
  taxItems: z.array(taxItemSchema).min(1, { message: "You must add at least one tax item." }),
});


// MAIN TAXFORM COMPONENT DEFINITION AND HOOKS
export function TaxForm({ caseIdToEdit }: { caseIdToEdit: string | null }) {
  const router = useRouter();
  const isEditMode = !!caseIdToEdit;
  const [isLoadingData, setIsLoadingData] = useState(isEditMode);
  const form = useForm<z.infer<typeof formSchema>>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      taxPayerTIN: "",
      caseId: "",
      auditorNames: "",
      dateAssessmentReceived: "",
      appealDate: "",
      appealExpireDate: "",
      taxItems: [
        {
          auditedTaxType: "",
          principalAmount: 0,
          understatementFines: 0,
          fixedAdministrativeFines: 0,
          dischargedAmount: 0,
          otherFines: 0,
          appeals: [
            {
              appealPoint: "",
              summarisedProblem: "",
              auditorsOpinion: "",
              proposedSolution: "",
            },
          ],
        },
      ],
    },
  });

useEffect(() => {
    // A helper function to format dates from ISO string (2023-12-25T00:00:00.000Z)
    // to what an <input type="date"> needs (2023-12-25)
    const formatDateForInput = (isoDate: string | null | undefined) => {
      if (!isoDate) return "";
      return isoDate.split('T')[0];
    };

    const fetchAndSetCaseData = async () => {
      if (!caseIdToEdit) return;

      try {
        const response = await api.get(`/api/v1/auth/explanatory_note/${caseIdToEdit}`);
        const data = response.data.data;

        // Map the fetched data to match the form's schema
        const formData = {
          caseId: data.caseId,
          auditorNames: data.auditorsName, // Note the name difference
          taxPayerTIN: data.tin,
          taxAssessmentTime: data.taxAssessmentTime,
          dateAssessmentReceived: formatDateForInput(data.taxAssessmentAcknowledgementDateByTaxpayer),
          appealDate: formatDateForInput(data.appealDate),
          appealExpireDate: formatDateForInput(data.appealExpireDate),
          taxItems: data.taxAudited.map((item: any) => ({
            auditedTaxType: item.taxTypeAudited,
            principalAmount: item.principalAmountToBePaid,
            understatementFines: item.understatementFines,
            fixedAdministrativeFines: item.fixedAdministrativeFines,
            dischargedAmount: item.dischargedAmount,
            otherFines: item.otherFines,
            appeals: item.appeals.map((appeal: any) => ({
              appealPoint: appeal.appealPoint,
              summarisedProblem: appeal.summarisedProblem,
              auditorsOpinion: appeal.auditorsOpinion,
              proposedSolution: appeal.proposedSolution,
            })),
          })),
        };
        
        form.reset(formData); 
      } catch (error) {
        console.error("Failed to fetch case data for editing:", error);
        alert("Failed to load case data. Please try again.");
      } finally {
        setIsLoadingData(false); 
      }
    };

    fetchAndSetCaseData();
  }, [caseIdToEdit, form]);

  const { fields: taxFields, append: appendTax, remove: removeTax } = useFieldArray({
    control: form.control,
    name: "taxItems",
  });

  const [total, setTotal] = useState(0);
  const [files, setFiles] = useState<File[] | undefined>();
  const [userName, setUserName] = useState("Unknown");
  const [isSubmitting, setIsSubmitting] = useState(false);

  useEffect(() => {
    const name = localStorage.getItem("staff_name");
    if (name) setUserName(name);
  }, []);

  const taxTypes = [
    { value: "VAT", label: "VAT" },
    { value: "CIT", label: "Corporate Income Tax" },
    { value: "PAYE", label: "PAYE" },
  ];

  const calculateTotal = () => {
    const values = form.getValues().taxItems;
    const newTotal = values.reduce((sum, item) => {
      return sum + (item.principalAmount || 0) + (item.understatementFines || 0) + (item.fixedAdministrativeFines || 0);
    }, 0);
    setTotal(newTotal);
  };

  useEffect(() => {
    const subscription = form.watch(calculateTotal);
    return () => subscription.unsubscribe();
  }, [form]);

  const handleDrop = (files: File[]) => {
    setFiles(files);
  };

  async function onSubmit(values: z.infer<typeof formSchema>) {
    setIsSubmitting(true);
    let uploadedFileUrl = "";

    if (files && files.length > 0) {
      const file = files[0];
      const storageRef = ref(storage, `attachments/${Date.now()}_${file.name}`);
      try {
        const snapshot = await uploadBytes(storageRef, file);
        uploadedFileUrl = await getDownloadURL(snapshot.ref);
      } catch (err) {
        console.error("Firebase upload error:", err);
        alert("Error uploading attachment. Please try again.");
        setIsSubmitting(false);
        return;
      }
    }

    const toISOString = (dateString: string | undefined | null): string | null => {
        if (!dateString) return null;
        try {
            return new Date(dateString).toISOString();
        } catch (e) {
            console.error("Could not parse date:", dateString);
            return null;
        }
    };

    try {
      const payload = {
        caseId: values.caseId,
        auditorsName: values.auditorNames,
        taxAssessmentAcknowledgementDateByTaxpayer: toISOString(values.dateAssessmentReceived),
        taxAssessmentTime: values.taxAssessmentTime,
        appealDate: toISOString(values.appealDate),
        appealExpireDate: toISOString(values.appealExpireDate),
        casePresenter: userName,
        tin: values.taxPayerTIN,
        attachmentLink: uploadedFileUrl,
        taxAudited: values.taxItems.map(taxItem => ({
          taxTypeAudited: taxItem.auditedTaxType,
          principalAmountToBePaid: taxItem.principalAmount,
          understatementFines: taxItem.understatementFines,
          fixedAdministrativeFines: taxItem.fixedAdministrativeFines,
          dischargedAmount: taxItem.dischargedAmount,
          otherFines: taxItem.otherFines,
          totalTaxAndFinesToBePaid:
            (taxItem.principalAmount || 0) +
            (taxItem.understatementFines || 0) +
            (taxItem.fixedAdministrativeFines || 0) -
            (taxItem.dischargedAmount || 0),
          appeals: taxItem.appeals.map(ap => ({
            appealPoint: ap.appealPoint,
            summarisedProblem: ap.summarisedProblem,
            auditorsOpinion: ap.auditorsOpinion,
            proposedSolution: ap.proposedSolution
          }))
        }))
      };

      const method = isEditMode ? 'PUT' : 'POST';
      const url = isEditMode
        ? `${API_URL}/api/v1/auth/explanatory_note/${caseIdToEdit}`
        : `${API_URL}/api/v1/auth/explanatory_note/`;

      const res = await fetch(url, {
        method, // Use the determined method
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${localStorage.getItem("staff_token")}`
        },
        body: JSON.stringify(payload)
      });

      if (!res.ok) {
        const errorBody = await res.text();
        throw new Error(`Failed to ${isEditMode ? 'update' : 'submit'} case: ${errorBody}`);
      }
      
      alert(`Case ${isEditMode ? 'updated' : 'submitted'} successfully!`);
      router.push('/cases/all-cases');

    } catch (err) {
      console.error(err);
      alert(`Error ${isEditMode ? 'updating' : 'submitting'} case. See console for details.`);
    } finally {
      setIsSubmitting(false);
    }
  }

  if (isLoadingData) {
    return <div className="text-center p-8">Loading case data...</div>;
  }
return (
    <div className="container p-4 max-w-4xl">
      <Form {...form}>
        <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
          {/* Case Info & Dates (No longer in a separate step) */}
          <div className="rounded-lg border p-6 space-y-4 bg-white shadow-md">
            <h2 className="text-xl font-semibold">Case Information</h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <FormField control={form.control} name="caseId" render={({ field }) => (<FormItem><FormLabel>Case ID</FormLabel><FormControl><Input placeholder="e.g., TAX-2023-001" {...field} disabled={isEditMode} /></FormControl><FormMessage /></FormItem>)} />
              <FormField control={form.control} name="auditorNames" render={({ field }) => (<FormItem><FormLabel>Auditor Names</FormLabel><FormControl><Input placeholder="e.g., John Doe" {...field} /></FormControl><FormMessage /></FormItem>)} />
              <FormField control={form.control} name="taxPayerTIN" render={({ field }) => (<FormItem><FormLabel>Tax Payer TIN</FormLabel><FormControl><Input placeholder="NNN-NN-NNNNN" {...field} /></FormControl><FormMessage /></FormItem>)} />
              <FormField control={form.control} name="taxAssessmentTime" render={({ field }) => (<FormItem><FormLabel>Tax Assessment Period</FormLabel><FormControl><Input placeholder="Input here" {...field} /></FormControl><FormMessage /></FormItem>)} />
              <FormField control={form.control} name="dateAssessmentReceived" render={({ field }) => (<FormItem><FormLabel>Date Tax Assessment Received</FormLabel><FormControl><Input type="date" {...field} /></FormControl><FormMessage /></FormItem>)} />
              <FormField control={form.control} name="appealDate" render={({ field }) => (<FormItem><FormLabel>Appeal Date</FormLabel><FormControl><Input type="date" {...field} /></FormControl><FormMessage /></FormItem>)} />
              <FormField control={form.control} name="appealExpireDate" render={({ field }) => (<FormItem><FormLabel>Appeal Expire Date</FormLabel><FormControl><Input type="date" {...field} /></FormControl><FormMessage /></FormItem>)} />
            </div>
          </div>

          {/* Dynamic Tax Items Section */}
          {taxFields.map((taxField, taxIndex) => (
            <div key={taxField.id} className="rounded-lg border p-6 space-y-6 bg-white shadow-md">
                <div className="flex justify-between items-center">
                    <h2 className="text-xl font-semibold">Tax Info #{taxIndex + 1}</h2>
                     {taxFields.length > 1 && (
                        <Button type="button" variant="ghost" size="icon" onClick={() => removeTax(taxIndex)}>
                            <Trash2 className="h-5 w-5 text-red-500" />
                        </Button>
                    )}
                </div>
              
              {/* Fields for the Tax Item itself */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <FormField control={form.control} name={`taxItems.${taxIndex}.auditedTaxType`} render={({ field }) => (
                    <FormItem className="col-span-full"><FormLabel>Audited Tax Type</FormLabel><Select onValueChange={field.onChange} defaultValue={field.value}><FormControl><SelectTrigger><SelectValue placeholder="Select Tax Type" /></SelectTrigger></FormControl><SelectContent>{taxTypes.map((type) => (<SelectItem key={type.value} value={type.value}>{type.label}</SelectItem>))}</SelectContent></Select><FormMessage /></FormItem>
                  )}/>
                  <FormField control={form.control} name={`taxItems.${taxIndex}.principalAmount`} render={({ field }) => (<FormItem><FormLabel>Principal Amount</FormLabel><FormControl><Input type="number" {...field} onChange={(e) => field.onChange(Number(e.target.value))} /></FormControl><FormMessage /></FormItem>)} />
                  <FormField control={form.control} name={`taxItems.${taxIndex}.understatementFines`} render={({ field }) => (<FormItem><FormLabel>Understatement Fines</FormLabel><FormControl><Input type="number" {...field} onChange={(e) => field.onChange(Number(e.target.value))} /></FormControl><FormMessage /></FormItem>)} />
                  <FormField control={form.control} name={`taxItems.${taxIndex}.fixedAdministrativeFines`} render={({ field }) => (<FormItem><FormLabel>Fixed Admin Fines</FormLabel><FormControl><Input type="number" {...field} onChange={(e) => field.onChange(Number(e.target.value))} /></FormControl><FormMessage /></FormItem>)} />
                  <FormField control={form.control} name={`taxItems.${taxIndex}.dischargedAmount`} render={({ field }) => (<FormItem><FormLabel>Discharged Amount</FormLabel><FormControl><Input type="number" {...field} onChange={(e) => field.onChange(Number(e.target.value))} /></FormControl><FormMessage /></FormItem>)} />
                  <FormField control={form.control} name={`taxItems.${taxIndex}.otherFines`} render={({ field }) => (<FormItem><FormLabel>Other Fines</FormLabel><FormControl><Input type="number" {...field} onChange={(e) => field.onChange(Number(e.target.value))} /></FormControl><FormMessage /></FormItem>)} />
              </div>

              {/* Calling the new helper component to render the nested appeals */}
              <NestedAppealArray taxIndex={taxIndex} />
            </div>
          ))}

          {/* This button now appends a full taxItem object, including a default nested appeal */}
          <Button type="button" variant="outline" className="w-full" onClick={() => appendTax({
              auditedTaxType: "",
              principalAmount: 0,
              understatementFines: 0,
              fixedAdministrativeFines: 0,
              dischargedAmount: 0,
              otherFines: 0,
              appeals: [{ appealPoint: "", summarisedProblem: "", auditorsOpinion: "", proposedSolution: "" }]
          })}>
            <PlusCircle className="mr-2 h-4 w-4" /> Add Another Tax Type
          </Button>
          
          <Dropzone accept={{'application/pdf': [], 'image/*': []}} maxSize={1024 * 1024 * 10} onDrop={handleDrop} src={files} className="border-[#18668D] border-2 border-dashed text-[#18668D]">
            <DropzoneEmptyState />
            <DropzoneContent />
          </Dropzone>

          <div className="rounded-lg border p-6 bg-white font-bold text-lg">
            Total taxes and fines to be paid: {total.toLocaleString()} RWF
          </div>

          <div className="flex justify-end">
            <Button type="submit" className="bg-[#18668D]" disabled={isSubmitting}>
              {isSubmitting ? 'Saving...' : (isEditMode ? 'Update Case' : 'Submit Case')}
            </Button>
          </div>
        </form>
      </Form>
    </div>
  );
}

function NestedAppealArray({ taxIndex }: { taxIndex: number }) {
    const { control } = useFormContext(); 
    const { fields, append, remove } = useFieldArray({
        control,
        name: `taxItems.${taxIndex}.appeals`
    });

    return (
        <div className="space-y-4 pt-4 border-t">
             <h3 className="text-lg font-semibold">Appeal Points</h3>
            {fields.map((field, appealIndex) => (
                <div key={field.id} className="p-4 border rounded-md space-y-2 relative bg-gray-50">
                    {/* Button to remove a specific appeal point */}
                    {fields.length > 1 && (
                         <Button type="button" variant="ghost" size="icon" className="absolute top-2 right-2" onClick={() => remove(appealIndex)}>
                            <Trash2 className="h-4 w-4 text-gray-500" />
                        </Button>
                    )}

                    {/* Form fields for the appeal point, with correctly nested names */}
                    <FormField control={control} name={`taxItems.${taxIndex}.appeals.${appealIndex}.appealPoint`} render={({ field }) => (<FormItem><FormLabel>Appeal Point #{appealIndex + 1}</FormLabel><FormControl><Input {...field} placeholder="Enter appeal point" /></FormControl><FormMessage /></FormItem>)} />
                    <FormField control={control} name={`taxItems.${taxIndex}.appeals.${appealIndex}.summarisedProblem`} render={({ field }) => (<FormItem><FormLabel>Problem Summary</FormLabel><FormControl><Textarea {...field} placeholder="Problem summary..." /></FormControl><FormMessage /></FormItem>)} />
                    <FormField control={control} name={`taxItems.${taxIndex}.appeals.${appealIndex}.auditorsOpinion`} render={({ field }) => (<FormItem><FormLabel>Basis of Tax assessment by Auditor</FormLabel><FormControl><Textarea {...field} placeholder="Auditor's comments..." /></FormControl><FormMessage /></FormItem>)} />
                    <FormField control={control} name={`taxItems.${taxIndex}.appeals.${appealIndex}.proposedSolution`} render={({ field }) => (<FormItem><FormLabel>Proposed Solution</FormLabel><FormControl><Textarea {...field} placeholder="Proposed solution..." /></FormControl><FormMessage /></FormItem>)} />
                </div>
            ))}
             <Button type="button" variant="secondary" className="w-full" onClick={() => append({ appealPoint: "", summarisedProblem: "", auditorsOpinion: "", proposedSolution: "" })}>
                <PlusCircle className="mr-2 h-4 w-4" /> Add Appeal Point to this Tax Type
            </Button>
        </div>
    );
}
</file>

<file path="frontend/src/components/TaxTypeDetails.tsx">
"use client";

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import api from '@/lib/api';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { FileText, HandCoins, Banknote, Coins, CheckCircle2 } from 'lucide-react';
import Link from 'next/link';

interface AppealDTO {
  AppealId: string;
  appealPoint: string;
  summarisedProblem: string;
  auditorsOpinion: string;
  proposedSolution: string;
}

interface TaxAuditedDTO {
  taxAuditedId: string;
  taxTypeAudited: string;
  principalAmountToBePaid: number;
  understatementFines: number;
  otherFines: number;
  fixedAdministrativeFines: number;
  appeals: AppealDTO[];
}

interface InfoCardProps {
  icon: React.ElementType;
  title: string;
  amount?: number;
  color: string;
}

const InfoCard = ({ icon: Icon, title, amount = 0, color }: InfoCardProps) => (
  <div className="flex items-center space-x-4">
    <div className={`p-3 rounded-full ${color}`}>
      <Icon className="h-6 w-6 text-white" />
    </div>
    <div>
      <p className="text-sm text-gray-500">{title}</p>
      <p className="font-bold">{amount.toLocaleString()} frw</p>
    </div>
  </div>
);

export function TaxTypeDetails({ caseId, taxAuditedId }: { caseId: string, taxAuditedId: string }) {
  const [taxItem, setTaxItem] = useState<TaxAuditedDTO | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [votedAppeals, setVotedAppeals] = useState<string[]>([]);
  const router = useRouter();

  useEffect(() => {
    const fetchData = async () => {
      setLoading(true);
      setError(null);
      try {
        // 1. Fetch Case Details
        const response = await api.get(`/api/v1/auth/explanatory_note/${caseId}`);
        const caseData = response.data.data;
        
        const specificTaxItem = caseData.taxAudited.find(
          (item: TaxAuditedDTO) => item.taxAuditedId === taxAuditedId
        );

        if (!specificTaxItem) {
          throw new Error("Audited tax item not found for the given ID.");
        }

        setTaxItem(specificTaxItem);

        // 2. Check Vote Status for these appeals
        // Extract all appeal IDs from the found tax item
        const appealIds = specificTaxItem.appeals.map((a: AppealDTO) => a.AppealId);

        if (appealIds.length > 0) {
          try {
            const voteStatusUrl = `/api/appeals/are-all-appeals-voted`;
            
            // Send the array of IDs to the backend
            const voteResponse = await api.post(voteStatusUrl, appealIds);
            const voteMap = voteResponse.data; // Expected format: { "uuid1": true, "uuid2": false }

            if (voteMap) {
              // Filter keys (IDs) where the value is true
              const votedIds = Object.keys(voteMap).filter(id => voteMap[id] === true);
              setVotedAppeals(votedIds);
            }
          } catch (voteErr) {
            console.error("Failed to fetch vote statuses:", voteErr);
            // We don't block the UI if vote check fails, we just don't show checkmarks
          }
        }

      } catch (err) {
        console.error("Failed to fetch tax type details:", err);
        setError("Could not load the details for this tax type.");
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, [caseId, taxAuditedId]);

  if (loading) return <div className="text-center p-8">Loading...</div>;
  if (error || !taxItem) return <div className="text-center text-red-500 p-8">{error || "Data not found"}</div>;

  return (
    <div className="w-full max-w-4xl mx-auto space-y-6">
      <p className="text-sm text-gray-500">
        meeting &gt; {caseId} &gt; {taxItem.taxTypeAudited}
      </p>

      <Card className="p-6">
        <CardContent className="p-0">
          <div className="flex items-center space-x-3 mb-6">
            <div className="bg-blue-100 p-2 rounded-full">
              <FileText className="h-6 w-6 text-blue-600" />
            </div>
            <h1 className="text-2xl font-bold">{taxItem.taxTypeAudited}</h1>
          </div>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6 p-4 bg-green-50 rounded-lg">
            <InfoCard icon={HandCoins} title="Principal amount to be paid" amount={taxItem.principalAmountToBePaid} color="bg-green-400" />
            <InfoCard icon={Banknote} title="Understatement fines" amount={taxItem.understatementFines} color="bg-purple-400" />
            <InfoCard icon={Coins} title="Fixed administrative fines" amount={taxItem.fixedAdministrativeFines} color="bg-orange-400" />
            <InfoCard icon={HandCoins} title="Other fines" amount={taxItem.otherFines} color="bg-orange-400" />
          </div>
        </CardContent>
      </Card>

      <Card className="p-6">
        <CardContent className="p-0">
          <div className="flex items-center space-x-3 mb-4">
            <div className="bg-blue-100 p-2 rounded-full">
               <FileText className="h-6 w-6 text-blue-600" />
            </div>
            <h2 className="text-xl font-bold">Appeal points</h2>
          </div>
          <div className="space-y-3">
            {taxItem.appeals.map((appeal, index) => (
              <Link
                key={appeal.AppealId}
                href={`/meetings/case-details/tax-type-details/${appeal.AppealId}?caseId=${caseId}`}
                className="block"
              >
                <div className="flex items-center justify-between p-4 border rounded-lg bg-white shadow-sm hover:bg-gray-100 transition-colors">
                  <div className="flex items-center space-x-4">
                    <div className="flex items-center justify-center h-8 w-8 rounded-full bg-blue-600 text-white font-bold text-sm">
                      {index + 1}
                    </div>
                    <span className="font-medium">{appeal.appealPoint}</span>
                  </div>
                  {votedAppeals.includes(appeal.AppealId) && (
                    <CheckCircle2 className="h-6 w-6 text-green-500" />
                  )}
                </div>
              </Link>
            ))}
          </div>
        </CardContent>
      </Card>

      <Button onClick={() => router.back()} className="bg-[#18668D] hover:bg-[#134d66]">
        Back
      </Button>
    </div>
  );
}
</file>

<file path="frontend/src/components/ui/avatar.tsx">
"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"

import { cn } from "@/lib/utils"

function Avatar({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Root>) {
  return (
    <AvatarPrimitive.Root
      data-slot="avatar"
      className={cn(
        "relative flex size-8 shrink-0 overflow-hidden rounded-full",
        className
      )}
      {...props}
    />
  )
}

function AvatarImage({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Image>) {
  return (
    <AvatarPrimitive.Image
      data-slot="avatar-image"
      className={cn("aspect-square size-full", className)}
      {...props}
    />
  )
}

function AvatarFallback({
  className,
  ...props
}: React.ComponentProps<typeof AvatarPrimitive.Fallback>) {
  return (
    <AvatarPrimitive.Fallback
      data-slot="avatar-fallback"
      className={cn(
        "bg-muted flex size-full items-center justify-center rounded-full",
        className
      )}
      {...props}
    />
  )
}

export { Avatar, AvatarImage, AvatarFallback }
</file>

<file path="frontend/src/components/ui/button.tsx">
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default:
          "bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",
        destructive:
          "bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
        secondary:
          "bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",
        ghost:
          "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean
  }) {
  const Comp = asChild ? Slot : "button"

  return (
    <Comp
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Button, buttonVariants }
</file>

<file path="frontend/src/components/ui/calendar.tsx">
"use client"

import * as React from "react"
import {
  ChevronDownIcon,
  ChevronLeftIcon,
  ChevronRightIcon,
} from "lucide-react"
import { DayButton, DayPicker, getDefaultClassNames } from "react-day-picker"

import { cn } from "@/lib/utils"
import { Button, buttonVariants } from "@/components/ui/button"

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  captionLayout = "label",
  buttonVariant = "ghost",
  formatters,
  components,
  ...props
}: React.ComponentProps<typeof DayPicker> & {
  buttonVariant?: React.ComponentProps<typeof Button>["variant"]
}) {
  const defaultClassNames = getDefaultClassNames()

  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn(
        "bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",
        String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,
        String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,
        className
      )}
      captionLayout={captionLayout}
      formatters={{
        formatMonthDropdown: (date) =>
          date.toLocaleString("default", { month: "short" }),
        ...formatters,
      }}
      classNames={{
        root: cn("w-fit", defaultClassNames.root),
        months: cn(
          "flex gap-4 flex-col md:flex-row relative",
          defaultClassNames.months
        ),
        month: cn("flex flex-col w-full gap-4", defaultClassNames.month),
        nav: cn(
          "flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between",
          defaultClassNames.nav
        ),
        button_previous: cn(
          buttonVariants({ variant: buttonVariant }),
          "size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",
          defaultClassNames.button_previous
        ),
        button_next: cn(
          buttonVariants({ variant: buttonVariant }),
          "size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",
          defaultClassNames.button_next
        ),
        month_caption: cn(
          "flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",
          defaultClassNames.month_caption
        ),
        dropdowns: cn(
          "w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",
          defaultClassNames.dropdowns
        ),
        dropdown_root: cn(
          "relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",
          defaultClassNames.dropdown_root
        ),
        dropdown: cn(
          "absolute bg-popover inset-0 opacity-0",
          defaultClassNames.dropdown
        ),
        caption_label: cn(
          "select-none font-medium",
          captionLayout === "label"
            ? "text-sm"
            : "rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",
          defaultClassNames.caption_label
        ),
        table: "w-full border-collapse",
        weekdays: cn("flex", defaultClassNames.weekdays),
        weekday: cn(
          "text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",
          defaultClassNames.weekday
        ),
        week: cn("flex w-full mt-2", defaultClassNames.week),
        week_number_header: cn(
          "select-none w-(--cell-size)",
          defaultClassNames.week_number_header
        ),
        week_number: cn(
          "text-[0.8rem] select-none text-muted-foreground",
          defaultClassNames.week_number
        ),
        day: cn(
          "relative w-full h-full p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",
          defaultClassNames.day
        ),
        range_start: cn(
          "rounded-l-md bg-accent",
          defaultClassNames.range_start
        ),
        range_middle: cn("rounded-none", defaultClassNames.range_middle),
        range_end: cn("rounded-r-md bg-accent", defaultClassNames.range_end),
        today: cn(
          "bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",
          defaultClassNames.today
        ),
        outside: cn(
          "text-muted-foreground aria-selected:text-muted-foreground",
          defaultClassNames.outside
        ),
        disabled: cn(
          "text-muted-foreground opacity-50",
          defaultClassNames.disabled
        ),
        hidden: cn("invisible", defaultClassNames.hidden),
        ...classNames,
      }}
      components={{
        Root: ({ className, rootRef, ...props }) => {
          return (
            <div
              data-slot="calendar"
              ref={rootRef}
              className={cn(className)}
              {...props}
            />
          )
        },
        Chevron: ({ className, orientation, ...props }) => {
          if (orientation === "left") {
            return (
              <ChevronLeftIcon className={cn("size-4", className)} {...props} />
            )
          }

          if (orientation === "right") {
            return (
              <ChevronRightIcon
                className={cn("size-4", className)}
                {...props}
              />
            )
          }

          return (
            <ChevronDownIcon className={cn("size-4", className)} {...props} />
          )
        },
        DayButton: CalendarDayButton,
        WeekNumber: ({ children, ...props }) => {
          return (
            <td {...props}>
              <div className="flex size-(--cell-size) items-center justify-center text-center">
                {children}
              </div>
            </td>
          )
        },
        ...components,
      }}
      {...props}
    />
  )
}

function CalendarDayButton({
  className,
  day,
  modifiers,
  ...props
}: React.ComponentProps<typeof DayButton>) {
  const defaultClassNames = getDefaultClassNames()

  const ref = React.useRef<HTMLButtonElement>(null)
  React.useEffect(() => {
    if (modifiers.focused) ref.current?.focus()
  }, [modifiers.focused])

  return (
    <Button
      ref={ref}
      variant="ghost"
      size="icon"
      data-day={day.date.toLocaleDateString()}
      data-selected-single={
        modifiers.selected &&
        !modifiers.range_start &&
        !modifiers.range_end &&
        !modifiers.range_middle
      }
      data-range-start={modifiers.range_start}
      data-range-end={modifiers.range_end}
      data-range-middle={modifiers.range_middle}
      className={cn(
        "data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70",
        defaultClassNames.day,
        className
      )}
      {...props}
    />
  )
}

export { Calendar, CalendarDayButton }
</file>

<file path="frontend/src/components/ui/card.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn(
        "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",
        className
      )}
      {...props}
    />
  )
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
        className
      )}
      {...props}
    />
  )
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-title"
      className={cn("leading-none font-semibold", className)}
      {...props}
    />
  )
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
        className
      )}
      {...props}
    />
  )
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-content"
      className={cn("px-6", className)}
      {...props}
    />
  )
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-footer"
      className={cn("flex items-center px-6 [.border-t]:pt-6", className)}
      {...props}
    />
  )
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
}
</file>

<file path="frontend/src/components/ui/checkbox.tsx">
"use client"

import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { CheckIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Checkbox({
  className,
  ...props
}: React.ComponentProps<typeof CheckboxPrimitive.Root>) {
  return (
    <CheckboxPrimitive.Root
      data-slot="checkbox"
      className={cn(
        "peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <CheckboxPrimitive.Indicator
        data-slot="checkbox-indicator"
        className="flex items-center justify-center text-current transition-none"
      >
        <CheckIcon className="size-3.5" />
      </CheckboxPrimitive.Indicator>
    </CheckboxPrimitive.Root>
  )
}

export { Checkbox }
</file>

<file path="frontend/src/components/ui/dialog.tsx">
"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { XIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Dialog({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Root>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />
}

function DialogTrigger({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />
}

function DialogPortal({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Portal>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />
}

function DialogClose({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />
}

function DialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function DialogContent({
  className,
  children,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Content> & {
  showCloseButton?: boolean
}) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        {showCloseButton && (
          <DialogPrimitive.Close
            data-slot="dialog-close"
            className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4"
          >
            <XIcon />
            <span className="sr-only">Close</span>
          </DialogPrimitive.Close>
        )}
      </DialogPrimitive.Content>
    </DialogPortal>
  )
}

function DialogHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  )
}

function DialogFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className
      )}
      {...props}
    />
  )
}

function DialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  )
}

function DialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
}
</file>

<file path="frontend/src/components/ui/form.tsx">
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  FormProvider,
  useFormContext,
  useFormState,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState } = useFormContext()
  const formState = useFormState({ name: fieldContext.name })
  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

function FormItem({ className, ...props }: React.ComponentProps<"div">) {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div
        data-slot="form-item"
        className={cn("grid gap-2", className)}
        {...props}
      />
    </FormItemContext.Provider>
  )
}

function FormLabel({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  const { error, formItemId } = useFormField()

  return (
    <Label
      data-slot="form-label"
      data-error={!!error}
      className={cn("data-[error=true]:text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
}

function FormControl({ ...props }: React.ComponentProps<typeof Slot>) {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      data-slot="form-control"
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
}

function FormDescription({ className, ...props }: React.ComponentProps<"p">) {
  const { formDescriptionId } = useFormField()

  return (
    <p
      data-slot="form-description"
      id={formDescriptionId}
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function FormMessage({ className, ...props }: React.ComponentProps<"p">) {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message ?? "") : props.children

  if (!body) {
    return null
  }

  return (
    <p
      data-slot="form-message"
      id={formMessageId}
      className={cn("text-destructive text-sm", className)}
      {...props}
    >
      {body}
    </p>
  )
}

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}
</file>

<file path="frontend/src/components/ui/input.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Input({ className, type, ...props }: React.ComponentProps<"input">) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
        "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
        className
      )}
      {...props}
    />
  )
}

export { Input }
</file>

<file path="frontend/src/components/ui/label.tsx">
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"

import { cn } from "@/lib/utils"

function Label({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        "flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",
        className
      )}
      {...props}
    />
  )
}

export { Label }
</file>

<file path="frontend/src/components/ui/pagination.tsx">
import * as React from "react"
import {
  ChevronLeftIcon,
  ChevronRightIcon,
  MoreHorizontalIcon,
} from "lucide-react"

import { cn } from "@/lib/utils"
import { Button, buttonVariants } from "@/components/ui/button"

function Pagination({ className, ...props }: React.ComponentProps<"nav">) {
  return (
    <nav
      role="navigation"
      aria-label="pagination"
      data-slot="pagination"
      className={cn("mx-auto flex w-full justify-center", className)}
      {...props}
    />
  )
}

function PaginationContent({
  className,
  ...props
}: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="pagination-content"
      className={cn("flex flex-row items-center gap-1", className)}
      {...props}
    />
  )
}

function PaginationItem({ ...props }: React.ComponentProps<"li">) {
  return <li data-slot="pagination-item" {...props} />
}

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<React.ComponentProps<typeof Button>, "size"> &
  React.ComponentProps<"a">

function PaginationLink({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) {
  return (
    <a
      aria-current={isActive ? "page" : undefined}
      data-slot="pagination-link"
      data-active={isActive}
      className={cn(
        buttonVariants({
          variant: isActive ? "outline" : "ghost",
          size,
        }),
        className
      )}
      {...props}
    />
  )
}

function PaginationPrevious({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to previous page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pl-2.5", className)}
      {...props}
    >
      <ChevronLeftIcon />
      <span className="hidden sm:block">Previous</span>
    </PaginationLink>
  )
}

function PaginationNext({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to next page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pr-2.5", className)}
      {...props}
    >
      <span className="hidden sm:block">Next</span>
      <ChevronRightIcon />
    </PaginationLink>
  )
}

function PaginationEllipsis({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      aria-hidden
      data-slot="pagination-ellipsis"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontalIcon className="size-4" />
      <span className="sr-only">More pages</span>
    </span>
  )
}

export {
  Pagination,
  PaginationContent,
  PaginationLink,
  PaginationItem,
  PaginationPrevious,
  PaginationNext,
  PaginationEllipsis,
}
</file>

<file path="frontend/src/components/ui/select.tsx">
"use client"

import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { CheckIcon, ChevronDownIcon, ChevronUpIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Select({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Root>) {
  return <SelectPrimitive.Root data-slot="select" {...props} />
}

function SelectGroup({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Group>) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />
}

function SelectValue({
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Value>) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />
}

function SelectTrigger({
  className,
  size = "default",
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
  size?: "sm" | "default"
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  )
}

function SelectContent({
  className,
  children,
  position = "popper",
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",
          position === "popper" &&
            "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
          className
        )}
        position={position}
        {...props}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            "p-1",
            position === "popper" &&
              "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  )
}

function SelectLabel({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Label>) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn("text-muted-foreground px-2 py-1.5 text-xs", className)}
      {...props}
    />
  )
}

function SelectItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Item>) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",
        className
      )}
      {...props}
    >
      <span className="absolute right-2 flex size-3.5 items-center justify-center">
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  )
}

function SelectSeparator({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Separator>) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn("bg-border pointer-events-none -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function SelectScrollUpButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className
      )}
      {...props}
    >
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  )
}

function SelectScrollDownButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn(
        "flex cursor-default items-center justify-center py-1",
        className
      )}
      {...props}
    >
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  )
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
}
</file>

<file path="frontend/src/components/ui/shadcn-io/dropzone/index.tsx">
'use client';

import { UploadIcon } from 'lucide-react';
import type { ReactNode } from 'react';
import { createContext, useContext } from 'react';
import type { DropEvent, DropzoneOptions, FileRejection } from 'react-dropzone';
import { useDropzone } from 'react-dropzone';
import { Button } from '@/components/ui/button';
import { cn } from '@/lib/utils';

type DropzoneContextType = {
  src?: File[];
  accept?: DropzoneOptions['accept'];
  maxSize?: DropzoneOptions['maxSize'];
  minSize?: DropzoneOptions['minSize'];
  maxFiles?: DropzoneOptions['maxFiles'];
};

const renderBytes = (bytes: number) => {
  const units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB'];
  let size = bytes;
  let unitIndex = 0;

  while (size >= 1024 && unitIndex < units.length - 1) {
    size /= 1024;
    unitIndex++;
  }

  return `${size.toFixed(2)}${units[unitIndex]}`;
};

const DropzoneContext = createContext<DropzoneContextType | undefined>(
  undefined
);

export type DropzoneProps = Omit<DropzoneOptions, 'onDrop'> & {
  src?: File[];
  className?: string;
  onDrop?: (
    acceptedFiles: File[],
    fileRejections: FileRejection[],
    event: DropEvent
  ) => void;
  children?: ReactNode;
};

export const Dropzone = ({
  accept,
  maxFiles = 1,
  maxSize,
  minSize,
  onDrop,
  onError,
  disabled,
  src,
  className,
  children,
  ...props
}: DropzoneProps) => {
  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    accept,
    maxFiles,
    maxSize,
    minSize,
    onError,
    disabled,
    onDrop: (acceptedFiles, fileRejections, event) => {
      if (fileRejections.length > 0) {
        const message = fileRejections.at(0)?.errors.at(0)?.message;
        onError?.(new Error(message));
        return;
      }

      onDrop?.(acceptedFiles, fileRejections, event);
    },
    ...props,
  });

  return (
    <DropzoneContext.Provider
      key={JSON.stringify(src)}
      value={{ src, accept, maxSize, minSize, maxFiles }}
    >
      <Button
        className={cn(
          'relative h-auto w-full flex-col overflow-hidden p-8',
          isDragActive && 'outline-none ring-1 ring-ring',
          className
        )}
        disabled={disabled}
        type="button"
        variant="outline"
        {...getRootProps()}
      >
        <input {...getInputProps()} disabled={disabled} />
        {children}
      </Button>
    </DropzoneContext.Provider>
  );
};

const useDropzoneContext = () => {
  const context = useContext(DropzoneContext);

  if (!context) {
    throw new Error('useDropzoneContext must be used within a Dropzone');
  }

  return context;
};

export type DropzoneContentProps = {
  children?: ReactNode;
  className?: string;
};

const maxLabelItems = 3;

export const DropzoneContent = ({
  children,
  className,
}: DropzoneContentProps) => {
  const { src } = useDropzoneContext();

  if (!src) {
    return null;
  }

  if (children) {
    return children;
  }

  return (
    <div className={cn('flex flex-col items-center justify-center', className)}>
      <div className="flex size-8 items-center justify-center rounded-md bg-muted text-muted-foreground">
        <UploadIcon size={16} />
      </div>
      <p className="my-2 w-full truncate font-medium text-sm">
        {src.length > maxLabelItems
          ? `${new Intl.ListFormat('en').format(
              src.slice(0, maxLabelItems).map((file) => file.name)
            )} and ${src.length - maxLabelItems} more`
          : new Intl.ListFormat('en').format(src.map((file) => file.name))}
      </p>
      <p className="w-full text-wrap text-muted-foreground text-xs">
        Drag and drop or click to replace
      </p>
    </div>
  );
};

export type DropzoneEmptyStateProps = {
  children?: ReactNode;
  className?: string;
};

export const DropzoneEmptyState = ({
  children,
  className,
}: DropzoneEmptyStateProps) => {
  const { src, accept, maxSize, minSize, maxFiles } = useDropzoneContext();

  if (src) {
    return null;
  }

  if (children) {
    return children;
  }

  let caption = '';

  if (accept) {
    caption += 'Accepts ';
    caption += new Intl.ListFormat('en').format(Object.keys(accept));
  }

  if (minSize && maxSize) {
    caption += ` between ${renderBytes(minSize)} and ${renderBytes(maxSize)}`;
  } else if (minSize) {
    caption += ` at least ${renderBytes(minSize)}`;
  } else if (maxSize) {
    caption += ` less than ${renderBytes(maxSize)}`;
  }

  return (
    <div className={cn('flex flex-col items-center justify-center', className)}>
      <div className="flex size-8 items-center justify-center rounded-md bg-muted text-muted-foreground">
        <UploadIcon size={16} />
      </div>
      <p className="my-2 w-full truncate text-wrap font-medium text-sm">
        Upload {maxFiles === 1 ? 'a file' : 'files'}
      </p>
      <p className="w-full truncate text-wrap text-muted-foreground text-xs">
        Drag and drop or click to upload
      </p>
      {caption && (
        <p className="text-wrap text-muted-foreground text-xs">{caption}.</p>
      )}
    </div>
  );
};
</file>

<file path="frontend/src/components/ui/switch.tsx">
"use client"

import * as React from "react"
import * as SwitchPrimitive from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

function Switch({
  className,
  ...props
}: React.ComponentProps<typeof SwitchPrimitive.Root>) {
  return (
    <SwitchPrimitive.Root
      data-slot="switch"
      className={cn(
        "peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <SwitchPrimitive.Thumb
        data-slot="switch-thumb"
        className={cn(
          "bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0"
        )}
      />
    </SwitchPrimitive.Root>
  )
}

export { Switch }
</file>

<file path="frontend/src/components/ui/table.tsx">
"use client"

import * as React from "react"

import { cn } from "@/lib/utils"

function Table({ className, ...props }: React.ComponentProps<"table">) {
  return (
    <div
      data-slot="table-container"
      className="relative w-full overflow-x-auto"
    >
      <table
        data-slot="table"
        className={cn("w-full caption-bottom text-sm", className)}
        {...props}
      />
    </div>
  )
}

function TableHeader({ className, ...props }: React.ComponentProps<"thead">) {
  return (
    <thead
      data-slot="table-header"
      className={cn("[&_tr]:border-b", className)}
      {...props}
    />
  )
}

function TableBody({ className, ...props }: React.ComponentProps<"tbody">) {
  return (
    <tbody
      data-slot="table-body"
      className={cn("[&_tr:last-child]:border-0", className)}
      {...props}
    />
  )
}

function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn(
        "bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",
        className
      )}
      {...props}
    />
  )
}

function TableRow({ className, ...props }: React.ComponentProps<"tr">) {
  return (
    <tr
      data-slot="table-row"
      className={cn(
        "hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",
        className
      )}
      {...props}
    />
  )
}

function TableHead({ className, ...props }: React.ComponentProps<"th">) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        "text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCell({ className, ...props }: React.ComponentProps<"td">) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        "p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCaption({
  className,
  ...props
}: React.ComponentProps<"caption">) {
  return (
    <caption
      data-slot="table-caption"
      className={cn("text-muted-foreground mt-4 text-sm", className)}
      {...props}
    />
  )
}

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}
</file>

<file path="frontend/src/components/ui/textarea.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

function Textarea({ className, ...props }: React.ComponentProps<"textarea">) {
  return (
    <textarea
      data-slot="textarea"
      className={cn(
        "border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className
      )}
      {...props}
    />
  )
}

export { Textarea }
</file>

<file path="frontend/src/components/vote.tsx">
'use client';

import {
  Card,
  CardContent,
  CardHeader,
  CardTitle,
} from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Check, X, Clock } from 'lucide-react';

const VotePage = () => {
  return (
      <div>
        {/* Main Card */}
        <Card className='shadow-lg'>
          <CardHeader className='grid grid-cols-2 gap-4 border-b pb-4'>
            <CardTitle>Case Info</CardTitle>
            <CardTitle className='border-l pl-4'>Taxpayer Details</CardTitle>
          </CardHeader>
          <CardContent className='pt-6 grid grid-cols-2 gap-4'>
            {/* Case Info Section */}
            <div className='space-y-4 pr-4'>
              <div className='grid grid-cols-2'>
                <div className='text-sm text-gray-500'>Case ID</div>
                <div className='text-sm font-medium'>Cuid - 2023-12343</div>
              </div>
              <div className='grid grid-cols-2'>
                <div className='text-sm text-gray-500'>Tax Type</div>
                <div className='text-sm font-medium'>EBM Fines</div>
              </div>
              <div className='grid grid-cols-2'>
                <div className='text-sm text-gray-500'>Tax to be paid</div>
                <div className='text-sm font-semibold text-red-500'>300,000 frw</div>
              </div>
            </div>

            {/* Taxpayer Details Section */}
            <div className='space-y-4 border-l pl-4'>
              <div className='grid grid-cols-2'>
                <div className='text-sm text-gray-500'>Taxpayer Name</div>
                <div className='text-sm font-medium'>Tonie Justin</div>
              </div>
              <div className='grid grid-cols-2'>
                <div className='text-sm text-gray-500'>Taxpayer TIN</div>
                <div className='text-sm font-medium'>TIN-123456790</div>
              </div>
              <div className='grid grid-cols-2'>
                <div className='text-sm text-gray-500'>Tel</div>
                <div className='text-sm font-medium'>+(250) 567 567 789</div>
              </div>
            </div>
          </CardContent>
        </Card>

        {/* Action Buttons */}
        <div className='flex justify-center space-x-4 pt-4'>
          <Button variant='outline' className='flex items-center space-x-2 bg-gray-400 text-[#255069]'>
            <Clock className='h-4 w-4 text-gray-500' />
            <span>Abstain</span>
          </Button>
          <Button variant='destructive' className='flex items-center space-x-2'>
            <X className='h-4 w-4' />
            <span>Unjustify</span>
          </Button>
          <Button className='bg-green-600 hover:bg-green-700 flex items-center space-x-2'>
            <Check className='h-4 w-4' />
            <span>Justify</span>
          </Button>
        </div>
      </div>
  );
};

export default VotePage;
</file>

<file path="frontend/src/components/yourcases.tsx">
"use client";

import { useState, useEffect } from "react";
import Link from 'next/link';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import {
  Pagination,
  PaginationContent,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
} from "@/components/ui/pagination";
import api from "@/lib/api"; 

interface Case {
  caseId: string;
  taxPayer: string; 
  submittedAt: string;
  daysLeft: string;
  status: "SUBMITTED" | "DISCUSSED"; 
}

export default function YourCasesPage() {
  const [allCases, setAllCases] = useState<Case[]>([]);
  const [loading, setLoading] = useState<boolean>(true);
  const [error, setError] = useState<string | null>(null);

  const [searchQuery, setSearchQuery] = useState("");
  const [showFilters, setShowFilters] = useState(false);
  const [statusFilter, setStatusFilter] = useState("All");

  useEffect(() => {
    const fetchCases = async () => {
      try {
        setLoading(true);
        setError(null);
        const token = localStorage.getItem("staff_token");
        if (!token) {
          throw new Error("Authentication token not found. Please log in again.");
        }

        const response = await api.get("/api/v1/my-cases/my-cases", {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        });

        if (response.data && response.data.data) {
          setAllCases(response.data.data);
        } else {
          setAllCases([]);
        }
      } catch (err: any) {
        if (err.response) {
          setError(`Error: ${err.response.data.message || 'Failed to fetch cases.'}`);
        } else {
          setError(err.message || "An unknown error occurred.");
        }
        console.error(err);
      } finally {
        setLoading(false);
      }
    };

    fetchCases();
  }, []); 

  const handleFilterByStatus = (status: string) => {
    setStatusFilter(status);
  };

  const filteredCases = allCases.filter((_case) => {
    const matchesSearch =
      _case.caseId.toLowerCase().includes(searchQuery.toLowerCase()) ||
      _case.taxPayer.toLowerCase().includes(searchQuery.toLowerCase());

    const matchesStatus =
      statusFilter === "All" || _case.status === statusFilter;

    return matchesSearch && matchesStatus;
  });

  const getStatusStyle = (status: string) => {
    switch (status) {
      case "SUBMITTED":
        return "bg-blue-100 text-blue-800";
      case "DISCUSSED":
        return "bg-green-100 text-green-800";
      default:
        return "bg-gray-100 text-gray-800";
    }
  };

  return (
    <div className="container mx-auto p-4 max-w-4xl">
      <div className="space-y-2 mb-8">
        <h1 className="text-3xl font-bold">Your cases</h1>
        <p className="text-gray-600">Track explanatory note for each of your case</p>
      </div>

      <div className="flex items-center space-x-2 mb-4 ">
        <Input
          placeholder="Search by Case ID or TIN..."
          className="max-w-xs flex-grow bg-white"
          value={searchQuery}
          onChange={(e) => setSearchQuery(e.target.value)}
        />
        <Button
          variant="outline"
          size="icon"
          className="h-10 w-10"
          onClick={() => setShowFilters(!showFilters)}
        >
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5">
            <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
        </Button>
      </div>
      
      {showFilters && (
        <div className="rounded-lg border p-4 mb-4 bg-white">
          <h3 className="font-semibold mb-2 ">Filter by Status</h3>
          <div className="flex space-x-2">
            <Button variant="secondary" className="hover:bg-[#18668D] hover:text-white" onClick={() => handleFilterByStatus("All")}>All</Button>
            <Button variant="secondary" className="hover:bg-[#18668D] hover:text-white" onClick={() => handleFilterByStatus("SUBMITTED")}>Submitted</Button>
            <Button variant="secondary" className="hover:bg-[#18668D] hover:text-white" onClick={() => handleFilterByStatus("DISCUSSED")}>Discussed</Button>
          </div>
        </div>
      )}

      <div className="rounded-lg border bg-white">
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>Case ID</TableHead>
              <TableHead>Tax Payer TIN</TableHead>
              <TableHead>Submitted At</TableHead>
              <TableHead>Days left</TableHead>
              <TableHead>Explanatory note</TableHead>
              <TableHead>Status</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {loading ? (
              <TableRow>
                <TableCell colSpan={6} className="h-24 text-center">
                  Loading cases...
                </TableCell>
              </TableRow>
            ) : error ? (
              <TableRow>
                <TableCell colSpan={6} className="h-24 text-center text-red-600">
                  {error}
                </TableCell>
              </TableRow>
            ) : filteredCases.length > 0 ? (
              filteredCases.map((_case, index) => (
                <TableRow key={index}>
                  <TableCell className="font-medium">{_case.caseId}</TableCell>
                  <TableCell>{_case.taxPayer}</TableCell>
                  <TableCell>{_case.submittedAt}</TableCell>
                  <TableCell>{_case.daysLeft} days</TableCell>
                  <TableCell className="text-blue-600 underline cursor-pointer">
                    <Link href={`/cases/new-case?editCaseId=${_case.caseId}`}>
                      view note
                    </Link>
                  </TableCell>
                  <TableCell>
                    <span className={`px-2 py-1 rounded-full text-xs font-semibold ${getStatusStyle(_case.status)}`}>
                      {_case.status}
                    </span>
                  </TableCell>
                </TableRow>
              ))
            ) : (
              <TableRow>
                <TableCell colSpan={6} className="h-24 text-center">
                  No cases found.
                </TableCell>
              </TableRow>
            )}
          </TableBody>
        </Table>
      </div>

      <div className="flex justify-between items-center mt-4 text-sm text-gray-500">
        <span>Showing {filteredCases.length} of {allCases.length} cases</span>
        <Pagination className="w-auto mx-0">
          <PaginationContent>
            <PaginationItem>
              <PaginationPrevious href="#" />
            </PaginationItem>
            <PaginationItem>
              <PaginationLink href="#" isActive>
                1
              </PaginationLink>
            </PaginationItem>
            <PaginationItem>
              <PaginationNext href="#" />
            </PaginationItem>
          </PaginationContent>
        </Pagination>
      </div>
    </div>
  );
}
</file>

<file path="frontend/src/lib/api.ts">
// frontend/src/lib/api.ts

import axios from "axios";

const api = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL,
  headers: {
    "Content-Type": "application/json",
  },
  withCredentials: true, // Include cookies for cross-origin requests
});

// Request Interceptor: Attaches the access token to every outgoing request.
api.interceptors.request.use(
  (config) => {
    if (typeof window !== "undefined") {
      // Skip for auth endpoints
      const authEndpoints = ['/api/v1/auth/login', '/api/v1/auth/refresh-token'];
      if (!authEndpoints.some(endpoint => config.url.includes(endpoint))) {
        const token = localStorage.getItem("staff_token");
        if (token) {
          config.headers.Authorization = `Bearer ${token}`;
        }
      }
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// Response Interceptor: The core logic for handling token expiration.
api.interceptors.response.use(
  (response) => {
    // If the request was successful, just return the response.
    return response;
  },
  async (error) => {
    const originalRequest = error.config;
        const isMeetingAuthEndpoint = originalRequest.url.includes('/api/v1/meetings/create');


    // Check if the error is due to an expired access token (e.g., a 401 or 500 error from the filter)
    // and that we haven't already tried to refresh the token for this request.
    if (error.response?.status === 401 && !originalRequest._retry && !isMeetingAuthEndpoint) {
      originalRequest._retry = true; // Mark the request to prevent infinite retry loops.

      try {
        const refreshToken = localStorage.getItem("staff_refresh_token");

        // If there's no refresh token, the user must log in.
        if (!refreshToken) {
          localStorage.clear();
          window.location.href = '/staff-login';
          return Promise.reject(new Error("No refresh token available."));
        }

        // Attempt to get a new access token using the refresh token.
        const response = await axios.post(
          `${process.env.NEXT_PUBLIC_API_URL}/api/v1/auth/refresh-token`,
          { refreshToken: refreshToken }
        );
        
        const { accessToken: newAccessToken, refreshToken: newRefreshToken } = response.data;

        // If successful, update the tokens in local storage.
        localStorage.setItem("staff_token", newAccessToken);
        localStorage.setItem("staff_refresh_token", newRefreshToken);

        // Update the header on the original request and retry it.
        originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;
        return api(originalRequest);
        
      } catch (refreshError) {
        // THIS IS THE CRITICAL BLOCK FOR YOUR REQUIREMENT
        // This block will execute if the refresh token API call fails for ANY reason.
        
        console.error("Refresh token is invalid or expired. Logging out.", refreshError);

        // 1. Delete all tokens (access and refresh) from local storage.
        localStorage.clear(); 

        // 2. Redirect the user to the login page to start over.
        window.location.href = '/staff-login'; 

        // 3. Reject the promise to stop the original failed request.
        return Promise.reject(refreshError);
      }
    }

    // For any other errors, just pass them along.
    return Promise.reject(error);
  }
);

export default api;
</file>

<file path="frontend/src/lib/firebase.ts">
import { initializeApp, getApps, getApp } from "firebase/app";
import { getStorage } from "firebase/storage";

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,
  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,
  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,
  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,
  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,
};

// Initialize Firebase
const app = !getApps().length ? initializeApp(firebaseConfig) : getApp();
const storage = getStorage(app);

export { app, storage };
</file>

<file path="frontend/src/lib/utils.ts">
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
</file>

<file path="frontend/tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
</file>

<file path="README.md">
# Tax Appeal Management System

![RRA Logo](frontend/public/Rralogo.png)

This is a full-stack web application designed to streamline the tax appeal process for the Rwanda Revenue Authority (RRA). It provides a comprehensive platform for managing tax appeal cases, scheduling meetings, conducting votes, and generating reports, with specific functionalities tailored to different user roles within the committee.

## Table of Contents

- [Features](#features)
- [User Roles](#user-roles)
- [Tech Stack](#tech-stack)
- [Getting Started](#getting-started)
  - [Prerequisites](#prerequisites)
  - [Backend Setup](#backend-setup)
  - [Frontend Setup](#frontend-setup)
- [Running the Application](#running-the-application)
- [API Documentation](#api-documentation)

## Features

- **Case Management**: Submit, view, edit, and delete tax appeal cases.
- **Role-Based Access Control**: Different user roles (Committee Leader, Committee Member) have tailored permissions and views.
- **Meeting Scheduling**: Seamless integration with Google Calendar for creating and managing meeting schedules.
- **Voting System**: A secure and efficient voting mechanism for committee members to decide on appeal cases, with vote tracking for leaders.
- **Analytics Dashboard**: Committee Leaders have access to a dashboard with key metrics and visualizations of case data and member attendance.
- **Report Generation**: Automatically generate formatted PDF reports for meeting minutes and explanatory notes.
- **Secure Authentication**: JWT-based authentication with refresh tokens ensures secure and persistent user sessions.
- **File Uploads**: Attach relevant documents to cases using Firebase Storage.

## User Roles

The application supports the following user roles:

- **COMMITTEE_MEMBER**:
  - Can view assigned meeting agendas and case details.
  - Can participate in voting on appeal points.
  - Has a personalized profile page to manage availability.
- **COMMITTEE_LEADER**:
  - Has all the permissions of a `COMMITTEE_MEMBER`.
  - Access to an exclusive `/admin` dashboard with analytics on cases and member attendance.
  - Can manage and override the availability status of committee members.
  - Can initiate video meetings through Google Meet.
  - Can edit meeting invitation templates.

## Tech Stack

### Backend

- **Java 21**
- **Spring Boot 3**: Framework for building the REST APIs.
- **Spring Security**: For authentication and role-based authorization.
- **JPA (Hibernate)**: For object-relational mapping and database interaction.
- **PostgreSQL**: Relational database for data storage.
- **Maven**: Dependency management.
- **JWT**: For secure token-based authentication.
- **Swagger/OpenAPI**: For API documentation.
- **Google Calendar API**: For scheduling and meeting integration.
- **Docker**: For containerization.

### Frontend

- **Next.js 15**: React framework for building the user interface.
- **TypeScript**: For type-safe JavaScript development.
- **Tailwind CSS**: For styling the application.
- **shadcn/ui**: Re-usable UI components.
- **React Hook Form**: For managing form state.
- **Zod**: For schema validation.
- **Axios**: For making HTTP requests to the backend.
- **Firebase Storage**: For file uploads and attachments.

## Getting Started

Follow these instructions to set up and run the project locally.

### Prerequisites

- **Java JDK 21** or later
- **Maven 3.8** or later
- **Node.js 20.x** or later
- **PostgreSQL** database
- **Docker** and **Docker Compose** (Optional, for running PostgreSQL)
- A registered **Google Cloud Platform** project with the Calendar API enabled and OAuth 2.0 credentials.

### Backend Setup

1.  **Clone the repository:**
    ```bash
    git clone <repository-url>
    cd <repository-folder>/backend/Tax_appeal_system
    ```

2.  **Configure the Database:**
    - If using Docker, you can start a PostgreSQL container from the `Tax_appeal_system` directory:
      ```bash
      docker-compose up -d db
      ```
    - Create a database named `tax_claim_system`.

3.  **Configure Application Properties:**
    - Navigate to `src/main/resources/` and open the `application.properties` file.
    - Update the `spring.datasource.*` properties to match your PostgreSQL setup.
    - Configure your `spring.mail.*` properties for email notifications.
    - Add your Google OAuth2 client ID and secret.
    - Set a `JWT_SECRET`.

4.  **Install Dependencies and Build:**
    ```bash
    mvn clean install
    ```

### Frontend Setup

1.  **Navigate to the frontend directory:**
    ```bash
    cd ../../frontend
    ```

2.  **Install dependencies:**
    ```bash
    npm install
    ```

3.  **Configure Environment Variables:**
    - Create a `.env.local` file in the `frontend` directory.
    - Add the following variables, pointing to your backend API and Firebase configuration:
      ```env
      NEXT_PUBLIC_API_URL=http://localhost:8084
      
      # Firebase Configuration
      NEXT_PUBLIC_FIREBASE_API_KEY=your_api_key
      NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your_auth_domain
      NEXT_PUBLIC_FIREBASE_PROJECT_ID=your_project_id
      NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=your_storage_bucket
      NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
      NEXT_PUBLIC_FIREBASE_APP_ID=your_app_id
      ```

## Running the Application

1.  **Start the Backend:**
    - From the `backend/Tax_appeal_system` directory, run:
      ```bash
      mvn spring-boot:run
      ```
    - The backend will start on `http://localhost:8084`.

2.  **Start the Frontend:**
    - From the `frontend` directory, run:
      ```bash
      npm run dev
      ```
    - The frontend will be accessible at `http://localhost:3000`.

3.  **Access the Application:**
    - Open your browser and navigate to `http://localhost:3000`. You will be redirected to the staff login page.

## API Documentation

Once the backend is running, the API documentation, powered by Swagger UI, is available at:
[http://localhost:8084/swagger-ui/index.html](http://localhost:8084/swagger-ui/index.html)
</file>

</files>
